(window["webpackJsonp_service"]=window["webpackJsonp_service"]||[]).push([["chunk-29c4d5f3"],{"2fc2":function(t,e,a){},4997:function(t,e,a){"use strict";a.d(e,"a",(function(){return c}));var i=a("1da1"),s=a("ade3"),n=a("d4ec"),o=a("bee2"),r=(a("96cf"),a("d3b7"),a("25f0"),a("159b"),a("4de4"),a("caad"),a("2532"),a("4360"));function l(t){if("function"===typeof t&&t().then)return!0}var c=function(){function t(e){Object(n["a"])(this,t),this._this=e._this,this.addr=[],this.indexSign=null,this.URL=e.url,this.id=e.id,this.errId=e.errId?e.errId:e.id,this.title=e.title?e.title:"审核",this.allTitle=e.allTitle,this.params=e.params,this.before=e.before,this.checkbox=null,this.Data=null,this.showConfirm=e.showConfirm,this.callbackFunc=e.callbackFunc}return Object(o["a"])(t,[{key:"verify",value:function(){return!(this._this.multipleSelection.length<1)||(this._this.$message({message:"请选择需要".concat(this.title,"的信息"),type:"warning"}),!1)}},{key:"confirm",value:function(){var t="确定要“"+this.title+"”此条信息?";return this.allTitle&&(t=this.allTitle),this._this.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}},{key:"sendAjax",value:function(t,e,a){var i,n=this,o=Object.assign(Object(s["a"])({},this.id,t),this.params);this._this.$axMethod[this.URL]?i=this._this.$axMethod[this.URL](o):this._this.$api[this.URL]&&(i=this._this.$axios({url:this._this.$api[this.URL],method:"post",data:o})),i.then((function(t){n.checkbox=n._this.multipleSelection,n.callbackFunc&&n.callbackFunc(t.data),200==t.data.code?(e(t),n.Data=t):a(t)})).catch((function(t){a(t)}))}},{key:"logic",value:function(){var t=this;if(!this.verify())return!1;for(var e=0;e<this._this.multipleSelection.length;e++)this.addr.push(this._this.multipleSelection[e][this.id]);var a=this.addr.toString();return new Promise((function(e,i){if(1==t.showConfirm)t.confirm().then((function(){if(l(t.before))t.before(a).then((function(){return t.sendAjax(a,e,i)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(a,e,i)}));else if(l(t.before))t.before(a).then((function(){return t.sendAjax(a,e,i)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(a,e,i)}))}},{key:"send",value:function(){var t=this;this.logic().then((function(e){var a=e.data;200===a.code&&(t._this.$message.success(a.msg?a.msg:a.data),t._this.onSearch&&t._this.onSearch())}))}},{key:"callback",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.logic();case 3:this.Data&&this.Data.data&&this.Data.data.data.length?(e=this.Data.data.data,a=[],e.forEach((function(t){a.push(t.serial)})),i=this.checkbox.filter((function(t){return 1==a.includes(t[n.errId])})),this._this.indexSign.arr=i,this._this.indexSign.str=this.errId,r["a"].commit("setErrorObj",{msg:this.Data.data.msg,table:this.Data.data.data,state:!0})):(s=this.Data.data.msg?this.Data.data.msg:this.Data.data.data,this._this.indexSign.arr=[],this._this.$message({message:s,type:"success"}),this._this.multipleSelection=[],this._this.onSearch&&this._this.onSearch()),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.log();case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));function e(){return t.apply(this,arguments)}return e}()}]),t}()},8529:function(t,e,a){"use strict";a("d0c4")},9126:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"companyGoods_base"},[a("div",{attrs:{id:"leixin"}},[a("div",{staticClass:"search_container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.params}},[a("el-form-item",{attrs:{label:"组织名称",size:"mini"}},[a("getServiceCompany",{attrs:{fatherParams:t.params},model:{value:t.params.company_id,callback:function(e){t.$set(t.params,"company_id",e)},expression:"params.company_id"}})],1),a("el-form-item",{attrs:{label:"单据号",size:"mini"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.params.outstock_sn,callback:function(e){t.$set(t.params,"outstock_sn",e)},expression:"params.outstock_sn"}})],1),a("el-form-item",{attrs:{label:"选择客户",size:"mini"}},[a("getServiceUser",{model:{value:t.params.customer_id,callback:function(e){t.$set(t.params,"customer_id",e)},expression:"params.customer_id"}})],1),a("el-form-item",{attrs:{label:"单据状态",size:"mini"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.params.auditor_status,callback:function(e){t.$set(t.params,"auditor_status",e)},expression:"params.auditor_status"}},[a("el-option",{attrs:{label:"全部",value:0}}),a("el-option",{attrs:{label:"已出库",value:2}}),a("el-option",{attrs:{label:"未出库",value:1}}),a("el-option",{attrs:{label:"作废",value:3}})],1)],1),a("el-form-item",{attrs:{label:"单据类型",size:"mini"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.params.is_erp,callback:function(e){t.$set(t.params,"is_erp",e)},expression:"params.is_erp"}},[a("el-option",{attrs:{label:"全部",value:""}}),a("el-option",{attrs:{label:"手动创建",value:2}}),a("el-option",{attrs:{label:"小程序推送",value:1}})],1)],1),a("el-form-item",{attrs:{label:"结算状态",size:"mini"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.params.pay_status,callback:function(e){t.$set(t.params,"pay_status",e)},expression:"params.pay_status"}},[a("el-option",{attrs:{label:"全部",value:0}}),a("el-option",{attrs:{label:"挂账",value:1}}),a("el-option",{attrs:{label:"完成付款",value:2}}),a("el-option",{attrs:{label:"已作废",value:3}})],1)],1),a("el-form-item",{attrs:{label:"单据日期",size:"mini"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.timeValue,callback:function(e){t.timeValue=e},expression:"timeValue"}})],1),a("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.onSearch}},[t._v("查询")]),a("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.onReset}},[t._v("重置")])],1)],1)],1),a("div",{staticClass:"add_delet"},[1==t.authority.b_add?a("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:t.add}},[t._v("新增 ")]):t._e()],1)]),a("div",{staticClass:"add_delet"}),a("div",{staticClass:"table_container"},[a("xTable",{ref:"xTable",attrs:{ajax:{url:"serviceStationGetSalesOutList",params:t.params},footerMethod:t.footerMethod,tableColumn:t.tableColumn},on:{getData:t.dealData}})],1),a("collection",{attrs:{data:t.currentRow},on:{success:t.onSearch},model:{value:t.isShowCollection,callback:function(e){t.isShowCollection=e},expression:"isShowCollection"}}),a("lodopDelivery",{ref:"lodopDelivery",attrs:{title:"serviceOutbound"},on:{Search:t.onSearch}})],1)},s=[],n=a("4997"),o=(a("d81d"),a("caad"),{outstock_sn:"",customer_id:"",company_id:localStorage.getItem("company_id"),company_name:localStorage.getItem("company_name"),auditor_status:0,is_erp:"",pay_status:0,business_start_time:"",business_end_time:""}),r={data:function(){var t=this,e=this.$createElement;return{footerData:{},tableColumn:[{title:"销售组织",field:"company_name",width:160},{title:"单据号",field:"outstock_sn",width:160,slots:{default:function(a){var i=a.row;return[e("el-link",{attrs:{disabled:1!=t.authority.b_info},on:{click:function(){t.goDetail(i)}}},["  ",i.outstock_sn," "])]}}},{title:"客户名称",field:"customer_name",width:80},{field:"name",title:"操作",width:180,align:"center",fixed:"right",slots:{default:function(a){var i=a.row;return[e("el-button",{attrs:{size:"small",type:"text",disabled:1!=t.authority.b_price||"完成付款"===i.pay_status||"已作废"===i.pay_status},on:{click:function(){t.openCollection(i)}}},["  收款 "]),e("el-button",{attrs:{size:"small",type:"text",disabled:1!=t.authority.b_pass||"手动创建"==i.add_status||"已出库"===i.auditor_status||"作废"===i.auditor_status},on:{click:function(){t.add(i)}}},["  出库 "]),e("el-button",{attrs:{size:"small",type:"text",disabled:1!=t.authority.b_invalid||"作废"===i.auditor_status},on:{click:function(){t.invalid(i)}}},["  作废 "]),e("el-button",{attrs:{size:"small",type:"text",disabled:1!=t.authority.b_print},on:{click:function(){t.print(i)}}},["  打印 "])]}}},{title:"出库数量",field:"outstock_num",headerAlign:"right",align:"right",width:84},{title:"优惠金额",field:"discount_total_amount",headerAlign:"right",align:"right",width:84},{title:"应收金额",field:"settlement_price",headerAlign:"right",align:"right",width:84},{title:"已收金额",field:"pay_price",headerAlign:"right",align:"right",width:84},{title:"单据状态",field:"auditor_status",width:84},{title:"单据类型",field:"add_status",width:84},{title:"结算状态",field:"pay_status",width:84},{title:"单据时间",field:"add_time_name",width:160,formatter:function(e){var a=e.row;return t.$publicFution.getAllTime(1e3*a.add_time)}},{title:"备注",field:"abstract"}]}},methods:{openCollection:function(t){this.currentRow=t,this.isShowCollection=!0},dealData:function(t){200===t.data.code&&(this.footerData=t.data.data.desc)},initParams:function(){this.$route.params&&this.$route.params.type&&(this.params.auditor_status=1,this.onSearch(1))},footerMethod:function(t){var e=this,a=t.columns,i=t.data;return[a.map((function(t,a){if(0===a)return"页小计";if(["settlement_price","outstock_num","pay_price","discount_total_amount"].includes(t.property)){var s=e.$utils.sum(i,t.property);return"outstock_num"===t.property?e.$publicFution.priceFormatNone(s,0):e.$publicFution.priceFormatNone(s)}return null})),a.map((function(t,a){if(0===a)return"合计";var s=e.$utils.sum(i,t.property);return"outstock_num"===t.property&&void 0!==e.footerData.total_num?e.$publicFution.priceFormatNone(s,0):"settlement_price"===t.property&&void 0!==e.footerData.total_settlement_price||"pay_price"===t.property&&void 0!==e.footerData.total_pay_price||"discount_total_amount"===t.property&&void 0!==e.footerData.total_discount_total_amount?e.$publicFution.priceFormatNone(s,2):["settlement_price","outstock_num","pay_price","discount_total_amount"].includes(t.property)?"加载中...":null}))]}}},l=a("78d2"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"params"},[a("vxe-modal",{attrs:{title:"销售出库收款",width:"800","esc-closable":!0,"destroy-on-close":"",height:"300","min-width":"600","min-height":"100",resize:"",remember:"",storage:"",transfer:""},on:{hide:t.close},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[a("div",[a("el-row",[a("el-col",{attrs:{span:12}},[t._v(" 销售组织： "+t._s(t.data.company_name)+" ")]),a("el-col",{attrs:{span:12}},[t._v(" 单据号： "+t._s(t.data.outstock_sn)+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[t._v(" 客户名称： "+t._s(t.data.customer_name)+" ")]),a("el-col",{attrs:{span:12}},[t._v(" 出库数量： "+t._s(t.data.outstock_num)+" ")])],1),a("el-row",[a("el-col",{attrs:{span:12}},[t._v(" 已收金额： "+t._s(t.data.pay_price)+" ")])],1),a("div",{staticClass:"line"}),a("div",[t._v(" 本次收款： "),a("span",[a("el-input",{staticStyle:{width:"100px"},on:{change:t.payPriceChange},model:{value:t.pay_price,callback:function(e){t.pay_price=e},expression:"pay_price"}},[a("span",{staticClass:"el-input__icon",attrs:{slot:"suffix"},slot:"suffix"},[t._v("元")])])],1),t._v("     "),a("span",[t._v("欠款： "+t._s((t.data.settlement_price-t.data.pay_price).toFixed(2))+" 元")])])],1),a("div",{staticClass:"line",staticStyle:{"margin-top":"40px"}}),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确定")]),a("el-button",{on:{click:t.close}},[t._v("取 消")])],1)])],1)},u=[],d={data:function(){return{pay_price:""}},props:{value:null,data:{type:Object,default:function(){}}},methods:{payPriceChange:function(){this.pay_price<0&&(this.$message.warning("本次收款不能小于0"),this.pay_price=""),this.pay_price>this.data.settlement_price-this.data.pay_price&&(this.$message.warning("本次收款不能大于总金额"),this.pay_price="")},close:function(){this.$emit("input",!1)},submit:function(){var t=this;this.pay_price>=0&&""!=this.pay_price&&this.$api.serviceStationSalesOutPayPrice({outstock_id:this.data.outstock_id,pay_price:this.pay_price}).then((function(e){var a=e.data;200==a.code&&(t.$message.success(a.msg),t.$emit("success"),t.close())}))}}},p=d,h=(a("8529"),a("2877")),m=Object(h["a"])(p,c,u,!1,null,"8bf2d8f0",null),_=m.exports,f={name:"service_station_sales_outstock_list",mixins:[r],data:function(){return{isShowCollection:!1,currentRow:{},multipleSelection:[],params:this.$publicFution.deepCopy(o),timeValue:[]}},components:{collection:_,lodopDelivery:l["a"]},methods:{print:function(t){this.$refs.lodopDelivery.printPdf({outstock_id:t.outstock_id})},invalid:function(t){this.multipleSelection=[t],new n["a"]({id:"outstock_id",_this:this,allTitle:"是否要作废销售出库单，并同时作废该出库单的已收金额？",url:"serviceStationaBolishSalesOut",showConfirm:!0}).send()},goDetail:function(t){this.$router.push({path:"/sales/service_station_sales_outstock_list/service_station_sales_outstock_see",query:{id:t.outstock_id}})},add:function(t){this.$router.push({path:"/sales/service_station_sales_outstock_list/service_station_sales_outstock_add",query:{id:t.outstock_id}})},onReset:function(){this.params=this.$publicFution.deepCopy(o),this.timeValue=[],this.onSearch(1)},deletes:function(){new n["a"]({id:"inventory_goods_id",_this:this,title:"删除",url:"serviceStationDelCompanyGoods",showConfirm:!0}).send()},exportOrder:function(t){var e=Object.assign(this.params,{export_type:t});this.$api.serviceStationExportGoodsUrl(e).then((function(t){200==t.data.code&&(window.location.href=t.data.data.url)}))},onSearch:function(t){Array.isArray(this.timeValue)?(this.params.business_start_time=this.timeValue[0],this.params.business_end_time=this.timeValue[1]):(this.params.business_start_time="",this.params.business_end_time=""),this.$refs.xTable._getData(t)}},activated:function(){this.initParams()}},b=f,v=(a("a92e"),Object(h["a"])(b,i,s,!1,null,"1c9b70f4",null));e["default"]=v.exports},a92e:function(t,e,a){"use strict";a("2fc2")},d0c4:function(t,e,a){}}]);
//# sourceMappingURL=chunk-29c4d5f3.7d2d04a4.js.map