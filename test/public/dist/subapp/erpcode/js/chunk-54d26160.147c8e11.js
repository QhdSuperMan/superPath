(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-54d26160"],{"8ba4":function(t,e,a){var i=a("23e7"),n=a("eac5");i({target:"Number",stat:!0},{isInteger:n})},b680:function(t,e,a){"use strict";var i=a("23e7"),n=a("da84"),r=a("e330"),l=a("5926"),o=a("408a"),s=a("1148"),u=a("d039"),p=n.RangeError,c=n.String,d=Math.floor,m=r(s),h=r("".slice),f=r(1..toFixed),_=function(t,e,a){return 0===e?a:e%2===1?_(t,e-1,a*t):_(t*t,e/2,a)},b=function(t){var e=0,a=t;while(a>=4096)e+=12,a/=4096;while(a>=2)e+=1,a/=2;return e},v=function(t,e,a){var i=-1,n=a;while(++i<6)n+=e*t[i],t[i]=n%1e7,n=d(n/1e7)},g=function(t,e){var a=6,i=0;while(--a>=0)i+=t[a],t[a]=d(i/e),i=i%e*1e7},y=function(t){var e=6,a="";while(--e>=0)if(""!==a||0===e||0!==t[e]){var i=c(t[e]);a=""===a?i:a+m("0",7-i.length)+i}return a},w=u((function(){return"0.000"!==f(8e-5,3)||"1"!==f(.9,0)||"1.25"!==f(1.255,2)||"1000000000000000128"!==f(0xde0b6b3a7640080,0)}))||!u((function(){f({})}));i({target:"Number",proto:!0,forced:w},{toFixed:function(t){var e,a,i,n,r=o(this),s=l(t),u=[0,0,0,0,0,0],d="",f="0";if(s<0||s>20)throw p("Incorrect fraction digits");if(r!=r)return"NaN";if(r<=-1e21||r>=1e21)return c(r);if(r<0&&(d="-",r=-r),r>1e-21)if(e=b(r*_(2,69,1))-69,a=e<0?r*_(2,-e,1):r/_(2,e,1),a*=4503599627370496,e=52-e,e>0){v(u,0,a),i=s;while(i>=7)v(u,1e7,0),i-=7;v(u,_(10,i,1),0),i=e-1;while(i>=23)g(u,1<<23),i-=23;g(u,1<<i),v(u,1,1),g(u,2),f=y(u)}else v(u,0,a),v(u,1<<-e,0),f=y(u)+m("0",s);return s>0?(n=f.length,f=d+(n<=s?"0."+m("0",s-n)+f:h(f,0,n-s)+"."+h(f,n-s))):f=d+f,f}})},c6b5:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"params"},[a("div",{attrs:{id:"leixin"}},[a("div",{staticClass:"search_container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.params}},[a("el-form-item",{attrs:{label:"采购组织",size:"mini"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",maxlength:"100"},on:{focus:t.companyListInvok,change:t.companyChange},model:{value:t.params.company_id,callback:function(e){t.$set(t.params,"company_id",e)},expression:"params.company_id"}},t._l(t.companyList,(function(e){return a("el-option",{key:e.company_id,attrs:{label:e.company_name,value:e.company_id}},[a("span",{class:1==e.type?"optionStyle":""},[t._v(t._s(e.company_name))])])})),1)],1),a("el-form-item",{attrs:{label:"采购部门",size:"mini"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",maxlength:"100"},on:{change:t.departmentChange,focus:t.DepartmentListInvok},model:{value:t.params.department_id,callback:function(e){t.$set(t.params,"department_id",e)},expression:"params.department_id"}},t._l(t.departmentList,(function(t){return a("el-option",{key:t.department_id,attrs:{label:t.department_name,value:t.department_id}})})),1)],1),a("el-form-item",{attrs:{label:"供应商(厂家)",size:"mini"}},[a("el-select",{attrs:{clearable:"","filter-method":t.supplierListInvok,filterable:"",placeholder:"请选择"},on:{change:t.supplierChange,focus:t.supplierListInvok},model:{value:t.params.supplier_id,callback:function(e){t.$set(t.params,"supplier_id",e)},expression:"params.supplier_id"}},t._l(t.supplierList,(function(t){return a("el-option",{key:t.supplier_id,attrs:{label:t.supplier_name,value:t.supplier_id}})})),1)],1),a("el-form-item",{attrs:{label:"单据日期",size:"mini"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.timeValue,callback:function(e){t.timeValue=e},expression:"timeValue"}})],1),a("el-form-item",{attrs:{label:"单据号",size:"mini"}},[a("el-input",{attrs:{maxlength:"100",placeholder:"请输入",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch(1)}},model:{value:t.params.plan_sn,callback:function(e){t.$set(t.params,"plan_sn",e)},expression:"params.plan_sn"}})],1),a("el-form-item",{attrs:{label:"审核状态",size:"mini"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.params.auditor_status,callback:function(e){t.$set(t.params,"auditor_status",e)},expression:"params.auditor_status"}},[a("el-option",{attrs:{label:"全部",value:0}},[t._v("全部")]),a("el-option",{attrs:{label:"未审核",value:1}},[t._v("未审核")]),a("el-option",{attrs:{label:"部分审核",value:4}},[t._v("部分审核")]),a("el-option",{attrs:{label:"已审核",value:2}},[t._v("已审核")]),a("el-option",{attrs:{label:"作废",value:3}},[t._v("作废")])],1)],1),a("el-form-item",{attrs:{label:"收货状态",size:"mini"}},[a("receivingStatus",{model:{value:t.params.delivery_status,callback:function(e){t.$set(t.params,"delivery_status",e)},expression:"params.delivery_status"}})],1),a("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.onSearch(1)}}},[t._v("查询")]),a("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.onReset}},[t._v("重置")])],1)],1)],1),a("div",{staticClass:"add_delet"},[1==t.authority.b_add?a("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:function(e){return t.untilList({})}}},[t._v("新增")]):t._e(),1==t.authority.b_del?a("el-button",{staticClass:"iconfont icon-iconfontshanchu3",attrs:{plain:"",size:"mini"},on:{click:t.deletes}},[t._v("删除")]):t._e(),1==t.authority.b_pass?a("el-button",{staticClass:"iconfont icon-pass",attrs:{type:"primary",size:"mini"},on:{click:t.shenHe}},[t._v("审核")]):t._e(),1==t.authority.b_invalid?a("el-button",{staticClass:"iconfont icon-zuofei",attrs:{plain:"",size:"mini"},on:{click:t.zuofei}},[t._v("作废")]):t._e(),a("el-button",{attrs:{plain:"",icon:"el-icon-download",size:"mini"},on:{click:t.downLoadFile}},[t._v("下载模板")]),a("el-button",{staticClass:"addBtn",attrs:{plain:"",icon:"iconfont icon-daoru5",size:"mini"},on:{click:function(e){return t.$refs.upload.stateOpen()}}},[t._v("导入")]),1==t.authority.b_export?a("el-dropdown",{staticStyle:{margin:"0 10px"}},[a("span",{staticStyle:{cursor:"pointer",color:"#4e90e2"},attrs:{"split-button":""}},[a("el-button",{attrs:{plain:"",icon:"iconfont icon-daochu10",size:"mini"}},[t._v("导出")])],1),a("el-dropdown-menu",{staticStyle:{"margin-top":"10px"},attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(e){return t.exportOrder(1)}}},[t._v("导出Excel文件")]),a("el-dropdown-item",{nativeOn:{click:function(e){return t.exportOrder(2)}}},[t._v("导出CSV逗号分隔")])],1)],1):t._e()],1),a("div",{staticClass:"table_container"},[a("xTable",{ref:"xTable",attrs:{ajax:{url:"getPlanList",params:t.params},footerMethod:t.footerMethod,tableColumn:t.tableColumn},on:{getData:t.dealData}})],1),a("upload",{ref:"upload",attrs:{options:t.options},on:{uploadFail:t.uploadFail}})],1),a("excelExport",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"excelExport",attrs:{headerTitle:t.headerTitle,titles:t.titles,dataList:t.dataList}})],1)},n=[],r=(a("b64b"),a("4de4"),a("d3b7"),a("25f0"),a("d81d"),a("caad"),a("b680"),a("8ba4"),a("a9e3"),{data:function(){var t=this;this.$createElement;return{footerData:{},tableColumn:[{type:"checkbox",width:44,align:"center"},{title:"采购组织",field:"company_name",width:130},{field:"name",title:"操作",width:100,fixed:"right",slots:{default:function(e,a){return[a("el-button",{attrs:{size:"small",type:"text",disabled:1!==t.authority.b_info},on:{click:function(){return t.planSee(e.row)}}},[" 查看 "]),a("el-button",{attrs:{size:"small",type:"text",disabled:!((1==e.row.auditor_status||4===e.row.auditor_status)&&1==t.authority.b_edit)},on:{click:function(){return t.untilList(e.row)}}},["修改"])]}}},{field:"plan_sn",width:156,title:"单据号",slots:{default:function(e,a){return[a("a",{on:{click:function(){return t.planSee(e.row)}}},[" ",e.row.plan_sn," "])]}}},{title:"供应商(厂家)",field:"supplier_name",width:150},{title:"仓库名称",field:"warehouse_name",width:150},{title:"采购数量",field:"num",headerAlign:"right",align:"right",width:70},{title:"总计金额",field:"subtotal_price",headerAlign:"right",align:"right",width:100,formatter:"priceFormat"},{title:"审核状态",field:"auditor_status_name",width:70},{title:"审核人",field:"auditor_name",width:84},{title:"审核时间",field:"auditor_time_name",width:140},{title:"创建人",field:"add_user_name",width:84},{title:"单据时间",field:"add_time_name",width:160},{title:"已收货数量",field:"delivery_num",headerAlign:"right",align:"right",width:100,formatter:function(t){var e=t.row;if(1===e.is_jc)return e.delivery_num}},{title:"收货状态",field:"delivery_status_name",width:100,formatter:function(t){var e=t.row;if(1===e.is_jc)return e.delivery_status_name}},{title:"所属部门",field:"department_name",width:88},{title:"单据备注",field:"remark",width:120},{title:"修改人",field:"update_user_name",width:84},{title:"修改时间",field:"update_time_name",width:84}]}},methods:{footerMethod:function(t){var e=this,a=t.columns,i=t.data;return[a.map((function(t,a){if(1===a)return"页小计";if(["num","subtotal_price"].includes(t.property)){var n=e.$utils.sum(i,t.property);return"num"===t.property?e.$publicFution.priceFormatNone(n):"subtotal_price"===t.property?e.$publicFution.priceFormatNone(n.toFixed(2)-0):Number.isInteger(n)?n:n.toFixed(2)}return null})),a.map((function(t,a){return 1===a?"合计":"num"===t.property&&e.footerData.sum_number?e.$publicFution.priceFormatNone(e.footerData.sum_number-0):"subtotal_price"===t.property&&e.footerData.sum_subtotal_price?e.$publicFution.priceFormatNone(e.footerData.sum_subtotal_price-0):["num","subtotal_price"].includes(t.property)?"计算中...":null}))]}}}),l={name:"purchasePlanIndex",mixins:[r],data:function(){return{params:{},dataList:[],headerTitle:[],titles:"",options:{title:"导入",url:"/v2/purchase/plan/importPlan"}}},methods:{onReset:function(){this.params={},this.timeValue=[],this.onSearch(1)},dealData:function(t){200===t.data.code&&(this.footerData=t.data.data.desc)},exportOrder:function(t){var e=Object.assign(this.params,{export_type:t});this.$axMethod.purchaseExportPlanUrl(e).then((function(t){200==t.data.code&&(window.location.href=t.data.data.url)}))},uploadFail:function(t){var e=this;400===t.code&&(Object.keys(t.data).length||t.data.length)&&(this.$refs.upload.close(),this.$confirm("是否下载错误文件?","温馨提示！",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.headerTitle=t.data.title,e.dataList=t.data.data,e.titles=t.data.file_name,e.$refs.excelExport.exportClick()})).catch((function(t){return t})))},downLoadFile:function(){this.$axMethod.getPlandownloadFile().then((function(t){var e=t.data;200===e.code&&window.open(e.data.url)}))},supplierChange:function(t){t&&(this.params.supplier_name=this.supplierList.filter((function(e){return e.supplier_id===t}))[0].supplier_name)},shenHe:function(){if(this.multipleSelection.length<1)return this.$message({message:"请选择需要审核的信息",type:"warning"}),!1;for(var t=[],e=0;e<this.multipleSelection.length;e++){if(1===this.multipleSelection[e].is_jc)return void this.$message.error("对接集采的采购申请不可审核");t.push(this.multipleSelection[e].plan_id)}var a=t.toString(),i={eachData:{plan_id:a.toString()},UrlApi:"purchaseAuditorPass",list:{UrlApi:"getPlanList",data:this.TableData,per_page:this.changePage}};this.$common.audit(i,this.onSearch)},zuofei:function(){if(this.multipleSelection.length<1)return this.$message({message:"请选择需要作废的信息",type:"warning"}),!1;for(var t=[],e=0;e<this.multipleSelection.length;e++)t.push(this.multipleSelection[e].plan_id);var a=t.toString(),i={eachData:{plan_id:a.toString()},UrlApi:"purchaseAuditorInvalid",list:{UrlApi:"getPlanList",data:this.TableData,per_page:this.changePage}};this.$common.audit(i,this.onSearch)},planSee:function(t){this.$router.push({path:"/purchase/plan/planSee",query:{id:t.plan_id}})},companyChange:function(t){t&&(this.params.company_name=this.companyList.filter((function(e){return e.company_id===t}))[0].company_name),this.$set(this.params,"supplier_id",""),this.$set(this.params,"department_id","")},departmentChange:function(t){t&&(this.params.department_name=this.departmentList.filter((function(e){return e.department_id===t}))[0].department_name)},untilList:function(t){this.$router.push({path:"/purchase/plan/planAdd",query:{id:t.plan_id}})},onSearch:function(t){this.footerData={},this.$refs.xTable._proxy("updateFooter"),this.timeValue?(this.params.start_time=this.timeValue[0],this.params.end_time=this.timeValue[1]):this.params.start_time=this.params.end_time="",this.$refs.xTable._getData(t)},deletes:function(){var t={deleID:"plan_id",deleSelect:this.multipleSelection,deleApi:"delplan",list:{UrlApi:"getPlanList",data:this.TableData,per_page:this.changePage}};this.$common.deletes(t,"删除",this,this.onSearch)}},created:function(){this.authority=JSON.parse(localStorage.getItem("authority"))},activated:function(){this.onSearch(window.goPage)}},o=l,s=a("2877"),u=Object(s["a"])(o,i,n,!1,null,"0aa7e305",null);e["default"]=u.exports},eac5:function(t,e,a){var i=a("861d"),n=Math.floor;t.exports=Number.isInteger||function(t){return!i(t)&&isFinite(t)&&n(t)===t}}}]);
//# sourceMappingURL=chunk-54d26160.147c8e11.js.map