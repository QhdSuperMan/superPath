(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-e2acef44"],{"10a0":function(e,t,a){"use strict";a("eadb")},"807c":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return l}));a("a9e3"),a("d3b7"),a("99af"),a("d81d"),a("b680");var n={company_id:localStorage.getItem("company_id"),company_name:localStorage.getItem("company_name"),ladder_mode:2,rebate_mode:1,effective_start_time:"",effective_end_time:"",rebate_cycle:"",img_path:[]},r=(localStorage.getItem("purchase_center_company_id"),{ladder_start_num:"",ladder_end_num:"无穷",rebate_type:1,rebate_type_name:"返点",rebate_price:""}),i={ladder_start_num:"",ladder_end_num:"",rebate_type:1,rebate_price:"",rebate_type_name:"",goods_type_id:"",goods_type_name:"",factory_code:"",unit_name:"",unit_id:"",brand_id:"",brand_name:"",goods_id:"",goods_name:""},l={data:function(){var e=this,t=this.$createElement;return{editRules:{ladder_start_num:[{required:!0,message:"阶梯起始数量请在0-99999999之间"}],ladder_end_num:[{required:!0,message:"阶梯截止数量请在0-99999999之间"}],rebate_type_name:[{required:!0,message:"请选择返利名称"}],rebate_price:[{required:!0,message:"请输入返利"}]},editRulesShop:{goods_name:[{required:!0,message:"请选择商品"}],rebate_type_name:[{required:!0,message:"请选择返利名称"}],rebate_price:[{required:!0,message:"请输入返利"}]},contentTableColumn:[],contentBaseTableColumn:[{title:"阶梯起始数量",field:"ladder_start_num",width:140,headerAlign:"right",align:"right",editRender:{name:"number",autoselect:!0,formatter:"Positive",events:{change:function(t){var a=t.row;a.ladder_end_num&&a.ladder_end_num<=a.ladder_start_num&&(e.$message.warning("阶梯截止数量不能小于等于阶梯起始数量！"),a.ladder_start_num=0)}}}},{title:"阶梯截止数量",field:"ladder_end_num",width:140,headerAlign:"right",align:"right",editRender:{name:"Vinput",autoselect:!0,formatter:"String",events:{change:function(t){var a=t.row,n=t.$rowIndex,r=t.data;if(a.ladder_start_num=Number(a.ladder_start_num),a.ladder_end_num&&"无穷"!=a.ladder_end_num){a.ladder_end_num=isNaN(parseInt(a.ladder_end_num))?0:parseInt(a.ladder_end_num),a.ladder_end_num<a.ladder_start_num&&(e.$message.warning("阶梯截止数量不能小于等于阶梯起始数量！"),a.ladder_end_num=a.ladder_start_num+1);var i=r[n+1];if(i){if(i.ladder_end_num&&a.ladder_end_num+1>=i.ladder_end_num)return a.ladder_end_num=a.ladder_start_num+1,void e.$message.warning("下一行阶梯截止数量不能小于等于阶梯起始数量！");i.ladder_start_num=a.ladder_end_num+1}else e.addContentRow()}else a.ladder_end_num="无穷"}}}}],shopTableColumn:[{type:"checkbox",width:44,align:"center",fixed:"left"},{title:"商品类型",field:"goods_type_name",width:150},{title:"品牌",field:"brand_name",width:150},{title:"商品编号",field:"goods_id",width:150},{title:"商品名称",field:"goods_name",width:400,editRender:{name:"vGoods",getParams:function(t){t.row;return{params:{company_id:e.params.company_id}}},events:{change:function(t,a){var n=a.row;["inventory_goods_id","unit_id","unit_name","brand_id","brand_name","specification_model","factory_code","specification_type","goods_type_name","goods_type_id"].forEach((function(e){n[e]=t[e]}));var r=e.$refs.xTable._proxy("getTableData").fullData;(0===r.length||r[r.length-1].goods_name)&&e.addShopRow()}}}},{title:"工厂代码",field:"factory_code",width:150},{title:"单位",field:"unit_name",width:150}],excess:[{title:"促销进价(元)",field:"promotion_price",width:140,headerAlign:"right",align:"right",editRender:{name:"Vinput",autoselect:!0}}],excessTableColumn:[{title:"返利方式",field:"rebate_type_name",width:140,editRender:{name:"vSelect",getParams:function(){return{modelKey:"rebate_type",list:[{value:1,label:"返点(%)"},{value:2,label:"金额(元)"}]}},events:{change:function(t){var a=t.$table,n=t.row;if(n.rebate_type||(n.rebate_price=""),"contentId"===a.rowId){var r=e.$refs.xTable._proxy("getTableData").fullData.concat([]);r=r.map((function(e){return e.rebate_type=n.rebate_type,e.rebate_type_name=n.rebate_type_name,e})),e.$refs.xTable._proxy("loadData",r)}}}}},{title:"返利",field:"rebate_price",width:140,headerAlign:"right",align:"right",editRender:{name:"Vinput",autoselect:!0,events:{change:function(t){var a=t.$table,n=t.row;if("contentId"===a.rowId){var r=e.$refs.xTable._proxy("getTableData").fullData.concat([]);r=r.map((function(e){return e.rebate_price=n.rebate_price,e})),e.$refs.xTable._proxy("loadData",r)}}},getOutSlots:function(e){var a,n=e.row;return 1===n.rebate_type?a="%":2===n.rebate_type&&(a="元"),[t("span",{style:"color: blue"},[a])]}}}]}},methods:{dealDetaiData:function(e){var t=this,a=e.map((function(e){if(1===e.rebate_type){var a=t.$publicFution.deepCopy(e);return a.rebate_price=100*a.rebate_price,a.rebate_price=a.rebate_price.toFixed(2),a}return e.rebate_price=Number(e.rebate_price).toFixed(2),e}));return a},rebateModeChange:function(){if(2===this.params.rebate_mode){var e=this.shopTableColumn.concat(this.excess);this.$refs.xTable&&this.$refs.xTable.initColumn(e)}else if(2===this.params.ladder_mode){this.$refs.xTable&&this.$refs.xTable.initColumn(this.shopTableColumn);var t=this.contentBaseTableColumn.concat(this.excessTableColumn);t.unshift({type:"checkbox",width:44,align:"center",fixed:"left"}),this.$refs.contentTable&&this.$refs.contentTable.initColumn(t)}else{var a=this.shopTableColumn.concat(this.excessTableColumn);this.$refs.xTable&&this.$refs.xTable.initColumn(a),this.$refs.contentTable&&this.$refs.contentTable.initColumn(this.excessTableColumn.concat([]))}},addContentRow:function(){if(this.$refs.contentTable){var e=this.$publicFution.deepCopy(r),t=this.$refs.contentTable._proxy("getTableData").fullData.concat([]),a=t[t.length-1];a?("number"!==typeof a.ladder_end_num&&(a.ladder_end_num=Number(a.ladder_start_num)+1),e.ladder_start_num=Number(a.ladder_end_num)+1):e.ladder_start_num=1,this.$refs.contentTable._proxy("insertAt",e,-1)}},contentTableUpdate:function(){var e=this.$refs.contentTable._proxy("getTableData").fullData.concat([]);this.indexSign=e.map((function(e,t){return t})),this.indexSign.length>1&&this.indexSign.pop()},delContentRow:function(){this.$refs.contentTable._proxy("getSelectRecords").length?this.$refs.contentTable._proxy("removeSelecteds"):this.$message.warning("请先选择要删除的商品！")},delShopRow:function(){this.$refs.xTable._proxy("getSelectRecords").length?this.$refs.xTable._proxy("removeSelecteds"):this.$message.warning("请先选择要删除的商品！")},addShopRow:function(){if(this.$refs.xTable){var e=this.$publicFution.deepCopy(i);if(1===this.params.ladder_mode){var t=this.$refs.contentTable._proxy("getTableData").fullData;t=t[0]?t[0]:{},e.rebate_price=t.rebate_price,e.rebate_type_name=t.rebate_type_name,e.rebate_type=t.rebate_type}this.$refs.xTable._proxy("insertAt",e,-1)}},isEdit:function(e){var t=e.column,a=(e.row,e.$rowIndex);return"ladder_start_num"!==t.property||0===a||(this.$publicFution.confirm("只能修改第一行的起始数量"),!1)}}}},b680:function(e,t,a){"use strict";var n=a("23e7"),r=a("da84"),i=a("e330"),l=a("5926"),s=a("408a"),o=a("1148"),d=a("d039"),c=r.RangeError,m=r.String,u=Math.floor,_=i(o),b=i("".slice),p=i(1..toFixed),f=function(e,t,a){return 0===t?a:t%2===1?f(e,t-1,a*e):f(e*e,t/2,a)},h=function(e){var t=0,a=e;while(a>=4096)t+=12,a/=4096;while(a>=2)t+=1,a/=2;return t},g=function(e,t,a){var n=-1,r=a;while(++n<6)r+=t*e[n],e[n]=r%1e7,r=u(r/1e7)},v=function(e,t){var a=6,n=0;while(--a>=0)n+=e[a],e[a]=u(n/t),n=n%t*1e7},y=function(e){var t=6,a="";while(--t>=0)if(""!==a||0===t||0!==e[t]){var n=m(e[t]);a=""===a?n:a+_("0",7-n.length)+n}return a},x=d((function(){return"0.000"!==p(8e-5,3)||"1"!==p(.9,0)||"1.25"!==p(1.255,2)||"1000000000000000128"!==p(0xde0b6b3a7640080,0)}))||!d((function(){p({})}));n({target:"Number",proto:!0,forced:x},{toFixed:function(e){var t,a,n,r,i=s(this),o=l(e),d=[0,0,0,0,0,0],u="",p="0";if(o<0||o>20)throw c("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return m(i);if(i<0&&(u="-",i=-i),i>1e-21)if(t=h(i*f(2,69,1))-69,a=t<0?i*f(2,-t,1):i/f(2,t,1),a*=4503599627370496,t=52-t,t>0){g(d,0,a),n=o;while(n>=7)g(d,1e7,0),n-=7;g(d,f(10,n,1),0),n=t-1;while(n>=23)v(d,1<<23),n-=23;v(d,1<<n),g(d,1,1),v(d,2),p=y(d)}else g(d,0,a),g(d,1<<-t,0),p=y(d)+_("0",o);return o>0?(r=p.length,p=u+(r<=o?"0."+_("0",o-r)+p:b(p,0,r-o)+"."+b(p,r-o))):p=u+p,p}})},c220:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container squareFormSpan"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("采购管理")]),a("el-breadcrumb-item",{staticClass:"attrbute"},[a("span",{on:{click:e.goBack}},[e._v("厂家返利政策")])]),a("el-breadcrumb-item",[e._v("查看厂家返利政策")])],1),a("div",{staticClass:"editOrderbox"},[a("h5",{staticClass:"firstTitle"},[e._v("返利信息")]),a("el-form",{ref:"params",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[a("el-form-item",{attrs:{label:"组织名称",size:"mini"}},[e._v(" "+e._s(e.params.company_name)+" ")]),a("el-form-item",{attrs:{label:"厂家名称",size:"mini"}},[e._v(" "+e._s(e.params.supplier_name)+" ")]),a("el-form-item",{attrs:{label:"返利政策名称",size:"mini"}},[e._v(" "+e._s(e.params.rebate_policy_name)+" ")]),a("el-form-item",{attrs:{label:"返利有效期",size:"mini"}},[e._v(" "+e._s(e.$publicFution.getTime(1e3*e.params.effective_start_time)+"-"+e.$publicFution.getTime(1e3*e.params.effective_end_time))+" ")]),1===e.params.rebate_mode?a("el-form-item",{attrs:{label:"返利周期",size:"mini"}},[a("cycleBox",{attrs:{hasAll:!1,disabled:!0},model:{value:e.params.rebate_cycle,callback:function(t){e.$set(e.params,"rebate_cycle",t)},expression:"params.rebate_cycle"}})],1):e._e(),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1===e.params.rebate_mode,expression:"params.rebate_mode === 1"}],attrs:{label:"阶梯模式",size:"mini"}},[e._v(" "+e._s(2===e.params.ladder_mode?"有阶梯":"无阶梯")+" ")])],1),a("div",{staticStyle:{"margin-top":"30px","margin-bottom":"-20px"}},[a("el-tabs",{model:{value:e.params.rebate_mode,callback:function(t){e.$set(e.params,"rebate_mode",t)},expression:"params.rebate_mode"}},[1===e.params.rebate_mode?a("el-tab-pane",{attrs:{label:"满量返点",name:1}}):e._e(),2===e.params.rebate_mode?a("el-tab-pane",{attrs:{label:"短期促销",name:2}}):e._e()],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.params.rebate_mode,expression:"params.rebate_mode === 1"}]},[a("h5",{staticClass:"baseTitle"},[e._v("返利内容")]),a("div",{staticClass:"table_container",staticStyle:{display:"inline-block"}},[a("xTable",{ref:"contentTable",attrs:{maxHeight:"500",isEdit:function(){return!1},tableColumn:e.contentBaseTableColumn}})],1)]),a("h5",{staticClass:"baseTitle"},[e._v("商品信息")]),a("div",{staticClass:"add_delet"},[a("span",{staticStyle:{"font-size":"12px"}},[e._v("品牌："+e._s(e.params.brand_name))])]),a("div",{staticClass:"table_container",staticStyle:{display:"inline-block"}},[a("xTable",{ref:"xTable",attrs:{tableColumn:e.shopTableColumn,isEdit:function(){return!1}}})],1),a("div",[a("h5",{staticClass:"baseTitle"},[e._v("附件信息")]),a("uploadCommon",{ref:"uploadFile",attrs:{beforeRemove:function(){return!1}},model:{value:e.params.img_path,callback:function(t){e.$set(e.params,"img_path",t)},expression:"params.img_path"}})],1),a("div",{staticClass:"sumbitButton"},[a("el-button",{attrs:{plain:"",size:"small"},on:{click:e.goBack}},[e._v("返回")])],1)],1)],1)},r=[],i=(a("99af"),a("807c")),l=a("f249"),s={name:"factoryPolicy/factoryPolicySee",mixins:[i["b"]],data:function(){return{policyDay:[],params:{},editType:1}},methods:{rebateModeChange:function(){if(2===this.params.rebate_mode){var e=this.shopTableColumn.concat(this.excess);e.shift(),this.$refs.xTable&&this.$refs.xTable.initColumn(e)}else if(2===this.params.ladder_mode){this.$refs.xTable&&this.$refs.xTable.initColumn(this.shopTableColumn);var t=this.contentBaseTableColumn.concat(this.excessTableColumn);this.$refs.contentTable&&this.$refs.contentTable.initColumn(t)}else{var a=this.shopTableColumn.concat(this.excessTableColumn);this.$refs.xTable&&this.$refs.xTable.initColumn(a),this.$refs.contentTable&&this.$refs.contentTable.initColumn(this.excessTableColumn.concat([]))}},goBack:function(){this.$publicFution.goPage(this.$route.query&&this.$route.query.id),this.$router.push("/purchase/factoryPolicy")}},components:{cycleBox:l["a"]},created:function(){this.shopTableColumn.shift()},mounted:function(){var e=this;this.editType=1,this.$route.query&&this.$route.query.id&&(this.editType=2,this.$axios({params:{rebate_policy_id:this.$route.query.id},method:"get",url:this.$api.getRebatePolicyInfoPurchase}).then((function(t){var a=t.data;a.code&&(e.params=a.data.info,e.rebateModeChange(),a.data.goods_list=e.dealDetaiData(a.data.goods_list),a.data.common_list=e.dealDetaiData(a.data.common_list),e.$refs.xTable._proxy("loadData",a.data.goods_list),e.$refs.contentTable._proxy("loadData",a.data.common_list),e.$refs.uploadFile._initList(a.data.photo_list.fileList))})))}},o=s,d=(a("10a0"),a("2877")),c=Object(d["a"])(o,n,r,!1,null,"4f50a218",null);t["default"]=c.exports},eadb:function(e,t,a){},f249:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{attrs:{placeholder:"请选择",clearable:"",disabled:e.disabled,filterable:""},on:{focus:e.getList,change:e.change},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.list,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)},r=[],i={name:"cycleBox",data:function(){return{list:[{value:0,label:"全部"},{value:1,label:"本月返"},{value:2,label:"本季返"},{value:3,label:"本半年返"},{value:4,label:"本年返"},{value:5,label:"次月返"},{value:6,label:"次季返"},{value:7,label:"次半年返"},{value:8,label:"次年返"}]}},props:{disabled:{type:Boolean,default:!1},hasAll:{type:Boolean,default:!0},value:null},created:function(){this.hasAll||this.list.shift()},methods:{getList:function(){},change:function(e){this.$emit("input",e),this.$emit("change",e)}}},l=i,s=a("2877"),o=Object(s["a"])(l,n,r,!1,null,null,null);t["a"]=o.exports}}]);
//# sourceMappingURL=chunk-e2acef44.a09c703a.js.map