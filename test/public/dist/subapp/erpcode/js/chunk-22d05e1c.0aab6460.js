(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-22d05e1c"],{"2ada":function(e,a,t){"use strict";t("58a3")},"58a3":function(e,a,t){},"7bcd":function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"container"},[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",[e._v("采购管理")]),t("el-breadcrumb-item",{staticClass:"attrbute"},[t("span",{on:{click:e.goBack}},[e._v("厂家返利政策")])]),t("el-breadcrumb-item",[e._v(e._s(e.$route.query&&e.$route.query.id?"修改":"新增")+"厂家返利政策")])],1),t("div",{staticClass:"editOrderbox"},[t("h5",{staticClass:"firstTitle"},[e._v("返利信息")]),t("el-form",{ref:"params",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[t("el-form-item",{attrs:{label:"组织名称",size:"mini",prop:"company_id",rules:{required:!0,message:"请选择公司名称",trigger:"change"}}},[t("erpCompanyList",{attrs:{disabled:2===e.editType,fatherParams:e.params},on:{change:function(){e.params.supplier_id="",e.params.supplier_name=""}},model:{value:e.params.company_id,callback:function(a){e.$set(e.params,"company_id",a)},expression:"params.company_id"}})],1),t("el-form-item",{attrs:{label:"厂家名称",size:"mini",prop:"supplier_id",rules:{required:!0,message:"请选择厂家名称",trigger:"change"}}},[t("erpSupplier",{attrs:{fatherParams:e.params,disabled:2===e.editType,searchParams:{company_id:e.params.company_id}},model:{value:e.params.supplier_id,callback:function(a){e.$set(e.params,"supplier_id",a)},expression:"params.supplier_id"}})],1),t("el-form-item",{attrs:{label:"返利政策名称",size:"mini",prop:"rebate_policy_name",rules:{required:!0,message:"请输入返利策略名称",trigger:"change"}}},[t("el-input",{attrs:{maxlength:"100",placeholder:"请输入策略名称",clearable:""},model:{value:e.params.rebate_policy_name,callback:function(a){e.$set(e.params,"rebate_policy_name",a)},expression:"params.rebate_policy_name"}})],1),t("el-form-item",{attrs:{label:"返利有效期",size:"mini",prop:"effective_start_time",rules:{required:!0,message:"请选择返利有效期",trigger:"change"}}},[t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.timeChange},model:{value:e.policyDay,callback:function(a){e.policyDay=a},expression:"policyDay"}})],1),1===e.params.rebate_mode?t("el-form-item",{attrs:{label:"返利周期",size:"mini",prop:"rebate_cycle",rules:{required:!0,message:"请选择返利周期",trigger:"change"}}},[t("cycleBox",{attrs:{hasAll:!1},model:{value:e.params.rebate_cycle,callback:function(a){e.$set(e.params,"rebate_cycle",a)},expression:"params.rebate_cycle"}})],1):e._e(),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1===e.params.rebate_mode,expression:"params.rebate_mode === 1"}],attrs:{label:"阶梯模式",size:"mini",prop:"ladder_mode",rules:{required:!0,message:"请选择阶梯模式",trigger:"change"}}},[t("el-radio-group",{on:{change:e.updateTable},model:{value:e.params.ladder_mode,callback:function(a){e.$set(e.params,"ladder_mode",a)},expression:"params.ladder_mode"}},[t("el-radio",{attrs:{label:2}},[e._v("有阶梯")]),t("el-radio",{attrs:{label:1}},[e._v("无阶梯")])],1)],1)],1),t("div",{staticStyle:{"margin-top":"30px","margin-bottom":"-20px"}},[t("el-tabs",{on:{"tab-click":e.rebateModeChange},model:{value:e.params.rebate_mode,callback:function(a){e.$set(e.params,"rebate_mode",a)},expression:"params.rebate_mode"}},[t("el-tab-pane",{attrs:{label:"满量返点",name:1}}),t("el-tab-pane",{attrs:{label:"短期促销",name:2}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:1===e.params.rebate_mode,expression:"params.rebate_mode === 1"}]},[t("h5",{staticClass:"baseTitle"},[e._v("返利内容")]),t("div",{directives:[{name:"show",rawName:"v-show",value:2===e.params.ladder_mode,expression:"params.ladder_mode === 2"}],staticClass:"add_delet"},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"small"},on:{click:e.addContentRow}},[e._v("增行")]),t("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"small"},on:{click:e.delContentRow}},[e._v("删行")])],1),t("div",{staticClass:"table_container",staticStyle:{display:"inline-block"}},[t("xTable",{ref:"contentTable",attrs:{rowId:"contentId",maxHeight:"500",editRules:e.editRules,selectConfig:{showHeader:!1},indexSign:e.indexSign,indexSignConfig:{indexDisabled:!0,className:"aaa"},tableColumn:e.contentBaseTableColumn,isEdit:e.isEdit},on:{tableUpdate:e.contentTableUpdate}})],1)]),t("h5",{staticClass:"baseTitle"},[e._v("商品信息")]),t("div",{staticClass:"add_delet"},[t("span",{staticStyle:{"font-size":"12px"}},[e._v("选择品牌 ")]),t("getBrand",{attrs:{fatherParams:e.params},on:{change:e.brandChange},model:{value:e.params.brand_id,callback:function(a){e.$set(e.params,"brand_id",a)},expression:"params.brand_id"}})],1),t("div",{staticClass:"add_delet"},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"small"},on:{click:e.addShopRow}},[e._v("增行")]),t("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"small"},on:{click:e.delShopRow}},[e._v("删行")])],1),t("div",{staticClass:"table_container",staticStyle:{display:"inline-block"}},[t("xTable",{ref:"xTable",attrs:{tableColumn:e.shopTableColumn,editRules:e.editRulesShop}})],1),t("h5",{staticClass:"baseTitle"},[e._v("上传附件")]),t("div",[t("uploadCommon",{ref:"uploadFile",attrs:{extendParams:e.extendParams},model:{value:e.params.img_path,callback:function(a){e.$set(e.params,"img_path",a)},expression:"params.img_path"}},[t("span",{on:{click:e.beforeUpload}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),t("tip",{attrs:{slot:"tip"},slot:"tip"},[t("span",{staticStyle:{"font-size":"12px"}},[e._v(" 建议上传合同附件，如合同扫描件等；图片支持jpg、jpeg、png、bmp格式，大小不超过2MB，最多上传6张；文档附件不超过10MB，最多上传3份 ")])])],1)],1),t("div",{staticClass:"sumbitButton"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.sumbit}},[e._v("保存")]),t("el-button",{attrs:{plain:"",size:"small"},on:{click:e.goBack}},[e._v("取消")])],1)],1)],1)},i=[],n=(t("d81d"),t("99af"),t("e9c4"),t("807c")),s=t("1c1e"),l=t("f249"),o={name:"factoryPolicy/factoryPolicyAdd",mixins:[n["b"]],data:function(){return{indexSign:[],policyDay:[],extendParams:{},params:this.$publicFution.deepCopy(n["a"]),editType:1}},methods:{brandChange:function(e){var a=this;e.brand_id&&this.$axMethod.getInventoryGoodsList({company_id:this.params.company_id,brand_id:e.brand_id}).then((function(e){var t=e.data,r=a.$refs.contentTable._proxy("getTableData").fullData;r=r[0]?r[0]:{};var i=t.data.map((function(e){return e.rebate_price=r.rebate_price,e.rebate_type_name=r.rebate_type_name,e.rebate_type=r.rebate_type,e}));a.$refs.xTable._proxy("loadData",i)}))},beforeUpload:function(e){return this.extendParams={company_id:this.params.company_id,sign:Object(s["a"])({company_id:this.params.company_id})},!!this.params.company_id||(this.$message.warning("请先选择公司名称"),e.preventDefault(),e.stopPropagation(),!1)},timeChange:function(e){Array.isArray(e)?(this.params.effective_start_time=e[0],this.params.effective_end_time=e[1]):(this.params.effective_start_time="",this.params.effective_end_time="")},updateTable:function(e){if(2===e){this.$refs.xTable&&this.$refs.xTable.initColumn(this.shopTableColumn);var a=this.contentBaseTableColumn.concat(this.excessTableColumn);a.unshift({type:"checkbox",width:44,align:"center",fixed:"left"}),this.$refs.contentTable&&this.$refs.contentTable.initColumn(a)}else{var t=this.shopTableColumn.concat(this.excessTableColumn);this.$refs.xTable&&this.$refs.xTable.initColumn(t),this.$refs.contentTable&&this.$refs.contentTable.initColumn(this.excessTableColumn.concat([])),this.$refs.contentTable._proxy("loadData",[]),this.addContentRow()}},sumbitFunction:function(e,a){var t=this;this.$refs.xTable._proxy("validate",a).then((function(r){var i=t.params;a=a.map((function(e){if(1===e.rebate_type){var a=t.$publicFution.deepCopy(e);return a.rebate_price=a.rebate_price/100,a}return e})),i.common_json=JSON.stringify(e),i.goods_json=JSON.stringify(a);var n="addRebatePolicyPurchase";2===t.editType&&(n="editRebatePolicyPurchase"),t.$axios({method:"post",data:i,url:t.$api[n]}).then((function(e){var a=e.data;200===a.code&&(t.$message.success(a.msg),t.goBack())}))}))},sumbit:function(){var e=this;this.$refs.params.validate((function(a){if(a){var t=e.$refs.contentTable._proxy("getTableData").fullData.concat([]),r=e.$refs.xTable._proxy("getTableData").fullData.concat([]);if(r[r.length-1]&&!r[r.length-1].goods_id&&r.pop(),r.length<1)return void e.$message.warning("请完善商品信息表格数据");if(1===e.params.rebate_mode){if(t=t.map((function(a){if(1===a.rebate_type){var t=e.$publicFution.deepCopy(a);return t.rebate_price=t.rebate_price/100,t}return a})),"无穷"!==t[t.length-1].ladder_end_num)return void e.$message.warning("最后一行的阶梯截止数量必须是无穷");e.$refs.contentTable._proxy("validate").then((function(a){e.sumbitFunction(t,r)}))}else e.sumbitFunction(t,r)}}))},goBack:function(){this.$publicFution.goPage(this.$route.query&&this.$route.query.id),this.$router.push("/purchase/factoryPolicy")}},components:{cycleBox:l["a"]},mounted:function(){var e=this;this.editType=1,this.$route.query&&this.$route.query.id?(this.editType=2,this.$axios({params:{rebate_policy_id:this.$route.query.id},method:"get",url:this.$api.getRebatePolicyInfoPurchase}).then((function(a){var t=a.data;200===t.code&&(e.params=t.data.info,e.rebateModeChange(),t.data.goods_list=e.dealDetaiData(t.data.goods_list),t.data.common_list=e.dealDetaiData(t.data.common_list),e.$refs.xTable._proxy("loadData",t.data.goods_list),e.$refs.contentTable._proxy("loadData",t.data.common_list),e.policyDay=[e.$publicFution.getTime(1e3*e.params.effective_start_time),e.$publicFution.getTime(1e3*e.params.effective_end_time)],e.timeChange(e.policyDay),e.$refs.uploadFile._initList(t.data.photo_list.fileList))}))):(this.$nextTick((function(){e.updateTable(e.params.ladder_mode)})),this.addContentRow())}},d=o,c=(t("2ada"),t("2877")),m=Object(c["a"])(d,r,i,!1,null,"0a65ffaa",null);a["default"]=m.exports},"807c":function(e,a,t){"use strict";t.d(a,"a",(function(){return r})),t.d(a,"b",(function(){return s}));t("a9e3"),t("d3b7"),t("99af"),t("d81d"),t("b680");var r={company_id:localStorage.getItem("company_id"),company_name:localStorage.getItem("company_name"),ladder_mode:2,rebate_mode:1,effective_start_time:"",effective_end_time:"",rebate_cycle:"",img_path:[]},i=(localStorage.getItem("purchase_center_company_id"),{ladder_start_num:"",ladder_end_num:"无穷",rebate_type:1,rebate_type_name:"返点",rebate_price:""}),n={ladder_start_num:"",ladder_end_num:"",rebate_type:1,rebate_price:"",rebate_type_name:"",goods_type_id:"",goods_type_name:"",factory_code:"",unit_name:"",unit_id:"",brand_id:"",brand_name:"",goods_id:"",goods_name:""},s={data:function(){var e=this,a=this.$createElement;return{editRules:{ladder_start_num:[{required:!0,message:"阶梯起始数量请在0-99999999之间"}],ladder_end_num:[{required:!0,message:"阶梯截止数量请在0-99999999之间"}],rebate_type_name:[{required:!0,message:"请选择返利名称"}],rebate_price:[{required:!0,message:"请输入返利"}]},editRulesShop:{goods_name:[{required:!0,message:"请选择商品"}],rebate_type_name:[{required:!0,message:"请选择返利名称"}],rebate_price:[{required:!0,message:"请输入返利"}]},contentTableColumn:[],contentBaseTableColumn:[{title:"阶梯起始数量",field:"ladder_start_num",width:140,headerAlign:"right",align:"right",editRender:{name:"number",autoselect:!0,formatter:"Positive",events:{change:function(a){var t=a.row;t.ladder_end_num&&t.ladder_end_num<=t.ladder_start_num&&(e.$message.warning("阶梯截止数量不能小于等于阶梯起始数量！"),t.ladder_start_num=0)}}}},{title:"阶梯截止数量",field:"ladder_end_num",width:140,headerAlign:"right",align:"right",editRender:{name:"Vinput",autoselect:!0,formatter:"String",events:{change:function(a){var t=a.row,r=a.$rowIndex,i=a.data;if(t.ladder_start_num=Number(t.ladder_start_num),t.ladder_end_num&&"无穷"!=t.ladder_end_num){t.ladder_end_num=isNaN(parseInt(t.ladder_end_num))?0:parseInt(t.ladder_end_num),t.ladder_end_num<t.ladder_start_num&&(e.$message.warning("阶梯截止数量不能小于等于阶梯起始数量！"),t.ladder_end_num=t.ladder_start_num+1);var n=i[r+1];if(n){if(n.ladder_end_num&&t.ladder_end_num+1>=n.ladder_end_num)return t.ladder_end_num=t.ladder_start_num+1,void e.$message.warning("下一行阶梯截止数量不能小于等于阶梯起始数量！");n.ladder_start_num=t.ladder_end_num+1}else e.addContentRow()}else t.ladder_end_num="无穷"}}}}],shopTableColumn:[{type:"checkbox",width:44,align:"center",fixed:"left"},{title:"商品类型",field:"goods_type_name",width:150},{title:"品牌",field:"brand_name",width:150},{title:"商品编号",field:"goods_id",width:150},{title:"商品名称",field:"goods_name",width:400,editRender:{name:"vGoods",getParams:function(a){a.row;return{params:{company_id:e.params.company_id}}},events:{change:function(a,t){var r=t.row;["inventory_goods_id","unit_id","unit_name","brand_id","brand_name","specification_model","factory_code","specification_type","goods_type_name","goods_type_id"].forEach((function(e){r[e]=a[e]}));var i=e.$refs.xTable._proxy("getTableData").fullData;(0===i.length||i[i.length-1].goods_name)&&e.addShopRow()}}}},{title:"工厂代码",field:"factory_code",width:150},{title:"单位",field:"unit_name",width:150}],excess:[{title:"促销进价(元)",field:"promotion_price",width:140,headerAlign:"right",align:"right",editRender:{name:"Vinput",autoselect:!0}}],excessTableColumn:[{title:"返利方式",field:"rebate_type_name",width:140,editRender:{name:"vSelect",getParams:function(){return{modelKey:"rebate_type",list:[{value:1,label:"返点(%)"},{value:2,label:"金额(元)"}]}},events:{change:function(a){var t=a.$table,r=a.row;if(r.rebate_type||(r.rebate_price=""),"contentId"===t.rowId){var i=e.$refs.xTable._proxy("getTableData").fullData.concat([]);i=i.map((function(e){return e.rebate_type=r.rebate_type,e.rebate_type_name=r.rebate_type_name,e})),e.$refs.xTable._proxy("loadData",i)}}}}},{title:"返利",field:"rebate_price",width:140,headerAlign:"right",align:"right",editRender:{name:"Vinput",autoselect:!0,events:{change:function(a){var t=a.$table,r=a.row;if("contentId"===t.rowId){var i=e.$refs.xTable._proxy("getTableData").fullData.concat([]);i=i.map((function(e){return e.rebate_price=r.rebate_price,e})),e.$refs.xTable._proxy("loadData",i)}}},getOutSlots:function(e){var t,r=e.row;return 1===r.rebate_type?t="%":2===r.rebate_type&&(t="元"),[a("span",{style:"color: blue"},[t])]}}}]}},methods:{dealDetaiData:function(e){var a=this,t=e.map((function(e){if(1===e.rebate_type){var t=a.$publicFution.deepCopy(e);return t.rebate_price=100*t.rebate_price,t.rebate_price=t.rebate_price.toFixed(2),t}return e.rebate_price=Number(e.rebate_price).toFixed(2),e}));return t},rebateModeChange:function(){if(2===this.params.rebate_mode){var e=this.shopTableColumn.concat(this.excess);this.$refs.xTable&&this.$refs.xTable.initColumn(e)}else if(2===this.params.ladder_mode){this.$refs.xTable&&this.$refs.xTable.initColumn(this.shopTableColumn);var a=this.contentBaseTableColumn.concat(this.excessTableColumn);a.unshift({type:"checkbox",width:44,align:"center",fixed:"left"}),this.$refs.contentTable&&this.$refs.contentTable.initColumn(a)}else{var t=this.shopTableColumn.concat(this.excessTableColumn);this.$refs.xTable&&this.$refs.xTable.initColumn(t),this.$refs.contentTable&&this.$refs.contentTable.initColumn(this.excessTableColumn.concat([]))}},addContentRow:function(){if(this.$refs.contentTable){var e=this.$publicFution.deepCopy(i),a=this.$refs.contentTable._proxy("getTableData").fullData.concat([]),t=a[a.length-1];t?("number"!==typeof t.ladder_end_num&&(t.ladder_end_num=Number(t.ladder_start_num)+1),e.ladder_start_num=Number(t.ladder_end_num)+1):e.ladder_start_num=1,this.$refs.contentTable._proxy("insertAt",e,-1)}},contentTableUpdate:function(){var e=this.$refs.contentTable._proxy("getTableData").fullData.concat([]);this.indexSign=e.map((function(e,a){return a})),this.indexSign.length>1&&this.indexSign.pop()},delContentRow:function(){this.$refs.contentTable._proxy("getSelectRecords").length?this.$refs.contentTable._proxy("removeSelecteds"):this.$message.warning("请先选择要删除的商品！")},delShopRow:function(){this.$refs.xTable._proxy("getSelectRecords").length?this.$refs.xTable._proxy("removeSelecteds"):this.$message.warning("请先选择要删除的商品！")},addShopRow:function(){if(this.$refs.xTable){var e=this.$publicFution.deepCopy(n);if(1===this.params.ladder_mode){var a=this.$refs.contentTable._proxy("getTableData").fullData;a=a[0]?a[0]:{},e.rebate_price=a.rebate_price,e.rebate_type_name=a.rebate_type_name,e.rebate_type=a.rebate_type}this.$refs.xTable._proxy("insertAt",e,-1)}},isEdit:function(e){var a=e.column,t=(e.row,e.$rowIndex);return"ladder_start_num"!==a.property||0===t||(this.$publicFution.confirm("只能修改第一行的起始数量"),!1)}}}},b680:function(e,a,t){"use strict";var r=t("23e7"),i=t("da84"),n=t("e330"),s=t("5926"),l=t("408a"),o=t("1148"),d=t("d039"),c=i.RangeError,m=i.String,u=Math.floor,p=n(o),_=n("".slice),b=n(1..toFixed),f=function(e,a,t){return 0===a?t:a%2===1?f(e,a-1,t*e):f(e*e,a/2,t)},h=function(e){var a=0,t=e;while(t>=4096)a+=12,t/=4096;while(t>=2)a+=1,t/=2;return a},g=function(e,a,t){var r=-1,i=t;while(++r<6)i+=a*e[r],e[r]=i%1e7,i=u(i/1e7)},y=function(e,a){var t=6,r=0;while(--t>=0)r+=e[t],e[t]=u(r/a),r=r%a*1e7},v=function(e){var a=6,t="";while(--a>=0)if(""!==t||0===a||0!==e[a]){var r=m(e[a]);t=""===t?r:t+p("0",7-r.length)+r}return t},x=d((function(){return"0.000"!==b(8e-5,3)||"1"!==b(.9,0)||"1.25"!==b(1.255,2)||"1000000000000000128"!==b(0xde0b6b3a7640080,0)}))||!d((function(){b({})}));r({target:"Number",proto:!0,forced:x},{toFixed:function(e){var a,t,r,i,n=l(this),o=s(e),d=[0,0,0,0,0,0],u="",b="0";if(o<0||o>20)throw c("Incorrect fraction digits");if(n!=n)return"NaN";if(n<=-1e21||n>=1e21)return m(n);if(n<0&&(u="-",n=-n),n>1e-21)if(a=h(n*f(2,69,1))-69,t=a<0?n*f(2,-a,1):n/f(2,a,1),t*=4503599627370496,a=52-a,a>0){g(d,0,t),r=o;while(r>=7)g(d,1e7,0),r-=7;g(d,f(10,r,1),0),r=a-1;while(r>=23)y(d,1<<23),r-=23;y(d,1<<r),g(d,1,1),y(d,2),b=v(d)}else g(d,0,t),g(d,1<<-a,0),b=v(d)+p("0",o);return o>0?(i=b.length,b=u+(i<=o?"0."+p("0",o-i)+b:_(b,0,i-o)+"."+_(b,i-o))):b=u+b,b}})},f249:function(e,a,t){"use strict";var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("el-select",{attrs:{placeholder:"请选择",clearable:"",disabled:e.disabled,filterable:""},on:{focus:e.getList,change:e.change},model:{value:e.value,callback:function(a){e.value=a},expression:"value"}},e._l(e.list,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)},i=[],n={name:"cycleBox",data:function(){return{list:[{value:0,label:"全部"},{value:1,label:"本月返"},{value:2,label:"本季返"},{value:3,label:"本半年返"},{value:4,label:"本年返"},{value:5,label:"次月返"},{value:6,label:"次季返"},{value:7,label:"次半年返"},{value:8,label:"次年返"}]}},props:{disabled:{type:Boolean,default:!1},hasAll:{type:Boolean,default:!0},value:null},created:function(){this.hasAll||this.list.shift()},methods:{getList:function(){},change:function(e){this.$emit("input",e),this.$emit("change",e)}}},s=n,l=t("2877"),o=Object(l["a"])(s,r,i,!1,null,null,null);a["a"]=o.exports}}]);
//# sourceMappingURL=chunk-22d05e1c.0aab6460.js.map