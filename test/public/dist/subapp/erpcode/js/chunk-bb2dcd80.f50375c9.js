(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-bb2dcd80"],{1457:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",[t._v("采购管理")]),i("el-breadcrumb-item",{staticClass:"attrbute"},[i("span",{on:{click:t.goBack}},[t._v("采购退货")])]),i("el-breadcrumb-item",[t._v("查看采购退货单")])],1),i("div",{staticClass:"search_container"},[i("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[i("el-form-item",{attrs:{label:"采购组织:","label-width":"110px",size:"mini"}},[t._v(" "+t._s(t.TableData.info.company_name)+" ")]),i("el-form-item",{attrs:{label:"单据号:","label-width":"110px",size:"mini"}},[i("span",[t._v(t._s(t.TableData.info.refund_sn))])]),i("el-form-item",{attrs:{label:"来源单号:","label-width":"110px",size:"mini"}},[i("span",[t._v(t._s(t.TableData.info.instorage_sn))])]),i("el-form-item",{attrs:{label:"业务日期:","label-width":"110px",size:"mini"}},[i("span",[t._v(t._s(t.TableData.info.business_time))])]),i("el-form-item",{attrs:{label:"出库类型:","label-width":"110px",size:"mini"}},[i("span",[t._v("采购退货")])]),i("el-form-item",{attrs:{label:"仓库名称","label-width":"110px",size:"mini"}},[t._v(" "+t._s(t.TableData.info.warehouse_name)+" ")]),i("el-form-item",{attrs:{label:"供应商(厂家):","label-width":"110px",size:"mini"}},[i("span",[t._v(t._s(t.TableData.info.supplier_name))])]),i("el-form-item",{attrs:{label:"部门:","label-width":"110px",size:"mini"}},[i("span",[t._v(t._s(t.TableData.info.department_name))])]),i("el-form-item",{attrs:{label:"采购员:","label-width":"110px",size:"mini"}},[i("span",[t._v(t._s(t.TableData.info.buyer_name))])]),i("el-form-item",{attrs:{label:"退货原因:","label-width":"110px",size:"mini"}},[i("span",[t._v(t._s(t.TableData.info.reason_name))])]),i("el-form-item",{attrs:{label:"审核状态:","label-width":"110px",size:"mini"}},[i("span",[t._v(t._s(t.TableData.info.auditor_status_name))])]),i("el-form-item",{attrs:{label:"备注:","label-width":"110px",size:"mini"}},[i("span",[t._v(" "+t._s(t.TableData.info.remark))])])],1)],1),i("div",{staticClass:"table_container"},[i("xTable",{ref:"xTable",attrs:{tableColumn:t.tableColumn,indexSign:t.indexSign,indexSignStart:1,xData:t.TableData.goods_list,showFooter:!0,totalArray:["goods_num","goods_price"]}}),i("div",{staticClass:"refundauditFoot"},[i("span",[t._v("创建人："+t._s(t.TableData.info.add_user_name))]),i("span",[t._v("创建时间："+t._s(t.TableData.info.add_time))]),i("span",[t._v("审核人："+t._s(t.TableData.info.auditor_name))]),i("span",[t._v("审核时间："+t._s(t.TableData.info.auditor_time))]),i("span",[t._v("修改人："+t._s(t.TableData.info.update_user_name))]),i("span",[t._v("修改时间："+t._s(t.TableData.info.update_time))])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[1==t.after_auditor_print_status?[1==t.authority.b_print&&2==t.TableData.info.auditor_status?i("el-button",{on:{click:t.printSheet}},[t._v("打印")]):t._e()]:[1==t.authority.b_print?i("el-button",{on:{click:t.printSheet}},[t._v("打印")]):t._e()],1==t.TableData.info.auditor_status?[1==t.authority.b_pass?i("el-button",{attrs:{type:"primary"},on:{click:t.examineFun}},[t._v("审 核")]):t._e(),1==t.authority.b_invalid?i("el-button",{on:{click:t.abolishFun}},[t._v("作 废")]):t._e()]:t._e(),2==t.TableData.info.auditor_status?[1==t.authority.b_nopass?i("el-button",{staticClass:"iconfont icon-fanshenhe",attrs:{plain:"",size:"mini"},on:{click:t.AUDIT_GET}},[t._v("弃审")]):t._e()]:t._e(),2==t.TableData.info.auditor_status||3==t.TableData.info.auditor_status||1!=t.authority.b_invalid&&1!=t.authority.b_pass?[i("el-button",{on:{click:t.goBack}},[t._v("返 回")])]:[i("el-button",{on:{click:t.goBack}},[t._v("取 消")])]],2),t.printFlag?i("div",[i("printRefund",{ref:"printRefund",attrs:{title:"salesReturn"}})],1):t._e()],1)],1)},n=[],r=(i("d81d"),i("caad"),i("8ba4"),i("a9e3"),i("b680"),i("78d2")),s=i("fe52"),o=i("4997"),l={name:"purchaseRefundSee",mixins:[s["b"]],data:function(){return{authority:{},printFlag:!0,TableData:{info:{}},indexSign:[],trunErrTable:[],errorState:!1,line:null,hasAuditorStatusPrint:null}},components:{printRefund:r["a"]},methods:{renderHeaderpro:function(){var t=this.$createElement;return t("el-tooltip",{class:"item",attrs:{content:"Bottom center",effect:"light"}},[t("p",{slot:"content"},["生产日期列后期将会隐藏，同时新增商品入库日期列"]),t("span",{class:"el-icon-question",style:"cursor:pointer;font-weight:bold;"},["生产日期"])])},AUDIT_GET:function(){var t=this,e=new o["b"]({_this:this,url:"purchaseUnAuditorPass",params:{refund_id:this.TableData.info.refund_id},list:this.TableData.goods_list,before:function(){return t.$baseData.checkCarDoctor({bill_type:14,bill_id:t.TableData.info.refund_id,operation_type:5})}});e.callback().then((function(){t.goBack()}))},printSheet:function(){var t=this;this.printFlag=!0,this.$nextTick((function(){t.$refs.printRefund.printPdf({refund_id:t.TableData.info.refund_id})}))},examineFun:function(){var t=this,e=new o["b"]({_this:this,url:"refundAuditorPass",params:{refund_id:this.TableData.info.refund_id},list:this.TableData.goods_list,before:function(){return t.$baseData.checkCarDoctor({bill_type:14,bill_id:t.TableData.info.refund_id,operation_type:4})}});e.callback().then((function(){t.goBack()}))},abolishFun:function(){var t=this,e=new o["b"]({_this:this,url:"refundAuditorInvalid",params:{refund_id:this.TableData.info.refund_id},list:this.TableData.goods_list,before:function(){return t.$baseData.checkCarDoctor({bill_type:14,bill_id:t.TableData.info.refund_id,operation_type:6})}});e.callback().then((function(){t.goBack()}))},goBack:function(){this.$router.push({path:"/purchase/refund"})},getSummaries:function(t){var e=this,i=t.columns,a=t.data;return i.map((function(t,i){return 0===i?"合计":["goods_num","goods_price"].includes(t.property)?(n=e.$utils.sum(a,t.property),Number.isInteger(n)?n:n.toFixed(2)):"";var n}))}},created:function(){var t=this;this.tableColumn=this.$publicFution.filterTableColumn(this.tableColumn),this.hasAuditorStatusPrint=window.localStorage.hasAuditorStatusPrint,this.authority=JSON.parse(localStorage.getItem("authority")),this.$route.query&&this.$route.query.id&&(this.after_auditor_print_status=this.$route.query.after_auditor_print_status,this.$axios({method:"get",url:this.$api.getRefundInfo,params:{refund_id:this.$route.query.id}}).then((function(e){var i=e.data;200==i.code&&t.$set(t,"TableData",i.data)})))}},u=l,c=(i("e5a8"),i("2877")),d=Object(c["a"])(u,a,n,!1,null,"7c0aaff8",null);e["default"]=d.exports},4997:function(t,e,i){"use strict";i.d(e,"a",(function(){return u})),i.d(e,"b",(function(){return c}));var a=i("1da1"),n=i("ade3"),r=i("d4ec"),s=i("bee2"),o=(i("96cf"),i("d3b7"),i("25f0"),i("159b"),i("4de4"),i("caad"),i("2532"),i("4360"));function l(t){if("function"===typeof t&&t().then)return!0}var u=function(){function t(e){Object(r["a"])(this,t),this._this=e._this,this.addr=[],this.indexSign=null,this.URL=e.url,this.id=e.id,this.errId=e.errId?e.errId:e.id,this.title=e.title?e.title:"审核",this.allTitle=e.allTitle,this.params=e.params,this.before=e.before,this.checkbox=null,this.Data=null,this.showConfirm=e.showConfirm,this.callbackFunc=e.callbackFunc}return Object(s["a"])(t,[{key:"verify",value:function(){return!(this._this.multipleSelection.length<1)||(this._this.$message({message:"请选择需要".concat(this.title,"的信息"),type:"warning"}),!1)}},{key:"confirm",value:function(){var t="确定要“"+this.title+"”此条信息?";return this.allTitle&&(t=this.allTitle),this._this.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}},{key:"sendAjax",value:function(t,e,i){var a,r=this,s=Object.assign(Object(n["a"])({},this.id,t),this.params);this._this.$axMethod[this.URL]?a=this._this.$axMethod[this.URL](s):this._this.$api[this.URL]&&(a=this._this.$axios({url:this._this.$api[this.URL],method:"post",data:s})),a.then((function(t){r.checkbox=r._this.multipleSelection,r.callbackFunc&&r.callbackFunc(t.data),200==t.data.code?(e(t),r.Data=t):i(t)})).catch((function(t){i(t)}))}},{key:"logic",value:function(){var t=this;if(!this.verify())return!1;for(var e=0;e<this._this.multipleSelection.length;e++)this.addr.push(this._this.multipleSelection[e][this.id]);var i=this.addr.toString();return new Promise((function(e,a){if(1==t.showConfirm)t.confirm().then((function(){if(l(t.before))t.before(i).then((function(){return t.sendAjax(i,e,a)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(i,e,a)}));else if(l(t.before))t.before(i).then((function(){return t.sendAjax(i,e,a)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(i,e,a)}))}},{key:"send",value:function(){var t=this;this.logic().then((function(e){var i=e.data;200===i.code&&(t._this.$message.success(i.msg?i.msg:i.data),t._this.onSearch&&t._this.onSearch())}))}},{key:"callback",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,i,a,n,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.logic();case 3:this.Data&&this.Data.data&&this.Data.data.data.length?(e=this.Data.data.data,i=[],e.forEach((function(t){i.push(t.serial)})),a=this.checkbox.filter((function(t){return 1==i.includes(t[r.errId])})),this._this.indexSign.arr=a,this._this.indexSign.str=this.errId,o["a"].commit("setErrorObj",{msg:this.Data.data.msg,table:this.Data.data.data,state:!0})):(n=this.Data.data.msg?this.Data.data.msg:this.Data.data.data,this._this.indexSign.arr=[],this._this.$message({message:n,type:"success"}),this._this.multipleSelection=[],this._this.onSearch&&this._this.onSearch()),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.log();case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));function e(){return t.apply(this,arguments)}return e}()}]),t}(),c=function(){function t(e){var i=e._this,a=e.url,n=e.list,s=void 0===n?[]:n,o=e.params,l=void 0===o?{}:o,u=e.before;Object(r["a"])(this,t),this._this=i,this.url=a,this.list=s,this.params=l,this.before=u}return Object(s["a"])(t,[{key:"sendAjax",value:function(t,e){var i;this._this.$axMethod[this.url]?i=this._this.$axMethod[this.url](this.params):this._this.$api[this.url]&&(i=this._this.$axios({url:this._this.$api[this.url],method:"post",data:this.params})),i.then((function(i){200==i.data.code?t(i):e(i)})).catch((function(t){e(t)}))}},{key:"edit",value:function(){var t=this;return new Promise((function(e,i){if(l(t.before))t.before().then((function(){return t.sendAjax(e,i)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(e,i)}))}},{key:"callback",value:function(){var t=this;return new Promise((function(e,i){t.edit().then((function(a){if(a.data&&a.data.data&&a.data.data.length){o["a"].commit("setErrorObj",{msg:a.data.msg,table:a.data.data,state:!0});var n=[];a.data.data.forEach((function(t){n.push(t.serial)})),t._this.indexSign=n,i(a)}else t._this.$message({message:a.data.msg?a.data.msg:a.data.data,type:"success"}),e(a)}))}))}}]),t}()},"8ba4":function(t,e,i){var a=i("23e7"),n=i("eac5");a({target:"Number",stat:!0},{isInteger:n})},a43d0:function(t,e,i){},b680:function(t,e,i){"use strict";var a=i("23e7"),n=i("da84"),r=i("e330"),s=i("5926"),o=i("408a"),l=i("1148"),u=i("d039"),c=n.RangeError,d=n.String,h=Math.floor,f=r(l),_=r("".slice),m=r(1..toFixed),p=function(t,e,i){return 0===e?i:e%2===1?p(t,e-1,i*t):p(t*t,e/2,i)},b=function(t){var e=0,i=t;while(i>=4096)e+=12,i/=4096;while(i>=2)e+=1,i/=2;return e},g=function(t,e,i){var a=-1,n=i;while(++a<6)n+=e*t[a],t[a]=n%1e7,n=h(n/1e7)},v=function(t,e){var i=6,a=0;while(--i>=0)a+=t[i],t[i]=h(a/e),a=a%e*1e7},w=function(t){var e=6,i="";while(--e>=0)if(""!==i||0===e||0!==t[e]){var a=d(t[e]);i=""===i?a:i+f("0",7-a.length)+a}return i},x=u((function(){return"0.000"!==m(8e-5,3)||"1"!==m(.9,0)||"1.25"!==m(1.255,2)||"1000000000000000128"!==m(0xde0b6b3a7640080,0)}))||!u((function(){m({})}));a({target:"Number",proto:!0,forced:x},{toFixed:function(t){var e,i,a,n,r=o(this),l=s(t),u=[0,0,0,0,0,0],h="",m="0";if(l<0||l>20)throw c("Incorrect fraction digits");if(r!=r)return"NaN";if(r<=-1e21||r>=1e21)return d(r);if(r<0&&(h="-",r=-r),r>1e-21)if(e=b(r*p(2,69,1))-69,i=e<0?r*p(2,-e,1):r/p(2,e,1),i*=4503599627370496,e=52-e,e>0){g(u,0,i),a=l;while(a>=7)g(u,1e7,0),a-=7;g(u,p(10,a,1),0),a=e-1;while(a>=23)v(u,1<<23),a-=23;v(u,1<<a),g(u,1,1),v(u,2),m=w(u)}else g(u,0,i),g(u,1<<-e,0),m=w(u)+f("0",l);return l>0?(n=m.length,m=h+(n<=l?"0."+f("0",l-n)+m:_(m,0,n-l)+"."+_(m,n-l))):m=h+m,m}})},e5a8:function(t,e,i){"use strict";i("a43d0")},eac5:function(t,e,i){var a=i("861d"),n=Math.floor;t.exports=Number.isInteger||function(t){return!a(t)&&isFinite(t)&&n(t)===t}},fe52:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return n}));i("d3b7");var a={serial_number:"",goods_id:"",goods_price:"",instorage_goods_id:"",purchase_price:"",batch:"",remark:"",allocation_id:"",goods_num:"",can_refund_num:"",production_time:"",refund_goods_id:0,no_revenue_price:"",taxrate:"",revenue_price:"",line:1},n={data:function(){var t=this;this.$createElement;return{editRules:{goods_num:[{required:!0,message:"数量输入请在0-99999999之间"}],goods_name:[{required:!0,message:"请选择商品"}],allocation_name:[{required:!0,message:"请选择货位"}],purchase_price:[{required:!0,message:"请输入采购价"}]},tableColumn:[{type:"checkbox",width:44,align:"center"},{title:"序号",type:"seq",width:50},{title:"操作",fixed:"right",width:80,field:"goods_id",slots:{default:function(e,i){return[i("i",{class:"el-icon-document",on:{click:function(){t.$refs.xTable._copyRow(e.row)}},style:"cursor: pointer;font-size: 15px;line-height: 28px;"})]}}},{title:"商品编号",field:"goods_id",width:80},{title:"商品名称",field:"goods_name",width:400,editRender:{name:"vGoods",getParams:function(e){var i=e.row;return{params:{isTotal:1,company_id:t.params.company_id,warehouse_id:t.params.warehouse_id,is_incomplete:0},getIcon:function(){return i.goods_name?[{icon:"el-icon-close",title:"删除商品",iconMethod:function(){for(var t in i)i[t]=""}}]:[]}}},events:{change:function(e,i){var a=i.row;["allocation_id","allocation_name","batch_id","unit_name","factory_code","purchase_price","production_time","return_goodsNum","refund_goods_id","goods_price"].forEach((function(t){a[t]="refund_goods_id"==t?0:null}));var n=["goods_id","goods_sn","stocks","factory_code","purchase_price","unit_name","taxrate"];n.forEach((function(t){a[t]=e[t]}));var r=t.$refs.xTable._proxy("getTableData").fullData;r[r.length-1].goods_name&&t.addF()}}}},{title:"年周/批次",field:"batch",width:120,editRender:{name:"vBatch",getParams:function(e){var i=e.row;return{url:"getGoodsBatchList",params:{company_id:t.params.company_id,warehouse_id:t.params.warehouse_id,goods_id:i.goods_id?i.goods_id:""}}},events:{change:function(t,e){var i=e.row;["batch","batch_id","production_time","allocation_id","allocation_name"].forEach((function(e){i[e]=t[e]}))}}}},{title:"生产日期",field:"production_time",width:100,slots:{header:function(t,e){return[e("el-tooltip",{class:"item",attrs:{content:"Bottom center",effect:"light"}},[e("p",{slot:"content"},["生产日期列后期将会隐藏，同时新增商品入库日期列"]),e("span",{class:"el-icon-question",style:"cursor:pointer;font-weight:bold;"},["生产日期"])])]}}},{title:"单位",field:"unit_name",width:100},{title:"货位名称",field:"allocation_name",width:130,editRender:{name:"vAllocation",getParams:function(e){var i=e.row;return{url:"newAllocationListList",isPage:!0,params:{company_id:t.params.company_id?t.params.company_id:"",warehouse_id:t.params.warehouse_id?t.params.warehouse_id:"",goods_id:i.goods_id,is_incomplete:0,batch:i.batch}}},events:{change:function(t,e){var i=t.row;i.allocation_id=e.allocation_id,i.allocation_name=e.allocation_name}}}},{title:"数量",field:"goods_num",headerAlign:"right",align:"right",width:110,editRender:{name:"number",events:{input:this.computedPrice}}},{title:"采购价",field:"purchase_price",headerAlign:"right",align:"right",width:132,editRender:{name:"Vinput",formatter:"String",events:{input:this.computedPrice}}},{title:"小计金额",field:"goods_price",headerAlign:"right",align:"right",width:132,editRender:{name:"Vinput",events:{input:this.computedPrice}}},{field:"revenue_price",showOverflow:!0,title:"税额",width:100,editRender:{autoselect:!0,name:"vNumber",events:{input:this.computedPrice}}},{field:"no_revenue_price",showOverflow:!0,width:100,title:"不含税金额"},{title:"工厂代码",field:"factory_code",width:150},{title:"备注",field:"remark",width:200,editRender:{name:"Vinput",formatter:"String"}}]}},methods:{isEdit:function(t){var e=t.row,i=t.column;return"goods_name"!==i.property&&"batch"!==i.property||1!==this.line?!("batch"===i.property&&!e.goods_name)||(this.$publicFution.confirm("请先选择商品"),!1):(this.$publicFution.confirm("引用单据不可修改"),!1)}}}}}]);
//# sourceMappingURL=chunk-bb2dcd80.f50375c9.js.map