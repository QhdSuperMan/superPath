(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-b1453f3a"],{bd24:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"params"},[a("div",{attrs:{id:"leixin"}},[a("div",{staticClass:"search_container"},[a("el-form",{ref:"filterFormRef",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[a("el-form-item",{attrs:{label:"采购组织",size:"mini"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",maxlength:"100"},on:{focus:e.companyListInvok,change:e.companyChange},model:{value:e.params.company_id,callback:function(t){e.$set(e.params,"company_id",t)},expression:"params.company_id"}},e._l(e.companyList,(function(t){return a("el-option",{key:t.company_id,attrs:{label:t.company_name,value:t.company_id}},[a("span",{class:1==t.type?"optionStyle":""},[e._v(e._s(t.company_name))])])})),1)],1),a("el-form-item",{attrs:{label:"业务日期",size:"mini"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.timeValue,callback:function(t){e.timeValue=t},expression:"timeValue"}})],1),a("el-form-item",{attrs:{label:"单据号",size:"mini"}},[a("el-input",{attrs:{maxlength:"100",placeholder:"请输入",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch(1)}},model:{value:e.params.order_sn,callback:function(t){e.$set(e.params,"order_sn",t)},expression:"params.order_sn"}})],1),a("el-form-item",{attrs:{label:"供应商(厂家)",size:"mini"}},[a("el-select",{attrs:{clearable:"",maxlength:"100","filter-method":e.supplierListInvok,filterable:"",placeholder:"请选择"},on:{change:e.supplierChangesave,focus:e.supplierListInvok},model:{value:e.params.supplier_id,callback:function(t){e.$set(e.params,"supplier_id",t)},expression:"params.supplier_id"}},e._l(e.supplierList,(function(e){return a("el-option",{key:e.supplier_id,attrs:{label:e.supplier_name,value:e.supplier_id}})})),1)],1),a("el-form-item",{attrs:{label:"订单类型",size:"mini"}},[a("el-select",{attrs:{clearable:""},model:{value:e.params.order_type,callback:function(t){e.$set(e.params,"order_type",t)},expression:"params.order_type"}},[a("el-option",{attrs:{label:"全部",value:""}},[e._v("全部")]),a("el-option",{attrs:{label:"普通订单",value:1}},[e._v("普通订单")]),a("el-option",{attrs:{label:"首配订单",value:2}},[e._v("首配订单")])],1)],1),a("el-form-item",{attrs:{label:"部门",size:"mini"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",maxlength:"100"},on:{focus:e.DepartmentListInvok,change:e.departmentChange},model:{value:e.params.department_id,callback:function(t){e.$set(e.params,"department_id",t)},expression:"params.department_id"}},e._l(e.departmentList,(function(e){return a("el-option",{key:e.department_id,attrs:{label:e.department_name,value:e.department_id}})})),1)],1),a("el-form-item",{attrs:{label:"采购员",size:"mini"}},[a("erpEmployee",{attrs:{title:"请选择采购员",searchParams:{company_id:e.params.company_id}},model:{value:e.params.buyer_id,callback:function(t){e.$set(e.params,"buyer_id",t)},expression:"params.buyer_id"}})],1),a("el-form-item",{attrs:{label:"来源单号",size:"mini"}},[a("el-input",{attrs:{maxlength:"100",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch(1)}},model:{value:e.params.plan_sn,callback:function(t){e.$set(e.params,"plan_sn",t)},expression:"params.plan_sn"}})],1),a("el-form-item",{attrs:{label:"审核日期",size:"mini"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.checkTime,callback:function(t){e.checkTime=t},expression:"checkTime"}})],1),a("el-form-item",{attrs:{label:"支付方式",size:"mini"}},[a("el-select",{attrs:{clearable:""},model:{value:e.params.pay_method,callback:function(t){e.$set(e.params,"pay_method",t)},expression:"params.pay_method"}},[a("el-option",{attrs:{label:"全部",value:0}},[e._v("全部")]),a("el-option",{attrs:{label:"在线支付",value:1}},[e._v("在线支付")]),a("el-option",{attrs:{label:"线下支付",value:2}},[e._v("线下支付")])],1)],1),a("el-form-item",{attrs:{label:"审核状态",size:"mini"}},[a("el-select",{attrs:{clearable:""},model:{value:e.params.auditor_status,callback:function(t){e.$set(e.params,"auditor_status",t)},expression:"params.auditor_status"}},[a("el-option",{attrs:{label:"全部",value:0}},[e._v("全部")]),a("el-option",{attrs:{label:"未审核",value:1}},[e._v("未审核")]),a("el-option",{attrs:{label:"已审核",value:2}},[e._v("已审核")]),a("el-option",{attrs:{label:"作废",value:3}},[e._v("作废")]),a("el-option",{attrs:{label:"关闭",value:4}},[e._v("关闭")])],1)],1),1!=e.is_company_service?a("el-form-item",{attrs:{label:"转单状态",size:"mini"}},[a("el-select",{attrs:{clearable:""},model:{value:e.params.turn_order_status,callback:function(t){e.$set(e.params,"turn_order_status",t)},expression:"params.turn_order_status"}},[a("el-option",{attrs:{label:"全部",value:0}},[e._v("全部")]),a("el-option",{attrs:{label:"未转单",value:1}},[e._v("未转单")]),a("el-option",{attrs:{label:"已转单",value:2}},[e._v("已转单")])],1)],1):e._e(),e.is_company_service?a("el-form-item",{attrs:{label:"商城订单号",size:"mini"}},[a("el-input",{attrs:{maxlength:"100",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch(1)}},model:{value:e.params.ec_order_sn,callback:function(t){e.$set(e.params,"ec_order_sn",t)},expression:"params.ec_order_sn"}})],1):e._e(),a("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.onSearch(1)}}},[e._v("查询")]),a("el-button",{attrs:{plain:"",size:"mini"},on:{click:e.onReset}},[e._v("重置")])],1)],1)],1),a("div",{staticClass:"add_delet"},[1==e.authority.b_add?a("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:e.orderAdd}},[e._v("新增")]):e._e(),1==e.authority.b_del?a("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.deletes}},[e._v("删除")]):e._e(),1==e.authority.b_pass?a("el-button",{staticClass:"iconfont icon-pass",attrs:{type:"primary",size:"mini"},on:{click:e.shenHe}},[e._v("审核")]):e._e(),1==e.authority.b_nopass?a("el-button",{attrs:{plain:"",size:"mini"},on:{click:e.AUDIT_GET}},[e._v("弃审")]):e._e(),e.authority.b_close?a("el-button",{attrs:{plain:"",icon:"el-icon-circle-close-outline",size:"mini"},on:{click:e.closeF}},[e._v("关闭")]):e._e(),1==e.authority.b_import?a("el-button",{staticClass:"addBtn",attrs:{plain:"",icon:"iconfont icon-daoru5",size:"mini"},on:{click:e.dialogEmployee}},[e._v("导入")]):e._e(),a("el-button",{attrs:{plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.downloadF}},[e._v("下载模板")])],1),e.tableColumn.length>0?a("xTable",{ref:"xTable",attrs:{ajax:{url:"orderGetOrderList",params:e.params},tableColumn:e.tableColumn,xData:e.TableData.tableData},on:{getData:e.dealData}}):e._e(),a("upload",{ref:"upload",attrs:{options:e.options},on:{receiveUploadMsg:e.receiveUploadMsg}})],1)])},i=[],s=a("5530"),n=(a("d3b7"),a("4de4"),a("caad"),a("2532"),a("d81d"),a("a9e3"),a("2f62")),o=a("cf50"),l=a("65b0"),d={auditor_status:0,order_type:"",pay_method:0},p={data:function(){var e=this,t=this.$createElement;return console.log(this.is_company_service),{tableColumn:[{type:"checkbox",width:44,align:"center"},{title:"采购组织",field:"company_name",width:130},{title:"订单类型",field:"order_type_name",width:85},{title:"操作",width:150,fixed:"right",slots:{default:function(a){var r=[];if(2===Number(a.row.order_source)){var i=Number(a.row.order_status);10===i?r.push(t("el-button",{attrs:{size:"small",type:"text",disabled:4==a.row.auditor_status},on:{click:function(){return e.payMoney(a)}}},[" 付款 "])):1==e.authority.b_turn&&1!=a.row.is_relation&&1!=e.is_company_service&&r.push(t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(){e.turnSaleOrder(a.row)}}},["转单"]))}return 1==e.is_company_service&&r.push(t("el-button",{attrs:{size:"small",type:"text",disabled:1==a.row.is_relation||1==a.row.auditor_status||0===Number(a.row.is_instorage)||a.row.order_status<30},on:{click:[function(){return e.orderModify(a,a.row)},function(){return e.storage(a)}]}},[" 入库 "])),[t("el-button",{attrs:{size:"small",type:"text",disabled:1!=e.authority.b_info},on:{click:function(){return e.orderSee(a,a.row)}}},[" 查看 "]),t("el-button",{attrs:{size:"small",type:"text",disabled:1!==a.row.auditor_status},on:{click:function(){return e.orderModify(a,a.row)}}},[" 修改  "]),r]}}},{field:"order_sn",width:156,title:"单据号",slots:{default:function(t,a){return[a("a",{on:{click:function(){return e.orderSee(t,t.row)}}},[" ",t.row.order_sn," "])]}}},{title:"供应商(厂家)",field:"supplier_name",width:150},{title:"采购数量",field:"num",headerAlign:"right",align:"right",width:70},{title:"总计金额",field:"total_price",headerAlign:"right",align:"right",width:100,formatter:"priceFormat"},{title:"部门",field:"department_name",width:100},{title:"采购员",field:"buyer_name",width:100},{title:"创建人",field:"add_user_name",width:84},{title:"支付方式",field:"pay_method_name",width:85},{title:"业务日期",field:"business_time",width:100},{title:"单据时间",field:"add_time",width:150},{title:"来源单号",field:"plan_sn",width:156},{title:"商城订单号",field:"ec_order_sn",visible:Boolean(Number(localStorage.getItem("is_company_service"))),width:156},{title:"审核状态",field:"auditor_status_name",width:70},{title:"订单状态",field:"order_status_name",width:70},{title:"审核人",field:"auditor_name",width:84},{title:"审核时间",field:"auditor_time",width:150},{title:"修改人",field:"update_user_name",width:84},{title:"修改时间",field:"update_time",width:150},{title:"转单次数",field:"turn_order_count",width:140},{title:"备注",field:"remark",width:120}]}},methods:{initParams:function(){this.$route.params.type?this.params=Object.assign({},this.params,{auditor_status:1}):this.params=Object.assign({},this.params,this.$route.params),this.onSearch(1)},storage:function(e){var t=e.row;this.$router.push({path:"/purchase/instorage/instorageAdd",query:{order_id:t.order_id}})},refund:function(e){var t=e.row;this.$router.push({path:"/purchase/refundRequest/refundRequestAdd",query:{id:t.ec_order_sn}})},return:function(e){var t=e.row;this.$router.push({path:"/purchase/order/jybdorderSee",query:{id:t.ec_order_sn}})}}},c={name:"purchaseOrderIndex",mixins:[o["a"],p],data:function(){return{options:{title:"导入",url:"/purchase/OrderExcel/importClaim"},checkTime:[],authority:{},params:this.$publicFution.deepCopy(d),timeValue:[],newresult:[]}},computed:Object(s["a"])({},Object(n["c"])(["orderIndexGet"])),methods:Object(s["a"])(Object(s["a"])({},Object(n["b"])(["orderAddACT","orderSeeACT","orderIndexACT"])),{},{dialogEmployee:function(){this.$refs.upload.stateOpen()},receiveUploadMsg:function(e){this.onSearch()},payMoney:function(e){var t=this,a=e.row;1==a.pay_method?this.$axMethod.OrderdoPay({order_id:a.order_id}).then((function(e){var a=e.data;if(200==a.code){console.log(a);var r={cashier_token:a.data.pay_data.cashier_token,pay_trade_no:a.data.pay_data.pay_trade_no,token:a.data.pay_data.user_pay_token};t.$router.push({name:"PlaceholderPaycenter",params:r})}})):this.$router.push({path:"/MoneyManagement/Checkstand",query:{id:a.ec_pay_sn}})},closeF:function(){var e=this;if(this.multipleSelection.length<1)return this.$message({message:"请选择需要关闭的订单",type:"warning"}),!1;for(var t=[],a=0;a<this.multipleSelection.length;a++)t.push(this.multipleSelection[a].order_id);var r=t.toString();this.$axMethod.closePurchaseOrder({order_id:r}).then((function(t){200==t.data.code&&(e.$message({message:t.data.data,type:"success"}),e.onSearch())}))},employeeChange:function(e){e?this.params.buyer_name=this.employeeList.filter((function(t){return t.employee_id===e}))[0].employee_name:(this.params.buyer_name="",this.params.buyer_id="")},AUDIT_GET:function(){var e=this;if(this.multipleSelection.length<1)return this.$message({message:"请选择需要弃审的信息",type:"warning"}),!1;for(var t=[],a=0;a<this.multipleSelection.length;a++)t.push(this.multipleSelection[a].order_id);var r=t.toString();this.$axMethod.auditorNoPassOrder({order_id:r}).then((function(t){200==t.data.code&&(e.$message({message:t.data.data,type:"success"}),e.onSearch())}))},downloadF:function(){this.$axMethod.downloadFileUrlOrder().then((function(e){200==e.data.code&&(window.location.href=e.data.data.url)}))},companyChange:function(e){e?this.params.company_name=this.companyList.filter((function(t){return t.company_id===e}))[0].company_name:(this.params.company_name="",this.params.company_id=""),this.$set(this.params,"supplier_id",""),this.$set(this.params,"department_id",""),this.$set(this.params,"buyer_id","")},supplierChangesave:function(e){e?this.params.supplier_name=this.supplierList.filter((function(t){return t.supplier_id===e}))[0].supplier_name:(this.params.supplier_name="",this.params.supplier_id="")},departmentChange:function(e){e?this.params.department_name=this.departmentList.filter((function(t){return t.department_id===e}))[0].department_name:(this.params.department_name="",this.params.department_id=""),this.$set(this.params,"buyer_id","")},selectRowChangeBg:function(e){var t=e.row;e.rowIndex;return this.multipleSelection.length&&this.multipleSelection.map((function(e){return e.order_id})).includes(t.order_id)?"background:#d4e1ee":""},shenHe:function(){if(this.multipleSelection.length<1)return this.$message({message:"请选择需要审核的数据！",type:"warning"}),!1;for(var e=[],t=0;t<this.multipleSelection.length;t++)e.push(this.multipleSelection[t].order_id);var a={examineID:"order_id",eachData:{order_id:e.toString()},examineApi:"orderAuditorOrder",list:{UrlApi:"orderGetOrderList",data:this.TableData,esData:this.params}};this.$common.examineFun(a,this.onSearch)},zuofei:function(){if(this.multipleSelection.length<1)return this.$message({message:"请选择废除的数据！",type:"warning"}),!1;for(var e=[],t=0;t<this.multipleSelection.length;t++)e.push(this.multipleSelection[t].order_id);var a={examineID:"order_id",eachData:{order_id:e.toString()},examineApi:"orderAuditorInvalid",list:{UrlApi:"orderGetOrderList",data:this.TableData,esData:this.params}};this.$common.examineFun(a,this.onSearch)},onReset:function(){this.timeValue=[],this.checkTime=[],this.params=this.$publicFution.deepCopy(d),this.onSearch(1)},orderSee:function(e,t){this.orderSeeACT({order_id:t.order_id,goPage:this.goPage,params:this.params,pageSize:this.pageSize}),this.$router.push({path:"/purchase/order/orderSee"})},orderAdd:function(){this.$router.push({path:"/purchase/order/orderAdd"}),this.orderAddACT({order_id:"",goPage:this.goPage,params:this.params,pageSize:this.pageSize})},orderModify:function(e,t){this.orderAddACT({order_id:t.order_id,goPage:this.goPage,params:this.params,pageSize:this.pageSize}),this.$router.push({path:"/purchase/order/orderAdd"})},timeF:function(){this.timeValue?(this.params.start_time=this.timeValue[0],this.params.end_time=this.timeValue[1]):this.params.start_time=this.params.end_time="",this.checkTime?(this.params.audit_start_time=this.checkTime[0],this.params.audit_end_time=this.checkTime[1]):this.params.audit_start_time=this.params.audit_end_time=""},onSearch:function(e){this.timeF(),this.$refs.xTable._getData(e)},deletes:function(){var e={deleID:"order_id",deleSelect:this.multipleSelection,deleApi:"delOrder",list:{UrlApi:"orderGetOrderList",data:this.TableData,esData:{page:this.goPage}}};this.$common.deletes(e,"删除",this,this.onSearch)}}),activated:function(){this.$set(this,"params",{company_id:Number(localStorage.company_id)}),Object(l["l"])(this,localStorage),this.initParams()}},m=c,u=a("2877"),h=Object(u["a"])(m,r,i,!1,null,"c9b3a6a2",null);t["default"]=h.exports},cf50:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("5530"),i=(a("d3b7"),a("159b"),a("b64b"),a("a9e3"),a("d81d"),a("2f62")),s=a("65b0"),n={data:function(){return{}},activated:function(){var e=this.$route.params;e.transferType&&this.portStockEarlyWarningChangeOrderInfo(e)},methods:Object(r["a"])(Object(r["a"])({},Object(i["b"])(["salesorderAdd"])),{},{getRebatePrice:function(){var e=this;this.params.supplier_id&&this.params.company_id&&this.$axMethod.getRebatePrice({brand_id:-1,supplier_id:this.params.supplier_id,company_id:this.params.company_id}).then((function(t){var a=t.data;200==a.code&&e.$set(e.params,"rebate_balance",a.data.rebate_balance)}))},turnSaleOrder:function(e){this.salesorderAdd({type:"采购单转销售订单",Buy_order:e,random:Math.floor(1e4*Math.random())}),this.$router.push({path:"/sales/salesorder/salesorderAdd"})},portStockEarlyWarningChangeOrderInfo:function(e){var t=this;this.loading=!0,this.$axMethod.stockEarlyWarningChangeOrderInfo(e.portParams).then((function(a){var r=a.data;if(t.loading=!1,200==r.code){var i=r.data.info,n=r.data.goods_list;switch(Object.keys(i).forEach((function(e){t.$set(t.params,e,i[e])})),t.params.remark=i.abstract,0==t.params.warehouse_id&&(t.params.warehouse_id=""),Number(localStorage.company_id)!=i.company_id?(t.$set(t.params,"department_id",""),t.$set(t.params,"buyer_id","")):t.params.department_id||(t.$set(t.params,"department_id",Number(localStorage.department_id)),t.$set(t.params,"buyer_id",Number(localStorage.employee_id))),Object(s["l"])(t,i),e.transferType){case 1:t.orderAddGet.order_id&&t.orderIndexACT({}),n=n.map((function(e){return e.unit_name&&delete e.unit_name,e.unit_id&&delete e.unit_id,e.remaining_goods_num=e.goods_num,t.handleEdit({row:e,column:{property:"goods_num"}}),e})),t.$refs.xTable._proxy("loadData",n);break;case 2:n=n.map((function(e){e.batch||t.$set(e,"batch",t.getWeek()),t.$set(e,"remaining_goods_num",e.goods_num),e.goods_num&&delete e.goods_num;var a={num:"remaining_goods_num",price:"purchase_price",totalPrice:"subtotal_price"};return t.$publicFution.computeTotal(e,a,"remaining_goods_num",t),e})),t.tableData=n;break}}})).catch((function(e){console.log(e),t.loading=!1,t.$message({type:"error",message:"转单失败请重试"})}))}})}}}]);
//# sourceMappingURL=chunk-b1453f3a.f7ccbb66.js.map