(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-44c7491e"],{"41cd":function(e,a,t){},"81d5":function(e,a,t){"use strict";var i=t("7b0b"),r=t("23cb"),s=t("07fa");e.exports=function(e){var a=i(this),t=s(a),o=arguments.length,n=r(o>1?arguments[1]:void 0,t),l=o>2?arguments[2]:void 0,c=void 0===l?t:r(l,t);while(c>n)a[n++]=e;return a}},"9b97":function(e,a,t){"use strict";t("41cd")},cb29:function(e,a,t){var i=t("23e7"),r=t("81d5"),s=t("44d2");i({target:"Array",proto:!0},{fill:r}),s("fill")},f19a:function(e,a,t){"use strict";t.r(a);var i=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",[e._v("库存管理")]),t("el-breadcrumb-item",{staticClass:"attrbute"},[t("span",{on:{click:e.goBack}},[e._v("其他入库管理")])]),t("el-breadcrumb-item",[e._v(e._s(e.title)+"其他入库单")])],1),t("div",{staticClass:"search_container"},[t("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[t("el-form-item",{attrs:{label:"库存组织",size:"mini",prop:"company_id",rules:e.rules.company_id}},[e._v(" "+e._s(function(){0==e.params.company_id&&(e.params.company_id=null)}())+" "),t("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",disabled:e.disabled},on:{focus:e.companyListInvok,change:e.companyChange},model:{value:e.params.company_id,callback:function(a){e.$set(e.params,"company_id",a)},expression:"params.company_id"}},e._l(e.companyList,(function(a){return t("el-option",{key:a.company_id,attrs:{label:a.company_name,value:a.company_id}},[t("span",{class:1==a.type?"optionStyle":""},[e._v(e._s(a.company_name))])])})),1)],1),t("el-form-item",{attrs:{label:"单据号",size:"mini"}},[t("el-input",{attrs:{disabled:""},model:{value:e.params.instorage_sn,callback:function(a){e.$set(e.params,"instorage_sn",a)},expression:"params.instorage_sn"}})],1),t("el-form-item",{attrs:{label:"业务日期",size:"mini",prop:"business_time",rules:e.rules.business_time}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.params.business_time,callback:function(a){e.$set(e.params,"business_time",a)},expression:"params.business_time"}})],1),t("el-form-item",{attrs:{label:"仓库名称",size:"mini",prop:"warehouse_id",rules:e.rules.warehouse_id}},[e._v(" "+e._s(function(){0==e.params.warehouse_id&&(e.params.warehouse_id=null)}())+" "),t("el-select",{attrs:{placeholder:"请选择",filterable:""},on:{focus:e.warehouseInvok,change:e.warehouseChange},model:{value:e.params.warehouse_id,callback:function(a){e.$set(e.params,"warehouse_id",a)},expression:"params.warehouse_id"}},e._l(e.warehouseList,(function(e){return t("el-option",{key:e.warehouse_id,attrs:{label:e.warehouse_name,value:e.warehouse_id}})})),1)],1),t("el-form-item",{attrs:{label:"入库类型",size:"mini"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.params.type,callback:function(a){e.$set(e.params,"type",a)},expression:"params.type"}},[t("el-option",{attrs:{label:"其他入库",value:2}})],1)],1),t("el-form-item",{attrs:{label:"供应商(厂家)",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.supplier_id&&(e.params.supplier_id=null)}())+" "),t("el-select",{attrs:{clearable:"",maxlength:"100","filter-method":e.supplierListInvok,filterable:"",placeholder:"请选择"},on:{focus:e.supplierListInvok},model:{value:e.params.supplier_id,callback:function(a){e.$set(e.params,"supplier_id",a)},expression:"params.supplier_id"}},e._l(e.supplierList,(function(e){return t("el-option",{key:e.supplier_id,attrs:{label:e.supplier_name,value:e.supplier_id}})})),1)],1),t("el-form-item",{attrs:{label:"部门",size:"mini",filterable:""}},[e._v(" "+e._s(function(){0==e.params.department_id&&(e.params.department_id=null)}())+" "),t("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",disabled:e.disabled},on:{focus:e.DepartmentListInvok,change:e.departmentChange},model:{value:e.params.department_id,callback:function(a){e.$set(e.params,"department_id",a)},expression:"params.department_id"}},e._l(e.departmentList,(function(e){return t("el-option",{key:e.department_id,attrs:{label:e.department_name,value:e.department_id}})})),1)],1),t("el-form-item",{attrs:{label:"采购员",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.buyer_id&&(e.params.buyer_id=null)}())+" "),t("el-select",{attrs:{clearable:"",placeholder:"请选择",disabled:e.disabled},on:{focus:e.EmployeeListInvok},model:{value:e.params.buyer_id,callback:function(a){e.$set(e.params,"buyer_id",a)},expression:"params.buyer_id"}},e._l(e.employeeList,(function(e){return t("el-option",{key:e.employee_id,attrs:{label:e.employee_name,value:e.employee_id}})})),1)],1),t("el-form-item",{attrs:{label:"其他费用",size:"mini"}},[t("el-input",{attrs:{placeholder:"金额"},on:{change:e.calcPrice,blur:e.calcPrice},model:{value:e.params.other_price,callback:function(a){e.$set(e.params,"other_price",a)},expression:"params.other_price"}},[t("el-select",{staticClass:"styleInput",attrs:{slot:"prepend",clearable:"",disabled:!e.vxeTableData.length},on:{change:e.calcPrice},slot:"prepend",model:{value:e.params.other_price_type,callback:function(a){e.$set(e.params,"other_price_type",a)},expression:"params.other_price_type"}},e._l(e.otherPriceType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-form-item",{attrs:{label:"付款方式",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.receivables_mode_id&&(e.params.receivables_mode_id=null)}())+" "),t("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{focus:e.receivablesInvok},model:{value:e.params.receivables_mode_id,callback:function(a){e.$set(e.params,"receivables_mode_id",a)},expression:"params.receivables_mode_id"}},e._l(e.receivablesList,(function(e){return t("el-option",{key:e.receivables_mode_id,attrs:{label:e.receivables_mode_name,value:e.receivables_mode_id}})})),1)],1),t("el-form-item",{attrs:{label:"关联单据号",size:"mini"}},[t("el-input",{attrs:{disabled:""},model:{value:e.params.order_sn,callback:function(a){e.$set(e.params,"order_sn",a)},expression:"params.order_sn"}})],1),t("el-form-item",{attrs:{label:"厂家发货单号",size:"mini"}},[t("el-input",{model:{value:e.params.factorysend_sn,callback:function(a){e.$set(e.params,"factorysend_sn",a)},expression:"params.factorysend_sn"}})],1),t("el-form-item",{attrs:{label:"厂家发货日期",size:"mini"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.params.factorysend_time,callback:function(a){e.$set(e.params,"factorysend_time",a)},expression:"params.factorysend_time"}})],1),t("el-form-item",{attrs:{label:"打印次数",size:"mini"}},[t("el-input",{attrs:{disabled:""},model:{value:e.params.print_times,callback:function(a){e.$set(e.params,"print_times",a)},expression:"params.print_times"}})],1)],1)],1),t("div",{staticClass:"add_delet"},[t("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini",disabled:e.disabled},on:{click:e.addF}},[e._v("增行")]),t("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.deleteF}},[e._v("删行")])],1),t("div",{staticClass:"table_container"},[t("xTable",{ref:"xTable",attrs:{isEdit:e.isEdit,tableColumn:e.tableColumn,showFooter:!0,totalArray:["goods_num","subtotal_price"]}}),t("div",{staticClass:"refundauditFoot"},[t("div",{staticStyle:{margin:"15px 0"}},[t("el-input",{attrs:{placeholder:"请输入",maxlength:"300"},model:{value:e.params.remark,callback:function(a){e.$set(e.params,"remark",a)},expression:"params.remark"}},[t("template",{slot:"prepend"},[e._v("备注")])],2)],1),"新增"==e.title?[t("span",[e._v("创建人："+e._s(e.add_user_name))])]:[t("span",[e._v("创建人："+e._s(e.params.add_user_name))]),t("span",[e._v("创建时间："+e._s(e.params.add_time))]),t("span",[e._v("审核人："+e._s(e.params.auditor_name))]),t("span",[e._v("审核时间："+e._s(e.params.auditor_time))]),t("span",[e._v("修改人："+e._s(e.params.update_user_name))]),t("span",[e._v("修改时间："+e._s(e.params.update_time))])]],2)],1),t("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center","margin-top":"20px"}},[t("el-button",{on:{click:e.goBack}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",disabled:!e.isCanSumbit},on:{click:function(a){return e.submit("ruleForm")}}},[e._v("确 定")])],1)],1)},r=[],s=t("b85c"),o=(t("d3b7"),t("159b"),t("4de4"),t("99af"),t("a9e3"),t("e9c4"),t("cb29"),t("caad"),t("65b0"));t("25f0");function n(){var e=new Date,a=new Date(e.getFullYear(),0,1),t=a.getDay(),i=1;0!=t&&(i=7-t+1),a=new Date(e.getFullYear(),0,1+i);var r=Math.ceil((e.valueOf()-a.valueOf())/864e5),s=2==String(Math.ceil(r/7)+1).length?Math.ceil(r/7)+1:"0".concat(Math.ceil(r/7)+1),o=e.getFullYear().toString().substring(2);return"".concat(s).concat(o)}var l={goods_id:"",goods_num:"",allocation_id:"",allocation_name:"",remark:"",purchase_price:"",batch:n(),subtotal_price:""},c={instorage_goods_id:0,goods_id:"",goods_num:"",allocation_id:"",remark:"",purchase_price:"",batch:n(),subtotal_price:""},d={data:function(){var e=this,a=this.$createElement;return{activateScope:{},tableColumn:[{type:"checkbox",width:44},{field:"id",title:"操作",fixed:"right",width:54,slots:{default:function(t){var i=t.row;return[a("i",{class:"el-icon-document",on:{click:function(){e.$refs.xTable._copyRow(i),e.calcPrice()}},style:"cursor: pointer;font-size: 15px;"})]}}},{title:"商品编号",field:"goods_id",width:80},{title:"商品名称",field:"goods_name",width:350,editRender:{name:"vGoods",getParams:function(){return{params:{company_id:e.params.company_id},showObj:{goods_id:"商品编号",goods_name:"商品名称",unit_name:"单位",brand_name:"品牌",specification_type:"规格型号",factory_code:"工厂代码"}}},events:{change:this.changeGoods}}},{title:"年周/批次",field:"batch",width:150,editRender:{name:"number",placeholder:"周周年年,如1421",events:{blur:this.blurChange}}},{title:"单位",field:"unit_name",width:100},{title:"入库数量",field:"goods_num",headerAlign:"right",align:"right",width:110,editRender:{name:"number",events:{input:this.handleEdit,change:this.calcPrice}}},{title:"采购价",field:"purchase_price",headerAlign:"right",align:"right",width:132,editRender:{name:"Vinput",events:{input:this.handleEdit,change:this.calcPrice}}},{title:"小计金额",field:"subtotal_price",headerAlign:"right",align:"right",width:132,editRender:{name:"Vinput",events:{input:this.handleEdit,change:this.calcPrice}}},{title:"货位名称",field:"allocation_name",width:130,editRender:{name:"vAllocation",getParams:function(a){var t=a.row;return{url:"newAllocationList",isPage:!0,params:{company_id:e.params.company_id,warehouse_id:e.params.warehouse_id,goods_id:t.goods_id}}},events:{change:function(e,a){var t=e.row;t.allocation_id=a.allocation_id,t.allocation_name=a.allocation_name}}}},{title:"其他费用",field:"other_price",headerAlign:"right",align:"right",width:100},{title:"备注",field:"remark",editRender:{name:"Vinput",formatter:"String"}}]}},methods:{isEdit:function(e){return this.activateScope=!1,"allocation_name"===e.column.property&&(this.activateScope=e),!0},blurChange:function(e){var a=e.row;(4!=a.batch.toString().length||a.batch.toString().substr(0,2)>52||a.batch.toString().substr(2,2)>21)&&(this.$message.warning("年周/批次填写错误，标准格式：周周年年，如1421"),this.$set(a,"batch",""))},getWeek:n}},p={name:"instorageOtheninstorageInstorageAdd",mixins:[d],data:function(){return{title:"新增",isCanSumbit:!0,vxeTableData:{length:0},loading:!1,supplierList:[],disabled:!1,otherPriceType:[{value:0,label:"不分摊"},{value:1,label:"按金额分摊"},{value:2,label:"按数量分摊"}],add_user_name:localStorage.employee_name}},methods:{warehouseChange:function(e){var a=this;this.$refs.xTable._proxy("getTableData").fullData.forEach((function(e){e.allocation_name="",e.allocation_id="",a.getAllocationList(e)}));var t=this.warehouseList.filter((function(a){return a.warehouse_id===e}));this.params.warehouse_name=t[0]?t[0].warehouse_name:""},changeGoods:function(e,a){var t=a.row;t.goods_id=e.goods_id,t.unit_name=e.unit_name,t.purchase_price=e.purchase_price;var i=["remaining_goods_num","subtotal_price","allocation_id"];i.forEach((function(e){var a=null;"subtotal_price"===e&&(a=0),t[e]=a})),this.getAllocationList(t),this.handleEdit({row:t,column:{property:"goods_num"}});var r=this.$refs.xTable._proxy("getTableData").fullData.concat([]);r[r.length-1].goods_id&&this.addF()},getAllocationList:function(e){var a=this;e.goods_id&&this.$axios({method:"get",url:this.$api.newAllocationList,params:{company_id:this.params.company_id,warehouse_id:this.params.warehouse_id,goods_id:e.goods_id,repeat:!0}}).then((function(t){if(t.data.data){var i,r=Object(s["a"])(t.data.data);try{for(r.s();!(i=r.n()).done;){var o=i.value;1==o.is_system&&(e.allocation_id=o.allocation_id,e.allocation_name=o.allocation_name,a.$refs.xTable._proxy("isActiveByRow",e)&&a.activateScope&&a.$refs.xTable._proxy("clearActived",a.activateScope))}}catch(n){r.e(n)}finally{r.f()}}}))},addF:function(){this.$refs.xTable._proxy("insertAt",this.$publicFution.deepCopy(l),-1)},companyChange:function(){Object(o["a"])(this,this.params),this.$refs.xTable._proxy("loadData",[])},departmentChange:function(){this.$set(this.params,"buyer_id","")},calcPrice:function(){var e=this;if(0==this.params.other_price&&0!=this.params.other_price_type)return this.$message.warning("分摊金额不能为0"),!1;if(0!=this.params.other_price_type){var a=this.$refs.xTable._proxy("getTableData").fullData.concat([]).filter((function(e,a){e.index=a;e.goods_id;var t=e.goods_name,i=e.goods_num,r=e.purchase_price,s=e.subtotal_price,o=e.allocation_id,n=e.remark;return t||i||r||s||o||n}));if(!a.length)return!1;var t=!0,i=[],r=[];if(a.forEach((function(e){Number(e.purchase_price)&&Number(e.goods_num)||(t=!1),r.push(e.index),i.push({goods_num:e.goods_num?e.goods_num:0,purchase_price:e.purchase_price?e.purchase_price:0})})),!t)return!1;this.params.other_price&&this.params.other_price_type&&(this.isCanSumbit=!1,this.$axios({method:"post",url:this.$api.getCountApportionOptions,data:{other_price_type:this.params.other_price_type,other_price:this.params.other_price,goods_info:JSON.stringify(i)}}).then((function(a){if(e.isCanSumbit=!0,200==a.data.code){for(var t=e.$refs.xTable._proxy("getTableData").fullData.concat([]),i=0;i<a.data.data.goods_list.length;i++)t[r[i]].other_price=a.data.data.goods_list[i].other_price;e.$refs.xTable._proxy("loadData",t)}})).catch((function(){e.isCanSumbit=!0})))}else this.$refs.xTable._proxy("getTableData").fullData.forEach((function(e){e.other_price=0}))},goBack:function(){this.$router.push({path:"/inventory/otheninstorage"})},deleteF:function(){this.$refs.xTable._proxy("getCheckboxRecords").length?(this.$refs.xTable._proxy("removeSelecteds"),this.calcPrice()):this.$message({message:"请先选择要删除的订单！",type:"warning"})},submit:function(e){var a=this;this.$refs[e].validate((function(e){if(e){var t=a.$refs.xTable._proxy("getTableData").fullData.concat([]);if(!t.length)return a.$message.error("请完善表格数据"),!1;t[t.length-1].goods_id||t.pop();var i=[];i=t.filter((function(e){e.goods_id;var a=e.goods_name,t=e.goods_num,i=e.purchase_price,r=e.subtotal_price,s=e.allocation_id,o=e.remark;return a||(s="",""),a||t||i||r||s||o}));for(var r=[],s=0;s<i.length;s++){if(!i[s].goods_id||!i[s].goods_name||!i[s].allocation_id||!i[s].goods_num||!i[s].batch||!Number(i[s].purchase_price)&&0!==Number(i[s].purchase_price))return a.$message.error({message:"请完善表格已手填信息行的数据"}),!1;r.push(a.$publicFution.filter(c,i[s]))}var o={type:a.params.type,order_id:a.params.order_id,supplier_id:a.params.supplier_id,company_id:a.params.company_id,department_id:a.params.department_id,buyer_id:a.params.buyer_id,factorysend_sn:a.params.factorysend_sn,receivables_mode_id:a.params.receivables_mode_id,business_time:a.params.business_time,factorysend_time:a.params.factorysend_time,remark:a.params.remark,other_price:a.params.other_price,other_price_type:a.params.other_price_type,warehouse_id:a.params.warehouse_id,goods_info:JSON.stringify(r)},n=a.$api.otherStorageAddInStorage;a.instorage_id&&(o.instorage_id=a.$route.query.instorage_id,n=a.$api.otherStorageEditInStorage),a.$baseData.checkComputation(r,{goods_num:"goods_num",total_price:"subtotal_price",goods_price:"purchase_price"}).then((function(){a.$baseData.checkCarDoctor({company_id:a.params.company_id,company_name:a.params.company_name,bill_type:a.params.type?a.params.type:2,bill_id:a.instorage_id,operation_type:a.instorage_id?2:1,goods_info:JSON.stringify(Array(r.length).fill({warehouse_id:a.params.warehouse_id,warehouse_name:a.params.warehouse_name}))}).then((function(){a.$axios({method:"post",url:n,data:o}).then((function(e){200==e.data.code&&(a.$message.success(e.data.msg),a.goBack())}))}))}))}}))},handleEdit:function(e){var a=e.row,t=e.column,i={num:"goods_num",price:"purchase_price",totalPrice:"subtotal_price"};this.$publicFution.computeTotal(a,i,t.property,this)}},mounted:function(){var e=this;if(this.instorage_id=this.$route.query.instorage_id,this.title=this.instorage_id?"修改":"新增",this.instorage_id)this.$axios({method:"get",url:this.$api.otherStorageInfoInStorage,params:{instorage_id:this.instorage_id}}).then((function(a){200==a.data.code&&(e.params=a.data.data.instoragList,e.$refs.xTable._proxy("loadData",a.data.data.goodsList),e.addF(),a.data.data.instoragList.order_sn&&(e.disabled=!0),Object.assign(a.data.data.instoragList,{employee_id:a.data.data.instoragList.buyer_id,employee_name:a.data.data.instoragList.buyer_name}),Object(o["l"])(e,a.data.data.instoragList))}));else{var a=localStorage,t=a.employee_id,i=a.company_admin_id;[0,1,2].includes(Number(t))||i>0?this.$set(this,"params",{business_time:this.$publicFution.formatData(new Date),company_id:Number(localStorage.company_id),type:2}):this.$set(this,"params",{business_time:this.$publicFution.formatData(new Date),company_id:Number(localStorage.company_id),department_id:Number(localStorage.department_id),buyer_id:Number(localStorage.employee_id),type:2}),Object(o["l"])(this,window.localStorage),setTimeout((function(){e.addF()}),200)}}},m=p,u=(t("9b97"),t("2877")),_=Object(u["a"])(m,i,r,!1,null,"28d68242",null);a["default"]=_.exports}}]);
//# sourceMappingURL=chunk-44c7491e.91d5dd53.js.map