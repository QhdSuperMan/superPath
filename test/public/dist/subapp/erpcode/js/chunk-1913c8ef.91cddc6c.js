(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-1913c8ef"],{"2ffb":function(e,t,i){},"64a8":function(e,t,i){"use strict";i("e869")},b680:function(e,t,i){"use strict";var a=i("23e7"),s=i("da84"),r=i("e330"),o=i("5926"),n=i("408a"),l=i("1148"),c=i("d039"),m=s.RangeError,d=s.String,u=Math.floor,_=r(l),p=r("".slice),b=r(1..toFixed),f=function(e,t,i){return 0===t?i:t%2===1?f(e,t-1,i*e):f(e*e,t/2,i)},h=function(e){var t=0,i=e;while(i>=4096)t+=12,i/=4096;while(i>=2)t+=1,i/=2;return t},g=function(e,t,i){var a=-1,s=i;while(++a<6)s+=t*e[a],e[a]=s%1e7,s=u(s/1e7)},v=function(e,t){var i=6,a=0;while(--i>=0)a+=e[i],e[i]=u(a/t),a=a%t*1e7},y=function(e){var t=6,i="";while(--t>=0)if(""!==i||0===t||0!==e[t]){var a=d(e[t]);i=""===i?a:i+_("0",7-a.length)+a}return i},x=c((function(){return"0.000"!==b(8e-5,3)||"1"!==b(.9,0)||"1.25"!==b(1.255,2)||"1000000000000000128"!==b(0xde0b6b3a7640080,0)}))||!c((function(){b({})}));a({target:"Number",proto:!0,forced:x},{toFixed:function(e){var t,i,a,s,r=n(this),l=o(e),c=[0,0,0,0,0,0],u="",b="0";if(l<0||l>20)throw m("Incorrect fraction digits");if(r!=r)return"NaN";if(r<=-1e21||r>=1e21)return d(r);if(r<0&&(u="-",r=-r),r>1e-21)if(t=h(r*f(2,69,1))-69,i=t<0?r*f(2,-t,1):r/f(2,t,1),i*=4503599627370496,t=52-t,t>0){g(c,0,i),a=l;while(a>=7)g(c,1e7,0),a-=7;g(c,f(10,a,1),0),a=t-1;while(a>=23)v(c,1<<23),a-=23;v(c,1<<a),g(c,1,1),v(c,2),b=y(c)}else g(c,0,i),g(c,1<<-t,0),b=y(c)+_("0",l);return l>0?(s=b.length,b=u+(s<=l?"0."+_("0",l-s)+b:p(b,0,s-l)+"."+p(b,s-l))):b=u+b,b}})},d8ba:function(e,t,i){"use strict";i("df1b")},df1b:function(e,t,i){},e869:function(e,t,i){},eb7f:function(e,t,i){"use strict";i("2ffb")},fc36:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",[e._v("客户管理")]),i("el-breadcrumb-item",[e._v("客户结算")]),i("el-breadcrumb-item",{staticClass:"attrbute"},[i("span",{on:{click:e.goBack}},[e._v("客户收款单管理")])]),i("el-breadcrumb-item",[e._v(e._s(e.title)+"收款单")])],1),i("div",{staticClass:"search_container"},[i("el-form",{ref:"params",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[i("el-form-item",{attrs:{label:"财务组织",size:"mini",prop:"company_id",rules:e.rules.company_id}},[e._v(" "+e._s(function(){0==e.params.company_id&&(e.params.company_id=null)}())+" "),i("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",disabled:e.isDisabled},on:{focus:e.companyListInvok,change:e.companyChange},model:{value:e.params.company_id,callback:function(t){e.$set(e.params,"company_id",t)},expression:"params.company_id"}},e._l(e.companyList,(function(t){return i("el-option",{key:t.company_id,attrs:{label:t.company_name,value:t.company_id-0}},[i("span",{class:1==t.type?"optionStyle":""},[e._v(e._s(t.company_name))])])})),1)],1),i("el-form-item",{attrs:{label:"单据号",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.receipt_sn,callback:function(t){e.$set(e.params,"receipt_sn",t)},expression:"params.receipt_sn"}})],1),10002!=e.params.accounts_type_id||e.is_company_service?e._e():i("el-form-item",{attrs:{label:"物流公司",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.logistics_id&&(e.params.logistics_id=null)}())+" "),i("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",disabled:e.isDisabled},on:{focus:e.logisticsInvok,change:e.changeLogistics},model:{value:e.params.logistics_id,callback:function(t){e.$set(e.params,"logistics_id",t)},expression:"params.logistics_id"}},e._l(e.logisticsList,(function(e){return i("el-option",{key:e.logistics_id,attrs:{label:e.logistics_name,value:e.logistics_id}})})),1)],1),10002!=e.params.accounts_type_id||e.is_company_service?e._e():i("el-form-item",{attrs:{label:"物流票号",size:"mini"}},[i("el-input",{attrs:{disabled:e.isDisabled},on:{change:function(t){return e.changeCustomer(t,1)}},model:{value:e.params.logistics_number,callback:function(t){e.$set(e.params,"logistics_number",t)},expression:"params.logistics_number"}})],1),i("el-form-item",{ref:"customer_id",staticClass:"red-star",attrs:{label:"客户名称",size:"mini",prop:"customer_id",rules:[10002,3].includes(e.params.accounts_type_id)?null:e.rules.customer_id}},[e._v(" "+e._s(function(){0==e.params.customer_id&&(e.params.customer_id=null)}())+" "),i("el-select",{ref:"customerId",attrs:{filterable:"",placeholder:"请输入",disabled:e.isDisabled&&10003!==Number(this.params.accounts_type_id),clearable:"",remote:"","remote-method":e.clienteleListInvok},on:{change:function(t){return e.changeCustomer(t,2)},focus:e.clienteleListInvok},model:{value:e.params.customer_id,callback:function(t){e.$set(e.params,"customer_id",t)},expression:"params.customer_id"}},[i("ul",{staticClass:"customer customer-ul4 customer-ul2"},[i("li",[e._v("客户编号")]),i("li",[e._v("客户名称")]),i("li",[e._v("联系人")]),i("li",[e._v("联系电话")]),i("li",[e._v("区域")])]),e._l(e.customerList,(function(t){return i("el-option",{key:t.customer_id,attrs:{label:t.customer_name,value:t.customer_id}},[i("ul",{staticClass:"customer customer-ul4"},[i("li",{attrs:{title:t.customer_id}},[e._v(e._s(t.customer_id))]),i("li",{attrs:{title:t.customer_name}},[e._v(e._s(t.customer_name))]),i("li",{attrs:{title:t.contact_name}},[e._v(e._s(t.contact_name))]),i("li",{attrs:{title:t.customer_mobile}},[e._v(e._s(t.customer_mobile))]),i("li",[e._v(e._s(t.province_name)+"/"+e._s(t.city_name)+"/"+e._s(t.area_name))])])])}))],2)],1),i("el-form-item",{attrs:{label:"预收余额",size:"mini"}},[i("span",[e._v(e._s(e.params.deposits||0))])]),i("el-form-item",{attrs:{label:"应收余额",size:"mini"}},[i("span",[e._v(e._s(e.params.balance||0))])]),i("el-form-item",{attrs:{label:"授信余额",size:"mini"}},[i("span",[e._v(e._s(e.params.credit_balance||0))]),i("span",[e._v("授信额度："+e._s(e.params.credit_quota||0))])]),i("el-form-item",{attrs:{label:"联系人",size:"mini"}},[i("span",[e._v(e._s(e.params.contact_name||""))])]),i("el-form-item",{attrs:{label:"联系电话",size:"mini"}},[i("span",[e._v(e._s(e.params.customer_mobile||""))])]),i("el-form-item",{attrs:{label:"商城订单号",size:"mini"}},[i("span",[e._v(e._s(e.params.shopping_order_sn||""))])]),i("el-divider"),i("el-form-item",{attrs:{label:"往来类型",size:"mini",prop:"accounts_type_id",rules:e.rules.accounts_type_id}},[e._v(" "+e._s(function(){0==e.params.accounts_type_id&&(e.params.accounts_type_id=null)}())+" "),i("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",disabled:e.isDisabled},on:{focus:e.getCurrentAccountListInvok,change:e.accountsTypeChange},model:{value:e.params.accounts_type_id,callback:function(t){e.$set(e.params,"accounts_type_id",t)},expression:"params.accounts_type_id"}},e._l(e.accountypeList,(function(e){return i("el-option",{key:e.accounts_type_id,attrs:{label:e.accounts_type_name,value:e.accounts_type_id}})})),1)],1),i("el-form-item",{attrs:{label:"业务日期",size:"mini",prop:"business_time",rules:e.rules.business_time}},[i("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",disabled:e.isDisabled,clearable:!1},model:{value:e.params.business_time,callback:function(t){e.$set(e.params,"business_time",t)},expression:"params.business_time"}})],1),this.is_company_service?i("el-form-item",{attrs:{label:"优惠金额",size:"mini"}},[i("el-input",{attrs:{type:"text"},model:{value:e.params.discount_price,callback:function(t){e.$set(e.params,"discount_price",t)},expression:"params.discount_price"}})],1):e._e(),i("el-form-item",{attrs:{label:"部门",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.department_id&&(e.params.department_id=null)}())+" "),i("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",disabled:e.isDisabled},on:{focus:e.DepartmentListInvok,change:function(t){return e.changeCustomer(t,3)}},model:{value:e.params.department_id,callback:function(t){e.$set(e.params,"department_id",t)},expression:"params.department_id"}},e._l(e.departmentList,(function(e){return i("el-option",{key:e.department_id,attrs:{label:e.department_name,value:e.department_id}})})),1)],1),i("el-form-item",{attrs:{label:"业务员",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.business_id&&(e.params.business_id=null)}())+" "),i("el-select",{attrs:{clearable:"",filterable:"",disabled:e.isDisabled},on:{focus:e.EmployeeListInvok,change:function(t){return e.changeCustomer(t,1)}},model:{value:e.params.business_id,callback:function(t){e.$set(e.params,"business_id",t)},expression:"params.business_id"}},e._l(e.employeeList,(function(e){return i("el-option",{key:e.employee_id,attrs:{label:e.employee_name,value:e.employee_id}})})),1)],1),e.params.ec_order_sn?i("el-form-item",{attrs:{label:"结算单号",size:"mini"}},[i("span",[e._v(e._s(e.params.ec_order_sn))])]):e._e(),i("el-form-item",{attrs:{label:"备注",size:"mini"}},[i("el-input",{attrs:{type:"text",maxlength:"300"},model:{value:e.params.remark,callback:function(t){e.$set(e.params,"remark",t)},expression:"params.remark"}})],1)],1),i("div",{staticClass:"add_delet"},[i("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:e.addF}},[e._v("增行")]),i("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.delF}},[e._v("删除")])],1)],1),e._m(0),i("div",{staticClass:"table_container"},[i("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:e.TableData,"summary-method":e.getSummaries,"show-summary":"","max-height":"600"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{"show-overflow-tooltip":!0,type:"selection",fixed:"left",align:"center",width:"44"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"receivables_mode_id",label:"结算方式",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{staticClass:"shortInput",attrs:{clearable:""},on:{focus:e.getCollectionListOptionInvok,change:function(i){return e.receivables(t.row,t.$index)}},model:{value:t.row.receivables_mode_id,callback:function(i){e.$set(t.row,"receivables_mode_id",i)},expression:"scope.row.receivables_mode_id"}},e._l(e.receivablesList,(function(e){return i("el-option",{key:e.receivables_mode_id,attrs:{label:e.receivables_mode_name,value:e.receivables_mode_id}})})),1)]}}])}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"bank_id",label:"开户银行",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[10007!=t.row.receivables_mode_id?i("el-select",{staticClass:"shortInput",attrs:{clearable:"","value-key":"bank_id"},on:{focus:e.getCollectingBankInvok,change:function(i){return e.getBanklist(t.row,t.$index)}},model:{value:t.row.bank_id,callback:function(i){e.$set(t.row,"bank_id",i)},expression:"scope.row.bank_id"}},e._l(e.bankList,(function(e){return i("el-option",{key:e.bank_id,attrs:{label:e.bank_name,value:e}})})),1):i("span",[e._v("返利账户 "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.bank_id,expression:"scope.row.bank_id"}],attrs:{type:"hidden"},domProps:{value:t.row.bank_id},on:{input:function(i){i.target.composing||e.$set(t.row,"bank_id",i.target.value)}}})])]}}])}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"bank_number",label:"银行账号",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-input",{staticClass:"editor",attrs:{size:"small",type:"number",disabled:"disabled"},model:{value:t.row.bank_number,callback:function(i){e.$set(t.row,"bank_number",i)},expression:"scope.row.bank_number"}})]}}])}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"common_price",label:"金额",align:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-input",{staticClass:"editor",attrs:{size:"small",type:"number","suffix-icon":"el-icon-edit-outline"},on:{change:function(i){return e.handleEdit(t.row,"common_price")}},model:{value:t.row.common_price,callback:function(i){e.$set(t.row,"common_price",i)},expression:"scope.row.common_price"}})]}}])}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"remark",label:"备注",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-input",{staticClass:"editor",attrs:{maxlength:"300","suffix-icon":"el-icon-edit-outline"},model:{value:t.row.remark,callback:function(i){e.$set(t.row,"remark",i)},expression:"scope.row.remark"}})]}}])}),i("el-table-column",{attrs:{label:"图片附件","show-overflow-tooltip":!0,"render-header":e.renderHeader1,"min-width":"400"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{width:"44px"}},[i("el-upload",{staticClass:"custom-avatar-uploader",attrs:{headers:e.headers,data:e.extendParams,action:e.imgUrl,"list-type":"picture-card",accept:"image/*",limit:e.imgLimit,"file-list":t.row.fileList,"on-preview":e.handlePictureCardPreview,"on-remove":function(i,a){e.handleRemove(i,a,t.row)},"on-success":function(i,a,s){e.handleAvatarSuccess(i,a,s,t.row)},"on-exceed":e.handleExceed,"on-error":e.imgUploadError}},[i("div",{on:{click:e.uploadImg}},[i("i",{staticClass:"el-icon-plus"})])])],1)]}}])})],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.is_disabled&&e.hexiaoDetail,expression:"is_disabled && hexiaoDetail"}],staticClass:"aboutList"},[i("div",{staticClass:"paymanageTitle fcsb"},[i("span",[e._v("核销明细")]),i("el-link",{attrs:{type:"primary"},on:{click:e.exportDataEvent}},[e._v("导出核销明细")])],1),i("div",{staticClass:"table_container",staticStyle:{"margin-top":"20px"}},[i("div",[i("vxe-table",{ref:"xTable",attrs:{border:"","show-overflow":"","show-header-overflow":"",size:"mini","keyboard-config":{isArrow:!0,isDel:!1,isTab:!0,isEdit:!0},"show-footer":"","footer-method":e.footerMethod,align:"center","highlight-cell":"","max-height":"500","highlight-hover-row":"","highlight-current-row":"",resizable:"","mouse-config":{selected:!0},"edit-config":{trigger:"click",mode:"cell"},"checkbox-config":{checkStrictly:!0}},on:{"select-change":e.SelectionChange,"edit-closed":e.editClosedEvent}},[i("vxe-table-column",{attrs:{type:"checkbox",width:"50"}}),i("vxe-table-column",{attrs:{type:"seq",width:"60",title:"序号"}}),i("vxe-table-column",{attrs:{field:"bill_sn",width:"120",title:"单据号"}}),i("vxe-table-column",{attrs:{field:"order_type",width:"120",title:"单据类型"}}),i("vxe-table-column",{attrs:{field:"customer_name",width:"120",title:"客户名称"}}),i("vxe-table-column",{attrs:{field:"bill_num",width:"120",title:"出库数量"}}),i("vxe-table-column",{attrs:{field:"order_price",width:"120",title:"出库金额"}}),i("vxe-table-column",{attrs:{field:"ec_channel_fee",width:"120",title:"通道费",visible:Boolean(!e.is_company_service)}}),i("vxe-table-column",{attrs:{field:"sc_price",title:"实际应收金额",width:"130"},scopedSlots:e._u([{key:"header",fn:function(){return[i("vxe-tooltip",{attrs:{content:"实际应收金额=本出库单中出库金额"},model:{value:e.showSexTip,callback:function(t){e.showSexTip=t},expression:"showSexTip"}},[i("span",[e._v("实际应收金额"),i("i",{staticClass:"el-icon-question",on:{click:function(t){e.showSexTip=!e.showSexTip}}})])])]},proxy:!0}])}),i("vxe-table-column",{attrs:{field:"business_time",width:"120",title:"业务日期"}}),i("vxe-table-column",{attrs:{field:"add_time",width:"120",title:"单据时间"}}),i("vxe-table-column",{attrs:{field:"remark",width:"120",title:"备注"}}),i("vxe-table-column",{attrs:{field:"rc_price",width:"120",title:"已冲销金额"}}),i("vxe-table-column",{attrs:{field:"bill_receipt_discount_price",width:"120",title:"已优惠金额",visible:Boolean(e.is_company_service)}}),i("vxe-table-column",{attrs:{field:"rest_price",width:"120",title:"未冲销金额"}}),i("vxe-table-column",{attrs:{field:"bill_discount_price",width:"120",title:"本次优惠金额","edit-render":{name:"vNumber"},visible:Boolean(e.is_company_service)}}),i("vxe-table-column",{attrs:{field:"bill_price",width:"120",title:"本次冲销金额","edit-render":{name:"vNumber"}}})],1)],1)])]),i("el-dialog",{attrs:{"close-on-click-modal":!1,title:"提示",visible:e.dialogVisible,width:"20%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("span",[e._v(e._s(e.msg))]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1,e.goto=0}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.confirm()}}},[e._v("确 定")])],1)]),i("el-dialog",{attrs:{"close-on-click-modal":!1,title:"提示",visible:e.dialogVisiblehj,width:"20%"},on:{"update:visible":function(t){e.dialogVisiblehj=t}}},[i("span",[e._v("本次冲销多结算"+e._s((Number(e.jshj)-Number(e.cxhj)).toFixed(2))+"元，将自动转为预收款，是否继续？")]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("params","Y")}}},[e._v("是")]),i("el-button",{on:{click:function(t){e.dialogVisiblehj=!1}}},[e._v("否")])],1)]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.goBack}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("params")}}},[e._v("确 定")])],1),i("el-dialog",{attrs:{visible:e.dialogVisibleimg,width:"30%"},on:{"update:visible":function(t){e.dialogVisibleimg=t}}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"paymanageTitle"},[i("span",[e._v("结算明细")])])}],r=i("5530"),o=(i("a9e3"),i("d81d"),i("caad"),i("b680"),i("b0c0"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("e9c4"),i("159b"),i("4de4"),i("a15b"),i("a434"),i("2532"),i("65b0")),n=i("2f62"),l=i("1c1e"),c={name:"customeReceiptmanageAdd",data:function(){return{params:{company_id:null},headers:{token:localStorage.getItem("token")},extendParams:{},associated_customer_id:"",dialogImageUrl:"",jshj:0,cxhj:0,bcyh:0,imgLimit:6,isMultiple:!0,showSexTip:!1,authority:{},title:"添加",loading1:!1,msg:null,goto:0,bankList:[],imgIndex:{},dialogVisible:!1,dialogVisiblehj:!1,sumBill_price:null,theForm:{},showDelete:!1,dialogVisibleimg:!1,newPic:"",imgUrl:"".concat(Object({NODE_ENV:"production",BASE_URL:""}).VUE_APP_BASE_API,"/v2/open/CustomerReceipt/receiptUpload"),TableData:[],companyList:[],multipleSelection:[],per_page:[30,50,100,500],index:0,customer_id:null,receipt_id:null,customer_name:"",isDisabled:!1,is_disabled:!1,PD:[],relationTable:[],changeIndex:0,xCheck:"N",hexiaoDetail:!0,repetition:!0}},computed:Object(r["a"])({},Object(n["c"])(["receiptmanageAdd_showGet"])),methods:Object(r["a"])(Object(r["a"])({uploadImg:function(e){this.params.customer_id||(this.$message.warning("请先选择客户名称"),e.preventDefault(),e.stopPropagation())}},Object(n["b"])(["receiptmanageIndexACT"])),{},{handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisibleimg=!0},editClosedEvent:function(e,t){var i=e.row;i.bill_price>0?Number(i.rest_price)<0&&(i.bill_price=0):Number(i.rest_price)>0&&(i.bill_price=0),this.$refs.xTable.setSelection(i,!0),this.$refs.xTable.updateFooter()},exportDataEvent:function(){this.$refs.xTable.exportData({filename:"核销明细",type:"csv"})},footerMethod:function(e){var t=this,i=e.columns,a=e.data;return[i.map((function(e,i){return 1===i?"合计":["sc_price","rc_price","rest_price","bill_price","bill_discount_price"].includes(e.property)?(t.cxhj=t.$utils.sum(a,"bill_price").toFixed(2),t.bcyh=t.$utils.sum(a,"bill_discount_price").toFixed(2),t.$utils.sum(a,e.property).toFixed(2)):null}))]},handleRemove:function(e,t,i){var a=t.map((function(e){return e.response?e.response.data[0]:e.name}));this.$set(i,"imglist",a)},handleAvatarSuccess:function(e,t,i,a){var s=i.map((function(e){return e.response?e.response.data:e.name}));this.$set(a,"imglist",s),this.imageUrl=URL.createObjectURL(t.raw)},handleExceed:function(e,t){this.$message.error("上传图片不能超过6张!")},imgUploadError:function(e,t,i){this.$message.error("上传图片失败!")},renderHeader:function(){var e=this.$createElement,t="";switch(this.params.accounts_type_id){case 10001:case 10002:case 3:t="实际应收金额=本出库单中出库金额";break;case 10003:case 10004:this.hexiaoDetail=!1;break;default:break}return e("el-tooltip",{class:"item",attrs:{effect:"dark",placement:"top"}},[e("p",{slot:"content"},[t]),e("span",{class:"el-icon-question",style:"cursor:pointer;font-weight:bold"},["实际应收金额"])])},renderHeader1:function(){var e=this.$createElement;return e("el-tooltip",{class:"item",attrs:{effect:"dark",placement:"top"}},[e("p",{slot:"content",style:"width:250px;"},["建议上传付款凭证，如汇款单等；图片支持jpg、jpeg、png、bmp格式，大小不超过2MB，最多上传6张；"]),e("span",{class:"el-icon-question",style:"cursor:pointer;font-weight:bold;"},["图片附件"])])},goBack:function(){this.$publicFution.goPage(this.$route.query.receipt_id),this.$router.push({path:"/custom/receiptmanage"})},getBanklist:function(e){this.$set(e,"bank_number",e.bank_id.bank_number)},confirm:function(){this.goto=1,this.dialogVisible=!1;var e=Object.assign({},this.params,{common_body:JSON.stringify(this.TableData),is_verify:1,goto:this.goto});this.$route.query.receipt_id?this.editlist(e):this.githexmx(e)},handleEdit:function(e,t){if(e.rest_price>0){var i=Number(e.bill_price)>=0&&Number(e.bill_price)<=Number(e.rest_price)?Number(e.bill_price):0;this.$nextTick((function(){e.bill_price=i}))}else if(e.rest_price<0){var a=Number(e.bill_price)>=Number(e.rest_price)&&Number(e.bill_price)<=0?Number(e.bill_price):0;this.$nextTick((function(){e.bill_price=a}))}e||this.$nextTick((function(){e[t]=e[t].toFixed(2)}))},SelectionChange:function(e){var t=this,i=e.selection,a=e.row,s=e.checked,r=[];if(i.length){10002!=this.params.accounts_type_id||this.params.company_id||(this.companyList=[],this.companyList.push({company_id:i[0].finance_company_id,company_name:i[0].finance_company_name}),this.$set(this.params,"company_id",i[0].finance_company_id),this.companyChange(i[0].finance_company_id),this.$refs["params"].validate((function(e){}))),i.forEach((function(e){void 0==e.bill_price&&t.$set(e,"bill_price","0.00"),r.push(Number(e.bill_price))})),this.sumBill_price=r.reduce((function(e,t){return e+t}));var o=this.jshj-this.sumBill_price}s?this.jshj>=0?Number(a.rest_price)>0?o>=Number(a.rest_price)?a.bill_price=Number(a.rest_price).toFixed(2):o>=0&&o<Number(a.rest_price)?a.bill_price=Number(o).toFixed(2):o<0&&o<Number(a.rest_price)?a.bill_price=0:a.bill_price=Number(o).toFixed(2):a.bill_price=Number(a.rest_price).toFixed(2):Number(a.rest_price)>0?o>0&&o>=Number(a.rest_price)?a.bill_price=Number(a.rest_price).toFixed(2):o>=0&&o<Number(a.rest_price)?a.bill_price=Number(o).toFixed(2):o<0&&o<Number(a.rest_price)&&(a.bill_price=0):o>=Number(a.rest_price)&&o<0?a.bill_price=Number(o).toFixed(2):(o<0&&o<Number(a.rest_price)||o>=0)&&(a.bill_price=Number(a.rest_price).toFixed(2)):a.bill_price=0,this.$refs.xTable.updateFooter();var n=this.$refs.xTable.footerData[0];this.cxhj=n[n.length-1]},editlist:function(e){var t=this,i=Object.assign(e,{receipt_id:this.$route.query.receipt_id});this.$axMethod.customEditReceipt(i).then((function(e){var i=e.data;200==i.code?(t.$message({message:i.msg,type:"success"}),t.goBack()):409==i.code&&(t.msg=i.msg,t.dialogVisible=!0)}))},githexmx:function(e){var t=this,i=(e.company_id,e.customer_id),a=e.accounts_type_id;if(![10002,3].includes(a)&&!i)return!1;this.$axMethod.getReceiptDetailed(e).then((function(e){var i=e.data;200==i.code&&i.data instanceof Array&&(t.is_disabled=!0,t.$refs.xTable&&(t.$refs.xTable.reloadData(i.data),t.$refs.xTable.updateFooter()))}))},datalist:function(e){var t=this,i=(e.company_id,e.customer_id),a=e.accounts_type_id;if(![10002,3].includes(a)&&!i)return!1;this.$axMethod.customAddReceipt(e).then((function(e){var i=e.data;200==i.code?i.data instanceof Array?(t.is_disabled=!0,t.$refs.xTable&&(t.$refs.xTable.reloadData(i.data),t.$refs.xTable.updateFooter()),0===i.data.length&&(t.$message({message:i.msg,type:"success"}),t.goBack())):(t.$message({message:i.msg,type:"success"}),t.goBack()):409==i.code&&(t.msg=i.msg,t.dialogVisible=!0)}))},receivables:function(e,t){var i=this;10007==e.receivables_mode_id&&(this.$axMethod.getCustomerInfoOpen({customer_id:this.params.customer_id,company_id:this.params.company_id,associated_customer_id:this.associated_customer_id}).then((function(t){var a=t.data;200==a.code&&(i.$set(e,"common_price",a.data.available_rebate_balance),i.$set(e,"bank_number",""),i.$set(e,"bank_id",{bank_id:""}))})),this.$nextTick((function(){i.$refs.table.bodyWrapper.scrollTop=i.$refs.table.bodyWrapper.scrollHeight+33})))},submitForm:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"N";this.$refs[e].validate((function(e){if(e){var a=t.TableData.filter((function(e){for(var t in e)if(void 0!==e[t])return e[t]}));if(a.length<1)return t.$message.error("结算明细不能为空"),!1;var s=["common_price","receivables_mode_id"],r=a.every((function(e){var t=!0;return s.forEach((function(i){void 0!==e[i]&&null!==e[i]&&""!==e[i]||(t=!1)})),t}));if(!r&&1!=t.is_company_service)return t.$message.warning("请完善 结算明细 表体信息"),!1;if([10002,10001,3].includes(t.params.accounts_type_id)){if(!t.$refs.xTable.getData().length)return t.$message.error("核销明细不能为空"),!1;if(!t.$refs.xTable.getSelectRecords().length)return t.$message.error("请选择至少一条核销明细"),!1}if(10001==t.params.accounts_type_id&&"N"==i)if(t.is_company_service){if(Number(t.bcyh)!=Number(t.params.discount_price?t.params.discount_price:0))return t.$message({message:'创建收款单据失败，请检查优惠金额是否在"本次优惠金额"列下全部核销',type:"warning"}),!1;if(Number(t.jshj)!=Number(t.cxhj))return t.$message({message:'创建收款单据失败，请检查填写的金额是否在"本次核销金额"列下全部核销',type:"warning"}),!1}else if(Number(t.jshj)>Number(t.cxhj))return t.dialogVisiblehj=!0,!1;var o=a.map((function(e){return{common_price:e.common_price,imglist:function(){if("undefined"!=typeof e.imglist)return e.imglist;var t=[];return e.fileList&&e.fileList.forEach((function(e){""!=e.url&&t.push(e.name)})),t}().join(),receivables_mode_id:e.receivables_mode_id,bank_id:void 0==e.bank_id||0==e.bank_id.bank_id?"":e.bank_id.bank_id,remark:e.remark}})),n=t.$refs.xTable.getSelectRecords();n.forEach((function(e){e._XID&&delete e._XID,e.checked=1}));var l=Object.assign({},t.params,{logistics_number:t.params.logistics_number?t.params.logistics_number:"",common_body:JSON.stringify(o),is_verify:0,goto:t.goto,bill_body:JSON.stringify(n)});t.$route.query.receipt_id?t.editlist(l):t.datalist(l)}}))},changeLogistics:function(e){this.remove();var t=Object.assign({},this.params,{common_body:JSON.stringify(this.TableData),is_verify:1,goto:this.goto});this.githexmx(t)},customerDetails:function(e){var t=this;this.$axMethod.getCustomerInfoNEWqx({customer_id:e,company_id:this.params.company_id}).then((function(e){var i=e.data;200==i.code&&(console.log(i.data),["deposits","balance","credit_balance","credit_quota","contact_name","customer_mobile","business_id"].forEach((function(e){t.$set(t.params,e,i.data[e])})),Object.assign(i.data,{employee_id:i.data.business_id,employee_name:i.data.business_name}),Object(o["l"])(t,i.data,"customer_id"))}))},changeCustomer:function(e,t){var i=this;this.extendParams={customer_id:this.params.customer_id,sign:Object(l["a"])({customer_id:this.params.customer_id})};var a=[10003,10004];if(this.TableData.length>0&&this.$set(this,"TableData",[]),this.jshj=0,2!=t){var s=Object.assign({},this.params,{common_body:JSON.stringify(this.TableData),is_verify:1,goto:this.goto});a.includes(this.params.accounts_type_id)||this.githexmx(s)}else if(this.$set(this.params,"business_id",""),this.associated_customer_id=this.customerList.filter((function(t){return t.customer_id===e}))[0].associated_customer_id,this.customerDetails(e),e)this.$refs["params"].validate((function(e){if(e)if([10003,10004].includes(i.params.accounts_type_id))i.is_disabled=!1,i.$refs.xTable&&i.$refs.xTable.reloadData([]);else{var t=Object.assign({},i.params,{common_body:JSON.stringify(i.TableData),is_verify:1,goto:i.goto});a.includes(i.params.accounts_type_id)||i.githexmx(t)}}));else{var r=Object.assign({},this.params,{common_body:JSON.stringify(this.TableData),is_verify:1,goto:this.goto});a.includes(this.params.accounts_type_id)||this.githexmx(r)}},addF:function(){this.params.accounts_type_id?this.TableData.push({}):this.$message.warning("请选择往来类型")},remove:function(){this.$set(this,"TableData",[])},delF:function(){var e=this;if(this.multipleSelection.length<1)return this.$message.error("请选择要删除的数据"),!1;this.multipleSelection.forEach((function(t){var i=e.TableData.indexOf(t);return e.TableData.splice(i,1)}))},handleSelectionChange:function(e){this.multipleSelection=e},accountsTypeChange:function(e){var t=this;if(e){this.remove();var i=["department_id","logistics_id"];if(i.forEach((function(e){t.$set(t.params,e,null)})),[10002,3].includes(e)&&this.$nextTick((function(){t.$refs["customer_id"].clearValidate()})),[10003,10004].includes(e))return this.is_disabled=!1,this.$refs.xTable&&(this.$refs.xTable.reloadData([]),this.$refs.xTable.updateFooter()),!1;this.$nextTick((function(){t.$refs["params"].validate((function(e){var i=Object.assign({},t.params,{common_body:JSON.stringify(t.TableData),is_verify:1,goto:t.goto});t.githexmx(i)}))}))}},companyChange:function(e){var t=this,i=[];for(var a in i=10002==this.params.accounts_type_id?["company_id","business_time","accounts_type_id","logistics_number"]:["company_id","business_time","accounts_type_id"],this.params)i.includes(a)||(this.params[a]=null);this.$set(this,"TableData",[]),this.$refs.xTable&&(this.$refs.xTable.reloadData([]),this.$refs.xTable.updateFooter()),this.$nextTick((function(){var e=Object.assign({},t.params,{common_body:JSON.stringify(t.TableData),is_verify:1,goto:t.goto});t.githexmx(e)}))},departmentChange:function(e){this.$set(this.params,"business_id",null)},getSummaries:function(e){var t=this,i=e.columns,a=e.data,s=[];return i.forEach((function(e,i){if(1!==i){var r=a.map((function(t){return Number(t[e.property])}));r.every((function(e){return isNaN(e)}))?s[i]="":(s[i]=r.reduce((function(e,t){var i=Number(t);return isNaN(i)?e:e+t}),0),4==i?(s[i]=parseFloat(s[i]).toFixed(2),t.jshj=parseFloat(s[i]).toFixed(2)):s[i]="")}else s[i]="总计"})),s}}),mounted:function(){var e=this,t=this.$route.query.receipt_id;if(this.title=t?"修改":"添加",t){var i={receipt_id:t,is_edit:1};this.isDisabled=!0,this.$axMethod.customGetReceiptInfo(i).then((function(t){var i=t.data;if(200==i.code){var a=i.data;Object(o["l"])(e,a),e.employeeList.push({employee_id:a.business_id,employee_name:a.business_name}),e.customerList=[{customer_name:a.customer_name,customer_id:a.customer_id,address:a.customer_id,customer_mobile:a.customer_mobile,contact_name:a.contact_name}],a.receipt_common_bill.length&&e.$set(e,"is_disabled",!0),e.$axMethod.getCustomerInfoNEWqx({customer_id:a.customer_id,company_id:a.company_id}).then((function(t){var i=t.data;200==i.code&&["deposits","balance","credit_balance","credit_quota","contact_name","customer_mobile","business_id"].forEach((function(t){e.$set(e.params,t,i.data[t])}))})),e.$set(e,"params",{shopping_order_sn:a.shopping_order_sn,accounts_type_id:a.accounts_type_id,business_time:a.business_time,company_id:a.company_id,discount_price:a.discount_price,logistics_number:a.logistics_number,department_id:a.department_id,logistics_id:a.logistics_id,customer_id:a.customer_id,receipt_sn:a.receipt_sn,ec_order_sn:a.ec_order_sn,remark:a.remark}),e.$set(e,"TableData",a.receipt_common),a.receipt_common.forEach((function(t,i){e.bankList.push({bank_id:t.bank_id,bank_number:t.bank_number,bank_name:t.bank_name}),e.receivablesList.push({receivables_mode_name:t.receivables_mode_name,receivables_mode_id:t.receivables_mode_id}),e.$set(e.TableData[i],"bank_id",{bank_id:t.bank_id,bank_number:t.bank_number,bank_name:t.bank_name})})),e.$refs.xTable&&(e.$refs.xTable.reloadData(a.receipt_common_bill),e.$refs.xTable.updateFooter());var s=a.receipt_common_bill.filter((function(e){return 1==e.checked}));s.length&&e.$nextTick((function(){s.forEach((function(t){e.$refs.xTable.toggleCheckboxRow(t);var i=e.$refs.xTable.footerData[0];e.cxhj=i[i.length-1]}))})),e.extendParams={customer_id:e.params.customer_id,sign:Object(l["a"])({customer_id:e.params.customer_id})}}}))}else this.$set(this,"params",{company_id:Number(localStorage.company_id),business_time:this.$publicFution.formatData(new Date)}),Object(o["l"])(this,localStorage);this.getCollectingBankInvok()}},m=c,d=(i("eb7f"),i("d8ba"),i("64a8"),i("2877")),u=Object(d["a"])(m,a,s,!1,null,"1e92d7e8",null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-1913c8ef.91cddc6c.js.map