(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-991f4f8a"],{"0c6a":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shoppingCart"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShowConfirmOrder,expression:"!isShowConfirmOrder"}],attrs:{id:"leixin"}},[i("div",{staticClass:"search_container"},[i("el-form",{ref:"filterFormRef",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.params}},[i("el-form-item",{staticStyle:{width:"412px"},attrs:{label:"关键字:",size:"mini"}},[i("el-input",{staticStyle:{width:"300px"},attrs:{maxlength:"100",placeholder:"请输入库位码/名称/品牌/OE码/商品类目",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch(1)}},model:{value:t.params.keyword,callback:function(e){t.$set(t.params,"keyword",e)},expression:"params.keyword"}})],1),i("el-form-item",{attrs:{label:"加购时间:",size:"mini"}},[i("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.timeValue,callback:function(e){t.timeValue=e},expression:"timeValue"}})],1),i("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.onSearch(1)}}},[t._v("搜索")]),i("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.onReset}},[t._v("重置")])],1)],1)],1),i("div",{staticClass:"add_delet"},[i("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:t.batchDeleteOrder}},[t._v("批量删除")])],1),i("div",{staticClass:"priceNumberRange"},[i("xTable",{ref:"xTable",attrs:{selectConfig:{checkMethod:t.checkMethod},"edit-rules":t.editRules,ajax:{url:"getShoppingCartList",params:t.params},tableColumn:t.tableColumn,pagerConfig:t.pagerConfig},on:{selectChange:t.computePrice,getData:t.dealData}})],1),i("div",{staticStyle:{"text-align":"right"}},[i("span",[t._v("已选"+t._s(t.allNum)+"件商品 "),i("span",[t._v("合计￥ "+t._s(t.allPrice))]),i("el-button",{attrs:{type:"primary",disabled:t.buttonStack},on:{click:t.sumbit}},[t._v("立即结算")])],1)]),i("div",{staticStyle:{"text-align":"right","margin-top":"20px"}},[i("span",[t._v("全部"+t._s(t.total_can.total_can_buy_num||0)+"件商品 "),i("span",[t._v("合计￥ "+t._s(t.total_can.total_can_buy_money||0))]),i("el-button",{attrs:{type:"primary"},on:{click:t.Allsumbit}},[t._v("全车结算")])],1)])]),t.isShowConfirmOrder?i("confirmOrder",{attrs:{data:t.confirmOrderData},on:{close:t.close}}):t._e()],1)},n=[],r=(i("a9e3"),i("d3b7"),i("b680"),i("c9b7")),s={data:function(){var t=this,e=this.$createElement;return{editRules:{goods_number:[{required:!0,message:"数量输入请在0-99999999之间",type:"number",min:1,max:99999999}]},tableColumn:[{type:"checkbox",width:44,align:"center"},{type:"seq",width:44,align:"center",title:"序号"},{title:"操作",width:50,fixed:"right",slots:{default:function(i){return[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(){t.deleteOrder(i)}}},["删除"])]}}},{title:"供应商",field:"store_name",width:150},{title:"商品名称",field:"goods_name",width:300,slots:{default:function(e,i){var a=[];return e.row.is_pre_sale?a.push(i("span",{style:{color:"red",paddingRight:"10px"}},["预售"]),i("a",{style:{cursor:"pointer"},on:{click:function(){t.seeF(e.row)}},attrs:{type:"text",size:"small"}},[e.row.goods_name," "])):a.push(i("a",{style:{cursor:"pointer"},on:{click:function(){t.seeF(e.row)}},attrs:{type:"text",size:"small"}},[e.row.goods_name," "])),a}}},{title:"加购时间",field:"add_time",width:150},{title:"单价",field:"goods_price",headerAlign:"right",align:"right",width:100,formatter:function(t){var e=t.row;return e.sourcing_goods_price&&e.sourcing_goods_price[0]?e.sourcing_goods_price[0].sourcing_price:0}},{title:"起订量",field:"order_batch_quantity",headerAlign:"right",align:"right",width:100},{title:"库存",field:"goods_storage",headerAlign:"right",align:"right"},{title:"数量",field:"goods_num",headerAlign:"center",align:"center",width:200,slots:{default:function(i){var a=i.row;return[e("el-button",{attrs:{plain:!0,size:"mini",disabled:Number(a.goods_num)<=Number(a.order_batch_quantity)||!t.checkMethod({row:a})},class:"numButon",on:{click:function(){t.subNum(a)}}},["-"]),e("el-input",{attrs:{disabled:!t.checkMethod({row:a})},on:{change:function(){t.arrangement(a)}},class:"numSpan",model:{value:a.goods_num,callback:function(e){t.$set(a,"goods_num",e)}}}),e("el-button",{attrs:{plain:!0,disabled:Number(a.goods_num)>=Number(a.goods_storage)||!t.checkMethod({row:a}),size:"mini"},class:"numButon",on:{click:function(){t.addNum(a)}}},["+"])]}}},{title:"金额",field:"goods_total_price",headerAlign:"right",align:"right",formatter:"priceFormat"}],allNum:0,allPrice:0,prevNum:0}},methods:{addNum:function(t){this.prevNum=t.goods_num,t.order_batch_quantity<1&&(t.order_batch_quantity=1),t.goods_num=Number(t.goods_num),t.order_batch_quantity=Number(t.order_batch_quantity),t.goods_num+=t.order_batch_quantity,this.arrangement(t,!0)},seeF:function(t){this.$router.push({path:"/purchase/jybdorder/particulars",query:{shop_goods_id:t.goods_id}})},subNum:function(t){this.prevNum=t.goods_num,t.order_batch_quantity<1&&(t.order_batch_quantity=1),t.goods_num=Number(t.goods_num),t.order_batch_quantity=Number(t.order_batch_quantity),t.goods_num-=t.order_batch_quantity,t.goods_num<0&&(t.goods_num=1),this.arrangement(t,!1)},arrangement:function(t,e){var i=this;if(this.$publicFution.toFixedTwo(t,"goods_num",{type:"PositiveInteger"}),t.goods_num<t.order_batch_quantity)return t.goods_num=t.order_batch_quantity,void this.$message.error("商品数量不能小于起订量");t.goods_num>Number(t.goods_storage)&&(t.goods_num=t.goods_storage),t.goods_num>t.order_batch_quantity&&(t.goods_num=t.goods_num-t.goods_num%t.order_batch_quantity),this.$axMethod.editShoppingCartGoods({cart_id:t.cart_id,quantity:t.goods_num,type:e,TimeStamp:(new Date).getTime()}).then((function(e){var a=e.data;200==a.code?(i.computePrice(),i.onSearch(window.goPage)):t.goods_num=i.prevNum})).catch((function(){t.goods_num=i.prevNum}))},checkMethod:function(t){var e=t.row;return!(!Number(e.inventory_goods_id)||0===Number(e.goods_storage))},goodsNumChange:Object(r["a"])((function(t){this.arrangement(t)}),500),computePrice:function(){var t=this.$refs.xTable._proxy("getCheckboxRecords");this.buttonStack=t.every((function(t){return t.goods_storage<t.goods_num})),this.allNum=this.$utils.sum(t,"goods_num"),this.allPrice=this.$utils.sum(t,"goods_total_price").toFixed(2)}}},o=i("4997"),c=i("069e0"),u={name:"shoppingCart",mixins:[s],data:function(){return{confirmOrderData:{},isShowConfirmOrder:!1,timeValue:[],buttonStack:!0,total_can:{},pagerConfig:{"page-sizes":[30,50,100,500,1e3,2e3]},params:{goods_name:""}}},components:{confirmOrder:c["a"]},methods:{onReset:function(){this.params={},this.timeValue=[],this.onSearch()},dealData:function(t){this.total_can={total_can_buy_money:t.data.data.total_can_buy_money||0,total_can_buy_num:t.data.data.total_can_buy_num}},close:function(){this.isShowConfirmOrder=!1,this.onSearch()},deleteOrder:function(t){var e=this,i=t.row;this.$confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$axMethod.deleteShoppingCartGoods({cart_id:i.cart_id}).then((function(t){var i=t.data;200===i.code&&(e.$message.success(i.msg),e.onSearch())}))}))},timeF:function(){this.timeValue?(this.params.start_add_time=this.timeValue[0],this.params.end_add_time=this.timeValue[1]):this.params.start_add_time=this.params.end_add_time=""},batchDeleteOrder:function(){var t=new o["a"]({id:"cart_id",_this:this,title:"删除",url:"deleteShoppingCartGoods",showConfirm:!0});t.send()},updateRow:function(t){var e=this,i=t.row;this.$axMethod.editShoppingCartGoods({cart_id:i.cart_id,quantity:i.goods_num}).then((function(t){var i=t.data;200===i.code&&(e.$message.success(i.msg),e.onSearch())}))},sumbit:function(){var t=this,e=this.$refs.xTable._proxy("getCheckboxRecords");e.length<1?this.$message.warning("请选择商品行"):this.$refs.xTable._proxy("validate",e).then((function(){t.confirmOrderData={type:1,data:e},t.isShowConfirmOrder=!0}))},Allsumbit:function(){this.total_can.total_can_buy_num>0?(this.confirmOrderData={type:1,all_receipt:1},this.isShowConfirmOrder=!0):this.$message.warning("购物车没有可结算商品")},onSearch:function(t){var e=this;this.timeF(),this.$refs.xTable._getData(t),setTimeout((function(){e.computePrice()}),20)}},activated:function(){this.onSearch(window.goPage)}},d=u,h=(i("63a4"),i("2877")),l=Object(h["a"])(d,a,n,!1,null,"0969b3cc",null);e["default"]=l.exports},4997:function(t,e,i){"use strict";i.d(e,"a",(function(){return u})),i.d(e,"b",(function(){return d}));var a=i("1da1"),n=i("ade3"),r=i("d4ec"),s=i("bee2"),o=(i("96cf"),i("d3b7"),i("25f0"),i("159b"),i("4de4"),i("caad"),i("2532"),i("4360"));function c(t){if("function"===typeof t&&t().then)return!0}var u=function(){function t(e){Object(r["a"])(this,t),this._this=e._this,this.addr=[],this.indexSign=null,this.URL=e.url,this.id=e.id,this.errId=e.errId?e.errId:e.id,this.title=e.title?e.title:"审核",this.allTitle=e.allTitle,this.params=e.params,this.before=e.before,this.checkbox=null,this.Data=null,this.showConfirm=e.showConfirm,this.callbackFunc=e.callbackFunc}return Object(s["a"])(t,[{key:"verify",value:function(){return!(this._this.multipleSelection.length<1)||(this._this.$message({message:"请选择需要".concat(this.title,"的信息"),type:"warning"}),!1)}},{key:"confirm",value:function(){var t="确定要“"+this.title+"”此条信息?";return this.allTitle&&(t=this.allTitle),this._this.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}},{key:"sendAjax",value:function(t,e,i){var a,r=this,s=Object.assign(Object(n["a"])({},this.id,t),this.params);this._this.$axMethod[this.URL]?a=this._this.$axMethod[this.URL](s):this._this.$api[this.URL]&&(a=this._this.$axios({url:this._this.$api[this.URL],method:"post",data:s})),a.then((function(t){r.checkbox=r._this.multipleSelection,r.callbackFunc&&r.callbackFunc(t.data),200==t.data.code?(e(t),r.Data=t):i(t)})).catch((function(t){i(t)}))}},{key:"logic",value:function(){var t=this;if(!this.verify())return!1;for(var e=0;e<this._this.multipleSelection.length;e++)this.addr.push(this._this.multipleSelection[e][this.id]);var i=this.addr.toString();return new Promise((function(e,a){if(1==t.showConfirm)t.confirm().then((function(){if(c(t.before))t.before(i).then((function(){return t.sendAjax(i,e,a)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(i,e,a)}));else if(c(t.before))t.before(i).then((function(){return t.sendAjax(i,e,a)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(i,e,a)}))}},{key:"send",value:function(){var t=this;this.logic().then((function(e){var i=e.data;200===i.code&&(t._this.$message.success(i.msg?i.msg:i.data),t._this.onSearch&&t._this.onSearch())}))}},{key:"callback",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,i,a,n,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.logic();case 3:this.Data&&this.Data.data&&this.Data.data.data.length?(e=this.Data.data.data,i=[],e.forEach((function(t){i.push(t.serial)})),a=this.checkbox.filter((function(t){return 1==i.includes(t[r.errId])})),this._this.indexSign.arr=a,this._this.indexSign.str=this.errId,o["a"].commit("setErrorObj",{msg:this.Data.data.msg,table:this.Data.data.data,state:!0})):(n=this.Data.data.msg?this.Data.data.msg:this.Data.data.data,this._this.indexSign.arr=[],this._this.$message({message:n,type:"success"}),this._this.multipleSelection=[],this._this.onSearch&&this._this.onSearch()),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.log();case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));function e(){return t.apply(this,arguments)}return e}()}]),t}(),d=function(){function t(e){var i=e._this,a=e.url,n=e.list,s=void 0===n?[]:n,o=e.params,c=void 0===o?{}:o,u=e.before;Object(r["a"])(this,t),this._this=i,this.url=a,this.list=s,this.params=c,this.before=u}return Object(s["a"])(t,[{key:"sendAjax",value:function(t,e){var i;this._this.$axMethod[this.url]?i=this._this.$axMethod[this.url](this.params):this._this.$api[this.url]&&(i=this._this.$axios({url:this._this.$api[this.url],method:"post",data:this.params})),i.then((function(i){200==i.data.code?t(i):e(i)})).catch((function(t){e(t)}))}},{key:"edit",value:function(){var t=this;return new Promise((function(e,i){if(c(t.before))t.before().then((function(){return t.sendAjax(e,i)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(e,i)}))}},{key:"callback",value:function(){var t=this;return new Promise((function(e,i){t.edit().then((function(a){if(a.data&&a.data.data&&a.data.data.length){o["a"].commit("setErrorObj",{msg:a.data.msg,table:a.data.data,state:!0});var n=[];a.data.data.forEach((function(t){n.push(t.serial)})),t._this.indexSign=n,i(a)}else t._this.$message({message:a.data.msg?a.data.msg:a.data.data,type:"success"}),e(a)}))}))}}]),t}()},"63a4":function(t,e,i){"use strict";i("6891")},6891:function(t,e,i){}}]);
//# sourceMappingURL=chunk-991f4f8a.e1f10bb2.js.map