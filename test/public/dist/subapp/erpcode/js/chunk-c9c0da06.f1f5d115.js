(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-c9c0da06"],{"0a0e":function(e,t,a){},"3d92":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_demo,expression:"loading_demo"}],attrs:{"element-loading-text":"列表正在生成中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("库存管理")]),a("el-breadcrumb-item",{staticClass:"attrbute"},[a("span",{on:{click:e.goBack}},[e._v("其他出库")])]),a("el-breadcrumb-item",[e._v(e._s(e.title)+"其他出库")])],1),a("div",{staticClass:"search_container"},[a("el-form",{ref:"TableDataRef",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[a("el-form-item",{attrs:{label:"库存组织",size:"mini",prop:"company_id",rules:[{required:!0,message:"请选择库存组织",trigger:"change"}]}},[e._v(" "+e._s(function(){0==e.params.company_id&&(e.params.company_id=null)}())+" "),a("el-select",{attrs:{placeholder:"请选择",filterable:""},on:{focus:e.companyListInvok,change:e.companyChange},model:{value:e.params.company_id,callback:function(t){e.$set(e.params,"company_id",t)},expression:"params.company_id"}},e._l(e.companyList,(function(t){return a("el-option",{key:t.company_id,attrs:{label:t.company_name,value:t.company_id}},[a("span",{class:1==t.type?"optionStyle":""},[e._v(e._s(t.company_name))])])})),1)],1),a("el-form-item",{attrs:{label:"单据号",size:"mini"}},["修改"==e.title?a("span",[e._v(e._s(e.params.outstock_sn))]):a("el-input",{attrs:{disabled:""},model:{value:e.params.outstock_sn,callback:function(t){e.$set(e.params,"outstock_sn",t)},expression:"params.outstock_sn"}})],1),a("el-form-item",{attrs:{label:"关联单据号",size:"mini"}},["修改"==e.title?a("span",[e._v(e._s(e.params.order_sn))]):a("el-input",{attrs:{disabled:""},model:{value:e.params.order_sn,callback:function(t){e.$set(e.params,"order_sn",t)},expression:"params.order_sn"}})],1),a("el-form-item",{attrs:{label:"业务日期",size:"mini",prop:"business_time",rules:[{required:!0,message:"请选择业务日期",trigger:"change"}]}},[a("el-date-picker",{attrs:{clearable:!1,type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:e.params.business_time,callback:function(t){e.$set(e.params,"business_time",t)},expression:"params.business_time"}})],1),a("el-form-item",{attrs:{label:"出库类型",size:"mini",prop:"outstock_type_id",rules:[{required:!0,message:"请选择出库类型",trigger:"change"}]}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.params.outstock_type_id,callback:function(t){e.$set(e.params,"outstock_type_id",t)},expression:"params.outstock_type_id"}},[a("el-option",{attrs:{label:"其他出库",value:10003}})],1)],1),a("el-form-item",{attrs:{label:"客户名称",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.customer_id&&(e.params.customer_id=null)}())+" "),a("el-select",{attrs:{filterable:"",placeholder:"请输入",clearable:"",loading:e.loading,remote:"","remote-method":e.clienteleListInvok},on:{change:e.getCustomerInfo,focus:e.clienteleListInvok},model:{value:e.params.customer_id,callback:function(t){e.$set(e.params,"customer_id",t)},expression:"params.customer_id"}},[a("ul",{staticClass:"customer customer-ul4 customer-ul2"},[a("li",[e._v("客户编号")]),a("li",[e._v("客户名称")]),a("li",[e._v("联系人")]),a("li",[e._v("联系电话")]),a("li",[e._v("区域")])]),e._l(e.customerList,(function(t){return a("el-option",{key:t.customer_id,attrs:{label:t.customer_name,value:t.customer_id}},[a("ul",{staticClass:"customer customer-ul4"},[a("li",{attrs:{title:t.customer_id}},[e._v(e._s(t.customer_id))]),a("li",{attrs:{title:t.customer_name}},[e._v(e._s(t.customer_name))]),a("li",{attrs:{title:t.contact_name}},[e._v(e._s(t.contact_name))]),a("li",{attrs:{title:t.customer_mobile}},[e._v(e._s(t.customer_mobile))]),a("li",[e._v(e._s(t.province_name)+"/"+e._s(t.city_name)+"/"+e._s(t.area_name))])])])}))],2)],1),a("el-form-item",{attrs:{label:"部门",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.department_id&&(e.params.department_id=null)}())+" "),a("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:""},on:{focus:e.DepartmentListInvok,change:e.departmentChange},model:{value:e.params.department_id,callback:function(t){e.$set(e.params,"department_id",t)},expression:"params.department_id"}},e._l(e.departmentList,(function(e){return a("el-option",{key:e.department_id,attrs:{label:e.department_name,value:e.department_id}})})),1)],1),a("el-form-item",{attrs:{label:"业务员",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.business_id&&(e.params.business_id=null)}())+" "),a("el-select",{attrs:{clearable:""},on:{focus:e.EmployeeListInvok},model:{value:e.params.business_id,callback:function(t){e.$set(e.params,"business_id",t)},expression:"params.business_id"}},e._l(e.employeeList,(function(e){return a("el-option",{key:e.employee_id,attrs:{label:e.employee_name,value:e.employee_id}})})),1)],1),a("el-form-item",{attrs:{label:"收货人",size:"mini",prop:"consignee_name"}},[a("el-input",{model:{value:e.params.consignee_name,callback:function(t){e.$set(e.params,"consignee_name",t)},expression:"params.consignee_name"}})],1),a("el-form-item",{attrs:{label:"收货人电话",size:"mini"}},[a("el-input",{model:{value:e.params.consignee_mobile,callback:function(t){e.$set(e.params,"consignee_mobile",t)},expression:"params.consignee_mobile"}})],1),a("el-form-item",{attrs:{label:"所属区域",size:"mini"}},[e.defaultArea&&e.defaultArea.length?a("getAreaList",{attrs:{defaultArea:e.defaultArea},on:{changeDefaultArea:e.changeDefaultArea}}):e._e()],1),a("el-form-item",{attrs:{size:"mini",label:"详细地址"}},[a("el-input",{model:{value:e.params.address,callback:function(t){e.$set(e.params,"address",t)},expression:"params.address"}})],1),a("el-form-item",{attrs:{label:"仓库名称",size:"mini"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择"},on:{focus:e.warehouseInvok,change:e.warehouse},model:{value:e.params.warehouse_id,callback:function(t){e.$set(e.params,"warehouse_id",t)},expression:"params.warehouse_id"}},e._l(e.warehouseList,(function(e){return a("el-option",{key:e.warehouse_id,attrs:{label:e.warehouse_name,value:e.warehouse_id}})})),1)],1),a("el-form-item",{attrs:{label:"回款方式",size:"mini",prop:"payment_method",rules:e.rules.payment_method}},[a("el-select",{on:{change:e.cleasrsettlement_customer_id},model:{value:e.params.payment_method,callback:function(t){e.$set(e.params,"payment_method",t)},expression:"params.payment_method"}},[a("el-option",{attrs:{label:"客户自结",value:1}},[e._v("客户自结")]),a("el-option",{attrs:{label:"物流代收",value:2}},[e._v("物流代收")])],1)],1),a("el-form-item",{attrs:{label:"物流公司",size:"mini"}},[a("el-select",{attrs:{clearable:"",filterable:"","filter-method":e.logisticsInvok},on:{change:e.logisticsChanges,focus:e.logisticsInvok},model:{value:e.params.settlement_customer_id,callback:function(t){e.$set(e.params,"settlement_customer_id",t)},expression:"params.settlement_customer_id"}},e._l(e.logisticsList,(function(e){return a("el-option",{key:e.logistics_id,attrs:{label:e.logistics_name,value:e.logistics_id}})})),1)],1),a("el-form-item",{attrs:{label:"送货需求",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.delivery_demand_id&&(e.params.delivery_demand_id=null)}())+" "),a("el-select",{attrs:{clearable:""},on:{focus:e.getDeliveryDemandListInvok},model:{value:e.params.delivery_demand_id,callback:function(t){e.$set(e.params,"delivery_demand_id",t)},expression:"params.delivery_demand_id"}},e._l(e.deliveryDemandList,(function(e){return a("el-option",{key:e.delivery_demand_id,attrs:{label:e.delivery_demand_name,value:e.delivery_demand_id}})})),1)],1),a("el-form-item",{attrs:{label:"交货方式",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.hand_over_id&&(e.params.hand_over_id=null)}())+" "),a("el-select",{attrs:{clearable:""},on:{focus:e.getHandoverListInvok},model:{value:e.params.hand_over_id,callback:function(t){e.$set(e.params,"hand_over_id",t)},expression:"params.hand_over_id"}},e._l(e.handoverList,(function(e){return a("el-option",{key:e.hand_over_id,attrs:{label:e.hand_over_name,value:e.hand_over_id}})})),1)],1),a("el-form-item",{attrs:{label:"打印次数",size:"mini"}},["修改"==e.title?a("span",[e._v(e._s(e.params.print_times))]):a("el-input",{attrs:{disabled:""},model:{value:e.params.print_times,callback:function(t){e.$set(e.params,"print_times",t)},expression:"params.print_times"}})],1),a("el-form-item",{attrs:{label:"单据状态",size:"mini"}},["修改"==e.title?a("span",[e._v(e._s(e.params.auditor_status_name))]):a("el-input",{attrs:{disabled:""},model:{value:e.params.auditor_status_name,callback:function(t){e.$set(e.params,"auditor_status_name",t)},expression:"params.auditor_status_name"}})],1),a("el-form-item",{attrs:{label:"订单号",size:"mini"}},[a("el-input",{attrs:{disabled:"",maxlength:"100"},model:{value:e.params.sales_order_sn,callback:function(t){e.$set(e.params,"sales_order_sn",t)},expression:"params.sales_order_sn"}})],1)],1)],1),a("div",{staticClass:"add_delet"},[a("el-button",{staticClass:"addRow",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:e.addRow}},[e._v("增行")]),a("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.deletes}},[e._v("删行")])],1),a("div",{staticClass:"table_container"},[a("vxe-grid",{ref:"xTable",attrs:{border:"","row-style":e.rowClassName,"show-overflow":"tooltip","show-footer":"true","edit-rules":e.validRules,size:"mini","footer-method":e.footerMethod,"max-height":"500px",data:e.tableData,resizable:"",height:"500px","column-min-width":"100","mouse-config":{selected:!0},columns:e.tableColumn,"keyboard-config":{isArrow:!0,isDel:!1,isTab:!0,isEdit:!0},"edit-config":{trigger:"click",mode:"cell",autoClear:!1,activeMethod:e.activeMethod}}})],1),a("div",{staticClass:"bzstyle"},[a("span",[e._v("备注")]),a("el-input",{attrs:{type:"text",maxlength:"300",placeholder:"请输入"},model:{value:e.params.abstract,callback:function(t){e.$set(e.params,"abstract",t)},expression:"params.abstract"}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.click_submit()}}},[e._v("确 定")])],1),e.dialogChooseProducts?a("goodsPopout",{attrs:{searchParams:{company_id:e.params.company_id,warehouse_id:e.params.warehouse_id,warehouse_name:e.params.warehouse_name,customer_id:e.params.customer_id}},on:{close:function(t){e.dialogChooseProducts=!1},submit:e.chooseProducts_confirm}}):e._e()],1)},s=[],o=a("5530"),n=(a("d81d"),a("d3b7"),a("159b"),a("a9e3"),a("b680"),a("4de4"),a("99af"),a("a15b"),a("e9c4"),a("caad"),a("b42c")),r=a("d12c"),l=a("2f62"),c=a("1da1"),d=(a("96cf"),a("2532"),a("fb6a"),{data:function(){var e=this;return{dialogArryrow:null,validRules:{goods_name:[{required:!0,message:"商品名称必填"}],batch:[{required:!0,message:"批次不能为空"}],real_num:[{required:!0,message:"数量必填"}],sale_price:[{required:!0,message:"单价必填"}],total_price:[{required:!0,message:"合计不能为空"}]},tableColumn:[{type:"checkbox",width:40},{type:"index",title:"序号",width:50},{field:"goods_id",title:"商品编号",width:80,showOverflow:"tooltip",showHeaderOverflow:"tooltip"},{field:"goods_name",title:"商品名称",width:300,showOverflow:"tooltip",showHeaderOverflow:"tooltip",editRender:{name:"vGoods",getParams:function(t){var a=e;return{params:{company_id:e.params.company_id||0,customer_id:e.params.customer_id||0,warehouse_id:e.params.warehouse_id||0,bill_type:2,isTotal:1},getIcon:function(){return[{icon:"el-icon-plus",iconMethod:function(){a.goSelectShop(t)}}]}}},events:{change:this.changeGoods}}},{field:"batch",title:"年周/批次",showOverflow:"tooltip",showHeaderOverflow:"tooltip",width:200,editRender:{autoselect:!0,name:"vBatch",getParams:function(t){return{params:{company_id:e.params.company_id,warehouse_id:e.params.warehouse_id,goods_id:t.row.goods_id,bill_type:2}}},events:{change:function(e,t){var a=t.row;if(!a.goods_id)return!1;var i=e.production_time,s=e.batch_id,o=e.batch,n=e.stocks,r=e.available_stocks,l=e.warehouse_id,c=e.unit_name,d=e.warehouse_name,u=e.allocation_id,m=e.allocation_name;Object.assign(a,{production_time:i,batch_id:s,batch:o,stocks:n,available_stocks:r,warehouse_id:l,unit_name:c,warehouse_name:d,allocation_id:u,allocation_name:m})}}}},{field:"warehouse_name",title:"仓库名称",showOverflow:"tooltip",showHeaderOverflow:"tooltip",width:120},{field:"allocation_name",title:"货位名称",showOverflow:"tooltip",showHeaderOverflow:"tooltip",width:120},{field:"unit_name",title:"单位",showOverflow:"tooltip",showHeaderOverflow:"tooltip",width:110},{field:"real_num",title:"数量",showOverflow:"tooltip",showHeaderOverflow:"tooltip",headerAlign:"right",align:"right",editRender:{autoselect:!0,name:"number",events:{input:function(t){e.handleEdit(t.row,"real_num",t.$rowIndex)}}}},{field:"sale_price",title:"单价",showOverflow:"tooltip",showHeaderOverflow:"tooltip",headerAlign:"right",align:"right",editRender:{autoselect:!0,name:"vNumber",events:{input:function(t){e.handleEdit(t.row,"sale_price",t.$rowIndex)}}}},{field:"total_price",title:"小计金额",showOverflow:"tooltip",showHeaderOverflow:"tooltip",headerAlign:"right",align:"right",editRender:{autoselect:!0,name:"vNumber",events:{input:function(t){e.handleEdit(t.row,"total_price",t.$rowIndex)}}}},{field:"remark",title:"备注",width:150,showOverflow:"tooltip",showHeaderOverflow:"tooltip",editRender:{name:"Vinput",formatter:"String"}}],tableData:[]}},methods:{activeMethod:function(e){var t=e.row,a=(e.rowIndex,e.column);e.columnIndex;return"batch"!=a.property&&"real_num"!=a.property&&"sale_price"!=a.property&&"remark"!=a.property&&"total_price"!=a.property||!!t.goods_id},rowClassName:function(e){var t=e.$rowIndex;e.column,e.columnIndex,e.$columnIndex;if(this.styleArry.includes(t+1+""))return{backgroundColor:"#fdecea",color:"#5F5F5F"}},fullValidEvent:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var a,i,s,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$createElement,i=e.$refs.xTable.getTableData().tableData.slice(0,-1),t.next=4,e.$refs.xTable.validate(i).catch((function(e){return e}));case 4:if(s=t.sent,!s){t.next=12;break}for(n in o=null,s)o=n;return e.$XModal.message({status:"error",message:function(){return[a("div",{class:"red",style:"max-height: 400px;overflow: auto;"},[a("div",[s[o].rule.message])])]}}),t.abrupt("return",!1);case 12:return t.abrupt("return",!0);case 13:case"end":return t.stop()}}),t)})))()},addRow:function(){var e=this.$createElement;if(!this.params.company_id)return this.$XModal.message({status:"error",message:function(){return[e("div",{class:"red",style:"max-height: 400px;overflow: auto;"},[e("div",["请选择组织"])])]}}),!1;var t=this.$refs.xTable;t.createRow({warehouse_id:""}).then((function(e){t.insertAt(e,-1)}))},footerMethod:function(e){var t=this,a=e.columns,i=e.data;return[a.map((function(e,a){return 1===a?"合计":"total_price"==e.property?(t.settlement_price=t.$utils.sum(i,e.property).toFixed(2),t.$utils.sum(i,e.property).toFixed(2)):"real_num"==e.property?t.$utils.sum(i,e.property):void 0}))]}}}),u=d,m=a("65b0"),_={mixins:[u],name:"instorageOthenoutstorageSalesoutstorageAdd",data:function(){return{authority:{},title:"新增",indexchart:{},tableData:[],styleArry:[],dialogChooseProducts:!1,addChandise:!1,rowIndex:null,state:!1,multipleSelection:[],params:{payment_method:1},showAllocationList:!0,companyList:[],showDepartment:!0,defaultArea:[0],allocationInventoryList:[],loading_demo:!1,loading:!1,cityList:[],settlement_price:0,saveNumBatchObj:{}}},components:{goodsAddress:n["a"],getAreaList:r["a"]},computed:Object(o["a"])({},Object(l["c"])(["salesoutstorageAddGet"])),methods:Object(o["a"])(Object(o["a"])({},Object(l["b"])(["othenoutstorageIndexACT"])),{},{goSelectShop:function(e){this.indexchart=e.row,this.dialogChooseProducts=!0},chooseProducts_confirm:function(e){var t=this;e=e.map((function(e){return e.sale_price=e.unit_price,e.real_num=e.goods_num,t.handleEdit(e,"real_num"),e})),this.dialogChooseProducts=!1;var a=this.$refs.xTable;a.insertAt(e,this.indexchart)},changeGoods:function(e,t){var a=t.row;Object.assign(a,{batch_id:null,goods_id:e.goods_id,goods_name:e.goods_name,available_stocks:"",batch:"",unit_name:e.unit_name,warehouse_name:"",allocation_name:"",allocation_id:"",sale_price:e.unit_price,discount_price:0,remark:""});var i=!0,s=this.$refs.xTable;s.getTableData().fullData.forEach((function(e){e.goods_id||(i=!1)})),i&&this.addRow()},batchListInitalList:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=["batch","batch_id","warehouse_id","warehouse_name","allocation_id","allocation_name","production_time","sale_price","available_stocks"];return s.forEach((function(s){if("available_stocks"==s){var o=t.saveNumBatchObj[e["batch_id"]],n=e[s];o&&(n=o),a[s]=n}else i.indexOf(s)<0&&(a[s]=e[s])})),a},cleasrsettlement_customer_id:function(){this.$set(this.params,"settlement_customer_id","")},goBack:function(){this.othenoutstorageIndexACT({goPage:this.salesoutstorageAddGet.goPage,params:this.salesoutstorageAddGet.params,pageSize:this.salesoutstorageAddGet.pageSize}),this.$router.push({path:"/inventory/othenoutstorage"})},toFixedTwo:function(e){var t=Number(e),a=isNaN(t);return a||(e=parseFloat(e).toFixed(2)),e},handleEdit:function(e,t,a){var i={num:"real_num",price:"sale_price",goodsPrice:"total_price"};this.$publicFution.computeTotal(e,i,t,this),this.$refs.xTable.updateFooter()},opens:function(){this.state=!0},goodsdialog:function(e){this.addChandise=!0},attribute:function(e){this.addChandise=e},getCustomerInfo:function(e,t,a){var i=this;if(e)var s=this.customerList.filter((function(t){return t.customer_id===e}))[0].company_id;var o={customer_id:e,company_id:s};if(!e)return!1;this.$axMethod.getCustomerInfoNEWqx(o).then((function(e){var t=e.data;if(200==t.code){var a=["business_id","business_name","hand_over_id","hand_over_name","delivery_demand_id","delivery_demand_name"];a.forEach((function(e){i.$set(i.params,e,t.data[e])})),i.employeeList=[{employee_id:t.data.business_id,employee_name:t.data.business_name}]}})).then((function(e){i.$axMethod.getDefaultAddress(o).then((function(e){var t=e.data;200==t.code&&(i.$set(i.params,"address",t.data.address),i.$set(i.params,"consignee_name",t.data.consignee_name),i.$set(i.params,"consignee_mobile",t.data.consignee_mobile),i.defaultAreaName="".concat(t.data.province_name,"/").concat(t.data.city_name,"/").concat(t.data.area_name),i.defaultArea=[t.data.province_id,t.data.city_id,t.data.area_id],i.params.cityList=i.defaultArea.join(","),i.params.province_id=i.defaultArea[0],i.params.city_id=i.defaultArea[1],i.params.area_id=i.defaultArea[2])}))}))},deletes:function(){var e=this.$refs.xTable;e.removeSelecteds(),e.updateFooter(),this.styleArry=[]},click_submit:function(){var e=this,t=this.$createElement;this.$refs.xTable.clearActived();var a=this.$refs.xTable.getTableData().fullData.filter((function(e){return e.goods_id}));return a.length?2!=this.params.payment_method||this.params.settlement_customer_id?(this.params.settlement_price=this.settlement_price,this.fullValidEvent().then((function(i){if(i){try{var s=[];a.forEach((function(a,i){if(a.real_num>a.available_stocks)throw e.$XModal.message({status:"error",message:function(){return e.$refs.xTable.setActiveCell(a,"real_num"),[t("div",{class:"red",style:"max-height: 400px;overflow: auto;"},[t("div",["第",i+1,"行数量超过商品批次可用数量"])])]}}),Error(!1);s.push(e.portParamsBuild(a,i))}))}catch(n){return!1}var o=s.map((function(e){return{warehouse_id:e.warehouse_id,warehouse_name:e.warehouse_name,allocation_id:e.allocation_id,goods_id:e.goods_id,batch:e.batch,order_goods_id:e.order_goods_id||0,sale_price:e.sale_price||0,batch_id:e.batch_id,goods_num:e.real_num}}));e.$baseData.checkCarDoctor({company_id:e.params.company_id,company_name:e.params.company_name,bill_type:10,bill_id:e.params.outstock_id,operation_type:e.params.outstock_id?2:1,goods_info:JSON.stringify(o)}).then((function(){e.$baseData.checkComputation(s,{goods_num:"real_num",total_price:"total_price",goods_price:"unit_price"}).then((function(){e.$axMethod.safetyStockCheck({bill_sn:e.params.outstock_sn,bill_id:e.params.outstock_id,company_id:e.params.company_id,company_name:e.params.company_name,business_time:e.params.business_time,bill_logogram:"qtck",order_type:1,goods_info:JSON.stringify(o)}).then((function(t){var a=Object.assign({},e.params,{goods_info:JSON.stringify(s)}),i=e.params.outstock_id?"otherStockEditOutstock":"otherStockAddOutstock",o=e;Object(m["m"])(e,{company_id:e.params.company_id,goods_info:JSON.stringify(s),status:1,type:4},(function(){o.$axMethod[i](a).then((function(e){var t=e.data;"200"==t.code?(o.$message({message:t.data,type:"success"}),o.goBack()):o.styleArry=t.data}))}))}))}))}))}})),!1):(this.$message.warning("请选择物流公司"),!1):(this.$message.warning("请完善数据表格"),!1)},portParamsBuild:function(e,t){return"新增"==this.title?{serial_number:t+1,goods_id:e.goods_id,batch:e.batch,batch_id:e.batch_id,warehouse_id:e.warehouse_id,warehouse_name:e.warehouse_name,allocation_id:e.allocation_id,allocation_name:e.allocation_name,settlement_price:e.settlement_price,unit_price:e.sale_price,total_price:e.total_price,production_time:e.production_time,discount_price:e.discount_price?e.discount_price:0,outstock_goods_id:e.outstock_goods_id?e.outstock_goods_id:0,discount_unit_price:e.discount_unit_price?e.discount_unit_price:0,unit_credit_price:e.unit_credit_price,unit_rebate_price:e.unit_rebate_price,unit_deposits_price:e.unit_deposits_price,business_type_id:10001,business_type_name:"商品订购",company_id:this.params.company_id,company_name:this.params.company_name,remark:e.remark?e.remark:"",real_num:e.real_num}:{serial_number:t+1,goods_id:e.goods_id,settlement_price:e.settlement_price,goods_name:e.goods_name instanceof Object?e.goods_name.goods_name:e.goods_name,warehouse_id:e.warehouse_id,warehouse_name:e.warehouse_name,outstock_goods_id:e.outstock_goods_id?e.outstock_goods_id:0,batch_id:e.batch_id,batch:e.batch,production_time:e.production_time,unit_price:e.sale_price,total_price:e.total_price,remark:e.remark?e.remark:"",allocation_id:e.allocation_id,real_num:e.real_num,goods_num:e.real_num}},companyChange:function(e){if(e){var t=this.companyList.filter((function(t){return t.company_id==e}));t.length>0&&(this.params.company_name=t[0].company_name)}this.$set(this.params,"business_id",""),1!=e&&(this.$set(this.params,"customer_id",null),this.$set(this.params,"warehouse_id",null),this.$set(this.params,"goods_info",[]),this.$set(this.params,"department_id",""),this.$set(this.params,"department_name","")),this.$refs.xTable.clearData()},departmentChange:function(e){e&&(this.params.department_name=this.departmentList.filter((function(t){return t.department_id===e}))[0].department_name)},warehouseChange:function(e){e.allocation_id_str=[]},warehouse:function(e){e&&(this.params.warehouse_name=this.warehouseList.filter((function(t){return t.warehouse_id===e}))[0].warehouse_name)},logisticsChange:function(e){this.$common.options("getLogisticsListOption",this.logisticsList,{company_id:this.params.company_id,logistics_name:e})},logisticsChanges:function(e){e&&(this.params.logistics_name=this.logisticsList.filter((function(t){return t.logistics_id==e}))[0].logistics_name)},changeDefaultArea:function(e){this.params.cityList=e.join(","),this.params.province_id=e[0],this.params.city_id=e[1],this.params.area_id=e[2]}}),created:function(){this.params=Object.assign(this.params,{payment_method:1})},mounted:function(){var e=this;if(this.title=this.salesoutstorageAddGet.outstock_id?"修改":"新增",this.salesoutstorageAddGet.outstock_id)this.$axMethod.otherStockCheckOutstock({outstock_id:this.salesoutstorageAddGet.outstock_id}).then((function(t){var a=t.data;200==a.code&&(0==a.data.settlement_customer_id&&(a.data.settlement_customer_id=""),e.defaultArea=[a.data.province_id,a.data.city_id,a.data.area_id],0==a.data.warehouse_id&&(a.data.warehouse_id=""),e.params.cityList=e.defaultArea.join(","),e.params.province_id=e.defaultArea[0],e.params.city_id=e.defaultArea[1],e.params.area_id=e.defaultArea[2],e.$set(e,"tableData",a.data.goods_info),delete a.data.goods_info,e.params=a.data,Object.assign(a.data,{employee_id:a.data.business_id,employee_name:a.data.business_name}),a.data.settlement_customer_id&&e.logisticsList.push({logistics_id:a.data.settlement_customer_id,logistics_name:a.data.settlement_customer_name}),Object(m["l"])(e,a.data))}));else{var t=localStorage,a=t.employee_id,i=t.company_admin_id;[0,1,2].includes(Number(a))||i>0?this.$set(this,"params",{outstock_type_id:10003,business_time:this.$publicFution.formatData(new Date),company_id:Number(localStorage.company_id),payment_method:1,cityList:""}):this.$set(this,"params",{outstock_type_id:10003,business_time:this.$publicFution.formatData(new Date),company_id:Number(localStorage.company_id),department_id:Number(localStorage.department_id),business_id:Number(localStorage.employee_id),payment_method:1,cityList:""}),Object(m["l"])(this,localStorage),this.addRow()}}},p=_,h=(a("d137"),a("2877")),f=Object(h["a"])(p,i,s,!1,null,"73c7acc9",null);t["default"]=f.exports},"6b35":function(e,t,a){},b42c:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"dialogForm",attrs:{"close-on-click-modal":!1,title:"货位列表",visible:!0,width:"800px"},on:{close:e.closeDialog}},[a("div",{staticClass:"search_container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[a("el-form-item",{attrs:{label:"货位名称",size:"mini"}},[a("el-input",{staticClass:"shortSearchInput",model:{value:e.params.allocation_name,callback:function(t){e.$set(e.params,"allocation_name",t)},expression:"params.allocation_name"}})],1),a("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[a("el-button",{attrs:{size:"mini"},on:{click:e.onSearch}},[e._v("查询")])],1)],1)],1),a("span",{staticClass:"pr20"},[e._v(e._s(e.TableData.goods_info.warehouse_name))]),a("span",{staticClass:"pr20"},[e._v(e._s(e.TableData.goods_info.goods_name))]),a("br"),a("br"),a("div",{staticClass:"table_container"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading1,expression:"loading1"}],staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:e.TableData.tableData,"max-height":"600"},on:{"row-click":e.handleSelectionChange}},[a("el-table-column",{attrs:{"show-overflow-tooltip":!0,width:"50",label:"选择"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.row.allocation_id},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v(e._s(null))])]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"allocation_name",label:"货位名称"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"stocks",label:"货位目前货品数量"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"订单商品数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"请输入","suffix-icon":"el-icon-edit-outline"},on:{change:function(a){return e.toPositiveNum(t.row)}},model:{value:t.row.num,callback:function(a){e.$set(t.row,"num",a)},expression:"scope.row.num"}})]}}])})],1)],1),a("div",{staticClass:"page_container"},[a("div",{staticClass:"pageNumber"},[e._v("每页显示")]),a("el-pagination",{staticClass:"erp-pagination",attrs:{"current-page":e.goPage,"page-sizes":[30,50,100,500],layout:"total,sizes, prev, pager, next,jumper",prevText:"上一页",nextText:"下一页",total:e.TableData.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.goPage=t},"update:current-page":function(t){e.goPage=t}}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.closeDialog()}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("确 定")])],1)])],1)},s=[],o=(a("e9c4"),a("65b0"),{data:function(){return{TableData:{tableData:[],goods_info:{},total:10},goPage:1,loading:!0,manageList:[],multipleSelection:[],params:{},radio:null}},props:{selectData:{type:[Object],default:"",required:!0}},methods:{toPositiveNum:function(e){var t=this;this.$nextTick((function(){(e.num<0||isNaN(e.num))&&(e.num=0),e.num>e.stocks&&(t.$message.warning("订单商品数量不能大于可用数量"),e.num=0),e.num=Math.ceil(e.num)}))},closeDialog:function(){this.$parent.goodsAddressVisible=!1},initData:function(){var e=this;this.$axMethod.publicsAllocationList(this.params).then((function(t){200==t.data.code&&(e.loading=!1,e.goods_info=t.data.data.goods_info,e.TableData.tableData=t.data.data.allocation_list.data,e.TableData.total=t.data.data.allocation_list.total)}))},handleSelectionChange:function(e){this.radio=e.allocation_id,this.multipleSelection=e},handleCurrentChange:function(e){this.params.page=e,this.initData()},onSearch:function(){this.goPage=1,this.params.page=1,this.initData()},submit:function(){var e=!0;if("{}"!=JSON.stringify(this.multipleSelection)){if(this.multipleSelection.num||(this.$message({message:"请填写已勾选货位的商品数量",type:"warning"}),e=!1),this.multipleSelection.num>this.multipleSelection.now_goods_num&&(this.$message({message:"数量不得大于货位目前货品数量！",type:"warning"}),e=!1),!e)return!1;this.$emit("getAllocationArr",this.multipleSelection),this.$parent.goodsAddressVisible=!1}else this.$message({message:"请选择货位信息",type:"warning"})}},mounted:function(){this.$set(this,"params",{goods_id:this.selectData.goods_id,warehouse_id:this.selectData.warehouse_id,company_id:this.selectData.company_id}),this.initData()}}),n=o,r=(a("d95ac"),a("2877")),l=Object(r["a"])(n,i,s,!1,null,"cc8da5b8",null);t["a"]=l.exports},b680:function(e,t,a){"use strict";var i=a("23e7"),s=a("da84"),o=a("e330"),n=a("5926"),r=a("408a"),l=a("1148"),c=a("d039"),d=s.RangeError,u=s.String,m=Math.floor,_=o(l),p=o("".slice),h=o(1..toFixed),f=function(e,t,a){return 0===t?a:t%2===1?f(e,t-1,a*e):f(e*e,t/2,a)},g=function(e){var t=0,a=e;while(a>=4096)t+=12,a/=4096;while(a>=2)t+=1,a/=2;return t},b=function(e,t,a){var i=-1,s=a;while(++i<6)s+=t*e[i],e[i]=s%1e7,s=m(s/1e7)},v=function(e,t){var a=6,i=0;while(--a>=0)i+=e[a],e[a]=m(i/t),i=i%t*1e7},w=function(e){var t=6,a="";while(--t>=0)if(""!==a||0===t||0!==e[t]){var i=u(e[t]);a=""===a?i:a+_("0",7-i.length)+i}return a},y=c((function(){return"0.000"!==h(8e-5,3)||"1"!==h(.9,0)||"1.25"!==h(1.255,2)||"1000000000000000128"!==h(0xde0b6b3a7640080,0)}))||!c((function(){h({})}));i({target:"Number",proto:!0,forced:y},{toFixed:function(e){var t,a,i,s,o=r(this),l=n(e),c=[0,0,0,0,0,0],m="",h="0";if(l<0||l>20)throw d("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return u(o);if(o<0&&(m="-",o=-o),o>1e-21)if(t=g(o*f(2,69,1))-69,a=t<0?o*f(2,-t,1):o/f(2,t,1),a*=4503599627370496,t=52-t,t>0){b(c,0,a),i=l;while(i>=7)b(c,1e7,0),i-=7;b(c,f(10,i,1),0),i=t-1;while(i>=23)v(c,1<<23),i-=23;v(c,1<<i),b(c,1,1),v(c,2),h=w(c)}else b(c,0,a),b(c,1<<-t,0),h=w(c)+_("0",l);return l>0?(s=h.length,h=m+(s<=l?"0."+_("0",l-s)+h:p(h,0,s-l)+"."+p(h,s-l))):h=m+h,h}})},d12c:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-cascader",{attrs:{filterable:e.filterable,placeholder:"请选择",options:e.options,clearable:"",size:"mini",props:e.prop},on:{change:e.changes,"expand-change":e.handleItemChange},model:{value:e.newDefaultArea,callback:function(t){e.newDefaultArea=t},expression:"newDefaultArea"}})],1)},s=[],o=(a("e3df"),a("42aa"),a("b1f0"),{data:function(){return{options:[],newDefaultArea:[]}},props:{defaultArea:{type:Array},filterable:{type:Boolean,default:!1},Level:{type:Number,default:3},prop:{type:Object,default:function(){return{value:"value",children:"cities"}}}},methods:{changes:function(e){var t=this;this.$nextTick((function(){t.$emit("changeDefaultArea",t.newDefaultArea)}))},handleItemChange:function(e){var t,a=this;1==e.length&&(t=e[0]),2==e.length&&(t=e[1]),this.$axios({method:"get",url:this.$api.getAreaListOption,params:{p_id:t,is_page:1}}).then((function(t){for(var i in a.options){if(1==e.length&&a.options[i].value==e[0]&&!a.options[i].cities.length)for(var s in t.data.data){var o={};o.label=t.data.data[s].area_name,o.value=t.data.data[s].area_id,3==a.Level&&(o.cities=[]),a.options[i].cities.push(o)}if(2==e.length&&3==a.Level)for(var n in a.options[i].cities)if(a.options[i].cities[n].value==e[1]&&!a.options[i].cities[n].cities.length)for(var r in t.data.data){var l={};l.label=t.data.data[r].area_name,l.value=t.data.data[r].area_id,a.options[i].cities[n].cities.push(l)}}}))},initAddress:function(){var e=this,t={level:2},a=this;a.$axMethod.getAreaList(t).then((function(t){var i={};for(var s in t.data.data){i={label:t.data.data[s].area_name,value:t.data.data[s].area_id,cities:[]};a.options.push(i)}if(e.defaultArea.length<=1)return!1;var o={level:3,p_id:a.defaultArea[0]};a.$axMethod.getAreaList(o).then((function(t){for(var i in a.options)if(a.options[i].value==o.p_id&&!a.options[i].cities.length)for(var s in t.data.data){var n={label:t.data.data[s].area_name,value:t.data.data[s].area_id,cities:[]};a.options[i].cities.push(n)}if(e.defaultArea.length<=2)return!1;var r={level:4,p_id:a.defaultArea[1]};a.$axMethod.getAreaList(r).then((function(e){for(var t in a.options)for(var i in a.options[t].cities)if(a.options[t].cities[i].value==r.p_id&&!a.options[t].cities[i].cities.length)for(var s in e.data.data){var o={label:e.data.data[s].area_name,value:e.data.data[s].area_id};a.options[t].cities[i].cities.push(o)}}))}))}))}},mounted:function(){var e=this;if(this.defaultArea.length>1)this.newDefaultArea=this.defaultArea.filter((function(e){return e})),this.initAddress();else{var t={level:2};this.$axMethod.getAreaList(t).then((function(t){var a={};for(var i in t.data.data){a={label:t.data.data[i].area_name,value:t.data.data[i].area_id,cities:[]};e.options.push(a)}}))}},watch:{defaultArea:{handler:function(e,t){this.options=[],this.newDefaultArea=this.defaultArea,this.initAddress()},deep:!0}}}),n=o,r=a("2877"),l=Object(r["a"])(n,i,s,!1,null,null,null);t["a"]=l.exports},d137:function(e,t,a){"use strict";a("6b35")},d95ac:function(e,t,a){"use strict";a("0a0e")}}]);
//# sourceMappingURL=chunk-c9c0da06.f1f5d115.js.map