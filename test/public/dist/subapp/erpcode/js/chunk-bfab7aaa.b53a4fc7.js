(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-bfab7aaa"],{1315:function(t,e,a){"use strict";a("78c6")},"19aa":function(t,e,a){var i=a("da84"),o=a("3a9b"),n=i.TypeError;t.exports=function(t,e){if(o(e,t))return t;throw n("Incorrect invocation")}},2266:function(t,e,a){var i=a("da84"),o=a("0366"),n=a("c65b"),s=a("825a"),r=a("0d51"),l=a("e95a"),c=a("07fa"),u=a("3a9b"),d=a("9a1f"),f=a("35a1"),b=a("2a62"),p=i.TypeError,h=function(t,e){this.stopped=t,this.result=e},m=h.prototype;t.exports=function(t,e,a){var i,_,v,g,w,y,j,x=a&&a.that,T=!(!a||!a.AS_ENTRIES),k=!(!a||!a.IS_ITERATOR),D=!(!a||!a.INTERRUPTED),S=o(e,x),$=function(t){return i&&b(i,"normal",t),new h(!0,t)},E=function(t){return T?(s(t),D?S(t[0],t[1],$):S(t[0],t[1])):D?S(t,$):S(t)};if(k)i=t;else{if(_=f(t),!_)throw p(r(t)+" is not iterable");if(l(_)){for(v=0,g=c(t);g>v;v++)if(w=E(t[v]),w&&u(m,w))return w;return new h(!1)}i=d(t,_)}y=i.next;while(!(j=n(y,i)).done){try{w=E(j.value)}catch(A){b(i,"throw",A)}if("object"==typeof w&&w&&u(m,w))return w}return new h(!1)}},2626:function(t,e,a){"use strict";var i=a("d066"),o=a("9bf2"),n=a("b622"),s=a("83ab"),r=n("species");t.exports=function(t){var e=i(t),a=o.f;s&&e&&!e[r]&&a(e,r,{configurable:!0,get:function(){return this}})}},"549e":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[t._v("库存管理")]),a("el-breadcrumb-item",{staticClass:"attrbute"},[a("span",{on:{click:t.goBack}},[t._v("调整成本价")])]),a("el-breadcrumb-item",[t._v(t._s(t.title)+"调整成本价")])],1),a("div",{staticClass:"search_container"},[a("el-form",{ref:"TableDataRef",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.TableData.info}},[a("el-form-item",{attrs:{label:"库存组织",size:"mini",prop:"company_id",rules:t.rules.company_id}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:""},on:{focus:t.companyListInvok,change:t.companyChange},model:{value:t.TableData.info.company_id,callback:function(e){t.$set(t.TableData.info,"company_id",e)},expression:"TableData.info.company_id"}},t._l(t.companyList,(function(e){return a("el-option",{key:e.company_id,attrs:{label:e.company_name,value:e.company_id}},[a("span",{class:1==e.type?"optionStyle":""},[t._v(t._s(e.company_name))])])})),1)],1),"新增"!=t.title?a("el-form-item",{attrs:{label:"单据号",size:"mini"}},[a("el-input",{attrs:{type:"text",disabled:!0,placeholder:"请输入"},model:{value:t.TableData.info.adjust_sn,callback:function(e){t.$set(t.TableData.info,"adjust_sn",e)},expression:"TableData.info.adjust_sn"}})],1):t._e(),a("el-form-item",{attrs:{label:"业务日期",size:"mini",prop:"business_time",rules:t.rules.business_time}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.TableData.info.business_time,callback:function(e){t.$set(t.TableData.info,"business_time",e)},expression:"TableData.info.business_time"}})],1),a("el-form-item",{attrs:{label:"备注",size:"mini"}},[a("el-input",{attrs:{type:"text",maxlength:"300",placeholder:"请输入"},model:{value:t.TableData.info.remark,callback:function(e){t.$set(t.TableData.info,"remark",e)},expression:"TableData.info.remark"}})],1)],1)],1),a("div",{staticClass:"add_delet"},[a("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:t.addLine}},[t._v("增行")]),a("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:t.deletes}},[t._v("删行")])],1),a("div",{staticClass:"table_container"},[a("el-table",{staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:t.TableData.goods_list.data,"max-height":"600"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{"show-overflow-tooltip":!0,type:"selection",fixed:"left",align:"center",width:"44","reserve-selection":!1}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_id",label:"商品编号","min-width":"160"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_name",label:"商品名称","min-width":"500"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("pre",[t._v(t._s(e.row.goods_name))])]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"batch",label:"年周/批次","min-width":"120"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"warehouse_name",label:"仓库名称",width:"132"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"allocation_name",label:"货位名称","min-width":"150"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"stocks",label:"结存数量","min-width":"150",align:"right"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"cost_price",label:"结存成本价","min-width":"150",align:"right"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"subtotal_amount",label:"结存成本总价","min-width":"150",align:"right"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"adjust_price",label:"调整后成本价","min-width":"150",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{placeholder:"请输入","suffix-icon":"el-icon-edit-outline"},on:{change:function(a){return t.toPositiveNum(e.row,"adjust_price",e.$index)}},model:{value:e.row.adjust_price,callback:function(a){t.$set(e.row,"adjust_price",a)},expression:"scope.row.adjust_price"}})]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"adjust_balance",label:"调整后结存成本总价","min-width":"150",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{placeholder:"请输入","suffix-icon":"el-icon-edit-outline"},on:{change:function(a){return t.toPositiveNum(e.row,"adjust_balance",e.$index)}},model:{value:e.row.adjust_balance,callback:function(a){t.$set(e.row,"adjust_balance",a)},expression:"scope.row.adjust_balance"}})]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"出库成本总差价","min-width":"150",align:"right","render-header":t.renderHeader,formatter:t.returnPrice}}),"修改"==t.title?a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"update_time",label:"最近修改时间","min-width":"170"}}):t._e()],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){return t.goBack()}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submit("TableDataRef")}}},[t._v("确 定")])],1),t.dialogFormVisible?a("goodsPopout",{attrs:{incloudTop:["batch","warehouse_name","cost_price","allocation_name","stocks"],ExcloudParams:["specification_type","pattern"],searchParams:{company_id:t.TableData.info.company_id}},on:{close:function(e){t.dialogFormVisible=!1},submit:t.confirm}}):t._e()],1)},o=[],n=a("2909"),s=a("5530"),r=(a("b680"),a("a9e3"),a("d3b7"),a("159b"),a("d81d"),a("caad"),a("2532"),a("6062"),a("3ca3"),a("ddb0"),a("4de4"),a("a630"),a("e9c4"),a("2f62")),l=a("65b0"),c={name:"instorageAdjustcostAdjustcostAdd",data:function(){return{authority:{},title:"新增",paramsRules:{},goodsAddressVisible:!1,return_allocation_arr:{},dialogFormVisible:!1,addChandise:!1,companyList:[],state:!1,multipleSelection:[],TableData:{goods_list:{data:[]},info:{}},showAllocationList:!0}},computed:Object(s["a"])({},Object(r["c"])(["adjustcostAddGet"])),methods:Object(s["a"])(Object(s["a"])({},Object(r["b"])(["adjustcostIndexACT"])),{},{returnPrice:function(t,e,a,i){return void 0==t.adjust_price||void 0==t.adjust_balance?0:Number(t.subtotal_amount-t.adjust_balance).toFixed(2)},cost_balance:function(t,e,a,i){return t.subtotal_amount=t.cost_price*t.stocks,t.subtotal_amount.toFixed(2)},renderHeader:function(){var t=this.$createElement;return t("el-tooltip",{class:"item",attrs:{effect:"dark",placement:"top"}},[t("p",{slot:"content"},["1、出库成本总差价=结存成本总价-调整后结存成本总价",t("br"),t("br"),"2、出库成本总差价>0，表示降低总成本价；",t("br"),t("br"),"3、出库成本总差价<0，表示调高总成本价；"]),t("span",{class:"el-icon-question",style:"cursor:pointer;font-weight:bold"},["出库成本总差价"])])},toPositiveNum:function(t,e,a){if(t[e]<0&&this.$message.warning("请输入大于等于0的数字"),(t[e]<0||isNaN(t[e]))&&(t[e]=0),t[e]>=1e8&&this.$message.warning("数值不能超过一亿"),"adjust_price"===e)this.$set(this.TableData.goods_list.data[a],"adjust_balance",t.adjust_price*t.stocks);else if("adjust_balance"===e){var i=0;0!=Number(t.stocks)&&(i=t.adjust_balance/t.stocks),this.$set(this.TableData.goods_list.data[a],"adjust_price",i)}t.adjust_price=Number(t.adjust_price).toFixed(2),t.adjust_balance=Number(t.adjust_balance).toFixed(2)},handleSelectionChange:function(t){this.multipleSelection=t},goBack:function(){this.$router.push({path:"/inventory/adjustcost"}),this.adjustcostIndexACT({goPage:this.adjustcostAddGet.goPage,params:this.adjustcostAddGet.params,pageSize:this.adjustcostAddGet.pageSize})},companyChange:function(){this.$set(this.TableData.goods_list,"data",[])},initData:function(){var t=this;this.$axMethod.infoAdjustGoods(this.TableData.info).then((function(e){var a=e.data;t.companyList.push({company_id:a.data.info.company_id,company_name:a.data.info.company_name}),a.data.goods_list.forEach((function(t){t.cost_balance&&(t.subtotal_amount=t.cost_balance)})),"200"==a.code&&(t.$set(t,"TableData",a.data),t.$set(t.TableData.goods_list,"data",a.data.goods_list))}))},addLine:function(){this.dialogFormVisible=!0},opens:function(){this.state=!0},goodsdialog:function(t){this.addChandise=!0},attribute:function(t){this.addChandise=t},confirm:function(t){var e=this,a=this.TableData.goods_list.data.map((function(t){return t.batch_id}));t.forEach((function(t){t.subtotal_amount&&(t.cost_balance=t.subtotal_amount),a.includes(t.batch_id)||e.TableData.goods_list.data.push(t)})),this.dialogFormVisible=!1,this.state=!1},deletes:function(){if(this.multipleSelection.length){var t=new Set(this.TableData.goods_list.data),e=new Set(this.multipleSelection),a=new Set(Object(n["a"])(t).filter((function(t){return!e.has(t)})));this.TableData.goods_list.data=Array.from(a)}else this.$message({message:"请先选择要删除的商品！",type:"warning"})},submit:function(t){var e=this,a=!0;if(!this.TableData.goods_list.data.length)return this.$message({message:"请先添加商品！",type:"warning"}),!1;this.$refs[t].validate((function(t){if(t){if(e.TableData.goods_list.data.forEach((function(t){t.adjust_price||(e.$message({message:"请先完善商品成本价！",type:"warning"}),a=!1)})),!a)return!1;var i=e.TableData.info,o=e.TableData.goods_list.data.map((function(t){return{batch:t.batch,goods_id:t.goods_id,cost_price:t.cost_price,cost_balance:t.subtotal_amount,adjust_price:t.adjust_price,adjust_balance:t.adjust_balance,warehouse_id:t.warehouse_id,allocation_id:t.allocation_id,stocks:t.stocks}}));e.TableData.info.adjust_id,i.goods_json=JSON.stringify(o);var n=e.TableData.info.adjust_id?"editAdjustGoods":"addAdjustGoods";e.$axMethod[n](i).then((function(t){var a=t.data;"200"==a.code&&(e.$message({message:a.msg||a.data,type:"success"}),setTimeout((function(){e.goBack()})))}))}}))}}),mounted:function(){this.title=this.adjustcostAddGet.adjust_id?"修改":"新增",this.adjustcostAddGet.adjust_id&&this.$set(this.TableData.info,"adjust_id",this.adjustcostAddGet.adjust_id),this.$set(this.TableData.info,"business_time",this.$publicFution.formatData(new Date)),this.adjustcostAddGet.adjust_id?this.initData():(this.$set(this.TableData.info,"company_id",Number(localStorage.company_id)),Object(l["l"])(this,window.localStorage))}},u=c,d=(a("1315"),a("2877")),f=Object(d["a"])(u,i,o,!1,null,"0b0e01c4",null);e["default"]=f.exports},6062:function(t,e,a){"use strict";var i=a("6d61"),o=a("6566");i("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),o)},6566:function(t,e,a){"use strict";var i=a("9bf2").f,o=a("7c73"),n=a("e2cc"),s=a("0366"),r=a("19aa"),l=a("2266"),c=a("7dd0"),u=a("2626"),d=a("83ab"),f=a("f183").fastKey,b=a("69f3"),p=b.set,h=b.getterFor;t.exports={getConstructor:function(t,e,a,c){var u=t((function(t,i){r(t,b),p(t,{type:e,index:o(null),first:void 0,last:void 0,size:0}),d||(t.size=0),void 0!=i&&l(i,t[c],{that:t,AS_ENTRIES:a})})),b=u.prototype,m=h(e),_=function(t,e,a){var i,o,n=m(t),s=v(t,e);return s?s.value=a:(n.last=s={index:o=f(e,!0),key:e,value:a,previous:i=n.last,next:void 0,removed:!1},n.first||(n.first=s),i&&(i.next=s),d?n.size++:t.size++,"F"!==o&&(n.index[o]=s)),t},v=function(t,e){var a,i=m(t),o=f(e);if("F"!==o)return i.index[o];for(a=i.first;a;a=a.next)if(a.key==e)return a};return n(b,{clear:function(){var t=this,e=m(t),a=e.index,i=e.first;while(i)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete a[i.index],i=i.next;e.first=e.last=void 0,d?e.size=0:t.size=0},delete:function(t){var e=this,a=m(e),i=v(e,t);if(i){var o=i.next,n=i.previous;delete a.index[i.index],i.removed=!0,n&&(n.next=o),o&&(o.previous=n),a.first==i&&(a.first=o),a.last==i&&(a.last=n),d?a.size--:e.size--}return!!i},forEach:function(t){var e,a=m(this),i=s(t,arguments.length>1?arguments[1]:void 0);while(e=e?e.next:a.first){i(e.value,e.key,this);while(e&&e.removed)e=e.previous}},has:function(t){return!!v(this,t)}}),n(b,a?{get:function(t){var e=v(this,t);return e&&e.value},set:function(t,e){return _(this,0===t?0:t,e)}}:{add:function(t){return _(this,t=0===t?0:t,t)}}),d&&i(b,"size",{get:function(){return m(this).size}}),u},setStrong:function(t,e,a){var i=e+" Iterator",o=h(e),n=h(i);c(t,e,(function(t,e){p(this,{type:i,target:t,state:o(t),kind:e,last:void 0})}),(function(){var t=n(this),e=t.kind,a=t.last;while(a&&a.removed)a=a.previous;return t.target&&(t.last=a=a?a.next:t.state.first)?"keys"==e?{value:a.key,done:!1}:"values"==e?{value:a.value,done:!1}:{value:[a.key,a.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),a?"entries":"values",!a,!0),u(e)}}},"6d61":function(t,e,a){"use strict";var i=a("23e7"),o=a("da84"),n=a("e330"),s=a("94ca"),r=a("6eeb"),l=a("f183"),c=a("2266"),u=a("19aa"),d=a("1626"),f=a("861d"),b=a("d039"),p=a("1c7e"),h=a("d44e"),m=a("7156");t.exports=function(t,e,a){var _=-1!==t.indexOf("Map"),v=-1!==t.indexOf("Weak"),g=_?"set":"add",w=o[t],y=w&&w.prototype,j=w,x={},T=function(t){var e=n(y[t]);r(y,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(v&&!f(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return v&&!f(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(v&&!f(t))&&e(this,0===t?0:t)}:function(t,a){return e(this,0===t?0:t,a),this})},k=s(t,!d(w)||!(v||y.forEach&&!b((function(){(new w).entries().next()}))));if(k)j=a.getConstructor(e,t,_,g),l.enable();else if(s(t,!0)){var D=new j,S=D[g](v?{}:-0,1)!=D,$=b((function(){D.has(1)})),E=p((function(t){new w(t)})),A=!v&&b((function(){var t=new w,e=5;while(e--)t[g](e,e);return!t.has(-0)}));E||(j=e((function(t,e){u(t,y);var a=m(new w,t,j);return void 0!=e&&c(e,a[g],{that:a,AS_ENTRIES:_}),a})),j.prototype=y,y.constructor=j),($||A)&&(T("delete"),T("has"),_&&T("get")),(A||S)&&T(g),v&&y.clear&&delete y.clear}return x[t]=j,i({global:!0,forced:j!=w},x),h(j,t),v||a.setStrong(j,t,_),j}},"78c6":function(t,e,a){},b680:function(t,e,a){"use strict";var i=a("23e7"),o=a("da84"),n=a("e330"),s=a("5926"),r=a("408a"),l=a("1148"),c=a("d039"),u=o.RangeError,d=o.String,f=Math.floor,b=n(l),p=n("".slice),h=n(1..toFixed),m=function(t,e,a){return 0===e?a:e%2===1?m(t,e-1,a*t):m(t*t,e/2,a)},_=function(t){var e=0,a=t;while(a>=4096)e+=12,a/=4096;while(a>=2)e+=1,a/=2;return e},v=function(t,e,a){var i=-1,o=a;while(++i<6)o+=e*t[i],t[i]=o%1e7,o=f(o/1e7)},g=function(t,e){var a=6,i=0;while(--a>=0)i+=t[a],t[a]=f(i/e),i=i%e*1e7},w=function(t){var e=6,a="";while(--e>=0)if(""!==a||0===e||0!==t[e]){var i=d(t[e]);a=""===a?i:a+b("0",7-i.length)+i}return a},y=c((function(){return"0.000"!==h(8e-5,3)||"1"!==h(.9,0)||"1.25"!==h(1.255,2)||"1000000000000000128"!==h(0xde0b6b3a7640080,0)}))||!c((function(){h({})}));i({target:"Number",proto:!0,forced:y},{toFixed:function(t){var e,a,i,o,n=r(this),l=s(t),c=[0,0,0,0,0,0],f="",h="0";if(l<0||l>20)throw u("Incorrect fraction digits");if(n!=n)return"NaN";if(n<=-1e21||n>=1e21)return d(n);if(n<0&&(f="-",n=-n),n>1e-21)if(e=_(n*m(2,69,1))-69,a=e<0?n*m(2,-e,1):n/m(2,e,1),a*=4503599627370496,e=52-e,e>0){v(c,0,a),i=l;while(i>=7)v(c,1e7,0),i-=7;v(c,m(10,i,1),0),i=e-1;while(i>=23)g(c,1<<23),i-=23;g(c,1<<i),v(c,1,1),g(c,2),h=w(c)}else v(c,0,a),v(c,1<<-e,0),h=w(c)+b("0",l);return l>0?(o=h.length,h=f+(o<=l?"0."+b("0",l-o)+h:p(h,0,o-l)+"."+p(h,o-l))):h=f+h,h}})},bb2f:function(t,e,a){var i=a("d039");t.exports=!i((function(){return Object.isExtensible(Object.preventExtensions({}))}))},e2cc:function(t,e,a){var i=a("6eeb");t.exports=function(t,e,a){for(var o in e)i(t,o,e[o],a);return t}},f183:function(t,e,a){var i=a("23e7"),o=a("e330"),n=a("d012"),s=a("861d"),r=a("1a2d"),l=a("9bf2").f,c=a("241c"),u=a("057f"),d=a("90e3"),f=a("bb2f"),b=!1,p=d("meta"),h=0,m=Object.isExtensible||function(){return!0},_=function(t){l(t,p,{value:{objectID:"O"+h++,weakData:{}}})},v=function(t,e){if(!s(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,p)){if(!m(t))return"F";if(!e)return"E";_(t)}return t[p].objectID},g=function(t,e){if(!r(t,p)){if(!m(t))return!0;if(!e)return!1;_(t)}return t[p].weakData},w=function(t){return f&&b&&m(t)&&!r(t,p)&&_(t),t},y=function(){j.enable=function(){},b=!0;var t=c.f,e=o([].splice),a={};a[p]=1,t(a).length&&(c.f=function(a){for(var i=t(a),o=0,n=i.length;o<n;o++)if(i[o]===p){e(i,o,1);break}return i},i({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:u.f}))},j=t.exports={enable:y,fastKey:v,getWeakData:g,onFreeze:w};n[p]=!0}}]);
//# sourceMappingURL=chunk-bfab7aaa.b53a4fc7.js.map