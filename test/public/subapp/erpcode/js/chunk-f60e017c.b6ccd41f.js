(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-f60e017c"],{2995:function(e,t,i){"use strict";i("38d6")},"38d6":function(e,t,i){},"4eeb":function(e,t,i){"use strict";i("d81d"),i("caad"),i("8ba4"),i("a9e3"),i("b680");function a(e,t,i){if(e)for(var a=0;a<e.length;a++)if(t.business_type_id===e[a].business_type_id)return e[a].business_type_name+s(t,i)}function s(e,t){if(10003===e.business_type_id)for(var i=t.$refs.xTable.getTableData().fullData,a=0;a<i.length;a++)if(i[a].binding_sign===e.binding_sign&&10003!==i[a].business_type_id)return"(行"+(a+1)+")";return""}function _(e,t){for(var i=0,a=t.$refs.xTable.getTableData().fullData,s=0;s<a.length;s++)if(void 0!==e.binding_sign&&a[s].binding_sign===e.binding_sign&&i++,i>=2&&10003===e.business_type_id)return t.$message.warning("当前满足促销政策不可修改"),!1;return!0}var r={data:function(){var e=this,t=this.$createElement;return{dialogArryrow:null,tableColumn:[{type:"checkbox",width:40},{type:"index",title:"序号",width:50},{title:"业务类型",field:"business_type_id",width:110,showOverflow:!0,editRender:{type:"default",autofocus:".el-input__inner"},slots:{edit:function(t,i){var a=t.row,s=(t.rowIndex,i("el-select",{on:{change:function(i){a.business_type_id=i,e.changeBusinessType(t)}},model:{value:a.business_type_id,callback:function(t){e.$set(a,"business_type_id",t)}}},[e.businessTypeList.map((function(e){return i("el-option",{attrs:{label:e.business_type_name,value:e.business_type_id},key:e.business_type_id})}))]));return[s]},default:function(t,i){var s,_=t.row;t.rowIndex;return s=i("span",[a(e.businessTypeList,_,e)]),e.addDisabled?[s]:[i("span",[_.business_type_name])]}}},{field:"goods_id",title:"商品编号",width:80,showOverflow:!0},{field:"goods_name",title:"商品名称",width:300,showOverflow:!0,editRender:{name:"vGoods",getParams:function(t){var i=e;return{params:{company_id:e.params.company_id||0,customer_id:e.params.customer_id||0,warehouse_id:e.params.warehouse_id||0,bill_type:2,isTotal:1},showObj:{goods_id:"商品编号",goods_name:"商品名称",factory_code:"工厂代码",shorthand_code:"速记码",available_stocks:"可用库存",stocks:"在库库存"},getIcon:function(){return[{icon:"el-icon-plus",iconMethod:function(){i.goSelectShop(t)}}]}}},events:{change:this.changeGoods}}},{field:"batch",title:"年周/批次",width:200,showOverflow:!0,editRender:{autoselect:!0,name:"vBatch",getParams:function(t){var i=e;return{params:{company_id:e.params.company_id,warehouse_id:e.params.warehouse_id,goods_id:t.row.goods_id,bill_type:2},getOutIcon:function(){return i.addDisabled?[]:[{icon:"icon-copy",iconMethod:function(){i.dialogArryrow=t,i.batchInvok(t.row,"",2),i.dialogTableBatch=!0}}]}}},events:{change:function(e,t){var i=t.row;if(!i.goods_id)return!1;var a=e.production_time,s=e.batch_id,_=e.batch,r=e.stocks,o=e.available_stocks,n=e.warehouse_id,l=e.warehouse_name,c=e.allocation_id,u=e.allocation_name;Object.assign(i,{production_time:a,batch_id:s,batch:_,stocks:r,available_stocks:o,warehouse_id:n,warehouse_name:l,allocation_id:c,allocation_name:u})}}}},{field:"production_time",title:"生产日期",showOverflow:!0,width:80},{field:"real_num",title:"数量",showOverflow:!0,editRender:{autoselect:!0,name:"number",events:{input:function(t){t.row.is_price=1,e.handleEdit(t)},change:function(t){e.confirm(t)}}}},{field:"unit_price",title:"售价",showOverflow:!0,width:150,editRender:{autoselect:!0,name:"Vinput",getSlots:function(i){if(e.addDisabled)return e.dialogArryrow=i,t("el-link",{on:{click:function(){e.getHistryPrice(i)}}},["历史价"])},events:{input:function(t){t.row.is_price=1,e.handleEdit(t)},change:function(t){e.confirm(t)}}}},{field:"sales_price",title:"商品金额",showOverflow:!0,editRender:{autoselect:!0,name:"Vinput",events:{input:function(t){t.row.is_price=1,e.handleEdit(t)},change:function(t,i){t.row,t.$rowIndex,t.column;e.confirm(t)}}}},{field:"discount_unit_price",title:"优惠单价",showOverflow:!0,editRender:{autoselect:!0,name:"vNumber",events:{input:function(t){e.handleEdit(t)}}}},{field:"discount_price",title:"优惠金额",showOverflow:!0,editRender:{autoselect:!0,name:"vNumber",events:{input:function(t){e.handleEdit(t)}}}},{field:"total_price",showOverflow:!0,title:"小计金额"},{title:"门店优惠金额",field:"shop_discount_price",headerAlign:"right",align:"right",width:100},{title:"原价金额",field:"original_price",headerAlign:"right",align:"right",width:100},{field:"revenue_price",showOverflow:!0,title:"税额",editRender:{autoselect:!0,name:"Vinput",formatter:"Positive",events:{input:function(t){e.handleEdit(t)}}}},{field:"no_revenue_price",showOverflow:!0,title:"不含税金额"},{field:"warehouse_name",title:"仓库",showOverflow:!0,width:120},{field:"allocation_name",title:"货位",showOverflow:!0,sortable:!0,width:120},{field:"unit_name",title:"单位",showOverflow:!0,width:110},{field:"policy_name",title:"促销政策",showOverflow:!0,width:150},{title:"工厂代码",field:"factory_code",showOverflow:!0,width:120},{title:"速记码",field:"shorthand_code",showOverflow:!0,width:120},{field:"remark",title:"备注",width:150,showOverflow:!0,editRender:{name:"Vinput",formatter:"String"}}],tableData:[]}},methods:{activeMethod:function(e){var t=e.column,i=e.row,a=!0;if(this.addDisabled){if("goods_name"===t.property&&10003===i.business_type_id&&(a=_(i,this)),"batch"===t.property&&(i.goods_id||(this.$message.warning("请先选择商品"),a=!1)),"sales_price"!==t.property&&"unit_price"!==t.property||10007===i.business_type_id&&i.policy_id&&(this.$message.warning("特价不允许修改售价和商品金额"),a=!1),"discount_unit_price"!==t.property&&"discount_price"!==t.property||10001!==i.business_type_id&&i.policy_id&&(this.$message.warning("当前满足促销政策不可修改"),a=!1),"discount_price"!==t.property&&"discount_unit_price"!==t.property&&"sales_price"!==t.property&&"unit_price"!==t.property||(10001===i.business_type_id&&(i.goods_name||(this.$message.warning("请先选择商品"),a=!1)),10002!==i.business_type_id&&10003!==i.business_type_id||(this.$message.warning("赠品不可修改"),a=!1)),"real_num"===t.property){if(!i.goods_name)return this.$message.warning("请先选择商品"),!1;a=_(i,this)}if("business_type_id"===t.property){if(this.salesorderAddGet&&this.salesorderAddGet.order_id)return this.$message.warning("修改不可编辑"),!1;if(i.policy_id)return this.$message.warning("当前满足促销政策不可修改"),!1;a=_(i,this)}return a}if("real_num"===t.property||"batch"===t.property||"revenue_price"===t.property){if(!i.goods_name)return this.$message.warning("请先选择商品"),!1;if("real_num"===t.property&&this.electricityOrderStatus&&"sourcing_order"!=this.ec_type&&"liancai_order"!=this.ec_type)return this.$message.warning("电商订单不允许部分出库！"),!1}else this.$message.warning("引用订单只能修改数量，批次和税额"),a=!1;return a},footerMethod:function(e){var t=this,i=e.columns,a=e.data;return[i.map((function(e,i){if(1===i)return"合计";if(["total_price","discount_price","real_num"].includes(e.property)){"total_price"==e.property&&(t.totalPrice=t.$utils.sum(a,e.property),t.countSettlementPrice());var s=t.$utils.sum(a,e.property);return Number.isInteger(s)?s:s.toFixed(2)}return null}))]}}};t["a"]=r},"52c5":function(module,__webpack_exports__,__webpack_require__){"use strict";var D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("1da1"),D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("5530"),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("96cf"),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("a15b"),core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("e9c4"),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("d3b7"),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("159b"),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("a434"),core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("99af"),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("4de4"),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_number_constructor_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("a9e3"),core_js_modules_es_number_constructor_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_number_constructor_js__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es_number_to_fixed_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("b680"),core_js_modules_es_number_to_fixed_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es_number_to_fixed_js__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("caad"),core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("d81d"),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("2532"),core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("ac1f"),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("5319"),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_16__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("b0c0"),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_17__),common_components_public_getAreaList__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("d12c"),_sourceBill_vue__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("262d6"),_salesoutModify_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("4eeb"),vuex__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("2f62"),common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("65b0"),_components_element_sales_config_historicalPrices_vue__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("2181");__webpack_exports__["a"]={mixins:[_salesoutModify_js__WEBPACK_IMPORTED_MODULE_20__["a"]],data:function(){return{tool_Config:{id:"JYBDXSCK",zoom:!0,setting:{storage:!0,immediate:!0}},indexchart:{},historylist:{},currentScope:null,rowgoodsid:"",timeValueks:[new Date,new Date],dialogTableBatch:!1,referenceDisabled:!1,styleArry:[],dialogChooseProducts:!1,stategoods:!1,saveNumBatchObj:{},loading:!1,loading_demo:!1,addChandise2:!1,addDisabled:!1,dialogBillVisible:!1,autoGetBatch:!0,multipleSelection:[],dataTableIndex:null,dataTable:[],ec_type:"",electricityOrderStatus:"",datas:null,dialogTableVisible:!1,defaultArea:[0],totalPrice:0,binding_sign:1,batchMultiple:[],sumprice:null,businessTypeList:[{business_type_name:"特价",business_type_id:10007},{business_type_name:"满折",business_type_id:10006},{business_type_name:"满减",business_type_id:10005},{business_type_name:"满赠",business_type_id:10004},{business_type_name:"赠品",business_type_id:10003},{business_type_name:"客户赠胎",business_type_id:10002},{business_type_name:"商品订购",business_type_id:10001}],hideClass:!0,index:null,TableData:[],defaultAreaName:"",customerNaN:null,username:localStorage.getItem("realname"),tkgoPage:1,loadSign:!0}},props:["sourceType"],components:{getAreaList:common_components_public_getAreaList__WEBPACK_IMPORTED_MODULE_18__["a"],sourceBill:_sourceBill_vue__WEBPACK_IMPORTED_MODULE_19__["a"],historicalPrices:_components_element_sales_config_historicalPrices_vue__WEBPACK_IMPORTED_MODULE_23__["a"]},methods:Object(D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__["a"])(Object(D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__["a"])({},Object(vuex__WEBPACK_IMPORTED_MODULE_21__["b"])(["accountloglist_showIndexACT"])),{},{formData:function(e){var t=new Date(e),i=""+(t.getMonth()+1),a=""+t.getDate(),s=t.getFullYear();return i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),[s,i,a].join("-")},getHistryPrice:function(e){this.currentScope=e,this.dialogTableVisible=!0},handleCurrentChange:function(e){this.currentScope.row.unit_price=e.unit_price,this.currentScope.row.is_price=1,this.confirm(this.currentScope),this.handleEdit(this.currentScope)},confirm:function(e){var t=this;if(1!==this.params.is_erp&&!this.order_id){var i=e.row;e.$rowIndex;if(10003!==i.business_type_id&&10002!==i.business_type_id&&this.params.customer_id&&i.goods_id&&this.params.business_time){this.flag=!0;var a={customer_id:this.params.customer_id,company_id:this.params.company_id,business_time:this.params.business_time,goods_info:[{is_price:i.is_price,binding_sign:i.binding_sign,business_type_id:i.business_type_id,goods_id:i.goods_id,goods_num:i.real_num,goods_name:i.goods_name,sales_price:i.unit_price?i.unit_price:0,goods_price:i.sales_price}]};a.goods_info=JSON.stringify(a.goods_info),this.$axios({method:"post",url:this.$api.getPromotionPolicyListCx,data:a}).then((function(a){if(t.flag=!1,200==a.data.code){var s=[];if(a.data.data.forEach((function(e){s.push({binding_sign:e.binding_sign,discount_price:e.discount_price,discount_unit_price:e.discount_unit_price,business_type_id:e.business_type_id,sales_price:e.goods_price,unit_price:e.sales_price,total_price:e.subtotal_price,policy_id:e.policy_id,real_num:e.goods_num,policy_name:e.policy_name,goods_name:e.goods_name,goods_id:e.goods_id,unit_name:e.unit_name})})),t.clearGift([i]),0!=s.length){var _=["binding_sign","discount_price","discount_unit_price","business_type_id","total_price","sales_price","unit_price","policy_id","policy_name"];if(_.forEach((function(e){i[e]=s[0][e]})),t.handleEdit(e),s.length>=2){var r=s.splice(1,s.length);t.copyRow(i,r)}}}})).catch((function(){t.flag=!1}))}}},copyRow:function(e,t){var i=this.$refs.xTable.$getRowIndex(e),a=this.$refs.xTable.getTableData().fullData.concat([]);delete e._XID,i<a.length-1?this.$refs.xTable.insertAt(t||e,a[i+1]):this.$refs.xTable.insertAt(t||e,-1),this.$refs.xTable.updateFooter()},clearGift:function(e){var t=e.concat([]),i=this.$refs.xTable.getTableData().fullData;t.forEach((function(e){void 0!==e.binding_sign&&10003!==e.business_type_id&&(i=i.filter((function(t){return e.binding_sign!==t.binding_sign||10003!==t.business_type_id})))})),this.$refs.xTable.loadData(i)},batchListInitalList:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=["batch","batch_id","warehouse_id","warehouse_name","allocation_id","allocation_name","production_time","sale_price","available_stocks"];return s.forEach((function(s){if("available_stocks"==s){var _=t.saveNumBatchObj[e["batch_id"]],r=e[s];_&&(r=_),i[s]=r}else a.indexOf(s)<0&&(i[s]=e[s])})),i},chooseProducts_confirm:function(e){var t=this;e.forEach((function(e,i){e.real_num=e.goods_num,e.business_type_id=10001,t.handleEdit({row:e,column:{property:"real_num"}});var a=t.batchListInitalList(e);t.$set(e,"batchList",[a])})),this.dialogChooseProducts=!1;var i=0;e.length>=10&&(this.loading_demo=!0,i=200);var a=[];this.TableData.forEach((function(e){e.goods_name&&a.push(e)})),setTimeout((function(){t.$set(t,"TableData",a.concat(e)),setTimeout((function(){t.loading_demo=!1}))}),i)},goodsdialog:function(e){this.addChandise2=!0},toFixedTwo:function(e){var t=Number(e),i=isNaN(t);return i||(e=parseFloat(e).toFixed(2)),e},rideCount:function(e,t){return this.toFixedTwo(e*t)},divCount:function(e,t){return this.toFixedTwo(e/t)},goSelectShop:function(){this.params.customer_id?this.dialogChooseProducts=!0:this.$message.warning("请先选择客户！")},opens:function(){this.stategoods=!0},tableRowClassName:function(e){var t=e.row;e.rowIndex;return t.notAdd?"warning-row":""},renderHeaderpro:function(){var e=this.$createElement;return e("el-tooltip",{class:"item",attrs:{content:"Bottom center",effect:"light"}},[e("p",{slot:"content"},["生产日期列后期将会隐藏，同时新增商品入库日期列"]),e("span",{class:"el-icon-question",style:"cursor:pointer;font-weight:bold;"},["生产日期"])])},goBack:function(){1===this.sourceType?this.$router.push({path:"/sales/salesout"}):this.$router.push({path:"/inventory/salesoutstorage"})},focusprice:function(e){var t=this,i=e.index,a=void 0===i?e.$rowIndex:i,s=e.row,_=void 0===s?e.row:s;if(!_.goods_id)return this.dataTable=[],!1;this.$axMethod.getHistoryOrder({goods_id:_.goods_id,customer_id:this.params.customer_id}).then((function(e){t.dataTable=e.data.data,t.dialogTableVisible=!0,t.dataTableIndex=a}))},datableMeth:function(e){var t=this.dialogArryrow.row;this.$set(t,"unit_price",Number(e.unit_price)),this.handleEdit({row:t,column:{property:"unit_price"}}),this.dialogTableVisible=!1},getSummaries:function(e){var t=this;this.datas=e;var i=e.columns,a=e.data,s=[];return i.forEach((function(e,i){if(1!==i){if(["total_price","discount_price"].includes(e.property)){var _=a.map((function(t){return Number(t[e.property]||0)}));s[i]=_.reduce((function(e,t){Number(t);return Number(e+t)}),0),"total_price"==e.property&&(t.totalPrice=Number(s[i]),t.countSettlementPrice()),s[i]=s[i].toFixed(2)}if("real_num"===e.property){var r=a.map((function(t){return Number(t[e.property])}));s[i]=r.reduce((function(e,t){var i=Number(t)||0;return Number(e+i)}),0)}}else s[i]="合计"})),s},orderAdd:function(e){var t=e.row,i=e.$rowIndex,a=["order_goods_id","unit_credit_price","unit_rebate_price","unit_deposits_price","remark"];this.index=i;var s=t.real_num;if(t.batch_id){this.batchMultiple.unshift(t);var _={};this.batchMultiple=this.batchMultiple.reduce((function(e,t){return!_[t.batch_id]&&(_[t.batch_id]=e.push(t)),e}),[])}this.batchMultiple.map((function(e,i){return s>=e.available_stocks?(e.real_num=e.available_stocks,e.business_type_name=t.business_type_name,e.business_type_id=t.business_type_id,s-=e.available_stocks,e.unit_price=t.unit_price,e.sales_price=Number(e.real_num*e.unit_price).toFixed(2),e.discount_unit_price=t.discount_unit_price,e.discount_price=Number(e.discount_unit_price*e.real_num).toFixed(2),e.total_price=e.sales_price-e.discount_price,e.warehouse_id=e.warehouse_id,e.allocation_id=e.allocation_id,e.allocation_name=e.allocation_name,a.forEach((function(i,a){e[i]=t[i]}))):s?(e.real_num=s,s=0,e.unit_price=t.unit_price,e.business_type_name=t.business_type_name,e.business_type_id=t.business_type_id,e.sales_price=Number(e.real_num*e.unit_price).toFixed(2),e.discount_unit_price=t.discount_unit_price,e.discount_price=Number(e.discount_unit_price*e.real_num).toFixed(2),e.total_price=e.sales_price-e.discount_price,e.warehouse_id=e.warehouse_id,e.allocation_id=e.allocation_id,e.allocation_name=e.allocation_name,a.forEach((function(i,a){e[i]=t[i]}))):(e.real_num=0,e.unit_price=t.unit_price,e.business_type_name=t.business_type_name,e.business_type_id=t.business_type_id,e.sales_price=Number(e.real_num*e.unit_price).toFixed(2),e.discount_unit_price=t.discount_unit_price,e.discount_price=Number(e.discount_unit_price*e.real_num).toFixed(2),e.total_price=e.sales_price-e.discount_price,e.warehouse_id=e.warehouse_id,e.allocation_id=e.allocation_id,e.allocation_name=e.allocation_name,a.forEach((function(i,a){e[i]=t[i]}))),e}));var r=this.$refs.xTable;r.insertAt(this.batchMultiple,t),r.remove(t),this.dialogTableBatch=!1},handleSelectionChangelist:function(e){0!=e.length&&(this.batchMultiple=e)},closeDialog:function(e){this.dialogBillVisible=!1},departmentF:function(e){e&&(this.params.department_name=this.departmentList.filter((function(t){return t.department_id==e}))[0].department_name)},changeDefaultArea:function(e){this.params.cityList=e.join(","),this.params.province_id=e[0],this.params.city_id=e[1],this.params.area_id=e[2]},paymentMethodChange:function(e){var t=this;2===this.params.payment_method?setTimeout((function(){t.$refs.TableDataRef.validateField(["settlement_customer_id"])}),50):this.$refs.TableDataRef.clearValidate("settlement_customer_id")},settlementCustomerChange:function(e){this.params.settlement_customer_name=e?this.logisticsList.filter((function(t){return t.logistics_id==e}))[0].logistics_name:""},logisticsChanges:function(e){this.params.logistics_name=e?this.logisticsList.filter((function(t){return t.logistics_id==e}))[0].logistics_name:""},warehousechange:function(e){e&&(this.params.warehouse_name=this.warehouseList.filter((function(t){return t.warehouse_id==e}))[0].warehouse_name)},referenceOrder:function(){this.dialogBillVisible=!0},dialogformInline:function(e,t){var i=this,a=e.goods_info,s=e.ec_type,_=e.is_erp;this.sumprice=t,this.ec_type=s,this.electricityOrderStatus=_,a.forEach((function(e){e.realNums=e.real_num,e.sales_price=e.real_num*e.unit_price,e.total_price=e.subtotal_price,e.batch_id&&i.batchList.push({batch:e.batch,batch_id:e.batch_id,warehouse_name:e.warehouse_name,warehouse_id:e.warehouse_id||"",allocation_name:e.allocation_name,available_stocks:e.available_stocks,stocks:e.stocks})})),this.defaultArea=[e.province_id,e.city_id,e.area_id],this.$set(this,"TableData",a),this.dialogBillVisible=!1,this.$refs.xTable.updateFooter()},renderHeader:function(e,t){var i=t.column;t.$index;return e("span",{class:"start",style:"cursor:pointer"},[i.label])},addRow:function(){var e=this.$refs.xTable;e.createRow({binding_sign:this.binding_sign++,discount_unit_price:"",outstock_goods_id:0,sales_price:"",discount_price:"",unit_price:"",real_num:"",remark:"",business_type_id:10001}).then((function(t){e.insertAt(t,-1)}))},rowClassName:function(e){var t=e.$rowIndex;e.column,e.columnIndex,e.$columnIndex;if(this.styleArry.includes(t+1+"")||this.styleArry.includes(t+1))return{backgroundColor:"#fdecea",color:"#5F5F5F"}},countSettlementPrice:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=["rebate_price","credit_price","deposits_price"];i.forEach((function(i){var a=e.params[i];a<0?a=a.replace(/[^0-9.]/,""):void 0==a&&(a="0.00"),a||2!=t||(a="0.00"),2==t&&(a=Number(a).toFixed(2)),e.$set(e.params,i,a)}));var a=Number(this.totalPrice)-Number(this.params.rebate_price)-Number(this.params.credit_price)-Number(this.params.deposits_price);this.$set(this.params,"settlement_price",a.toFixed(2))},handleEdit:function(e){var t=e.row,i=e.column;if("goods_name"!==i.property){var a=this,s={num:"real_num",price:"unit_price",goodsPrice:"sales_price",discount_unitPrice:"discount_unit_price",discount_price:"discount_price",totalPrice:"total_price",taxrate:"taxrate",revenue_price:"revenue_price",no_revenue_price:"no_revenue_price",BuoyancyFactor:"BuoyancyFactor"},_=!0;this.order_id&&(_=!1),this.$publicFution.computeTotal(t,s,i.property,this,{callback:function(){var e=a.$refs.xTable;e.reloadRow(t),e.updateFooter()},minus:!0,major:_})}},deleteRow:function(){var e=this.$refs.xTable;e.removeSelecteds(),e.getTableData().fullData.length||(this.order_id?this.referenceDisabled=!0:this.addDisabled=!0),e.updateFooter(),this.styleArry=[]},batchChange:function(e,t){var i=e.production_time,a=e.batch_id,s=e.batch,_=e.stocks,r=e.available_stocks,o=e.warehouse_id,n=e.warehouse_name,l=e.allocation_id,c=e.allocation_name;Object.assign(e,{production_time:i,batch_id:a,batch:s,stocks:_,available_stocks:r,warehouse_id:o,warehouse_name:n,allocation_id:l,allocation_name:c})},seeMoneyDetail:function(){this.$router.push({path:"/custom/accountloglist"}),this.accountloglist_showIndexACT({params:this.params,goPage:this.goPage,pageSize:this.pageSize})},changeGoods:function(e,t){var i=this,a=t.row;Object.assign(a,e,{discount_unit_price:"",sales_price:"",discount_price:"",unit_price:"",real_num:"",total_price:"",remark:"",business_type_id:10001}),this.autoGetBatch?(e.batch=null,e.batch_id=null,e.warehouse_name=null,e.allocation_name=null,Object.assign(a,e),this.batchInvok(a,"",2,(function(e){if(200===e.code){var t=e.data[0],s={batch:t.batch||"",batch_id:t.batch_id||"",warehouse_id:t.warehouse_id||"",warehouse_name:t.warehouse_name||"",allocation_name:t.allocation_name||"",allocation_id:t.allocation_id||""};i.batchList.push(s),Object.assign(a,s)}}))):(this.$set(a,"unit_name",e.unit_name),this.$set(a,"goods_id",e.goods_id),this.$set(a,"batch",null),this.$set(a,"unit_price",e.unit_price?e.unit_price:0)),[10002,10003].includes(a.business_type_id)&&(this.$set(a,"sales_price",0),this.$set(a,"total_price",0),this.$set(a,"discount_unit_price",0)),this.confirm(t);var s=!0,_=this.$refs.xTable;_.getTableData().fullData.forEach((function(e){e.goods_id||(s=!1)})),s&&this.addRow()},submitInfo:function(e){var t=this,i=this,a=["serial_number","binding_sign","batch_id","goods_id","allocation_id","goods_name","goods_sn","warehouse_id","warehouse_name","batch","production_time","real_num","order_goods_id","sales_price","total_price","outstock_goods_id","unit_price","cost_price","discount_unit_price","discount_price","business_type_id","business_type_name","unit_credit_price","unit_rebate_price","unit_deposits_price","policy_name","policy_id","factory_code","remark","allocation_id_str","taxrate","revenue_price","no_revenue_price","invoice_info"],s=this.$refs.xTable.getTableData().fullData.concat([]).filter((function(e){return!!e.goods_id}));if(console.log(s.length),!s.length)return this.$message.warning("请先选择商品！"),!1;var _=[];s.forEach((function(e,i){_.push({}),a.forEach((function(a){if("allocation_id_str"==a){var s={};s[e.allocation_id]=e.real_num,t.$set(_[i],a,s)}else"serial_number"==a?t.$set(_[i],a,i+1):"real_num"==a||"outstock_goods_id"==a?t.$set(_[i],a,e[a]?e[a]:0):t.$set(_[i],a,e[a]?e[a]:"")}))})),this.params.goods_info=JSON.stringify(_);var r=Object.assign({},{type:this.referenceDisabled?0:1,order_type:0},this.params),o={company_id:this.params.company_id,goods_info:this.params.goods_info,operation:1,bill_type:2,is_info:0},n={foo:function(){return Object(D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",i.$axMethod.v2setBillCostControl(o).then((function(t){var a=t.data.data;if(200==t.data.code){if(!(a.length>0))throw i.clickEnd(e,r),new Error("出错了");if(0==a[0].bill_setting_status){var s="";a.forEach((function(e,t){s+=t+1+"."+e.name+"<br>"})),i.$confirm(' <div class="colorblue">'.concat(s,"</div> <br>以上商品售价低于成本价，是否继续提交？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,showClose:!1,type:"warning",distinguishCancelAndClose:!1}).then((function(){i.clickEnd(e,r)})).catch((function(){}))}else i.$message({message:"商品售价低于成本价，保存失败！",type:"warning"}),a.forEach((function(e){i.styleArry.push(Number(e.serial_number))}))}})).catch((function(e){console.log(e)})));case 1:case"end":return t.stop()}}),t)})))()}};n.foo().catch((function(){t.clickEnd(e,r)}))},clickEnd:function(e,t){var i=this,a=this,s=JSON.parse(t.goods_info).map((function(e){return{warehouse_id:e.warehouse_id,warehouse_name:e.warehouse_name,allocation_id:e.allocation_id,goods_id:e.goods_id,order_goods_id:e.order_goods_id||0,sale_price:e.unit_price||0,batch:e.batch,batch_id:e.batch_id,goods_num:e.real_num}}));this.$baseData.checkCarDoctor({company_id:this.params.company_id,company_name:this.params.company_name,bill_type:9,bill_id:this.outstock_id,operation_type:2,goods_info:JSON.stringify(s)}).then((function(){i.$baseData.checkComputation(JSON.parse(t.goods_info),{goods_num:"real_num",total_price:"total_price",goods_price:"unit_price",discounted_price:"discount_unit_price"}).then((function(){i.$axMethod.safetyStockCheck({bill_sn:i.params.outstock_sn,bill_id:i.outstock_id,company_id:i.params.company_id,company_name:i.params.company_name,business_time:i.params.business_time,bill_logogram:"xsck",order_type:1,goods_info:JSON.stringify(s)}).then((function(s){Object(common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_22__["m"])(i,{company_id:i.params.company_id,goods_info:i.params.goods_info,status:1,type:1},(function(){a.$axMethod.salesOutstockEditOut(t).then((function(t){var i=t.data;"200"==i.code?(a.$message({message:i.data,type:"success"}),e?(a.$router.push({path:"/sales/salesout/salesoutAdd"}),a.initialize(),a.$refs.xTable.remove(),a.$refs.xTable.updateFooter(),a.referenceDisabled=!1,a.addDisabled=!0):a.goBack()):a.styleArry=i.data}))}))}))}))}))},preSubmit:function(e,t){var i=this;this.$refs.xTable.clearActived();var a=this.$refs.xTable.getTableData().fullData.concat([]),s="n";void 0!=this.params.warehouse_id&&a.some((function(e){e.warehouse_id&&e.warehouse_id!=i.params.warehouse_id&&(s="y")})),"y"==s?this.$confirm("表头仓库和表体商品仓库不一致，是否清空表头仓库","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",distinguishCancelAndClose:!0}).then((function(){i.params.warehouse_id="",i.submit(e,t)})).catch((function(a){"cancel"==a&&i.submit(e,t)})):this.submit(e,t)},submit:function(e,t){var i=this,a=this.$refs.xTable.getTableData().fullData.concat([]);this.$refs[e].validate((function(e){if(e){var s=!0;a.length||(i.$message.error("请先选择订单"),s=!1);for(var _=0;_<a.length;_++)if(!a[_].batch_id&&a[_].goods_id)return i.$message.error("请完善批次信息"),void(s=!1);if(!s)return!1;if(i.addDisabled){var r=a.reduce((function(e,t){return Number(e.real_num)+Number(t.real_num)}));if(r<i.sumprice)var o="y";if(r!=i.sumprice&&i.electricityOrderStatus&&"sourcing_order"!=i.ec_type&&"liancai_order"!=i.ec_type)return i.$message.error("电商订单不允许部分出库"),!1;"y"==o&&1==i.params.is_erp?i.$confirm("商城订单只允许一次出库，请谨慎操作！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.submitInfo(t)})).catch((function(){i.$message({type:"info",message:"已取消新增出库单"})})):i.submitInfo(t)}else i.submitInfo(t)}}))},initialize:function(){this.$set(this,"params",{business_time:this.$publicFution.formatData(new Date),company_id:Number(localStorage.company_id),company_name:localStorage.company_name,payment_method:1}),Object(common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_22__["l"])(this,window.localStorage)},dealLogistics:function(e){if(e.settlement_customer_id){var t={logistics_id:e.settlement_customer_id,logistics_name:e.settlement_customer_name};this.logisticsList.push(t)}if(e.settlement_customer_id&&e.settlement_customer_id!=e.settlement_customer_id){var i={logistics_id:e.settlement_customer_id,logistics_name:e.settlement_customer_name};this.logisticsList.push(i)}}}),mounted:function mounted(){var _this15=this;if(this.order_id=this.$route.query&&this.$route.query.order_id,this.outstock_id=this.$route.query&&this.$route.query.id,this.authority=JSON.parse(localStorage.getItem("authority")),this.order_id?(this.referenceDisabled=!0,this.$axios({method:"get",url:this.$api.getNormalOutstockInfoPublics,params:{outstock_id:this.outstock_id}}).then((function(e){var t=e.data,i=t.data,a=i.goods_info,s=i.ec_type,_=i.is_erp;_this15.ec_type=s,_this15.electricityOrderStatus=_;var r=0;a=a.map((function(e){return e.is_price=1,e.binding_sign>r&&(r=e.binding_sign),e})),_this15.binding_sign=r+1,_this15.defaultAreaName="".concat(t.data.province_name,"/").concat(t.data.city_name,"/").concat(t.data.area_name),_this15.$set(_this15,"TableData",a),delete t.data.goods_info,_this15.params=t.data,Object.assign(t.data,{employee_id:t.data.business_id,employee_name:t.data.business_name}),Object(common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_22__["l"])(_this15,t.data),_this15.params.settlement_customer_name||(_this15.params.settlement_customer_id=null),_this15.logisticsList=[{logistics_name:_this15.params.settlement_customer_name,logistics_id:_this15.params.settlement_customer_id}],_this15.dealLogistics(t.data)}))):(this.addDisabled=!0,this.$axios({method:"get",url:this.$api.getNormalOutstockInfoPublics,params:{outstock_id:this.outstock_id}}).then((function(e){var t=e.data,i=t.data.goods_info;_this15.electricityOrderStatus=t.data.is_erp;var a=0;i=i.map((function(e){return e.is_price=1,e.binding_sign>a&&(a=e.binding_sign),e})),_this15.binding_sign=a+1,i.forEach((function(e){e.sales_price=e.sales_price})),_this15.defaultAreaName="".concat(t.data.province_name,"/").concat(t.data.city_name,"/").concat(t.data.area_name),_this15.defaultArea=[t.data.province_id,t.data.city_id,t.data.area_id],_this15.params.cityList=_this15.defaultArea.join(","),_this15.params.province_id=_this15.defaultArea[0],_this15.params.city_id=_this15.defaultArea[1],_this15.params.area_id=_this15.defaultArea[2],_this15.$set(_this15,"TableData",i),delete t.data.goods_info,_this15.params=t.data,_this15.params.settlement_customer_name||(_this15.params.settlement_customer_id=null),Object.assign(t.data,{employee_id:t.data.business_id,employee_name:t.data.business_name}),Object(common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_22__["l"])(_this15,t.data),_this15.params.settlement_customer_name||(_this15.params.settlement_customer_id=null),_this15.logisticsList=[{logistics_name:_this15.params.settlement_customer_name,logistics_id:_this15.params.settlement_customer_id}],_this15.dealLogistics(t.data)})).then((function(){_this15.$axMethod.getCustomerInfoNEWqx({customer_id:_this15.params.customer_id,company_id:_this15.params.company_id}).then((function(e){var t=e.data;if(200==t.code){_this15.$set(_this15.params,"balance",t.data.balance);var i=[{topName:"rebate_balance",bottomName:"rebate_price"},{topName:"credit_balance",bottomName:"credit_price"},{topName:"deposits",bottomName:"deposits_price"}];i.forEach((function(e){var i=e.topName,a=e.bottomName;_this15.$set(_this15.params,i,(Number(t.data[i])+Number(_this15.params[a])).toFixed(2))}))}}))}))),localStorage.Documents_operation){var state=localStorage.getItem("Documents_operation");this.autoGetBatch=1==eval(state)[0].status}}}},"9d5f":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("common",{attrs:{sourceType:2}})},s=[],_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",[e._v(e._s(1===e.sourceType?"销售管理":"库存管理"))]),i("el-breadcrumb-item",{staticClass:"attrbute"},[i("span",{on:{click:e.goBack}},[e._v("销售出库")])]),i("el-breadcrumb-item",[e._v("修改销售出库")])],1),i("el-form",{ref:"TableDataRef",attrs:{inline:!0,model:e.params}},[i("el-form-item",{attrs:{label:"销售组织",size:"mini",prop:"company_id",rules:e.rules.company_id}},[i("el-select",{attrs:{placeholder:"请选择",disabled:"",filterable:""},on:{focus:e.companyListInvok},model:{value:e.params.company_id,callback:function(t){e.$set(e.params,"company_id",t)},expression:"params.company_id"}},e._l(e.companyList,(function(t){return i("el-option",{key:t.company_id,attrs:{label:t.company_name,value:t.company_id}},[i("span",{class:1==t.type?"optionStyle":""},[e._v(e._s(t.company_name))])])})),1)],1),i("el-form-item",{attrs:{label:"单据号",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.outstock_sn,callback:function(t){e.$set(e.params,"outstock_sn",t)},expression:"params.outstock_sn"}})],1),i("el-form-item",{attrs:{label:"业务日期",size:"mini",prop:"business_time",rules:e.rules.business_time}},[i("el-date-picker",{attrs:{type:"date",disabled:e.referenceDisabled,"value-format":"yyyy-MM-dd"},model:{value:e.params.business_time,callback:function(t){e.$set(e.params,"business_time",t)},expression:"params.business_time"}})],1),i("el-form-item",{attrs:{label:"客户名称",size:"mini",prop:"customer_id",rules:e.rules.customer_id}},[i("el-select",{ref:"customerId",attrs:{filterable:"",placeholder:"请先选择客户",clearable:"",disabled:"",loading:e.loading,remote:"","remote-method":e.clienteleListInvok},on:{focus:e.clienteleListInvok},model:{value:e.params.customer_id,callback:function(t){e.$set(e.params,"customer_id",t)},expression:"params.customer_id"}},[i("ul",{staticClass:"customer customer-ul4 customer-ul2"},[i("li",[e._v("客户编号")]),i("li",[e._v("客户名称")]),i("li",[e._v("联系人")]),i("li",[e._v("联系电话")]),i("li",[e._v("区域")])]),e._l(e.customerList,(function(t){return i("el-option",{key:t.customer_id,attrs:{label:t.customer_name,value:t.customer_id}},[i("ul",{staticClass:"customer customer-ul4"},[i("li",{attrs:{title:t.customer_id}},[e._v(e._s(t.customer_id))]),i("li",{attrs:{title:t.customer_name}},[e._v(e._s(t.customer_name))]),i("li",{attrs:{title:t.contact_name}},[e._v(e._s(t.contact_name))]),i("li",{attrs:{title:t.customer_mobile}},[e._v(e._s(t.customer_mobile))]),i("li",[e._v(e._s(t.province_name)+"/"+e._s(t.city_name)+"/"+e._s(t.area_name))])])])}))],2)],1),i("el-form-item",{attrs:{label:"部门",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.department_id&&(e.params.department_id=null)}())+" "),i("el-select",{attrs:{clearable:"",disabled:1==e.electricityOrderStatus,placeholder:"请选择",filterable:""},on:{change:e.departmentF,focus:e.DepartmentListInvok},model:{value:e.params.department_id,callback:function(t){e.$set(e.params,"department_id",t)},expression:"params.department_id"}},e._l(e.departmentList,(function(e){return i("el-option",{key:e.department_id,attrs:{label:e.department_name,value:e.department_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"业务员",size:"mini"}},[i("erpEmployee",{attrs:{fatherParams:e.params,modelLabel:"business_name",disabled:e.referenceDisabled,searchParams:{company_id:e.params.company_id}},model:{value:e.params.business_id,callback:function(t){e.$set(e.params,"business_id",t)},expression:"params.business_id"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"收货人",size:"mini"}},[i("el-input",{attrs:{maxlength:"7",disabled:e.referenceDisabled},model:{value:e.params.consignee_name,callback:function(t){e.$set(e.params,"consignee_name",t)},expression:"params.consignee_name"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"电话",size:"mini"}},[i("el-input",{attrs:{disabled:e.referenceDisabled},model:{value:e.params.consignee_mobile,callback:function(t){e.$set(e.params,"consignee_mobile",t)},expression:"params.consignee_mobile"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],staticClass:"wauto",staticStyle:{"min-width":"312px"},attrs:{label:"所属区域",size:"mini"}},[e.defaultArea&&e.addDisabled?i("getAreaList",{attrs:{defaultArea:e.defaultArea},on:{changeDefaultArea:e.changeDefaultArea}}):i("el-input",{attrs:{disabled:""},model:{value:e.defaultAreaName,callback:function(t){e.defaultAreaName=t},expression:"defaultAreaName"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"详细地址",size:"mini"}},[i("el-input",{attrs:{disabled:e.referenceDisabled},model:{value:e.params.address,callback:function(t){e.$set(e.params,"address",t)},expression:"params.address"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],staticStyle:{cursor:"pointer"},attrs:{label:"关联单据号",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.order_sn,callback:function(t){e.$set(e.params,"order_sn",t)},expression:"params.order_sn"}})],1),i("el-form-item",{attrs:{label:"回款方式",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.payment_method&&(e.params.payment_method=null)}())+" "),i("el-select",{attrs:{disabled:e.referenceDisabled},on:{change:e.paymentMethodChange},model:{value:e.params.payment_method,callback:function(t){e.$set(e.params,"payment_method",t)},expression:"params.payment_method"}},[i("el-option",{attrs:{label:"客户自结",value:1}},[e._v("客户自结")]),i("el-option",{attrs:{label:"物流代收",value:2}},[e._v("物流代收")]),i("el-option",{attrs:{label:"电商结算",value:3}},[e._v("电商结算")])],1)],1),2===e.params.payment_method?i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"物流公司",size:"mini",prop:"settlement_customer_id",rules:e.rules.settlement_customer_id}},[i("el-select",{attrs:{clearable:"",filterable:"","filter-method":e.logisticsInvok},on:{focus:e.logisticsInvok,change:e.logisticsChanges},model:{value:e.params.settlement_customer_id,callback:function(t){e.$set(e.params,"settlement_customer_id",t)},expression:"params.settlement_customer_id"}},e._l(e.logisticsList,(function(e){return i("el-option",{key:e.logistics_id,attrs:{label:e.logistics_name,value:e.logistics_id}})})),1)],1):i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"物流公司",size:"mini",prop:"settlement_customer_id"}},[i("el-select",{attrs:{clearable:"",filterable:"","filter-method":e.logisticsInvok},on:{focus:e.logisticsInvok,change:e.logisticsChanges},model:{value:e.params.settlement_customer_id,callback:function(t){e.$set(e.params,"settlement_customer_id",t)},expression:"params.settlement_customer_id"}},e._l(e.logisticsList,(function(e){return i("el-option",{key:e.logistics_id,attrs:{label:e.logistics_name,value:e.logistics_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"送货需求",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.delivery_demand_id&&(e.params.delivery_demand_id=null)}())+" "),i("el-select",{attrs:{clearable:"",disabled:e.referenceDisabled},on:{focus:e.getDeliveryDemandListInvok},model:{value:e.params.delivery_demand_id,callback:function(t){e.$set(e.params,"delivery_demand_id",t)},expression:"params.delivery_demand_id"}},e._l(e.deliveryDemandList,(function(e){return i("el-option",{key:e.delivery_demand_id,attrs:{label:e.delivery_demand_name,value:e.delivery_demand_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"交货方式",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.hand_over_id&&(e.params.hand_over_id=null)}())+" "),i("el-select",{attrs:{clearable:"",disabled:e.referenceDisabled},on:{focus:e.getHandoverListInvok},model:{value:e.params.hand_over_id,callback:function(t){e.$set(e.params,"hand_over_id",t)},expression:"params.hand_over_id"}},e._l(e.handoverList,(function(e){return i("el-option",{key:e.hand_over_id,attrs:{label:e.hand_over_name,value:e.hand_over_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"出库类型",size:"mini"}},[e._v(" "+e._s(function(){e.params.outstock_type_id=10002}())+" "),i("el-input",{attrs:{value:"销售出库",disabled:""}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"仓库名称",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.warehouse_id&&(e.params.warehouse_id=null)}())+" "),i("el-select",{attrs:{clearable:""},on:{focus:e.warehouseInvok,change:e.warehousechange},model:{value:e.params.warehouse_id,callback:function(t){e.$set(e.params,"warehouse_id",t)},expression:"params.warehouse_id"}},e._l(e.warehouseList,(function(e){return i("el-option",{key:e.warehouse_id,attrs:{label:e.warehouse_name,value:e.warehouse_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"打印次数",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.print_times,callback:function(t){e.$set(e.params,"print_times",t)},expression:"params.print_times"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"单据状态:",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.auditor_status_name,callback:function(t){e.$set(e.params,"auditor_status_name",t)},expression:"params.auditor_status_name"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"摘要",size:"mini"}},[i("el-input",{attrs:{type:"text",maxlength:"300",placeholder:"摘要最多300个字"},model:{value:e.params.abstract,callback:function(t){e.$set(e.params,"abstract",t)},expression:"params.abstract"}})],1),i("p",{staticStyle:{"text-align":"center","font-size":"14px",cursor:"pointer",color:"#409eff"},on:{click:function(t){e.hideClass=!e.hideClass}}},[i("i",{class:e.hideClass?"el-icon-caret-top":"el-icon-caret-bottom"}),i("span",[e._v(e._s(e.hideClass?"收缩":"展开"))])])],1),i("div",{staticClass:"add_delet"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.referenceDisabled,expression:"referenceDisabled"}],staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:e.referenceOrder}},[e._v("参照订单")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.addDisabled,expression:"addDisabled"}],staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini",title:"选择客户"},on:{click:e.addRow}},[e._v("增行")]),i("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.deleteRow}},[e._v("删行")])],1),i("div",{staticClass:"table_container"},[i("vxe-grid",{ref:"xTable",attrs:{border:"","show-overflow":"tooltip","show-footer":"true",toolbar:e.tool_Config,"sort-config":{trigger:"cell"},"row-style":e.rowClassName,size:"mini","footer-method":e.footerMethod,"max-height":"500px",data:e.TableData,resizable:"",height:"500px","column-min-width":"100","mouse-config":{selected:!0},columns:e.tableColumn,"keyboard-config":{isArrow:!0,isDel:!1,isTab:!0,isEdit:!0},"edit-config":{trigger:"click",mode:"cell",autoClear:!1,activeMethod:e.activeMethod}}})],1),i("br"),e.addDisabled?i("div",[i("el-form",{ref:"TableDataRef2",staticClass:"db priceFoot",attrs:{model:e.params,inline:!0}},[i("el-form-item",{attrs:{label:"本单使用返利："}},[i("el-input",{staticClass:"element_input",attrs:{type:"number"},on:{blur:function(t){return e.countSettlementPrice(2)}},nativeOn:{keyup:function(t){return function(t){return e.countSettlementPrice(1)}.apply(null,arguments)}},model:{value:e.params.rebate_price,callback:function(t){e.$set(e.params,"rebate_price",t)},expression:"params.rebate_price"}}),i("span",{staticClass:"yeban"},[e._v("余额:"+e._s(e._f("priceFormat")(e.params.rebate_balance?e.params.rebate_balance:0)))])],1),i("el-form-item",{attrs:{label:"本单使用授信："}},[i("el-input",{staticClass:"element_input",attrs:{type:"number"},on:{blur:function(t){return e.countSettlementPrice(2)}},nativeOn:{keyup:function(t){return function(t){return e.countSettlementPrice(1)}.apply(null,arguments)}},model:{value:e.params.credit_price,callback:function(t){e.$set(e.params,"credit_price",t)},expression:"params.credit_price"}}),i("span",{staticClass:"yeban"},[e._v("余额:"+e._s(e._f("priceFormat")(e.params.credit_balance?e.params.credit_balance:0)))])],1),i("el-form-item",{attrs:{label:"本单使用预收："}},[i("el-input",{staticClass:"element_input",attrs:{type:"number"},on:{blur:function(t){return e.countSettlementPrice(2)}},nativeOn:{keyup:function(t){return function(t){return e.countSettlementPrice(1)}.apply(null,arguments)}},model:{value:e.params.deposits_price,callback:function(t){e.$set(e.params,"deposits_price",t)},expression:"params.deposits_price"}}),i("span",{staticClass:"yeban"},[e._v("余额:"+e._s(e._f("priceFormat")(e.params.deposits?e.params.deposits:0)))])],1),i("el-form-item",{attrs:{label:"客户余额："}},[i("el-input",{staticClass:"element_input",attrs:{disabled:"",size:"mini"},model:{value:e.params.balance,callback:function(t){e.$set(e.params,"balance",t)},expression:"params.balance"}}),i("el-button",{attrs:{type:"primary"},on:{click:e.seeMoneyDetail}},[e._v("查看往来")])],1),i("el-form-item",{attrs:{label:"本单结算金额：",size:"mini"}},[i("el-input",{staticClass:"element_input",attrs:{disabled:"",type:"number"},model:{value:e.params.settlement_price,callback:function(t){e.$set(e.params,"settlement_price",t)},expression:"params.settlement_price"}})],1)],1)],1):e._e(),i("div",[i("span",{staticStyle:{"font-size":"14px"}},[e._v("开票信息：")]),i("el-input",{staticStyle:{width:"50%","vertical-align":"text-top"},attrs:{type:"textarea",placeholder:"请输入开票金额"},model:{value:e.params.invoice_info,callback:function(t){e.$set(e.params,"invoice_info",t)},expression:"params.invoice_info"}})],1),i("div",{staticClass:"refundauditFoot"},[i("span",[e._v("制单人："+e._s(e.params.add_user_name?e.params.add_user_name:e.username))]),i("span",[e._v("单据时间："+e._s(e.params.add_time))]),i("span",[e._v("审核人："+e._s(e.params.auditor_name))]),i("span",[e._v("审核时间："+e._s(e.params.auditor_time))]),i("span",[e._v("修改人："+e._s(e.params.update_user_name))]),i("span",[e._v("修改时间："+e._s(e.params.update_time))])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.goBack}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.preSubmit("TableDataRef",!1)}}},[e._v("保 存")]),1==e.authority.b_add?i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.preSubmit("TableDataRef",!0)}}},[e._v("保存并新增")]):e._e()],1),i("el-dialog",{attrs:{title:"多批次",visible:e.dialogTableBatch,width:"40%"},on:{"update:visible":function(t){e.dialogTableBatch=t}}},[i("el-table",{attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:e.batchList,"max-height":"300"},on:{"selection-change":e.handleSelectionChangelist}},[i("el-table-column",{attrs:{"show-overflow-tooltip":!0,type:"selection",fixed:"left",align:"center",width:"44"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"batch",width:"100",label:"年周/批次",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"warehouse_name",label:"仓库名称",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"allocation_name",label:"货位名称",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"production_time",label:"生产日期",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"stocks",label:"在库库存",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"available_stocks",label:"批次可用库存",align:"right"}})],1),i("div",{staticStyle:{"text-align":"center",padding:"10px"}},[i("el-button",{staticStyle:{width:"100px"},attrs:{size:"small",type:"primary"},on:{click:function(t){return e.orderAdd(e.dialogArryrow)}}},[e._v("确定")])],1)],1),e.dialogChooseProducts?i("goodsPopout",{attrs:{searchParams:{company_id:e.params.company_id,warehouse_id:e.params.warehouse_id,customer_id:e.params.customer_id,warehouse_name:e.params.warehouse_name}},on:{close:function(t){e.dialogChooseProducts=!1},submit:e.chooseProducts_confirm}}):e._e(),e.dialogBillVisible?i("div",[i("el-dialog",{staticClass:"dialogForm",attrs:{"close-on-click-modal":!1,title:"选择订单",visible:e.dialogBillVisible,width:"1300px"},on:{"update:visible":function(t){e.dialogBillVisible=t}}},[i("source-bill",{attrs:{pardata:e.params},on:{dialogformInline:e.dialogformInline,closedialog:e.closeDialog}})],1)],1):e._e(),e.dialogTableVisible?i("historicalPrices",{attrs:{searchParams:{company_id:e.params.company_id,goods_id:e.currentScope.row&&e.currentScope.row.goods_id},company_id:e.params.company_id},on:{sumbitData:e.handleCurrentChange},model:{value:e.dialogTableVisible,callback:function(t){e.dialogTableVisible=t},expression:"dialogTableVisible"}}):e._e()],1)},r=[],o=i("52c5"),n=o["a"],l=(i("2995"),i("2877")),c=Object(l["a"])(n,_,r,!1,null,"d3d284c6",null),u=c.exports,d={name:"inventorySalesoutModify",data:function(){return{}},components:{common:u}},m=d,p=Object(l["a"])(m,a,s,!1,null,null,null);t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-f60e017c.b6ccd41f.js.map