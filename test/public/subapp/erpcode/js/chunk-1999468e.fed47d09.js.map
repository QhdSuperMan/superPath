{"version":3,"sources":["webpack://erpcode-[name]/./src/components/placeholder/paycenter.vue?f254","webpack://erpcode-[name]/src/components/placeholder/paycenter.vue","webpack://erpcode-[name]/./src/components/placeholder/paycenter.vue?0047","webpack://erpcode-[name]/./src/components/placeholder/paycenter.vue","webpack://erpcode-[name]/./src/components/placeholder/paycenter.vue?d2a0"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","attrs","origin","staticRenderFns","name","data","queryParams","cashier_token","pay_trade_no","token","device_type","app_type","reset_pwd_url","urls","order_detail_title","order_detail_url","created","watch","handler","newVal","init","mounted","getOrigin","activated","deactivated","window","removeEventListener","receiveMsg","methods","closeTab","$EventBus","$emit","$router","callback","e","pay_status","beforeDestroy","component"],"mappings":"yIAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,SAAS,CAACG,IAAI,YAAYC,MAAM,CAAC,GAAK,YAAY,IAAOR,EAAIS,OAAS,UAAW,YAAc,IAAI,MAAQ,OAAO,OAAS,aAC9PC,EAAkB,G,wBCMtB,G,UAAA,4CACA,GACEC,KAAM,YACNC,KAFF,WAGI,MAAO,CACLH,OAAQ,GACRI,YAAa,CACXC,cAAe,GACfC,aAAc,GACdC,MAAO,GACPC,YAAa,KACbC,SAAU,MACVC,cAAeC,EAAO,wCACtBC,mBAAoB,OACpBC,iBAAkBF,EAAO,oBAI/BG,QAjBF,WAkBItB,KAAKY,YAAc,OAAvB,OAAuB,CAAvB,yDAEEW,MAAO,CAEL,6BAA8B,CAC5BC,QADN,SACA,GACQC,GAAUzB,KAAK0B,UAIrBC,QA5BF,WA6BI3B,KAAK4B,YACL5B,KAAK0B,MAAK,IAEZG,UAhCF,WAiCI7B,KAAK0B,QAEPI,YAnCF,WAoCIC,OAAOC,oBAAoB,UAAWhC,KAAKiC,aAE7CC,QAAS,CACP,KADJ,WACA,8KACA,cADA,OAEA,+BACA,gFAGA,kCAEA,oCACA,uCAEA,mDAXA,8CAeIN,UAhBJ,WAkBA,sCACA,gCAEQ5B,KAAKQ,OAAS,8BAEdR,KAAKQ,OAAS,0BAKlB2B,SA5BJ,SA4BA,GACMnC,KAAKoC,UAAUC,MAAM,WAAYrC,KAAKsC,QAASC,IAIjDN,WAjCJ,SAiCA,cAEUO,EAAEhC,SAAWR,KAAKQ,QAAWgC,EAAE7B,MAEV,QAArB6B,EAAE7B,KAAK8B,YAETzC,KAAKmC,UAAS,WACZ,EAAV,4CAKEO,cAnFF,WAoFIX,OAAOC,oBAAoB,UAAWhC,KAAKiC,cC5FmT,I,wBCQ9VU,EAAY,eACd,EACA7C,EACAW,GACA,EACA,KACA,KACA,MAIa,aAAAkC,E,oECnBf","file":"js/chunk-1999468e.fed47d09.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"paycenter\"},[_c('iframe',{ref:\"paycenter\",attrs:{\"id\":\"paycenter\",\"src\":(_vm.origin + \"/pc/pay\"),\"frameborder\":\"0\",\"width\":\"100%\",\"height\":\"100%\"}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"paycenter\">\n    <iframe ref=\"paycenter\" id=\"paycenter\" :src=\"`${origin}/pc/pay`\" frameborder=\"0\" width=\"100%\" height=\"100%\"></iframe>\n  </div>\n</template>\n\n<script>\nconst urls = location.protocol + \"//\" + location.host + \"/#/\";\nexport default {\n  name: \"paycenter\",\n  data() {\n    return {\n      origin: \"\",\n      queryParams: {\n        cashier_token: \"\", // 收银台支付token\n        pay_trade_no: \"\", // 支付单号\n        token: \"\", // 用户token\n        device_type: \"pc\", // 固定值 (设备终端类型：app/pc/h5/small_routine)\n        app_type: \"erp\", // 应用场景:weixin/mdbs/ddt/sjb/hcb/ymm/erp\n        reset_pwd_url: urls + \"system/service_station_myself_account\", // 充值密码地址\n        order_detail_title: \"采购订单\", // 订单详情页面标题\n        order_detail_url: urls + \"purchase/order\", // 订单详情页面地址\n      },\n    };\n  },\n  created() {\n    this.queryParams = { ...this.queryParams, ...this.$route.params };\n  },\n  watch: {\n    // 监听到支付单号变更后重新向收银台推送数据\n    \"$route.params.pay_trade_no\": {\n      handler(newVal) {\n        newVal && this.init();\n      },\n    },\n  },\n  mounted() {\n    this.getOrigin();\n    this.init(true);\n  },\n  activated() {\n    this.init();\n  },\n  deactivated() {\n    window.removeEventListener(\"message\", this.receiveMsg);\n  },\n  methods: {\n    async init() {\n      await this.$nextTick();\n      if (this.$route.params.pay_trade_no) {\n        this.queryParams = { ...this.queryParams, ...this.$route.params };\n      }\n\n      const iframeWin = this.$refs.paycenter.contentWindow;\n\n      this.$refs.paycenter.onload = () => {\n        iframeWin.postMessage(this.queryParams, this.origin);\n      };\n      window.addEventListener(\"message\", this.receiveMsg, false);\n    },\n\n    // 获取收银台域名\n    getOrigin() {\n      if (\n        location.protocol + \"//\" + location.host ==\n        \"https://test-www.taijierp.com\"\n      ) {\n        this.origin = \"https://test-paywap.jybd.cn\";\n      } else {\n        this.origin = \"https://paywap.jybd.cn\";\n      }\n    },\n\n    // 关闭当前tab\n    closeTab(callback) {\n      this.$EventBus.$emit(\"closeTab\", this.$router, callback);\n    },\n\n    // 接收到收银台消息回复\n    receiveMsg(e) {\n      // 收银台域名\n      if (e.origin !== this.origin || !e.data) return;\n\n      if (e.data.pay_status == \"succ\") {\n        // 支付成功后, 跳转到采购订单\n        this.closeTab(() => {\n          this.$router.push({ path: \"/purchase/order\" });\n        });\n      }\n    },\n  },\n  beforeDestroy() {\n    window.removeEventListener(\"message\", this.receiveMsg);\n  },\n};\n</script>\n\n<style>\n.paycenter {\n  width: 100%;\n  height: calc(100vh - 92px);\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./paycenter.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./paycenter.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./paycenter.vue?vue&type=template&id=0eaac335&\"\nimport script from \"./paycenter.vue?vue&type=script&lang=js&\"\nexport * from \"./paycenter.vue?vue&type=script&lang=js&\"\nimport style0 from \"./paycenter.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./paycenter.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}