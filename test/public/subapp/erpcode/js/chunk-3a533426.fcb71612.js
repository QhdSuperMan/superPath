(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-3a533426"],{"2e54":function(module,__webpack_exports__,__webpack_require__){"use strict";var D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("1da1"),D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("5530"),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("96cf"),regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("e9c4"),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("d3b7"),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("159b"),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("a434"),core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_array_splice_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("99af"),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("4de4"),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("d81d"),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_number_to_fixed_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("b680"),core_js_modules_es_number_to_fixed_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_number_to_fixed_js__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es_number_constructor_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("a9e3"),core_js_modules_es_number_constructor_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es_number_constructor_js__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("a15b"),core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("caad"),core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("2532"),core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("ac1f"),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("5319"),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_16__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("b0c0"),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_17__),common_components_public_getAreaList__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("d12c"),_sourceBill_vue__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("262d6"),vuex__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("2f62"),common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("65b0"),_salesoutAdd_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("e6f0"),_components_element_sales_config_historicalPrices_vue__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("2181");__webpack_exports__["a"]={mixins:[_salesoutAdd_js__WEBPACK_IMPORTED_MODULE_22__["a"]],data:function(){return{tool_Config:{id:"JYBDXSCK",zoom:!0,setting:{storage:!0,immediate:!0}},dialogChooseProducts:!1,rowgoodsid:"",currentScope:{},timeValueks:[new Date,new Date],onces:1,stategoods:!1,flag:!1,indexchart:{},saveNumBatchObj:{},loading_demo:!1,dialogTableBatch:!1,onlyQuote:!1,addChandise2:!1,referenceDisabled:!1,dialogBillVisible:!1,addDisabled:!0,autoGetBatch:!1,username:localStorage.getItem("realname"),dialogTableVisible:!1,datas:null,loading:!1,styleArry:[],electricityOrderStatus:0,ec_type:"",dataTableIndex:null,defaultArea:[0],totalPrice:0,binding_sign:1,batchMultiple:[],sumprice:null,dataTable:[],businessTypeList:[],hideClass:!0,index:null,TableData:[],loadSign:!0,tkgoPage:1}},props:["sourceType"],components:{getAreaList:common_components_public_getAreaList__WEBPACK_IMPORTED_MODULE_18__["a"],sourceBill:_sourceBill_vue__WEBPACK_IMPORTED_MODULE_19__["a"],historicalPrices:_components_element_sales_config_historicalPrices_vue__WEBPACK_IMPORTED_MODULE_23__["a"]},computed:{businessIdRules:function(){var e=[];return 1!=this.sourceType||this.addDisabled||e.push({required:!0,message:"请选择业务员",trigger:"change"}),e}},methods:Object(D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__["a"])(Object(D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__["a"])({},Object(vuex__WEBPACK_IMPORTED_MODULE_20__["b"])(["accountloglist_showIndexACT"])),{},{getHistryPrice:function(e){this.currentScope=e,this.dialogTableVisible=!0},handleCurrentChange:function(e){this.currentScope.row.unit_price=e.unit_price,this.currentScope.row.is_price=1,this.confirm(this.currentScope),this.handleEdit(this.currentScope)},clearlist:function(){this.referenceDisabled=!1,this.$refs.xTable._proxy("remove"),this.$refs.xTable._proxy("updateFooter")},confirm:function(e){var t=this;if(1!==this.params.is_erp&&!this.addDisabled){var i=e.row;e.$rowIndex;if(10003!==i.business_type_id&&10002!==i.business_type_id&&this.params.customer_id&&i.goods_id&&this.params.business_time){this.flag=!0;var s={customer_id:this.params.customer_id,company_id:this.params.company_id,business_time:this.params.business_time,goods_info:[{is_price:i.is_price,binding_sign:i.binding_sign,business_type_id:i.business_type_id,goods_id:i.goods_id,goods_num:i.real_num,goods_name:i.goods_name,sales_price:i.unit_price?i.unit_price:0,goods_price:i.sales_price}]};s.goods_info=JSON.stringify(s.goods_info),this.$axios({method:"post",url:this.$api.getPromotionPolicyListCx,data:s}).then((function(s){if(t.flag=!1,200==s.data.code){var a=[];if(s.data.data.forEach((function(e){a.push({binding_sign:e.binding_sign,discount_price:e.discount_price,discount_unit_price:e.discount_unit_price,business_type_id:e.business_type_id,sales_price:e.goods_price,unit_price:e.sales_price,total_price:e.subtotal_price,policy_id:e.policy_id,real_num:e.goods_num,policy_name:e.policy_name,goods_name:e.goods_name,goods_id:e.goods_id,unit_name:e.unit_name})})),t.clearGift([i]),0!=a.length){var _=["binding_sign","discount_price","discount_unit_price","business_type_id","total_price","sales_price","unit_price","policy_id","policy_name"];if(_.forEach((function(e){i[e]=a[0][e]})),t.handleEdit(e),a.length>=2){var r=a.splice(1,a.length);t.copyRow(i,r)}}}})).catch((function(){t.flag=!1}))}}},copyRow:function(e,t){var i=this.$refs.xTable._proxy("$getRowIndex",e),s=this.$refs.xTable._proxy("getTableData").fullData.concat([]);delete e._XID,i<s.length-1?this.$refs.xTable._proxy("insertAt",t||e,s[i+1]):this.$refs.xTable._proxy("insertAt",t||e,-1),this.$refs.xTable._proxy("updateFooter")},clearGift:function(e){var t=e.concat([]),i=this.$refs.xTable._proxy("getTableData").fullData;t.forEach((function(e){void 0!==e.binding_sign&&10003!==e.business_type_id&&(i=i.filter((function(t){return e.binding_sign!==t.binding_sign||10003!==t.business_type_id})))})),this.$refs.xTable._proxy("loadData",i)},chooseProducts_confirm:function(e){var t=this;e=e.map((function(e){return e.real_num=e.goods_num,e.business_type_id=10001,t.handleEdit({row:e,column:{property:"real_num"}}),e})),this.$refs.xTable._proxy("insertAt",e,this.indexchart),this.dialogChooseProducts=!1,this.$refs.xTable._proxy("updateFooter")},confirmList:function(e){1!==this.params.is_erp&&(this.gitfDisabled=!0,this.confirmAction())},confirmAction:function(e){var t=this;if(this.gitfDisabled=!1,this.params.customer_id&&this.params.business_time){var i=this.$refs.xTable._proxy("getTableData").fullData.concat([]),s=[];if(i=i.filter((function(t){if(10003!==t.business_type_id&&t.goods_name){var i={is_price:e?0:t.is_price,policy_id:t.policy_id,binding_sign:t.binding_sign,business_type_id:t.business_type_id,goods_id:t.goods_id,goods_num:t.real_num,goods_name:t.goods_name,sales_price:t.unit_price?t.unit_price:0,goods_price:t.sales_price};return s.push(i),!0}})),0===s.length)return;var a={customer_id:this.params.customer_id,company_id:this.params.company_id,business_time:this.params.business_time,goods_info:JSON.stringify(s)};this.flag=!0,this.$axios({method:"post",url:this.$api.getPromotionPolicyListCx,data:a}).then((function(e){if(t.flag=!1,200==e.data.code){var s=e.data.data.map((function(e,s){for(var a=0;a<i.length;a++)if(i[a].binding_sign===e.binding_sign&&10003!==e.business_type_id){var _=["binding_sign","discount_price","discount_unit_price","business_type_id","subtotal_price","sales_price","goods_price","policy_id","policy_name"];return _.forEach((function(t){i[a][t]=e[t]})),t.handleEdit({row:i[a],column:{property:"goods_num"}}),i[a]}return e}));0!==s.length&&t.$refs.xTable._proxy("loadData",s);var a=t.$refs.xTable._proxy("getTableData").fullData.concat([]);(0===a.length||a[a.length-1].goods_num)&&t.addF(),t.$refs.xTable._proxy("updateFooter")}})).catch((function(){t.flag=!1}))}},goodsdialog:function(e){this.addChandise2=!0},goSelectShop:function(e){this.params.customer_id?(this.dialogChooseProducts=!0,this.indexchart=e.row):this.$message.warning("请先选择客户！")},opens:function(){this.stategoods=!0},goBack:function(){1===this.sourceType?this.$router.push({path:"/sales/salesout"}):this.$router.push({path:"/inventory/salesoutstorage"}),this.$publicFution.goPage(1)},companyChange:function companyChange(val){var _this4=this;val&&(this.params.company_name=this.companyList.filter((function(e){return e.company_id===val}))[0].company_name),this.params={company_name:this.params.company_name,company_id:val,business_time:this.$publicFution.formatData(new Date),payment_method:1},this.$refs.xTable._proxy("remove"),this.referenceDisabled=!1,this.addDisabled=!0,this.electricityOrderStatus=0,this.$baseData.settingInfo({num:2,company_id:val},(function(){if(localStorage.Documents_operation){var state=localStorage.getItem("Documents_operation");_this4.autoGetBatch=1==eval(state)[0].status}})),this.$baseData.settingInfo({num:3,company_id:val},(function(){if(localStorage.FDBName_business){var state=localStorage.getItem("FDBName_business");_this4.onlyQuote=1==eval(state)[1].status,_this4.addDisabled=1==eval(state)[1].status}}))},orderAdd:function(e){var t=e.row,i=e.$rowIndex,s=["order_goods_id","unit_credit_price","unit_rebate_price","unit_deposits_price","remark"];this.index=i;var a=t.real_num;if(t.batch_id){this.batchMultiple.unshift(t);var _={};this.batchMultiple=this.batchMultiple.reduce((function(e,t){return!_[t.batch_id]&&(_[t.batch_id]=e.push(t)),e}),[])}this.batchMultiple.map((function(e,i){return a>=e.available_stocks?(e.real_num=e.available_stocks,e.business_type_name=t.business_type_name,e.business_type_id=t.business_type_id,a-=e.available_stocks,e.unit_price=t.unit_price,e.sales_price=Number(e.real_num*e.unit_price).toFixed(2),e.discount_unit_price=t.discount_unit_price,e.discount_price=Number(e.discount_unit_price*e.real_num).toFixed(2),e.total_price=e.sales_price-e.discount_price,e.warehouse_id=e.warehouse_id,e.allocation_id=e.allocation_id,e.allocation_name=e.allocation_name,s.forEach((function(i,s){e[i]=t[i]}))):a?(e.real_num=a,a=0,e.unit_price=t.unit_price,e.business_type_name=t.business_type_name,e.business_type_id=t.business_type_id,e.sales_price=Number(e.real_num*e.unit_price).toFixed(2),e.discount_unit_price=t.discount_unit_price,e.discount_price=Number(e.discount_unit_price*e.real_num).toFixed(2),e.total_price=e.sales_price-e.discount_price,e.warehouse_id=e.warehouse_id,e.allocation_id=e.allocation_id,e.allocation_name=e.allocation_name,s.forEach((function(i,s){e[i]=t[i]}))):(e.real_num=0,e.unit_price=t.unit_price,e.business_type_name=t.business_type_name,e.business_type_id=t.business_type_id,e.sales_price=Number(e.real_num*e.unit_price).toFixed(2),e.discount_unit_price=t.discount_unit_price,e.discount_price=Number(e.discount_unit_price*e.real_num).toFixed(2),e.total_price=e.sales_price-e.discount_price,e.warehouse_id=e.warehouse_id,e.allocation_id=e.allocation_id,e.allocation_name=e.allocation_name,s.forEach((function(i,s){e[i]=t[i]}))),e}));var r=this.$refs.xTable;r._proxy("insertAt",this.batchMultiple,t),r._proxy("remove",t),this.dialogTableBatch=!1},handleSelectionChangelist:function(e){0!=e.length&&(this.batchMultiple=e)},closeDialog:function(e){this.dialogBillVisible=!1},getCustomerInfo:function(e){var t=this;e?(this.referenceDisabled=!1,this.$refs.xTable._proxy("remove"),this.$refs.xTable._proxy("updateFooter"),this.addDisabled=!1,e&&(this.params.customer_name=this.customerList.filter((function(t){return t.customer_id==e}))[0].customer_name),this.$axMethod.getCustomerInfoV2({company_id:this.params.company_id,customer_id:this.params.customer_id}).then((function(e){var i=e.data;if(200==i.code){delete i.data.company_id;var s=Object.assign({},t.params,i.data);t.params=s,t.defaultArea=[i.data.province_id,i.data.city_id,i.data.area_id],Object(common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_21__["l"])(t,i.data)}}))):(this.referenceDisabled=!1,this.addDisabled=!0)},departmentF:function(e){e&&(this.params.department_name=this.departmentList.filter((function(t){return t.department_id==e}))[0].department_name)},changeDefaultArea:function(e){this.params.cityList=e.join(","),this.params.province_id=e[0],this.params.city_id=e[1],this.params.area_id=e[2]},paymentMethodChange:function(e){var t=this;2===this.params.payment_method?(1!==this.params.is_erp||this.clearSettlement_customerId||(this.clearSettlement_customerId=!0,this.params.settlement_customer_id=""),setTimeout((function(){t.$refs.TableDataRef.validateField(["settlement_customer_id"])}),50)):this.$refs.TableDataRef.clearValidate("settlement_customer_id")},logisticsChanges:function(e){this.$refs.TableDataRef.validateField(["settlement_customer_id"]),this.clearSettlement_customerId=!0,this.params.logistics_name=this.logisticsList.filter((function(t){return t.logistics_id==e}))[0].logistics_name},warehousechange:function(e){e&&(this.params.warehouse_name=this.warehouseList.filter((function(t){return t.warehouse_id==e}))[0].warehouse_name)},referenceOrder:function(){this.dialogBillVisible=!0},dialogformInline:function(e,t){var i=this;this.clearSettlement_customerId=!1,this.$refs.xTable._proxy("remove"),this.dialogBillVisible=!1;var s=e.goods_info,a=e.is_erp,_=e.ec_type;this.electricityOrderStatus=a,this.ec_type=_,this.sumprice=t,s.forEach((function(e){e.realNums=e.real_num,e.sales_price=e.goods_price,e.total_price=e.subtotal_price,i.handleEdit({row:e,column:{property:"sales_price"}}),e.batch_id&&i.batchList.push({batch:e.batch,batch_id:e.batch_id,warehouse_id:e.warehouse_id||"",warehouse_name:e.warehouse_name,allocation_name:e.allocation_name,available_stocks:e.available_stocks,stocks:e.stocks})}));var r=this.$refs.xTable;r._proxy("insertAt",s,-1),Object.assign(e,{employee_id:e.business_id,employee_name:e.business_name},{settlement_customer_name:this.params.settlement_customer_name?this.params.settlement_customer_name:e.intentional_logistics,settlement_customer_id:this.params.settlement_customer_id?this.params.settlement_customer_id:e.intentional_logistics_id}),this.logisticsList.push({logistics_name:e.intentional_logistics,logistics_id:e.intentional_logistics_id}),delete e.goods_info,delete e.business_time,delete e.company_id,delete e.intentional_logistics,delete e.intentional_logistics_id,this.defaultArea=[e.province_id,e.city_id,e.area_id],this.params=Object.assign({},this.params,e),Object(common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_21__["l"])(this,e),this.addDisabled=!0,this.$refs.xTable._proxy("updateFooter"),this.params.settlement_customer_name||(this.params.settlement_customer_id=null)},open11:function(){this.$message({showClose:!0,message:"请确认业务日期，修改会清空表体数据",type:"warning",duration:5e3})},addRow:function(){var e=this.$refs.xTable;e._proxy("createRow",{binding_sign:this.binding_sign++,discount_unit_price:"",sales_price:"",discount_price:"",unit_price:"",real_num:"",remark:"",business_type_id:10001}).then((function(t){e._proxy("insertAt",t,-1)})),this.referenceDisabled=!0},rowClassName:function(e){var t=e.$rowIndex;if(this.styleArry.includes(t+1+"")||this.styleArry.includes(t+1))return{backgroundColor:"#fdecea",color:"#5F5F5F"}},countSettlementPrice:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=["rebate_price","credit_price","deposits_price"];i.forEach((function(i){var s=e.params[i];s<0?s=s.replace(/[^0-9.]/,""):void 0==s&&(s="0.00"),s||2!=t||(s="0.00"),2==t&&(s=Number(s).toFixed(2)),e.$set(e.params,i,s)}));var s=Number(this.totalPrice)-Number(this.params.rebate_price)-Number(this.params.credit_price)-Number(this.params.deposits_price);this.$set(this.params,"settlement_price",s.toFixed(2))},handleEdit:function(e){var t=e.row,i=e.column;if("goods_name"!==i.property){var s={num:"real_num",price:"unit_price",goodsPrice:"sales_price",discount_unitPrice:"discount_unit_price",discount_price:"discount_price",totalPrice:"total_price",taxrate:"taxrate",revenue_price:"revenue_price",no_revenue_price:"no_revenue_price",BuoyancyFactor:"BuoyancyFactor"},a=!0;0==this.referenceDisabled&&(a=!1);var _=this;this.$publicFution.computeTotal(t,s,i.property,this,{callback:function(){var e=_.$refs.xTable;e._proxy("reloadRow",t),e._proxy("updateFooter")},minus:!0,major:a})}},deleteRow:function(){var e=this.$refs.xTable;e._proxy("removeSelecteds"),e._proxy("getTableData").fullData.length||(this.referenceDisabled=!1,this.addDisabled=!1,this.$set(this.params,"order_sn",""),this.$set(this.params,"order_id",""),this.electricityOrderStatus=0),e._proxy("updateFooter"),this.styleArry=[]},batchChange:function(e,t){var i=e.production_time,s=e.batch_id,a=e.batch,_=e.stocks,r=e.available_stocks,o=e.warehouse_id,n=e.warehouse_name,l=e.allocation_id,c=e.allocation_name;Object.assign(e,{production_time:i,batch_id:s,batch:a,stocks:_,available_stocks:r,warehouse_id:o,warehouse_name:n,allocation_id:l,allocation_name:c})},seeMoneyDetail:function(){this.$router.push({path:"/custom/accountloglist"}),this.accountloglist_showIndexACT({params:this.params,goPage:this.goPage,pageSize:this.pageSize})},changeGoods:function(e,t){var i=this,s=t.row;Object.assign(s,e,{discount_unit_price:"",sales_price:"",discount_price:"",unit_price:"",real_num:"",total_price:"",remark:"",business_type_id:10001}),this.autoGetBatch?(e.batch=null,e.batch_id=null,e.warehouse_name=null,e.allocation_name=null,Object.assign(s,e),this.batchInvok(s,"",2,(function(e){if(200===e.code){var t=e.data[0],a={batch:t.batch||"",batch_id:t.batch_id||"",warehouse_id:t.warehouse_id||"",warehouse_name:t.warehouse_name||"",allocation_id:t.allocation_id||"",allocation_name:t.allocation_name||"",production_time:t.production_time||""};i.batchList.push(a),Object.assign(s,a)}}))):(this.$set(s,"unit_name",e.unit_name),this.$set(s,"goods_id",e.goods_id),this.$set(s,"batch",null),this.$set(s,"unit_price",e.unit_price?e.unit_price:0)),[10002,10003].includes(s.business_type_id)&&(this.$set(s,"sales_price",0),this.$set(s,"total_price",0),this.$set(s,"discount_unit_price",0)),this.confirm(t);var a=!0,_=this.$refs.xTable;_._proxy("getTableData").fullData.forEach((function(e){e.goods_id||(a=!1)})),a&&this.addRow()},submitInfo:function(e){var t=this,i=this,s=["serial_number","binding_sign","batch_id","goods_id","allocation_id","goods_name","goods_sn","warehouse_id","warehouse_name","batch","production_time","real_num","order_goods_id","sales_price","total_price","outstock_goods_id","unit_price","cost_price","discount_unit_price","discount_price","business_type_id","unit_credit_price","unit_rebate_price","unit_deposits_price","policy_name","policy_id","factory_code","remark","allocation_id_str","taxrate","revenue_price","no_revenue_price"],a=this.$refs.xTable._proxy("getTableData").fullData.concat([]).filter((function(e){return!!e.goods_id}));if(!a.length)return this.$message.warning("请先选择商品！"),!1;var _=[];a.forEach((function(e,i){_.push({}),s.forEach((function(s){if("allocation_id_str"==s){var a={};a[e.allocation_id]=e.real_num,t.$set(_[i],s,a)}else"serial_number"==s?t.$set(_[i],s,i+1):"real_num"==s?t.$set(_[i],s,e[s]?e[s]:0):t.$set(_[i],s,e[s]?e[s]:"")}))})),this.params.goods_info=JSON.stringify(_);var r=Object.assign({},{type:this.addDisabled?0:1,order_type:0},this.params),o={company_id:this.params.company_id,goods_info:this.params.goods_info,operation:1,bill_type:2,is_info:0},n={foo:function(){return Object(D_worker_project_MergeERP_erpcode_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",i.$axMethod.v2setBillCostControl(o).then((function(t){var s=t.data.data;if(200==t.data.code){if(!(s.length>0))throw i.clickEnd(e,r),new Error("出错了");if(0==s[0].bill_setting_status){var a="";s.forEach((function(e,t){a+=t+1+"."+e.name+"<br>"})),i.$confirm(' <div class="colorblue">'.concat(a,"</div> <br>以上商品售价低于成本价，是否继续提交？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,showClose:!1,type:"warning",distinguishCancelAndClose:!0}).then((function(){i.clickEnd(e,r)})).catch((function(){}))}else i.$message({message:"商品售价低于成本价，保存失败！",type:"warning"}),s.forEach((function(e){i.styleArry.push(Number(e.serial_number))}))}})).catch((function(e){console.log(e)})));case 1:case"end":return t.stop()}}),t)})))()}};n.foo().catch((function(){t.clickEnd(e,r)}))},clickEnd:function(e,t){var i=this,s=this,a=JSON.parse(t.goods_info).map((function(e){return{warehouse_id:e.warehouse_id,warehouse_name:e.warehouse_name,allocation_id:e.allocation_id,order_goods_id:e.order_goods_id||0,sale_price:e.unit_price||0,goods_id:e.goods_id,batch:e.batch,batch_id:e.batch_id,goods_num:e.real_num}}));this.$baseData.checkCarDoctor({company_id:this.params.company_id,company_name:this.params.company_name,bill_type:9,operation_type:1,goods_info:JSON.stringify(a)}).then((function(){i.$baseData.checkComputation(JSON.parse(t.goods_info),{goods_num:"real_num",total_price:"total_price",goods_price:"unit_price",discounted_price:"discount_unit_price"}).then((function(){i.$axMethod.safetyStockCheck({company_id:i.params.company_id,company_name:i.params.company_name,business_time:i.params.business_time,bill_logogram:"xsck",order_type:1,goods_info:JSON.stringify(a)}).then((function(a){Object(common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_21__["m"])(i,{company_id:i.params.company_id,goods_info:i.params.goods_info,status:1,type:1},(function(){s.$axMethod.salesOutstockAddOut(t).then((function(t){var i=t.data;"200"==i.code?(s.$message({message:i.data,type:"success"}),e?(s.initialize(),s.$refs.xTable._proxy("remove"),s.$refs.xTable._proxy("updateFooter"),s.referenceDisabled=!1,s.addDisabled=!0):s.goBack()):s.styleArry=i.data}))}))}))}))}))},preSubmit:function(e,t){var i=this;this.$refs.xTable._proxy("clearActived");var s=this.$refs.xTable._proxy("getTableData").fullData.concat([]),a="n";void 0!=this.params.warehouse_id&&s.some((function(e){e.warehouse_id&&e.warehouse_id!=i.params.warehouse_id&&(a="y")})),"y"==a?this.$confirm("表头仓库和表体商品仓库不一致，是否清空表头仓库","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning",distinguishCancelAndClose:!0}).then((function(){i.params.warehouse_id="",i.submit(e,t)})).catch((function(s){"cancel"==s&&i.submit(e,t)})):this.submit(e,t)},submit:function(e,t){var i=this,s=this.$refs.xTable._proxy("getTableData").fullData.concat([]);this.$refs[e].validate((function(e){if(e){var a=!0;s.length||(i.$message.error("请先选择订单"),a=!1);for(var _=0;_<s.length;_++)if(!s[_].batch_id&&s[_].goods_id)return i.$message.error("请完善批次信息"),void(a=!1);if(!a)return!1;if(i.addDisabled){var r=0;if(s.length>1?s.forEach((function(e){r+=e.real_num})):r=s[0].real_num,r!=i.sumprice&&i.electricityOrderStatus&&"sourcing_order"!=i.ec_type&&"liancai_order"!=i.ec_type)return i.$message.error("电商订单不允许部分出库"),!1;i.submitInfo(t)}else i.submitInfo(t)}}))},initialize:function(){this.$set(this,"params",{business_time:this.$publicFution.formatData(new Date),company_id:Number(localStorage.company_id),company_name:localStorage.company_name,payment_method:1}),Object(common_utils_public_function_commonUtils__WEBPACK_IMPORTED_MODULE_21__["l"])(this,window.localStorage)}}),mounted:function mounted(){var _this14=this;this.$baseData.settingInfo({num:3,company_id:Number(localStorage.company_id)},(function(){if(localStorage.FDBName_business){var state=localStorage.getItem("FDBName_business");console.log(eval(state)[1]),_this14.onlyQuote=1==eval(state)[1].status,_this14.addDisabled=1==eval(state)[1].status}})),this.$baseData.settingInfo({num:2,company_id:Number(localStorage.company_id)},(function(){if(localStorage.Documents_operation){var state=localStorage.getItem("Documents_operation");_this14.autoGetBatch=1==eval(state)[0].status}})),this.authority=JSON.parse(localStorage.getItem("authority")),this.initialize(),this.getBusinsstypeInvok({order_key:"business_type_id",order_by:1}),this.$refs.customerId.focus()}}},4555:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("common",{attrs:{sourceType:2}})},a=[],_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_demo,expression:"loading_demo"}],attrs:{"element-loading-text":"列表正在生成中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",[e._v(e._s(1===e.sourceType?"销售管理":"库存管理"))]),i("el-breadcrumb-item",{staticClass:"attrbute"},[i("span",{on:{click:e.goBack}},[e._v("销售出库")])]),i("el-breadcrumb-item",[e._v("新增销售出库")])],1),i("el-form",{ref:"TableDataRef",attrs:{inline:!0,model:e.params}},[i("el-form-item",{attrs:{label:"销售组织",size:"mini",prop:"company_id",rules:e.rules.company_id}},[i("el-select",{attrs:{placeholder:"请选择",filterable:""},on:{focus:e.companyListInvok,change:e.companyChange},model:{value:e.params.company_id,callback:function(t){e.$set(e.params,"company_id",t)},expression:"params.company_id"}},e._l(e.companyList,(function(t){return i("el-option",{key:t.company_id,attrs:{label:t.company_name,value:t.company_id}},[i("span",{class:1==t.type?"optionStyle":""},[e._v(e._s(t.company_name))])])})),1)],1),i("el-form-item",{attrs:{label:"单据号",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.outstock_sn,callback:function(t){e.$set(e.params,"outstock_sn",t)},expression:"params.outstock_sn"}})],1),i("el-form-item",{attrs:{label:"业务日期",size:"mini",prop:"business_time",rules:e.rules.business_time}},[i("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},on:{change:function(t){return e.confirmList()}},model:{value:e.params.business_time,callback:function(t){e.$set(e.params,"business_time",t)},expression:"params.business_time"}})],1),i("el-form-item",{attrs:{label:"客户名称",size:"mini",prop:"customer_id",rules:e.rules.customer_id}},[i("el-select",{ref:"customerId",attrs:{filterable:"",placeholder:"请先选择客户",loading:e.loading,remote:"","remote-method":e.clienteleListInvok},on:{change:e.getCustomerInfo,focus:e.clienteleListInvok},model:{value:e.params.customer_id,callback:function(t){e.$set(e.params,"customer_id",t)},expression:"params.customer_id"}},[i("ul",{staticClass:"customer customer-ul4 customer-ul2"},[i("li",[e._v("客户编号")]),i("li",[e._v("客户名称")]),i("li",[e._v("联系人")]),i("li",[e._v("联系电话")]),i("li",[e._v("区域")])]),e._l(e.customerList,(function(t){return i("el-option",{key:t.customer_id,attrs:{label:t.customer_name,value:t.customer_id}},[i("ul",{staticClass:"customer customer-ul4"},[i("li",{attrs:{title:t.customer_id}},[e._v(e._s(t.customer_id))]),i("li",{attrs:{title:t.customer_name}},[e._v(e._s(t.customer_name))]),i("li",{attrs:{title:t.contact_name}},[e._v(e._s(t.contact_name))]),i("li",{attrs:{title:t.customer_mobile}},[e._v(e._s(t.customer_mobile))]),i("li",[e._v(e._s(t.province_name)+"/"+e._s(t.city_name)+"/"+e._s(t.area_name))])])])}))],2)],1),i("el-form-item",{attrs:{label:"部门",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.department_id&&(e.params.department_id=null)}())+" "),i("el-select",{attrs:{clearable:"",disabled:1==e.electricityOrderStatus,placeholder:"请选择",filterable:""},on:{change:e.departmentF,focus:e.DepartmentListInvok},model:{value:e.params.department_id,callback:function(t){e.$set(e.params,"department_id",t)},expression:"params.department_id"}},e._l(e.departmentList,(function(e){return i("el-option",{key:e.department_id,attrs:{label:e.department_name,value:e.department_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"业务员",size:"mini",prop:"business_id",rules:e.businessIdRules}},[i("erpEmployee",{attrs:{fatherParams:e.params,modelLabel:"business_name",disabled:e.addDisabled,searchParams:{company_id:e.params.company_id}},model:{value:e.params.business_id,callback:function(t){e.$set(e.params,"business_id",t)},expression:"params.business_id"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"收货人",size:"mini"}},[i("el-input",{attrs:{maxlength:"7",disabled:e.addDisabled},model:{value:e.params.consignee_name,callback:function(t){e.$set(e.params,"consignee_name",t)},expression:"params.consignee_name"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"电话",size:"mini"}},[i("el-input",{attrs:{disabled:e.addDisabled},model:{value:e.params.consignee_mobile,callback:function(t){e.$set(e.params,"consignee_mobile",t)},expression:"params.consignee_mobile"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],staticClass:"wauto",staticStyle:{"min-width":"312px"},attrs:{label:"所属区域",size:"mini"}},[e.defaultArea&&e.defaultArea.length?i("getAreaList",{attrs:{disabled:e.addDisabled,defaultArea:e.defaultArea},on:{changeDefaultArea:e.changeDefaultArea}}):e._e()],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"详细地址",size:"mini"}},[i("el-input",{attrs:{disabled:e.addDisabled},model:{value:e.params.address,callback:function(t){e.$set(e.params,"address",t)},expression:"params.address"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],staticStyle:{cursor:"pointer"},attrs:{label:"关联单据号",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.order_sn,callback:function(t){e.$set(e.params,"order_sn",t)},expression:"params.order_sn"}})],1),i("el-form-item",{attrs:{label:"回款方式",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.payment_method&&(e.params.payment_method=null)}())+" "),i("el-select",{on:{change:e.paymentMethodChange},model:{value:e.params.payment_method,callback:function(t){e.$set(e.params,"payment_method",t)},expression:"params.payment_method"}},[i("el-option",{attrs:{label:"客户自结",value:1}},[e._v("客户自结")]),i("el-option",{attrs:{label:"物流代收",value:2}},[e._v("物流代收")]),i("el-option",{attrs:{label:"电商结算",value:3}},[e._v("电商结算")])],1)],1),2===e.params.payment_method?i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"物流公司",size:"mini",prop:"settlement_customer_id",rules:e.rules.settlement_customer_id}},[i("el-select",{attrs:{clearable:"",filterable:"","filter-method":e.logisticsInvok},on:{focus:e.logisticsInvok,change:e.logisticsChanges},model:{value:e.params.settlement_customer_id,callback:function(t){e.$set(e.params,"settlement_customer_id",t)},expression:"params.settlement_customer_id"}},e._l(e.logisticsList,(function(e){return i("el-option",{key:e.logistics_id,attrs:{label:e.logistics_name,value:e.logistics_id}})})),1)],1):i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"物流公司",size:"mini",prop:"settlement_customer_id"}},[i("el-select",{attrs:{clearable:"",filterable:"","filter-method":e.logisticsInvok},on:{focus:e.logisticsInvok,change:e.logisticsChanges},model:{value:e.params.settlement_customer_id,callback:function(t){e.$set(e.params,"settlement_customer_id",t)},expression:"params.settlement_customer_id"}},e._l(e.logisticsList,(function(e){return i("el-option",{key:e.logistics_id,attrs:{label:e.logistics_name,value:e.logistics_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"送货需求",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.delivery_demand_id&&(e.params.delivery_demand_id=null)}())+" "),i("el-select",{attrs:{clearable:"",disabled:e.addDisabled},on:{focus:e.getDeliveryDemandListInvok},model:{value:e.params.delivery_demand_id,callback:function(t){e.$set(e.params,"delivery_demand_id",t)},expression:"params.delivery_demand_id"}},e._l(e.deliveryDemandList,(function(e){return i("el-option",{key:e.delivery_demand_id,attrs:{label:e.delivery_demand_name,value:e.delivery_demand_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"交货方式",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.hand_over_id&&(e.params.hand_over_id=null)}())+" "),i("el-select",{attrs:{clearable:"",disabled:e.addDisabled},on:{focus:e.getHandoverListInvok},model:{value:e.params.hand_over_id,callback:function(t){e.$set(e.params,"hand_over_id",t)},expression:"params.hand_over_id"}},e._l(e.handoverList,(function(e){return i("el-option",{key:e.hand_over_id,attrs:{label:e.hand_over_name,value:e.hand_over_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"出库类型",size:"mini"}},[e._v(" "+e._s(function(){e.params.outstock_type_id=10002}())+" "),i("el-input",{attrs:{value:"销售出库",disabled:""}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"仓库名称",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.warehouse_id&&(e.params.warehouse_id=null)}())+" "),i("el-select",{attrs:{clearable:"",filterable:""},on:{focus:e.warehouseInvok,change:e.warehousechange},model:{value:e.params.warehouse_id,callback:function(t){e.$set(e.params,"warehouse_id",t)},expression:"params.warehouse_id"}},e._l(e.warehouseList,(function(e){return i("el-option",{key:e.warehouse_id,attrs:{label:e.warehouse_name,value:e.warehouse_id}})})),1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"打印次数",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.print_times,callback:function(t){e.$set(e.params,"print_times",t)},expression:"params.print_times"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"单据状态:",size:"mini"}},[i("el-input",{attrs:{disabled:""},model:{value:e.params.auditor_status_name,callback:function(t){e.$set(e.params,"auditor_status_name",t)},expression:"params.auditor_status_name"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.hideClass,expression:"hideClass"}],attrs:{label:"摘要",size:"mini"}},[i("el-input",{attrs:{type:"text",maxlength:"300",placeholder:"摘要最多300个字"},model:{value:e.params.abstract,callback:function(t){e.$set(e.params,"abstract",t)},expression:"params.abstract"}})],1),i("p",{staticStyle:{"text-align":"center","font-size":"14px",cursor:"pointer",color:"#409eff"},on:{click:function(t){e.hideClass=!e.hideClass}}},[i("i",{class:e.hideClass?"el-icon-caret-top":"el-icon-caret-bottom"}),i("span",[e._v(e._s(e.hideClass?"收缩":"展开"))])])],1),i("div",{staticClass:"add_delet"},[i("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",disabled:e.referenceDisabled,type:"primary",size:"mini"},on:{click:e.referenceOrder}},[e._v("参照订单")]),e.onlyQuote?e._e():i("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",disabled:e.addDisabled,type:"primary",size:"mini"},on:{click:e.addRow}},[e._v("增行")]),i("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.deleteRow}},[e._v("删行")])],1),i("div",{staticClass:"table_container"},[i("xTable",{ref:"xTable",attrs:{isEdit:!0,toolConfig:e.tool_Config,showFooter:!0,"row-style":e.rowClassName,footerMethod:e.footerMethod,xData:e.tableData,dragable:"","column-min-width":"100","mouse-config":{selected:!0},tableColumn:e.tableColumn,isShowTool:!0,editConfig:{trigger:"click",mode:"cell",autoClear:!1,activeMethod:e.activeMethod}}})],1),i("br"),e.addDisabled?e._e():i("div",[i("el-form",{ref:"TableDataRef2",staticClass:"db priceFoot",attrs:{model:e.params,inline:!0}},[i("el-form-item",{attrs:{label:"本单使用返利："}},[i("el-input",{staticClass:"element_input",attrs:{type:"number"},on:{blur:function(t){return e.countSettlementPrice(2)},input:function(t){return e.countSettlementPrice(1)}},model:{value:e.params.rebate_price,callback:function(t){e.$set(e.params,"rebate_price",t)},expression:"params.rebate_price"}}),i("span",{staticClass:"yeban"},[e._v("余额:"+e._s(e._f("priceFormat")(e.params.rebate_balance?e.params.rebate_balance:0)))])],1),i("el-form-item",{attrs:{label:"本单使用授信："}},[i("el-input",{staticClass:"element_input",attrs:{type:"number"},on:{blur:function(t){return e.countSettlementPrice(2)},input:function(t){return e.countSettlementPrice(1)}},model:{value:e.params.credit_price,callback:function(t){e.$set(e.params,"credit_price",t)},expression:"params.credit_price"}}),i("span",{staticClass:"yeban"},[e._v("余额:"+e._s(e._f("priceFormat")(e.params.credit_balance?e.params.credit_balance:0)))])],1),i("el-form-item",{attrs:{label:"本单使用预收："}},[i("el-input",{staticClass:"element_input",attrs:{type:"number"},on:{blur:function(t){return e.countSettlementPrice(2)},input:function(t){return e.countSettlementPrice(1)}},model:{value:e.params.deposits_price,callback:function(t){e.$set(e.params,"deposits_price",t)},expression:"params.deposits_price"}}),i("span",{staticClass:"yeban"},[e._v("余额:"+e._s(e._f("priceFormat")(e.params.deposits?e.params.deposits:0)))])],1),i("el-form-item",{attrs:{label:"客户余额："}},[i("el-input",{staticClass:"element_input",attrs:{disabled:"",size:"mini"},model:{value:e.params.balance,callback:function(t){e.$set(e.params,"balance",t)},expression:"params.balance"}}),i("el-button",{attrs:{type:"primary"},on:{click:e.seeMoneyDetail}},[e._v("查看往来")])],1),i("el-form-item",{attrs:{label:"本单结算金额：",size:"mini"}},[i("el-input",{staticClass:"element_input",attrs:{disabled:"",type:"number"},model:{value:e.params.settlement_price,callback:function(t){e.$set(e.params,"settlement_price",t)},expression:"params.settlement_price"}})],1)],1)],1),i("div",[i("span",{staticStyle:{"font-size":"14px"}},[e._v("开票信息：")]),i("el-input",{staticStyle:{width:"50%","vertical-align":"text-top"},attrs:{type:"textarea",placeholder:"请输入开票金额"},model:{value:e.params.invoice_info,callback:function(t){e.$set(e.params,"invoice_info",t)},expression:"params.invoice_info"}})],1),i("div",{staticClass:"refundauditFoot"},[i("span",[e._v("制单人："+e._s(e.username))]),i("span",[e._v("单据时间："+e._s(e.params.add_time))]),i("span",[e._v("审核人："+e._s(e.params.auditor_name))]),i("span",[e._v("审核时间："+e._s(e.params.auditor_time))]),i("span",[e._v("修改人："+e._s(e.params.update_user_name))]),i("span",[e._v("修改时间："+e._s(e.params.update_time))])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.goBack}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.preSubmit("TableDataRef",!1)}}},[e._v("保 存")]),1==e.authority.b_add?i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.preSubmit("TableDataRef",!0)}}},[e._v("保存并新增")]):e._e()],1),i("el-dialog",{attrs:{title:"多批次",visible:e.dialogTableBatch,width:"40%"},on:{"update:visible":function(t){e.dialogTableBatch=t}}},[i("el-table",{attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:e.batchList,"max-height":"300"},on:{"selection-change":e.handleSelectionChangelist}},[i("el-table-column",{attrs:{"show-overflow-tooltip":!0,type:"selection",fixed:"left",align:"center",width:"44"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"batch",width:"100",label:"年周/批次",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"warehouse_name",label:"仓库名称",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"allocation_name",label:"货位名称",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"production_time",label:"生产日期",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"stocks",label:"在库库存",align:"right"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"available_stocks",label:"批次可用库存",align:"right"}})],1),i("div",{staticStyle:{"text-align":"center",padding:"10px"}},[i("el-button",{staticStyle:{width:"100px"},attrs:{size:"small",type:"primary"},on:{click:function(t){return e.orderAdd(e.dialogArryrow)}}},[e._v("确定")])],1)],1),e.dialogChooseProducts?i("goodsPopout",{attrs:{searchParams:{company_id:e.params.company_id,warehouse_id:e.params.warehouse_id,customer_id:e.params.customer_id,warehouse_name:e.params.warehouse_name}},on:{close:function(t){e.dialogChooseProducts=!1},submit:e.chooseProducts_confirm}}):e._e(),e.dialogBillVisible?i("div",[i("el-dialog",{staticClass:"dialogForm",attrs:{"close-on-click-modal":!1,title:"选择订单",visible:e.dialogBillVisible,width:"1300px"},on:{"update:visible":function(t){e.dialogBillVisible=t}}},[i("source-bill",{attrs:{pardata:e.params},on:{dialogformInline:e.dialogformInline,closedialog:e.closeDialog}})],1)],1):e._e(),e.dialogTableVisible?i("historicalPrices",{attrs:{searchParams:{company_id:e.params.company_id,goods_id:e.currentScope.row&&e.currentScope.row.goods_id},company_id:e.params.company_id},on:{sumbitData:e.handleCurrentChange},model:{value:e.dialogTableVisible,callback:function(t){e.dialogTableVisible=t},expression:"dialogTableVisible"}}):e._e()],1)},r=[],o=i("2e54"),n=o["a"],l=(i("d274"),i("2877")),c=Object(l["a"])(n,_,r,!1,null,"4c1182d4",null),d=c.exports,u={name:"inventorySalesoutAdd",data:function(){return{}},components:{common:d}},m=u,p=Object(l["a"])(m,s,a,!1,null,null,null);t["default"]=p.exports},d274:function(e,t,i){"use strict";i("e436")},e436:function(e,t,i){},e6f0:function(e,t,i){"use strict";i("d81d"),i("caad"),i("8ba4"),i("a9e3"),i("b680");function s(e,t,i){if(e)for(var s=0;s<e.length;s++)if(t.business_type_id===e[s].business_type_id)return e[s].business_type_name+a(t,i)}function a(e,t){if(10003===e.business_type_id)for(var i=t.$refs.xTable._proxy("getTableData").fullData,s=0;s<i.length;s++)if(i[s].binding_sign===e.binding_sign&&10003!==i[s].business_type_id)return"(行"+(s+1)+")";return""}function _(e,t){for(var i=0,s=t.$refs.xTable._proxy("getTableData").fullData,a=0;a<s.length;a++)if(void 0!==e.binding_sign&&s[a].binding_sign===e.binding_sign&&i++,i>=2&&10003===e.business_type_id)return t.$message.warning("当前满足促销政策不可修改"),!1;return!0}var r={data:function(){var e=this,t=this.$createElement;return{dialogArryrow:null,tableColumn:[{type:"checkbox",width:40},{type:"index",title:"序号",width:50},{title:"业务类型",field:"business_type_id",width:110,showOverflow:!0,editRender:{type:"default",autofocus:".el-input__inner"},slots:{edit:function(t,i){var s=t.row,a=(t.rowIndex,i("el-select",{on:{change:function(i){s.business_type_id=i,e.changeBusinessType(t)}},model:{value:s.business_type_id,callback:function(t){e.$set(s,"business_type_id",t)}}},[e.businessTypeList.map((function(e){return i("el-option",{attrs:{label:e.business_type_name,value:e.business_type_id},key:e.business_type_id})}))]));return[a]},default:function(t,i){var a,_=t.row;t.rowIndex;return a=i("span",[s(e.businessTypeList,_,e)]),[a]}}},{field:"goods_id",title:"商品编号",width:80,showOverflow:!0},{field:"goods_name",title:"商品名称",width:300,showOverflow:!0,editRender:{name:"vGoods",getParams:function(t){var i=e;return{params:{company_id:e.params.company_id||0,customer_id:e.params.customer_id||0,warehouse_id:e.params.warehouse_id||0,bill_type:2,isTotal:1},showObj:{goods_id:"商品编号",goods_name:"商品名称",factory_code:"工厂代码",shorthand_code:"速记码",available_stocks:"可用库存",stocks:"在库库存"},getIcon:function(){return[{icon:"el-icon-plus",iconMethod:function(){i.goSelectShop(t)}}]}}},events:{change:this.changeGoods}}},{field:"batch",title:"年周/批次",showOverflow:!0,width:200,editRender:{autoselect:!0,name:"vBatch",getParams:function(t){var i=e;return{params:{company_id:e.params.company_id,warehouse_id:e.params.warehouse_id,goods_id:t.row.goods_id,bill_type:2},getOutIcon:function(){return i.addDisabled?[{icon:"icon-copy",iconMethod:function(){i.dialogArryrow=t,i.batchInvok(t.row,"",2),i.dialogTableBatch=!0}}]:[]}}},events:{change:function(e,t){var i=t.row;if(!i.goods_id)return!1;var s=e.production_time,a=e.batch_id,_=e.batch,r=e.stocks,o=e.available_stocks,n=e.warehouse_id,l=e.warehouse_name,c=e.allocation_id,d=e.allocation_name;Object.assign(i,{production_time:s,batch_id:a,batch:_,stocks:r,available_stocks:o,warehouse_id:n,warehouse_name:l,allocation_id:c,allocation_name:d})}}}},{field:"production_time",title:"生产日期",showOverflow:!0,width:80},{field:"real_num",title:"数量",showOverflow:!0,editRender:{autoselect:!0,name:"number",events:{input:function(t){t.row.is_price=1,e.handleEdit(t)},change:function(t,i){t.row,t.$rowIndex,t.column;e.confirm(t)}}}},{field:"unit_price",title:"售价",showOverflow:!0,width:150,editRender:{autoselect:!0,name:"Vinput",getSlots:function(i){if(!e.addDisabled)return e.dialogArryrow=i,t("el-link",{on:{click:function(){e.getHistryPrice(i)}}},["历史价"])},events:{input:function(t){t.row.is_price=1,e.handleEdit(t)},change:function(t,i){t.row,t.$rowIndex,t.column;e.confirm(t)}}}},{field:"sales_price",title:"商品金额",showOverflow:!0,editRender:{autoselect:!0,name:"Vinput",events:{input:function(t){t.row.is_price=1,e.handleEdit(t)},change:function(t,i){t.row,t.$rowIndex,t.column;e.confirm(t)}}}},{field:"discount_unit_price",title:"优惠单价",showOverflow:!0,editRender:{autoselect:!0,name:"vNumber",events:{input:function(t){e.handleEdit(t)}}}},{field:"discount_price",title:"优惠金额",showOverflow:!0,editRender:{autoselect:!0,name:"vNumber",events:{input:function(t){e.handleEdit(t)}}}},{field:"total_price",showOverflow:!0,title:"小计金额"},{title:"门店优惠金额",field:"shop_discount_price",headerAlign:"right",align:"right",width:100},{title:"原价金额",field:"original_price",headerAlign:"right",align:"right",width:100},{field:"revenue_price",showOverflow:!0,title:"税额",editRender:{autoselect:!0,name:"Vinput",formatter:"Positive",events:{input:function(t){e.handleEdit(t)}}}},{field:"no_revenue_price",showOverflow:!0,title:"不含税金额"},{field:"warehouse_name",title:"仓库",showOverflow:!0,width:120},{field:"allocation_name",title:"货位",sortable:!0,showOverflow:!0,width:120},{field:"unit_name",title:"单位",showOverflow:!0,width:110},{field:"policy_name",title:"促销政策",showOverflow:!0,width:150},{title:"工厂代码",field:"factory_code",showOverflow:!0,width:120},{title:"速记码",field:"shorthand_code",showOverflow:!0,width:120},{field:"remark",title:"备注",width:150,showOverflow:!0,editRender:{name:"Vinput",formatter:"String"}}],tableData:[]}},methods:{activeMethod:function(e){var t=e.column,i=e.row,s=!0;if(this.addDisabled){if("real_num"===t.property||"batch"===t.property||"revenue_price"===t.property){if(!i.goods_name)return this.$message.warning("请先选择商品"),!1;if("real_num"===t.property&&this.electricityOrderStatus&&"sourcing_order"!=this.ec_type&&"liancai_order"!=this.ec_type)return this.$message.warning("电商订单不允许部分出库！"),!1}else this.$message.warning("引用订单只能修改数量，批次和税额"),s=!1;return s}if("goods_name"===t.property&&10003===i.business_type_id&&(s=_(i,this)),"batch"===t.property&&(i.goods_id||(this.$message.warning("请先选择商品"),s=!1)),"sales_price"!==t.property&&"unit_price"!==t.property||10007===i.business_type_id&&i.policy_id&&(this.$message.warning("特价不允许修改售价和商品金额"),s=!1),"discount_unit_price"!==t.property&&"discount_price"!==t.property||10001!==i.business_type_id&&i.policy_id&&(this.$message.warning("当前满足促销政策不可修改"),s=!1),"discount_price"!==t.property&&"discount_unit_price"!==t.property&&"sales_price"!==t.property&&"unit_price"!==t.property||(10001===i.business_type_id&&(i.goods_name||(this.$message.warning("请先选择商品"),s=!1)),10002!==i.business_type_id&&10003!==i.business_type_id||(this.$message.warning("赠品不可修改"),s=!1)),"real_num"===t.property){if(!i.goods_name)return this.$message.warning("请先选择商品"),!1;s=_(i,this)}if("business_type_id"===t.property){if(this.salesorderAddGet&&this.salesorderAddGet.order_id)return this.$message.warning("修改不可编辑"),!1;if(i.policy_id)return this.$message.warning("当前满足促销政策不可修改"),!1;s=_(i,this)}return s},footerMethod:function(e){var t=this,i=e.columns,s=e.data;return[i.map((function(e,i){if(1===i)return"合计";if(["total_price","discount_price","real_num"].includes(e.property)){"total_price"==e.property&&(t.totalPrice=t.$utils.sum(s,e.property),t.countSettlementPrice());var a=t.$utils.sum(s,e.property);return Number.isInteger(a)?a:a.toFixed(2)}return null}))]}}};t["a"]=r}}]);
//# sourceMappingURL=chunk-3a533426.fcb71612.js.map