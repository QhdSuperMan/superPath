(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-77ad1e51"],{b680:function(e,t,a){"use strict";var i=a("23e7"),s=a("da84"),r=a("e330"),o=a("5926"),n=a("408a"),l=a("1148"),c=a("d039"),u=s.RangeError,m=s.String,d=Math.floor,_=r(l),p=r("".slice),h=r(1..toFixed),b=function(e,t,a){return 0===t?a:t%2===1?b(e,t-1,a*e):b(e*e,t/2,a)},g=function(e){var t=0,a=e;while(a>=4096)t+=12,a/=4096;while(a>=2)t+=1,a/=2;return t},f=function(e,t,a){var i=-1,s=a;while(++i<6)s+=t*e[i],e[i]=s%1e7,s=d(s/1e7)},v=function(e,t){var a=6,i=0;while(--a>=0)i+=e[a],e[a]=d(i/t),i=i%t*1e7},y=function(e){var t=6,a="";while(--t>=0)if(""!==a||0===t||0!==e[t]){var i=m(e[t]);a=""===a?i:a+_("0",7-i.length)+i}return a},k=c((function(){return"0.000"!==h(8e-5,3)||"1"!==h(.9,0)||"1.25"!==h(1.255,2)||"1000000000000000128"!==h(0xde0b6b3a7640080,0)}))||!c((function(){h({})}));i({target:"Number",proto:!0,forced:k},{toFixed:function(e){var t,a,i,s,r=n(this),l=o(e),c=[0,0,0,0,0,0],d="",h="0";if(l<0||l>20)throw u("Incorrect fraction digits");if(r!=r)return"NaN";if(r<=-1e21||r>=1e21)return m(r);if(r<0&&(d="-",r=-r),r>1e-21)if(t=g(r*b(2,69,1))-69,a=t<0?r*b(2,-t,1):r/b(2,t,1),a*=4503599627370496,t=52-t,t>0){f(c,0,a),i=l;while(i>=7)f(c,1e7,0),i-=7;f(c,b(10,i,1),0),i=t-1;while(i>=23)v(c,1<<23),i-=23;v(c,1<<i),f(c,1,1),v(c,2),h=y(c)}else f(c,0,a),f(c,1<<-t,0),h=y(c)+_("0",l);return l>0?(s=h.length,h=d+(s<=l?"0."+_("0",l-s)+h:p(h,0,s-l)+"."+p(h,s-l))):h=d+h,h}})},c4a4:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("售后管理")]),a("el-breadcrumb-item",{staticClass:"attrbute"},[a("span",{on:{click:e.goBack}},[e._v("三包退货")])]),a("el-breadcrumb-item",[e._v("新增三包退货单")])],1),a("div",{staticClass:"search_container"},[a("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[a("el-form-item",{attrs:{label:"销售组织",size:"mini",prop:"company_id",rules:e.rules.company_id}},[e._v(" "+e._s(function(){0==e.params.company_id&&(e.params.company_id=null)}())+" "),a("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",disabled:1==e.line},on:{change:e.companyChange,focus:e.companyListInvok},model:{value:e.params.company_id,callback:function(t){e.$set(e.params,"company_id",t)},expression:"params.company_id"}},e._l(e.companyList,(function(t){return a("el-option",{key:t.company_id,attrs:{label:t.company_name,value:t.company_id}},[a("span",{class:1==t.type?"optionStyle":""},[e._v(e._s(t.company_name))])])})),1)],1),a("el-form-item",{attrs:{label:"客户名称",size:"mini",prop:"customer_id",rules:e.rules.customer_id}},[e._v(" "+e._s(function(){0==e.params.customer_id&&(e.params.customer_id=null)}())+" "),a("el-select",{attrs:{filterable:"",placeholder:"请选择",clearable:"",loading:e.loading,remote:"","remote-method":e.clienteleListInvok,disabled:1==e.line},on:{change:e.changeCustomer,focus:e.clienteleListInvok},model:{value:e.params.customer_id,callback:function(t){e.$set(e.params,"customer_id",t)},expression:"params.customer_id"}},[a("ul",{staticClass:"customer customer-ul4 customer-ul2"},[a("li",[e._v("客户编号")]),a("li",[e._v("客户名称")]),a("li",[e._v("联系人")]),a("li",[e._v("联系电话")]),a("li",[e._v("区域")])]),e._l(e.customerList,(function(t){return a("el-option",{key:t.customer_id,attrs:{label:t.customer_name,value:t.customer_id}},[a("ul",{staticClass:"customer customer-ul4"},[a("li",{attrs:{title:t.customer_id}},[e._v(e._s(t.customer_id))]),a("li",{attrs:{title:t.customer_name}},[e._v(e._s(t.customer_name))]),a("li",{attrs:{title:t.contact_name}},[e._v(e._s(t.contact_name))]),a("li",{attrs:{title:t.customer_mobile}},[e._v(" "+e._s(t.customer_mobile)+" ")]),a("li",[e._v(" "+e._s(t.province_name)+"/"+e._s(t.city_name)+"/"+e._s(t.area_name)+" ")])])])}))],2)],1),a("el-form-item",{attrs:{label:"业务日期",size:"mini",prop:"business_time",rules:e.rules.business_time}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:e.params.business_time,callback:function(t){e.$set(e.params,"business_time",t)},expression:"params.business_time"}})],1),a("el-form-item",{attrs:{label:"部门",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.department_id&&(e.params.department_id=null)}())+" "),a("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",disabled:1==e.line},on:{focus:e.DepartmentListInvok},model:{value:e.params.department_id,callback:function(t){e.$set(e.params,"department_id",t)},expression:"params.department_id"}},e._l(e.departmentList,(function(e){return a("el-option",{key:e.department_id,attrs:{label:e.department_name,value:e.department_id}})})),1)],1),a("el-form-item",{attrs:{label:"业务员",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.business_id&&(e.params.business_id=null)}())+" "),a("el-select",{attrs:{clearable:"",placeholder:"请选择",disabled:1==e.line},on:{focus:function(t){return e.EmployeeListInvok(1)}},model:{value:e.params.business_id,callback:function(t){e.$set(e.params,"business_id",t)},expression:"params.business_id"}},e._l(e.employeeList,(function(e){return a("el-option",{key:e.employee_id,attrs:{label:e.employee_name,value:e.employee_id}})})),1)],1),a("el-form-item",{attrs:{label:"单据号",size:"mini"}},[a("el-input",{attrs:{disabled:""},model:{value:e.params.return_sn,callback:function(t){e.$set(e.params,"return_sn",t)},expression:"params.return_sn"}})],1),a("el-form-item",{attrs:{label:"来源单号",size:"mini"}},[this.params.return_id?a("el-input",{attrs:{disabled:"",readonly:"","suffix-icon":"el-icon-more"},model:{value:e.params.outstock_sn,callback:function(t){e.$set(e.params,"outstock_sn",t)},expression:"params.outstock_sn"}}):a("el-input",{staticStyle:{cursor:"pointer",width:"200px"},attrs:{clearable:"",disabled:2==e.line,"suffix-icon":"el-icon-more"},on:{clear:e.clearF},nativeOn:{click:function(t){e.salesDocumentsVisible=!0}},model:{value:e.params.outstock_sn,callback:function(t){e.$set(e.params,"outstock_sn",t)},expression:"params.outstock_sn"}})],1),a("el-form-item",{attrs:{label:"物流公司",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.intentional_logistics_id&&(e.params.intentional_logistics_id=null)}())+" "),a("el-select",{attrs:{clearable:"",filterable:"","filter-method":e.logisticsInvok},on:{focus:e.logisticsInvok,change:e.logisticsChanges},model:{value:e.params.intentional_logistics_id,callback:function(t){e.$set(e.params,"intentional_logistics_id",t)},expression:"params.intentional_logistics_id"}},e._l(e.logisticsList,(function(e){return a("el-option",{key:e.logistics_id,attrs:{label:e.logistics_name,value:e.logistics_id}})})),1)],1),a("el-form-item",{attrs:{label:"退货原因",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.reason_id&&(e.params.reason_id=null)}())+" "),a("el-select",{attrs:{clearable:"","value-key":"item.reason_id"},on:{focus:e.getReasonListInvok},model:{value:e.params.reason_id,callback:function(t){e.$set(e.params,"reason_id",t)},expression:"params.reason_id"}},e._l(e.reasonList,(function(e){return a("el-option",{key:e.reason_id,attrs:{label:e.reason_name,value:e.reason_id}})})),1)],1),a("el-form-item",{attrs:{label:"单据状态:",size:"mini",disabled:""}},[a("el-input",{attrs:{disabled:""},model:{value:e.params.auditor_status_name,callback:function(t){e.$set(e.params,"auditor_status_name",t)},expression:"params.auditor_status_name"}})],1),a("el-form-item",{attrs:{label:"备注",size:"mini",prop:"remark"}},[a("el-input",{attrs:{type:"text",maxlength:"300",placeholder:"请输入"},model:{value:e.params.remark,callback:function(t){e.$set(e.params,"remark",t)},expression:"params.remark"}})],1)],1)],1),a("div",{staticClass:"add_delet"},[e.onlyQuote?e._e():a("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",disabled:1==e.line,size:"mini"},on:{click:function(t){return e.addLine("ruleForm")}}},[e._v("增行")]),a("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.deleteF}},[e._v("删行")])],1),a("xTable",{ref:"xTable",attrs:{isEdit:e.isEdit,tableColumn:e.tableColumn,showFooter:!0,totalArray:["return_goods_num","return_subtotal_price"]}}),a("div",{staticClass:"refundauditFoot"},[a("span",[e._v("制单人："+e._s(e.username))]),a("span",[e._v("单据时间："+e._s(e.params.add_time))]),a("span",[e._v("审核人："+e._s(e.params.auditor_name))]),a("span",[e._v("审核时间："+e._s(e.params.auditor_time))]),a("span",[e._v("修改人："+e._s(e.params.update_user_name))]),a("span",[e._v("修改时间："+e._s(e.params.update_time))])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.goBack()}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:e.submitDisabled},on:{click:function(t){return e.submit("ruleForm")}}},[e._v("确 定")])],1),e.salesDocumentsVisible?a("div",[a("el-dialog",{staticClass:"dialogForm",attrs:{"close-on-click-modal":!1,title:"引用三包出库单据",visible:e.salesDocumentsVisible,width:"1030px"},on:{"update:visible":function(t){e.salesDocumentsVisible=t},close:function(t){e.salesDocumentsVisible=!1}}},[a("outboundOrder",{attrs:{par:e.params},on:{closedialog:function(t){e.salesDocumentsVisible=!1},dialogformInline:e.dialogformInline}})],1)],1):e._e()],1)},s=[],r=a("53ca"),o=(a("a9e3"),a("d3b7"),a("159b"),a("b680"),a("4de4"),a("99af"),a("e9c4"),a("d81d"),a("e87e")),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"search_container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[a("el-form-item",{attrs:{label:"业务日期",size:"mini"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.timeValue,callback:function(t){e.timeValue=t},expression:"timeValue"}})],1),a("el-form-item",{attrs:{label:"单据号",size:"mini"}},[a("el-input",{staticClass:"shortSearchInput",attrs:{placeholder:"请输入"},model:{value:e.params.outstock_sn,callback:function(t){e.$set(e.params,"outstock_sn",t)},expression:"params.outstock_sn"}})],1),a("el-form-item",{attrs:{label:"客户名称",size:"mini"}},[a("el-select",{attrs:{disabled:e.khdisable,clearable:"",maxlength:"100",filterable:"",placeholder:"请选择"},on:{focus:e.clienteleListInvok},model:{value:e.params.customer_id,callback:function(t){e.$set(e.params,"customer_id",t)},expression:"params.customer_id"}},e._l(e.customerList,(function(e){return a("el-option",{key:e.customer_id,attrs:{label:e.customer_name,value:e.customer_id}})})),1)],1),a("el-form-item",{staticStyle:{},attrs:{size:"mini"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.onSearch}},[e._v("查询")])],1)],1),a("div",{staticClass:"add_delet"},[a("p",[e._v("【"+e._s(e.title)+"单】单据列表")])]),a("div",{staticClass:"table_container"},[a("el-table",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.loadMore,expression:"loadMore"}],staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:e.TableData.tableData,"max-height":"200"},on:{"row-click":e.handleCurrentChanges}},[a("el-table-column",{attrs:{"show-overflow-tooltip":!0,width:"50",label:"选择"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.row.outstock_sn},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v(e._s(null))])]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"outstock_sn",width:"150",label:"单据号"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"customer_name",label:"客户名称"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"outstock_num",label:"商品数量"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"unreturn_num",label:"未退货数量"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"business_time",label:"业务日期"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"add_time",label:"单据时间"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"auditor_status_name",label:"单据状态"}})],1)],1),a("p",{staticStyle:{margin:"20px 0px","border-bottom":"1px dashed #e5e5e5"}}),a("div",{staticClass:"add_delet"},[a("p",[e._v("【"+e._s(e.title)+"单】单据明细")])]),a("div",{staticClass:"table_container"},[a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:e.TableDatas,"max-height":"300"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{"show-overflow-tooltip":!0,type:"selection",fixed:"left",align:"center",width:"44"}}),a("el-table-column",{attrs:{type:"index",label:"序号",width:"40"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"outstock_sn",width:"150",label:"单据号"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_id",label:"商品编号"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_name",label:"商品名称"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"unreturn_num",label:"未退货数量"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"batch",label:"年周/批次"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"warehouse_name",label:"仓库"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"allocation_name",label:"货位"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.dialogCancelForm}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.dialogSubmitForm}},[e._v("确 定")])],1)],1)])},l=[],c=a("ade3"),u=a("65b0"),m={data:function(){var e;return e={params:{},searchParams:{},timeValue:[],multipleSelection:[],supplierList:[],companyList:[],TableDatas:[],tabledatas:[],radio:null,goPage:1,pageSize:30,per_page:[30,50,100,500],order_id:""},Object(c["a"])(e,"searchParams",{}),Object(c["a"])(e,"loadSign",!0),Object(c["a"])(e,"khdisable",!1),e},methods:{loadMore:function(){var e=this;this.loadSign&&(this.loadSign=!1,this.goPage++,Object.assign(this.searchParams.params,{page:this.goPage}),Object(u["g"])(this.searchParams,4),setTimeout((function(){e.loadSign=!0}),1e3))},onSearch:function(){this.timeValue&&2==this.timeValue.length?(this.params.start_time=this.timeValue[0],this.params.end_time=this.timeValue[1]):this.params.start_time=this.params.end_time="",Object(u["g"])(this.searchParams)},handleSelectionChange:function(e){this.multipleSelection=e},onReset:function(){this.$set(this,"params",{}),this.$set(this.params,"company_id",this.par.company_id),this.timeValue=[],Object(u["h"])(this,{API:"v2getSalesOutstockList",params:this.params},"TableData.tableData")},handleCurrentChanges:function(e){var t=this;this.$axMethod.v2getSalesOutstockInfo({outstock_id:e.outstock_id,outstock_type_id:e.outstock_type_id}).then((function(e){var a=e.data;200==a.code&&(t.tabledatas=a.data,t.TableDatas=a.data.goods_list,t.TableDatas.forEach((function(e,a){t.$nextTick((function(){this.$refs.table.toggleRowSelection(this.TableDatas[a],!0)}))})))}))},dialogCancelForm:function(){this.$emit("closedialog",!1)},dialogSubmitForm:function(){if(!this.TableDatas.length)return this.$message.error("请选择订单"),!1;this.tabledatas.goods_list=this.multipleSelection,this.$emit("dialogformInline",this.tabledatas)}},props:["par"],mounted:function(){this.params={company_id:this.par.company_id,customer_id:this.par.customer_id,outstock_type_id:this.par.outstock_type_id},this.$set(this,"customerList",[{customer_id:this.par.customer_id,customer_name:this.par.customer_name}]),this.par.customer_id&&(this.khdisable=!0),10002==this.par.outstock_type_id?this.title="销售出库":this.title="三包出库",this.$set(this,"searchParams",{params:this.params,TableData:this.TableData,API:"v2getSalesOutstockList",vm:this}),Object(u["g"])(this.searchParams)}},d=m,_=a("2877"),p=Object(_["a"])(d,n,l,!1,null,"d3eb3874",null),h=p.exports,b=a("b85c"),g=(a("25f0"),{return_goods_num:"",unit_price:"",return_subtotal_price:"",return_goods_id:0,batch:f(),goods_name:"",warehouse_id:"",warehouse_name:"",allocation_id:"",allocation_name:"",goods_id:"",goods_sn:"",is_tire_management:"",brand_id:"",unit_name:"",batch_id:"",remark:"",stocks:"",is_system:"",add_time:"",production_time:""});function f(){var e=new Date,t=new Date(e.getFullYear(),0,1),a=t.getDay(),i=1;0!=a&&(i=7-a+1),t=new Date(e.getFullYear(),0,1+i);var s=Math.ceil((e.valueOf()-t.valueOf())/864e5),r=2==String(Math.ceil(s/7)+1).length?Math.ceil(s/7)+1:"0".concat(Math.ceil(s/7)+1),o=e.getFullYear().toString().substring(2);return"".concat(r).concat(o)}var v={data:function(){var e=this,t=this.$createElement;return{validRules:{goods_name:[{required:!0,message:"商品必填"}],batch:[{required:!0,message:"批次必填"}],warehouse_name:[{required:!0,message:"仓库必填"}],return_goods_num:[{required:!0,message:"数量必填"}]},tableColumn:[{type:"checkbox",width:44,treeNode:!0,align:"center"},{title:"序号",type:"index",width:60},{title:"商品编号",field:"goods_id",width:80},{title:"商品名称",field:"goods_name",width:400,headIcon:!0,editRender:{name:"vGoods",getParams:function(){return{params:{company_id:e.params.company_id,customer_id:e.params.customer_id},showObj:{goods_id:"商品编号",goods_name:"商品名称"}}},events:{change:this.changeGoods}}},{title:"年周/批次",field:"batch",headIcon:!0,width:120,editRender:{name:"Vinput",formatter:"String",placeholder:"周周年年,如1421",events:{blur:this.blurChange}}},{title:"数量",field:"return_goods_num",headerAlign:"right",align:"right",width:88,headIcon:!0,editRender:{name:"number",events:{input:this.handleEdit}}},{title:"销售单价",field:"unit_price",headerAlign:"right",align:"right",width:132,editRender:{name:"Vinput",events:{input:this.handleEdit}}},{title:"金额",field:"return_subtotal_price",headerAlign:"right",align:"right",width:100,editRender:{name:"Vinput",events:{input:this.handleEdit}}},{title:"仓库名称",field:"warehouse_name",width:132,headIcon:!0,editRender:{name:"vSelect",getParams:function(t){t.row;return{url:"getWarehouseFocus",params:{company_id:e.params.company_id},itemObj:{id:"warehouse_id",name:"warehouse_name"}}},events:{change:function(t,a){var i=t.row;i.allocation_name=a.allocation_name,i.allocation_id=a.allocation_id,i.batch_id=0,i.warehouse_name=a.warehouse_name,e.$axios({method:"get",url:e.$api.newAllocationList,params:{company_id:e.params.company_id,warehouse_id:i.warehouse_id,goods_id:i.goods_id}}).then((function(e){if(e.data.data){var t,a=Object(b["a"])(e.data.data);try{for(a.s();!(t=a.n()).done;){var s=t.value;1==s.is_system&&(i.allocation_id=s.allocation_id,i.allocation_name=s.allocation_name,i.is_system=s.stocks,i.stocks=s.stocks)}}catch(r){a.e(r)}finally{a.f()}}}))}}}},{title:"货位名称",field:"allocation_name",width:130,editRender:{name:"vAllocation",getParams:function(t){var a=t.row;return{url:"newAllocationListList",isPage:!0,params:{company_id:e.params.company_id,warehouse_id:a.warehouse_id,goods_id:a.goods_id}}},events:{change:function(e,t){var a=e.row;a.is_system=t.is_system,a.stocks=t.stocks,a.batch_id=0,a.allocation_name=t.allocation_name}}}},{title:"生产日期",field:"production_time",width:"100",slots:{header:function(){return[t("el-tooltip",{class:"item",attrs:{content:"Bottom center",effect:"light"}},[t("p",{slot:"content"},[" 生产日期列后期将会隐藏， 同时新增商品入库日期列 "])," ",t("span",{class:"el-icon-question",style:"cursor:pointer;font-weight:bold;"},[" 生产日期 "])," "])]}}},{title:"单位",field:"unit_name",width:"50"},{title:"备注",field:"remark",editRender:{name:"Vinput",formatter:"String"}}]}},methods:{blurChange:function(e){var t=e.row;(4!=t.batch.toString().length||t.batch.toString().substr(0,2)>52||t.batch.toString().substr(2,2)>21)&&(this.$message.warning("年周/批次填写错误，标准格式：周周年年，如1421"),this.$set(t,"batch",""))},isEdit:function(e){var t=e.column;return"goods_name"!==t.property&&"batch"!==t.property||2===this.line||(this.$publicFution.confirm("引入出库单不可修改"),!1)}}},y={name:"threePackageReturnAdd",mixins:[v],data:function(){return{username:localStorage.getItem("realname"),onlyQuote:!1,rebate_price:0,credit_price:0,loading:!1,deposits_price:0,pagetotle:0,pagetotlenum:0,disabled:!1,add_user_name:localStorage.employee_name,line:null,params:{business_time:this.$publicFution.formatData(new Date),company_id:Number(localStorage.company_id),outstock_type_id:10007},customer_name:null,salesDocumentsVisible:!1,submitDisabled:!1}},components:{outboundOrder:h},methods:{dialogformInline:function(e){var t=this;e.info.outstock_type_id=this.params.outstock_type_id,Object(u["b"])(this,e.info,[["company_id","company_name","companyList"],["department_id","department_name","departmentList"],["customer_id","customer_name","customerList"],["logistics_id","logistics_name","logisticsList"]]),this.$set(this,"logisticsList",[{logistics_name:e.info.intentional_logistics,logistics_id:e.info.intentional_logistics_id}]),this.$set(this,"employeeList",[{employee_id:e.info.business_id,employee_name:e.info.business_name}]),e.goods_list.forEach((function(e,a){t.pagetotlenum+=e.remain_num,t.pagetotle+=Number(e.subtotal_price),e.unit_price=Number(e.unit_price-e.discount_unit_price).toFixed(2),e.true_unit_price=e.unit_price,e.return_goods_num=e.remain_num,e.return_subtotal_price=e.subtotal_price})),this.$refs.xTable._proxy("loadData",e.goods_list),this.$set(this,"params",Object.assign({},e.info,{business_time:this.$publicFution.formatData(new Date)})),this.pagetotlenum>=this.params.unreturn_num?(this.rebate_price=Number(this.params.un_rebate_price),this.credit_price=Number(this.params.un_credit_price),this.deposits_price=Number(this.params.un_deposits_price)):(this.rebate_price=Number(this.params.outstock_rebate_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.rebate_price=this.rebate_price.toFixed(2),this.credit_price=Number(this.params.outstock_credit_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.credit_price=this.credit_price.toFixed(2),this.deposits_price=Number(this.params.outstock_deposits_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.deposits_price=this.deposits_price.toFixed(2)),this.line=1,this.salesDocumentsVisible=!1},logisticsChanges:function(e){e&&(this.params.logistics_name=this.logisticsList.filter((function(t){return t.logistics_id==e}))[0].logistics_name),this.params.intentional_logistics=this.params.logistics_name},changeCustomer:function(e){var t=this;if(e){var a={customer_id:this.params.customer_id,company_id:this.params.company_id};this.params.customer_name=this.customerList.filter((function(t){return t.customer_id==e}))[0].customer_name,a.company_id=this.customerList.filter((function(t){return t.customer_id==e}))[0].company_id,this.$axMethod.getCustomerInfoNEWqx(a).then((function(e){var a=e.data;200==a.code&&(t.$set(t.params,"business_id",a.data.business_id),Object.assign(a.data,{employee_id:a.data.business_id,employee_name:a.data.business_name}),Object(u["b"])(t,a.data,[["employee_id","employee_name","employeeList"]]))}))}},companyChange:function(e){var t=this;Object(u["a"])(this,this.params),this.$refs.xTable._proxy("loadData"),this.$set(this.params,"reason_id",0),this.$baseData.settingInfo({num:3,company_id:e},(function(){if(localStorage.FDBName_business){var e=JSON.parse(localStorage.getItem("FDBName_business"));t.onlyQuote=1==e[8].status}}))},addLine:function(e){var t=this;this.$refs[e].validate((function(e){e&&(t.line=2,t.$refs.xTable._proxy("insertAt",t.$publicFution.deepCopy(g),-1),t.$refs.xTable._proxy("updateFooter"))}))},clearF:function(e){this.$refs.xTable._proxy("loadData",[]),this.$refs.xTable._proxy("updateFooter"),this.line=null,this.params={business_time:this.$publicFution.formatData(new Date),company_id:Number(localStorage.company_id),outstock_type_id:10007}},changeGoods:function(e,t){var a=t.row,i=["goods_id","goods_sn","goods_name","is_tire_management","brand_id","unit_name","unit_price"],s=[{field:"warehouse_id",initValue:""},{field:"warehouse_name",initValue:""},{field:"allocation_id",initValue:""},{field:"allocation_name",initValue:""},{field:"allocationInventoryList",initValue:[]},{field:"unit_price",initValue:""}];s.forEach((function(e){e.isClear||(a[e["field"]]=e["initValue"])})),i.forEach((function(t,i){a[t]=e[t]})),this.handleEdit({row:a,column:{property:"unit_price"}});var r=this.$refs.xTable._proxy("getTableData").fullData.concat([]);r[r.length-1].goods_name&&this.addLine("ruleForm")},deleteF:function(){var e=this,t=this.$refs.xTable._proxy("getSelectRecords");t.length?(this.$refs.xTable._proxy("removeSelecteds"),this.$refs.xTable._proxy("updateFooter"),1==this.line&&(this.pagetotle=0,this.pagetotlenum=0,this.$refs.xTable._proxy("getTableData").fullData.forEach((function(t){e.pagetotle+=Number(t.return_subtotal_price),e.pagetotlenum+=Number(t.return_goods_num)})),this.pagetotle=this.pagetotle.toFixed(2),this.pagetotlenum>=this.params.unreturn_num?(this.rebate_price=Number(this.params.un_rebate_price),this.credit_price=Number(this.params.un_credit_price),this.deposits_price=Number(this.params.un_deposits_price)):(this.rebate_price=Number(this.params.outstock_rebate_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.rebate_price=this.rebate_price.toFixed(2),this.credit_price=Number(this.params.outstock_credit_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.credit_price=this.credit_price.toFixed(2),this.deposits_price=Number(this.params.outstock_deposits_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.deposits_price=this.deposits_price.toFixed(2)))):this.$message.warning("请先选择要删除的商品！"),0===this.$refs.xTable._proxy("getTableData").fullData.length&&(this.params.outstock_sn||this.$set(this,"line",null))},handleEdit:function(e){var t=this,a=e.row,i=e.column,s={num:"return_goods_num",price:"unit_price",goodsPrice:"return_subtotal_price"};this.$publicFution.computeTotal(a,s,i.property,this),this.$refs.xTable._proxy("updateFooter"),2!=this.line&&(this.pagetotle=0,this.pagetotlenum=0,this.$refs.xTable._proxy("getTableData").fullData.forEach((function(e){t.pagetotle+=Number(e.return_subtotal_price),t.pagetotlenum+=Number(e.return_goods_num)})),this.pagetotle=this.pagetotle.toFixed(2),this.pagetotlenum>=this.params.unreturn_num?(this.rebate_price=Number(this.params.un_rebate_price),this.credit_price=Number(this.params.un_credit_price),this.deposits_price=Number(this.params.un_deposits_price)):(this.rebate_price=Number(this.params.outstock_rebate_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.rebate_price=this.rebate_price.toFixed(2),this.credit_price=Number(this.params.outstock_credit_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.credit_price=this.credit_price.toFixed(2),this.deposits_price=Number(this.params.outstock_deposits_price)*(Number(this.pagetotle)/Number(this.params.outstock_price)),this.deposits_price=this.deposits_price.toFixed(2)),a.return_goods_num>a.remain_num&&(this.$message.warning("退货数量不可大于可退货数量"),this.submitDisabled=!0,setTimeout((function(){t.$set(a,"return_goods_num",a.remain_num),t.$set(a,"return_subtotal_price",Number(a.unit_price*a.return_goods_num).toFixed(2)),t.submitDisabled=!1}),1e3)))},goBack:function(){this.$publicFution.goPage(this.params.return_id),this.$router.push({path:"/aftersale/threepackagereturn"})},verifyTableData:function(e){var t=this.TableData.filter((function(t){var a=e.every((function(e){return t[e]||0===t[e]}));if(!a)return Object.assign({},t,{index:t.index})}));return!t.length||(this.$message.warning(t[0].goods_id?"请完善 ".concat(t[0].goods_name," 商品信息"):"第".concat(t[0].index,"条商品信息有误")),!1)},submit:function(e){var t=this,a=this;if(this.carDoctorWarehouse=[],this.TableData=this.$refs.xTable._proxy("getTableData").fullData.concat([]),null==this.TableData||!this.TableData.length)return this.$message.warning("请增加退货信息！"),!1;this.TableData[this.TableData.length-1].goods_name||this.TableData.pop(),this.$refs[e].validate((function(e){if(e){var i=["return_goods_num","return_subtotal_price","unit_price","batch","warehouse_id","allocation_id"],s=["return_goods_num","warehouse_id","allocation_id","unit_price"];if(0==t.params.intentional_logistics_id&&(t.params.intentional_logistics=null),1==t.line||null==t.line){var o="",n=[];if(a.TableData.forEach((function(e,a){if(!o){var i=Number(e.subtotal_price),s=Number(e.return_subtotal_price);!isNaN(i)&&!isNaN(s)&&s>i&&(o="商品编号：".concat(e.goods_id," 可退货商品总价格为：").concat(i))}n.push({outstock_goods_id:e.outstock_goods_id,batch_id:e.batch_id,batch:e.batch,return_subtotal_price:e.return_subtotal_price,warehouse_id:e.warehouse_id,return_unit_price:Number(e.unit_price||0)+Number(e.discount_unit_price||0),unit_price:e.true_unit_price?e.true_unit_price:0,return_goods_num:e.return_goods_num?e.return_goods_num:0,discount_unit_price:e.discount_unit_price?e.discount_unit_price:0,goods_id:e.goods_id,remark:e.remark?e.remark:"",allocation_id:e.allocation_id,return_num:e.return_goods_num?e.return_goods_num:0}),t.params.return_id&&(n[n.length-1].return_goods_id=e.return_goods_id),t.carDoctorWarehouse.push({warehouse_name:e.warehouse_name,warehouse_id:e.warehouse_id})})),o)return void t.$message({message:o,type:"warning"});if(!a.verifyTableData(i))return!1;t.params.rebate_price=t.rebate_price,t.params.credit_price=t.credit_price,t.params.deposits_price=t.deposits_price,t.params.return_goods_arr=JSON.stringify(n);var l="addThressReturnSales";t.params.return_id?(t.params.return_id=t.params.return_id,t.params.type=4,l="editThressReturnSales"):t.params.type=2,t.$baseData.checkCarDoctor({company_id:t.params.company_id,company_name:t.params.company_name,bill_type:7,bill_id:t.params.return_id,operation_type:t.params.return_id?2:1,goods_info:JSON.stringify(t.carDoctorWarehouse)}).then((function(){a.$axMethod[l](a.params).then((function(e){200==e.data.code&&(a.$message.success(e.data.msg),a.goBack())}))}))}if(2==t.line){var c,u=function(){for(var e=0;e<t.TableData.length;e++)if(!t.TableData[e].goods_id)return t.$message.warning({message:"第"+e+"1行请选择商品"}),{v:!1};Object.assign(t.params,{intentional_logistics:t.params.logistics_name});var i=[];if(t.TableData.forEach((function(e,a){e.return_unit_price=Number(e.unit_price||0)+Number(e.discount_unit_price||0),e.allocation_id&&i.push(Object.assign({},e,{allocation_id:e.allocation_id,allocation_name:e.allocation_id,stocks:e.allocation_id.stocks,is_system:e.allocation_id.stocks,intentional_logistics_id:e.intentional_logistics_id})),t.carDoctorWarehouse.push({warehouse_name:e.warehouse_name,warehouse_id:e.warehouse_id})})),!a.verifyTableData(s))return{v:!1};var r=Object.assign({},{return_goods_arr:JSON.parse(JSON.stringify(i)),reason_id:t.params.reason_id,business_time:t.params.business_time,remark:t.params.remark,customer_id:t.params.customer_id,business_id:t.params.business_id,company_id:t.params.company_id,department_id:t.params.department_id,return_id:t.params.return_id,intentional_logistics:t.params.intentional_logistics,intentional_logistics_id:t.params.intentional_logistics_id,outstock_type_id:t.params.outstock_type_id}),o=["goods_id","batch","return_goods_num","warehouse_id"],n=!1;for(c=0;c<r.return_goods_arr.length;c++)if(o.forEach((function(e){""==r.return_goods_arr[c][e]&&(n=!0)})),n)return t.$message.warning({message:"请完善信息"}),{v:!1};var l=r.return_goods_arr.map((function(e,a){return e.add_time=t.$publicFution.formatData(new Date),e.remark||(e.remark=""),e.production_time||(e.production_time=""),e.allocation_id||(e.allocation_id=0),e.warehouse_id||(e.warehouse_id=0),e.unit_price||(e.unit_price=0),delete e.item,delete e.allocationInventoryList,e}));r.return_goods_arr=JSON.stringify(l);var u="addThressReturnSales";t.params.return_id?(r.return_id=t.params.return_id,r.type=3,u="editThressReturnSales"):r.type=1,t.$baseData.checkCarDoctor({company_id:t.params.company_id,company_name:t.params.company_name,bill_type:7,bill_id:t.params.return_id,operation_type:t.params.return_id?2:1,goods_info:JSON.stringify(t.carDoctorWarehouse)}).then((function(){a.$axMethod[u](r).then((function(e){200==e.data.code&&(a.$message.success(e.data.msg),a.goBack())}))}))}();if("object"===Object(r["a"])(u))return u.v}}}))}},mounted:function(){var e=this;try{if(localStorage.FDBName_business){var t=JSON.parse(localStorage.getItem("FDBName_business"));this.onlyQuote=1==t[8].status}}catch(a){}this.$route.query.id?this.$axios({method:"get",url:o["a"].SeeThressReturn,params:{return_id:this.$route.query.id}}).then((function(t){var a=t.data;if(200==a.code){Object.assign(a.data,{logistics_name:a.data.intentional_logistics,logistics_id:a.data.intentional_logistics_id}),0==a.data.outstock_id?(e.line=2,a.data.goods_info.map((function(e){return e.outstock_goods_num="",e.line=2,e}))):e.line=1;var i=[];e.$set(e,"warehouseList",i),e.$refs.xTable._proxy("loadData",a.data.goods_info),Object(u["l"])(e,a.data),e.$set(e,"params",a.data),delete e.params.goods_info,e.rebate_price=e.params.rebate_price,e.credit_price=e.params.credit_price,e.deposits_price=e.params.deposits_price,e.$set(e,"employeeList",[{employee_id:a.data.business_id,employee_name:a.data.business_name}])}})):Object(u["l"])(this,window.localStorage)}},k=y,w=Object(_["a"])(k,i,s,!1,null,"f8475506",null);t["default"]=w.exports}}]);
//# sourceMappingURL=chunk-77ad1e51.62a71388.js.map