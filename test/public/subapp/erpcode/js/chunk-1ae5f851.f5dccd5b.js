(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-1ae5f851"],{"3d22":function(t,e,a){"use strict";a("fd9c")},4458:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"policyadd"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[t._v("销售管理")]),a("el-breadcrumb-item",{staticClass:"attrbute"},[a("span",{on:{click:t.goBack}},[t._v("促销政策")])]),a("el-breadcrumb-item",[t._v(t._s(t.title)+"促销政策")])],1),a("div",{staticClass:"contbk"},[a("h2",{staticClass:"cont_tit"},[t._v(t._s(t.title)+"促销政策")]),a("el-form",{ref:"policyRef",staticClass:"cont_list",attrs:{inline:!0,model:t.params}},[a("el-form-item",{attrs:{label:"销售组织:",size:"mini",prop:"company_id",rules:t.rules.company_id}},[a("el-select",{attrs:{placeholder:"请选择",filterable:""},on:{focus:t.companyListInvok,change:t.companyChange},model:{value:t.params.company_id,callback:function(e){t.$set(t.params,"company_id",e)},expression:"params.company_id"}},t._l(t.companyList,(function(e){return a("el-option",{key:e.company_id,attrs:{label:e.company_name,value:e.company_id}},[a("span",{class:1==e.type?"optionStyle":""},[t._v(t._s(e.company_name))])])})),1)],1),a("br"),a("el-form-item",{attrs:{size:"mini",prop:"policy_name",label:"政策名称:",rules:t.rules.policy_name}},[a("el-input",{attrs:{maxlength:"100",placeholder:"请输入"},model:{value:t.params.policy_name,callback:function(e){t.$set(t.params,"policy_name",e)},expression:"params.policy_name"}})],1),a("br"),a("el-form-item",{attrs:{size:"mini",prop:"cxzctime",rules:t.rules.cxzctime,label:"政策生效日期:"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:t.timeChange},model:{value:t.params.cxzctime,callback:function(e){t.$set(t.params,"cxzctime",e)},expression:"params.cxzctime"}}),a("span",{staticClass:"smstyle"},[t._v("说明：促销政策有效期在业务日期内，促销政策有效")])],1),a("br"),a("el-row",{staticStyle:{margin:"20px 0"}},[a("span",{staticClass:"resetH2"},[t._v("促销商品:")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading1,expression:"loading1"}],staticClass:"goodslist",attrs:{"highlight-current-row":!0,"row-class-name":t.tableRowClassName,"tooltip-effect":"light",border:"",data:t.goodslist,"max-height":"298"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"45"}}),a("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("i",{staticClass:"el-icon-circle-plus",on:{click:function(a){return t.addGoodlist(e.$index,e.row)}}}),t._v("    "),a("i",{staticClass:"el-icon-error",on:{click:function(a){return t.delGoodlist(e.$index,e.row)}}})]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_id",label:"商品编号",width:"70"}}),a("el-table-column",{attrs:{property:"goods_name",label:"商品名称","min-width":"290"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticStyle:{width:"95%",float:"left"}},[a("vGoodsList",{attrs:{scopes:e,showObj:t.showObj,vxeParams:t.params,changeGoods:t.changeGoods1}})],1),a("div",{staticStyle:{float:"right",width:"5%","margin-top":"5px"}},[a("i",{staticClass:"el-icon-search",on:{click:function(a){return t.openIndexgoods(e.$index)}}})])]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"brand_name",label:"品牌","min-width":"110"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"unit_name","min-width":"40",label:"单位"}})],1),a("div",{staticClass:"smstyle",staticStyle:{float:"left","margin-left":"106px"}},[t._v(" 【说明】 1、点击商品名称中的放大镜图标，可批量选择商品；2、将对以上每一个商品分别应用促销规则。 ")])],1),a("el-row",[a("span",{staticClass:"resetH"},[t._v("促销类型:")]),a("el-radio-group",{on:{change:t.getlable},model:{value:t.params.unit_type,callback:function(e){t.$set(t.params,"unit_type",e)},expression:"params.unit_type"}},[a("el-radio",{attrs:{label:3}},[t._v("按照商品数量")]),a("el-radio",{attrs:{label:4}},[t._v("按照商品金额")]),a("el-radio",{attrs:{label:5}},[t._v("特价")])],1)],1),a("el-row",{staticStyle:{margin:"20px 0"}},[a("span",{staticClass:"resetH2"},[t._v("促销规则:")]),5!=t.params.unit_type?a("el-radio-group",{on:{change:t.getlable},model:{value:t.params.full_type,callback:function(e){t.$set(t.params,"full_type",e)},expression:"params.full_type"}},[a("el-radio",{attrs:{label:2}},[t._v("满减")]),a("el-radio",{attrs:{label:3}},[t._v("满折")]),a("el-radio",{attrs:{label:1}},[t._v("满赠")])],1):t._e(),5!=t.params.unit_type?a("div",{staticClass:"flagstyle pdbj"},[t._v(" "+t._s(t.textone)+" "),a("el-input",{nativeOn:{change:function(e){return t.handleInput2.apply(null,arguments)}},model:{value:t.params.full_price,callback:function(e){t.$set(t.params,"full_price",e)},expression:"params.full_price"}}),t._v(" "+t._s(t.texttwo)+" "),a("el-input",{nativeOn:{input:function(e){return t.handinput1.apply(null,arguments)},change:function(e){return t.handleInput2.apply(null,arguments)}},model:{value:t.params.full_subtraction_price,callback:function(e){t.$set(t.params,"full_subtraction_price",e)},expression:"params.full_subtraction_price"}}),t._v(" "+t._s(t.textthree)+" "),1==t.params.full_type?a("span",{staticClass:"btncustomer",on:{click:function(e){t.isShowGoodsLayer=!0}}},[t._v("添加赠品")]):t._e()],1):t._e(),5!=t.params.unit_type&&3!=t.params.full_type?a("div",{staticStyle:{float:"left",margin:"10px 0 0 106px"}},[a("el-checkbox",{attrs:{"false-label":"0","true-label":"1"},model:{value:t.params.is_double,callback:function(e){t.$set(t.params,"is_double",e)},expression:"params.is_double"}},[t._v("启动倍送")]),a("span",{staticClass:"smstyle"},[t._v("（启用后，按照本次条件的整数倍进行优惠；例：启用时，满3减/赠1，如果满7则减/赠2）")])],1):t._e(),5==t.params.unit_type?a("div",{staticClass:"flagstyle"},[t._v(" 商品售价降至 "),a("el-input",{nativeOn:{change:function(e){return t.handleInput2.apply(null,arguments)}},model:{value:t.params.full_price,callback:function(e){t.$set(t.params,"full_price",e)},expression:"params.full_price"}}),t._v(" 元 ")],1):t._e(),1==t.params.full_type&&5!=t.params.unit_type?a("div",{staticClass:"customBk"},t._l(t.goods,(function(e){return a("el-tag",{key:e.goods_id,attrs:{closable:"",type:e.type},on:{close:function(a){return t.handleClosegoods(e)}}},[t._v(" "+t._s(e.goods_name)+" ")])})),1):t._e()],1),a("el-row",{staticStyle:{"margin-bottom":"20px"}},[a("span",{staticClass:"resetH2"},[t._v("促销范围:")]),a("el-radio-group",{on:{change:t.getlablecustomer},model:{value:t.params.promotion_range,callback:function(e){t.$set(t.params,"promotion_range",e)},expression:"params.promotion_range"}},[a("el-radio",{attrs:{label:2}},[t._v("全部客户")]),a("el-radio",{attrs:{label:1}},[t._v("指定客户")])],1),1==t.params.promotion_range?a("span",{staticClass:"btncustomer",on:{click:function(e){t.isShowCustomLayer=!0}}},[t._v("选择客户")]):t._e(),1==t.params.promotion_range?a("div",{staticClass:"customBk"},t._l(t.customs,(function(e,s){return a("el-tag",{key:e.customer_id,attrs:{closable:"",type:e.type},on:{close:function(a){return t.handleClose(e)}}},[t._v(" "+t._s(s+1)+"、 "+t._s(e.customer_id)+" "+t._s(e.customer_name)+" "+t._s(e.customer_mobile)+" ")])})),1):t._e()],1),a("el-form-item",{attrs:{size:"mini",label:"备注:"}},[a("el-input",{attrs:{maxlength:"300",placeholder:"请输入","suffix-icon":"el-icon-edit-outline"},model:{value:t.params.remark,callback:function(e){t.$set(t.params,"remark",e)},expression:"params.remark"}})],1),a("div",{staticClass:"smstyle",staticStyle:{float:"left","margin-left":"106px"}},[t._v(" 【说明】 在相同生效时间内，相同的商品、客户，以最新的促销政策为准。 ")])],1),a("el-row",{staticStyle:{width:"780px",margin:"30px 0"},attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple-light"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.submit("policyRef")}}},[t._v("确定")])],1)]),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.goBack}},[t._v("取消")])],1)])],1)],1),t.isShowCustomLayer?a("selectCustomLayer",{attrs:{companyId:t.params.company_id,choose_status:t.params.promotion_range,choose_customer_str:t.customs},on:{selectCustomResult:t.selectCustomResult}}):t._e(),t.isShowGoodsLayer?a("selectGoods",{attrs:{companyId:t.params.company_id},on:{goodsdialog:t.goodsdialog}}):t._e(),t.isShowGoodsLayer2?a("goodsPopout",{attrs:{incloudTop:["pattern","brand_name","specification_type","unit_name"],url:"getGoodsListDropdown",tableColumnConfig:[{old_field:"sale_price",field:"unit_price"}],ExcloudParams:["warehouse",,"is_stocks","is_available_stocks"],searchParams:{company_id:t.params.company_id},width:"1100",rowId:"goods_id"},on:{close:function(e){t.isShowGoodsLayer2=!1},submit:t.goodsdialog2}}):t._e()],1)},o=[],i=a("2909"),l=a("5530"),r=(a("ac1f"),a("466d"),a("d3b7"),a("a434"),a("d81d"),a("159b"),a("caad"),a("2532"),a("99af"),a("a15b"),a("4de4"),a("a9e3"),a("2f62")),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"选择商品",visible:!0,width:"1030px"},on:{close:function(e){return t.cancel()}}},[a("div",{staticClass:"search_container"},[a("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.params}},[a("el-form-item",{attrs:{label:"商品类型","label-width":"65px"}},[a("jybd-cascader",{ref:"cascader",on:{cascaderMethod:t.cascaderMethod}})],1),a("br"),a("el-form-item",{attrs:{label:"商品名称",size:"mini","label-width":"65px"}},[a("el-input",{model:{value:t.params.goods_name,callback:function(e){t.$set(t.params,"goods_name",e)},expression:"params.goods_name"}})],1),a("el-form-item",{attrs:{label:"商品编号",size:"mini","label-width":"65px"}},[a("el-input",{model:{value:t.params.goods_id,callback:function(e){t.$set(t.params,"goods_id",e)},expression:"params.goods_id"}})],1),a("el-form-item",{attrs:{label:"品牌",size:"mini","label-width":"50px"}},[a("getBrand",{model:{value:t.params.brand_id,callback:function(e){t.$set(t.params,"brand_id",e)},expression:"params.brand_id"}})],1),a("el-form-item",{attrs:{label:"规格型号",size:"mini","label-width":"65px"}},[a("el-input",{model:{value:t.params.specification_name,callback:function(e){t.$set(t.params,"specification_name",e)},expression:"params.specification_name"}})],1),a("el-form-item",{attrs:{label:"花纹",size:"mini","label-width":"65px"}},[a("el-input",{model:{value:t.params.figure_name,callback:function(e){t.$set(t.params,"figure_name",e)},expression:"params.figure_name"}})],1),a("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSearch}},[t._v("查询")]),a("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.onReset}},[t._v("重置")])],1)],1),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:t.TableData.tableData,"max-height":"300"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{"show-overflow-tooltip":!0,type:"selection",fixed:"left",align:"center",width:"44","reserve-selection":!1}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_id",label:"商品编号"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_name",label:"商品名称","min-width":"500"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("pre",[t._v(t._s(e.row.goods_name))])]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"brand_name",label:"品牌"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"specification_name",label:"规格型号"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"figure_name",label:"花纹"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"unit_name",label:"单位"}})],1)],1),a("div",{staticClass:"page_container"},[a("el-pagination",{staticClass:"erp-pagination",attrs:{"current-page":t.goPage,"page-size":t.pageSize1,"page-sizes":[30],layout:"total,sizes, prev, pager, next,jumper",prevText:"上一页",nextText:"下一页",total:t.TableData.total},on:{"update:currentPage":function(e){t.goPage=e},"update:current-page":function(e){t.goPage=e},"current-change":t.handleCurrentChange}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.cancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)])],1)},c=[],m={data:function(){return{radio:"",gather:[],loading:!1,showGoodsAdd:!1}},props:["isShowGoodsLayer","companyId"],methods:{handleSelectionChange:function(t){this.gather=t},handleCurrentChange:function(t){this.$common.initData("cxzcgoodlist",this.TableData,Object(l["a"])(Object(l["a"])({},this.params),{},{company_id:this.companyId,page:t}))},onReset:function(){this.$refs.cascader.clear(),this.goPage=1,this.$set(this,"params",{page:1,company_id:this.companyId,type:2}),this.$common.initData("cxzcgoodlist",this.TableData,this.params)},onSearch:function(){this.$common.initData("cxzcgoodlist",this.TableData,this.params)},cancel:function(){this.$parent.isShowGoodsLayer=!1},submit:function(){this.$emit("goodsdialog",this.gather),this.$parent.isShowGoodsLayer=!1}},mounted:function(){this.$common.initData("cxzcgoodlist",this.TableData,{company_id:this.companyId,type:2}),this.params.company_id=this.companyId}},p=m,u=a("2877"),d=Object(u["a"])(p,n,c,!1,null,null,null),h=d.exports,_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"选择商品",visible:!0,width:"1030px"},on:{close:function(e){return t.cancel()}}},[a("div",{staticClass:"search_container"},[a("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.params}},[a("el-form-item",{attrs:{label:"商品类型","label-width":"65px"}},[a("jybd-cascader",{ref:"cascader",on:{cascaderMethod:t.cascaderMethod}})],1),a("br"),a("el-form-item",{attrs:{label:"商品名称",size:"mini","label-width":"65px"}},[a("el-input",{model:{value:t.params.goods_name,callback:function(e){t.$set(t.params,"goods_name",e)},expression:"params.goods_name"}})],1),a("el-form-item",{attrs:{label:"商品编号",size:"mini","label-width":"65px"}},[a("el-input",{model:{value:t.params.goods_id,callback:function(e){t.$set(t.params,"goods_id",e)},expression:"params.goods_id"}})],1),a("el-form-item",{attrs:{label:"品牌",size:"mini","label-width":"50px"}},[a("getBrand",{model:{value:t.params.brand_id,callback:function(e){t.$set(t.params,"brand_id",e)},expression:"params.brand_id"}})],1),a("el-form-item",{attrs:{label:"规格型号",size:"mini","label-width":"65px"}},[a("el-input",{model:{value:t.params.specification_name,callback:function(e){t.$set(t.params,"specification_name",e)},expression:"params.specification_name"}})],1),a("el-form-item",{attrs:{label:"花纹",size:"mini","label-width":"65px"}},[a("el-input",{model:{value:t.params.figure_name,callback:function(e){t.$set(t.params,"figure_name",e)},expression:"params.figure_name"}})],1),a("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSearch}},[t._v("查询")]),a("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.onReset}},[t._v("重置")])],1)],1),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"",data:t.TableData.tableData,"max-height":"300"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{"show-overflow-tooltip":!0,type:"selection",fixed:"left",align:"center",width:"44","reserve-selection":!1}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_id",label:"商品编号"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"goods_name",label:"商品名称","min-width":"500"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("pre",[t._v(t._s(e.row.goods_name))])]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"brand_name",label:"品牌"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"specification_name",label:"规格型号"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"figure_name",label:"花纹"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"unit_name",label:"单位"}})],1)],1),a("div",{staticClass:"page_container"},[a("el-pagination",{staticClass:"erp-pagination",attrs:{"current-page":t.goPage,"page-size":t.pageSize1,"page-sizes":[30],layout:"total,sizes, prev, pager, next,jumper",prevText:"上一页",nextText:"下一页",total:t.TableData.total},on:{"update:currentPage":function(e){t.goPage=e},"update:current-page":function(e){t.goPage=e},"current-change":t.handleCurrentChange}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.cancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)])],1)},g=[],f=a("65b0"),b={data:function(){return{radio:"",loading:!1,gather:[]}},props:["state","isShowGoodsLayer2","companyId"],methods:{cancel:function(){this.$parent.isShowGoodsLayer2=!1},submit:function(){this.$emit("goodsdialog2",this.gather),this.$parent.isShowGoodsLayer2=!1},resetForm:function(){this.$refs.cascader.clear(),this.goPage=1,this.$set(this,"params",{type:2,is_gift:1,page:1,company_id:this.companyId}),this.$set(this,"searchParams",{params:this.params,TableData:this.TableData,API:"cxzcgoodlist",vm:this}),Object(f["g"])(this.searchParams)},handleSelectionChange:function(t){this.gather=t},handleCurrentChange:function(t){Object.assign(this.searchParams.params,{page:t,type:2}),Object(f["g"])(this.searchParams)},onSearch:function(){Object.assign(this.searchParams.params,this.params,{page:1,type:2}),Object(f["g"])(this.searchParams)},innerVisible:function(){this.$emit("goodsdialog2",!1)}},computed:{refresh:function(){return this.$store.state.refresh}},mounted:function(){this.$set(this,"params",{is_gift:1,type:2,company_id:this.companyId}),this.$set(this,"searchParams",{params:this.params,TableData:this.TableData,API:"cxzcgoodlist",vm:this}),Object(f["g"])(this.searchParams)}},y=b,v=Object(u["a"])(y,_,g,!1,null,null,null),w=v.exports,x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"选择客户",visible:!0,width:"962px"},on:{close:function(e){return t.cancel()}}},[a("el-form",{ref:"params",attrs:{inline:!0,model:t.params}},[a("el-form-item",{staticClass:"dQzcCustom",staticStyle:{width:"256px"},attrs:{label:"客户名称",size:"mini","label-width":"95px"}},[a("el-select",{attrs:{filterable:"",placeholder:"请输入",clearable:"",loading:t.loading,remote:"","remote-method":t.clienteleListInvok},on:{focus:t.clienteleListInvok},model:{value:t.params.customer_id,callback:function(e){t.$set(t.params,"customer_id",e)},expression:"params.customer_id"}},[a("ul",{staticClass:"customer customer-ul4 customer-ul2"},[a("li",[t._v("客户编号")]),a("li",[t._v("客户名称")]),a("li",[t._v("联系人")]),a("li",[t._v("联系电话")]),a("li",[t._v("区域")])]),t._l(t.customerList,(function(e){return a("el-option",{key:e.customer_id,attrs:{label:e.customer_name,value:e.customer_id}},[a("ul",{staticClass:"customer customer-ul4"},[a("li",{attrs:{title:e.customer_id}},[t._v(t._s(e.customer_id))]),a("li",{attrs:{title:e.customer_name}},[t._v(t._s(e.customer_name))]),a("li",{attrs:{title:e.contact_name}},[t._v(t._s(e.contact_name))]),a("li",{attrs:{title:e.customer_mobile}},[t._v(t._s(e.customer_mobile))]),a("li",[t._v(t._s(e.province_name)+"/"+t._s(e.city_name)+"/"+t._s(e.area_name))])])])}))],2)],1),a("el-form-item",{staticClass:"dQzcCustom",staticStyle:{width:"256px"},attrs:{label:"手机号码",size:"mini","label-width":"95px"}},[a("el-input",{model:{value:t.params.customer_mobile,callback:function(e){t.$set(t.params,"customer_mobile",e)},expression:"params.customer_mobile"}})],1),a("el-form-item",{attrs:{label:"客户分类",size:"mini"}},[a("el-select",{attrs:{clearable:""},on:{focus:t.customerTypeInvok,change:t.clearCustomer},model:{value:t.params.customer_type_id,callback:function(e){t.$set(t.params,"customer_type_id",e)},expression:"params.customer_type_id"}},t._l(t.customerTypeList,(function(t){return a("el-option",{key:t.customer_type_id,attrs:{label:t.customer_type_name,value:t.customer_type_id}})})),1)],1),a("el-form-item",{staticClass:"dQzcCustom",staticStyle:{width:"256px"},attrs:{label:"选择状态",size:"mini","label-width":"95px"}},[a("el-select",{attrs:{clearable:""},model:{value:t.params.choose_status,callback:function(e){t.$set(t.params,"choose_status",e)},expression:"params.choose_status"}},[a("el-option",{attrs:{label:"全部",value:0}},[t._v("全部")]),a("el-option",{attrs:{label:"已选择",value:2}},[t._v("已选择")]),a("el-option",{attrs:{label:"未选择",value:1}},[t._v("未选择")])],1)],1),a("el-form-item",{staticClass:"el-form-item_shortInput ",attrs:{label:"区域",clearable:"",size:"mini"}},[a("el-cascader",{attrs:{options:t.options,props:t.props1},on:{change:t.changes,"expand-change":t.handleItemChange},model:{value:t.clearuser,callback:function(e){t.clearuser=e},expression:"clearuser"}})],1),a("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSearch}},[t._v("查询")]),a("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.onReset}},[t._v("重置")])],1)],1),a("div",{staticClass:"table_container"},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,"tooltip-effect":"light",border:"","max-height":"300",data:t.TableDataCustom.tableData},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{"show-overflow-tooltip":!0,type:"selection",fixed:"left",align:"center",width:"44",label:"选择"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"customer_id",label:"客户编号"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"customer_name",label:"客户名称"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"customer_mobile",label:"手机号码"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"customer_type_name",label:"客户分类"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,property:"addressDetail",label:"所属区域"}})],1),a("div",{staticClass:"page_container"},[a("el-pagination",{staticClass:"erp-pagination",attrs:{"current-page":t.customListPage,layout:"total,sizes, prev, pager, next,jumper","page-sizes":t.per_page,"page-size":t.pageSize1,prevText:"上一页",nextText:"下一页",total:t.TableDataCustom.total},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange,"update:currentPage":function(e){t.customListPage=e},"update:current-page":function(e){t.customListPage=e}}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.cancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1)],1)},C=[],$=a("b85c"),k={name:"selectCustomLayer",data:function(){return{params:{},options:[],selectedOptions:[,,],customListPage:1,TableDataCustom:{tableData:[],total:10},gather:[],radio:"",loading:!1,props1:{value:"value",children:"cities"},clearuser:[],pagechoose_customer_str:""}},props:["isShowCustomLayer","companyId","choose_status","choose_customer_str"],methods:{clearCustomer:function(t){this.$set(this.params,"customer_id","")},getCustomerListRemote:function(t){Object(f["f"])(this,{company_id:this.companyId,choose_customer_str:this.pagechoose_customer_str,choose_status:this.params.choose_status,customer_name:t})},getCustomList:function(t){this.$common.initData("getCustomerList",this.TableDataCustom,Object.assign({},t,{company_id:this.companyId,choose_customer_str:this.pagechoose_customer_str,choose_status:this.params.choose_status,page:this.customListPage,per_page:30}))},handleSizeChange:function(t){this.$common.initData("getCustomerList",this.TableDataCustom,Object.assign({},params,{per_page:t,page:1}))},cancel:function(){this.$parent.isShowCustomLayer=!1},submit:function(){this.$emit("selectCustomResult",this.gather),this.$parent.isShowCustomLayer=!1},onSearch:function(){this.getCustomList(Object.assign({},this.params,{province_id:this.selectedOptions[0],city_id:this.selectedOptions[1],area_id:this.selectedOptions[2]}))},onReset:function(){this.customListPage=1,this.selectedOptions=[],this.$set(this,"params",{}),this.$set(this,"clearuser",[]);var t={};this.$common.initData("getCustomerList",this.TableDataCustom,Object.assign({},t,{page:this.customListPage,company_id:this.companyId,customer_type_id:this.customertypeId,per_page:30}))},handleSelectionChange:function(t){this.gather=t},handleCurrentChange:function(t){this.customListPage=t,this.getCustomList()},changes:function(t){this.selectedOptions=t},handleItemChange:function(t){var e,a=this;1==t.length&&(e=t[0]),2==t.length&&(e=t[1]),this.$axios({method:"get",url:this.$api.getAreaListOption,params:{p_id:e,is_page:1}}).then((function(e){for(var s in a.options){if(1==t.length&&a.options[s].value==t[0]&&!a.options[s].cities.length)for(var o in e.data.data){var i={};i.label=e.data.data[o].area_name,i.value=e.data.data[o].area_id,i.cities=[],a.options[s].cities.push(i)}if(2==t.length)for(var l in a.options[s].cities)if(a.options[s].cities[l].value==t[1]&&!a.options[s].cities[l].cities.length)for(var o in e.data.data){i={};i.label=e.data.data[o].area_name,i.value=e.data.data[o].area_id,a.options[s].cities[l].cities.push(i)}}}))},reDataCustom:function(){var t,e=Object($["a"])(this.TableDataCustom.tableData);try{for(e.s();!(t=e.n()).done;){var a=t.value;Object.assign(a,{addressDetail:"\n          ".concat(a.province_name).concat(a.city_name).concat(a.area_name).concat(a.address,"\n        ")})}}catch(s){e.e(s)}finally{e.f()}}},mounted:function(){var t=this;1==this.choose_status&&(this.choose_customer_str.length>=1?(this.pagechoose_customer_str=this.choose_customer_str.map((function(t){return t.customer_id})).join(","),this.$set(this.params,"choose_status",1)):this.$set(this.params,"choose_status",1)),this.params.company_id=this.companyId,this.getCustomList(),this.$axios({method:"get",url:this.$api.getAreaListOption,params:{level:2,is_page:1}}).then((function(e){var a={};for(var s in e.data.data){a={};a.label=e.data.data[s].area_name,a.value=e.data.data[s].area_id,a.cities=[],t.options.push(a)}}))},watch:{TableDataCustom:{handler:function(){this.reDataCustom()},deep:!0}}},z=k,S=(a("a095"),Object(u["a"])(z,x,C,!1,null,null,null)),L=S.exports,O=a("1521"),j={name:"salesPolicyadd",data:function(){return{flagbtn:!1,showObj:{goods_id:"商品编号",goods_name:"商品名称"},listchuan:{},goodslist:[],opengoodsindex:0,textone:"商品数量满",texttwo:"则减免",textthree:"元",title:"新增",isShowCustomLayer:!1,isShowGoodsLayer:!1,isShowGoodsLayer2:!1,customs:[],goods:[],loading:!0,brandList:[],list:[],params:{promotion_range:2,policy_name:null,customer_type_id:null,company_id:null,start_time:null,end_time:null,brand_id:null,remark:null,customer_user_id_str:[],goods_id_str:[],gift_goods_id_str:[],unit_type:null,unit_value:null,full_type:null,full_price:null,full_subtraction_price:null}}},components:{selectCustomLayer:L,selectGoods:h,selectGoods2:w,vGoodsList:O["a"]},methods:Object(l["a"])(Object(l["a"])({},Object(r["b"])(["paramsLookuser_hide","promotionpolicyIndexACT","paramsAdd_hide"])),{},{handinput1:function(t){t.target.value=t.target.value.match(/^\d*(\.?\d{0,2})/g)[0]||""},handleInput2:function(t){t.target.value<=0&&(t.target.value=""),this.$forceUpdate()},tableRowClassName:function(t){var e=t.row;t.rowIndex;return e.canNotDelete?"error-row":""},openIndexgoods:function(t){this.opengoodsindex=t,this.isShowGoodsLayer2=!0},changeGoods1:function(t,e){var a=this,s=["goods_id","goods_sn","goods_name","unit_name","unit_id","brand_name"];s.forEach((function(s,o,i){a.$set(a.goodslist[e.$index],s,t[s])}))},getlablecustomer:function(){this.$set(this,"customs",[]),this.$set(this.params,"customer_str",[])},getlable:function(t){if(t&&(this.$set(this.params,"full_price",""),this.$set(this.params,"full_subtraction_price","")),3==this.params.unit_type)switch(this.params.full_type){case 2:this.textone="商品数量满",this.texttwo="则减免",this.textthree="元";break;case 3:this.textone="商品数量满",this.texttwo="则打",this.textthree="折";break;case 1:this.textone="商品数量满",this.texttwo="则赠送数量",this.textthree="的";break}else if(4==this.params.unit_type)switch(this.params.full_type){case 2:this.textone="商品金额满",this.texttwo="则减免",this.textthree="元";break;case 3:this.textone="商品金额满",this.texttwo="则打",this.textthree="折";break;case 1:this.textone="商品金额满",this.texttwo="则赠送数量",this.textthree="的";break}},addGoodlist:function(t,e){var a=Object.assign({},{}),s=this.goodslist;s.splice(t+1,0,a),this.$set(this,"goodslist",s)},delGoodlist:function(t,e){var a=this.goodslist;a.splice(t,1),this.$set(this,"goodslist",a),0==this.goodslist.length&&this.goodslist.push({goods_id:"",goods_name:"",brand_name:"",unit_name:""})},companyChange:function(){this.$set(this,"goodslist",[]);for(var t=0;t<8;t++)this.goodslist.push({goods_id:"",goods_name:"",brand_name:"",unit_name:""});this.$set(this,"goods",[]),this.$set(this,"customs",[])},timeChange:function(){this.params.cxzctime?(this.params.start_time=this.params.cxzctime[0],this.params.end_time=this.params.cxzctime[1]):(this.params.start_time="",this.params.end_time="")},customerTypeFocus:function(){this.$common.options("getCustomerTypeListOption",this.customerTypeList,{company_id:this.params.company_id,is_page:1})},goodsdialog:function(t){var e=this;this.isShowGoodsLayer=!1;var a=this.goods.map((function(t){return t.goods_id}));t.forEach((function(t){a.includes(t.goods_id)||e.goods.push(t)})),(this.goods||0!=this.goods.length)&&(this.params.gift_str=this.goods)},goodsdialog2:function(t){var e;this.isShowGoodsLayer2=!1,(e=this.goodslist).splice.apply(e,[this.opengoodsindex,0].concat(Object(i["a"])(t)))},goBack:function(){this.$publicFution.goPage(this.$route.query.id),this.$router.push({path:"/sales/promotionpolicy"})},submit:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return console.error("error submit!!"),!1;var a=Object.assign({},e.params);if(e.params.customer_str&&(a.customer_str=e.params.customer_str.map((function(t){return t.customer_id})).join(",")),e.goodslist){var s=e.goodslist;a.goods_str=s.filter((function(t){return""!=t.goods_name})),a.goods_str=a.goods_str.map((function(t){return t.goods_id})).join(",")}e.params.gift_str&&(a.gift_str=e.params.gift_str.map((function(t){return t.goods_id})).join(","));var o=e.$route.query.id?"editCXmessage":"addCXmessage";e.$axMethod[o](a).then((function(t){if(200==t.data.code)"重复请求"==t.data.msg?e.$message({message:t.data.msg,type:"error"}):(e.$message({message:t.data.msg,type:"success"}),setTimeout((function(){e.goBack()}),1e3));else{var a=t.data.data.error_customer?t.data.data.error_customer:t.data.data.error_customer=[],s=t.data.data.error_goods?t.data.data.error_goods:t.data.data.error_goods=[];e.goodslist.forEach((function(t){-1!=s.indexOf(t.goods_id)&&(t.canNotDelete=!0)})),e.goodslist.push({}),e.goodslist.pop(),e.customs.forEach((function(t){-1!=a.indexOf(t.customer_id)&&(t.type="danger")})),e.customs.push({}),e.customs.pop()}}))}))},selectCustomResult:function(t){var e=this,a=this.customs.map((function(t){return t.customer_id}));t.forEach((function(t){a.includes(t.customer_id)||e.customs.push(t)})),this.customs&&this.customs.length&&(this.params.customer_str=this.customs)},handleClosegoods:function(t){this.goods.splice(this.goods.indexOf(t),1),this.params.gift_str=this.goods},handleClose:function(t){this.customs.splice(this.customs.indexOf(t),1),this.params.customer_str=this.customs}}),mounted:function(){var t=this;if(this.$route.query&&this.$route.query.id)this.title="修改",this.params.type=2,this.$axios({method:"get",url:this.$api.getPromotionPolicyInfo,params:{policy_id:this.$route.query.id}}).then((function(e){Object(f["l"])(t,e.data.data),t.params=e.data.data,t.customs=t.params.customer_list,t.goodslist=t.params.goods_list,t.goods=t.params.gift_goods_list,t.params.customer_str=t.customs,t.params.gift_str=t.goods,t.params.goods_str=t.goodslist,t.params.type=2,t.$set(t.params,"cxzctime",[t.params.start_time,t.params.end_time]),t.getlable()}));else{for(var e=0;e<8;e++)this.goodslist.push({goods_id:"",goods_name:"",brand_name:"",unit_name:""});this.$set(this,"params",{company_id:Number(localStorage.company_id),type:2,promotion_range:2,unit_type:3,full_type:2}),Object(f["b"])(this,window.localStorage,[["company_id","company_name","companyList"]])}}},D=j,I=(a("3d22"),Object(u["a"])(D,s,o,!1,null,"77dc8de9",null));e["default"]=I.exports},"466d":function(t,e,a){"use strict";var s=a("c65b"),o=a("d784"),i=a("825a"),l=a("50c4"),r=a("577e"),n=a("1d80"),c=a("dc4a"),m=a("8aa5"),p=a("14c3");o("match",(function(t,e,a){return[function(e){var a=n(this),o=void 0==e?void 0:c(e,t);return o?s(o,e,a):new RegExp(e)[t](r(a))},function(t){var s=i(this),o=r(t),n=a(e,s,o);if(n.done)return n.value;if(!s.global)return p(s,o);var c=s.unicode;s.lastIndex=0;var u,d=[],h=0;while(null!==(u=p(s,o))){var _=r(u[0]);d[h]=_,""===_&&(s.lastIndex=m(o,l(s.lastIndex),c)),h++}return 0===h?null:d}]}))},"70e5":function(t,e,a){},a095:function(t,e,a){"use strict";a("70e5")},fd9c:function(t,e,a){}}]);
//# sourceMappingURL=chunk-1ae5f851.f5dccd5b.js.map