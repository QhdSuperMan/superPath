(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-7a2ad47e"],{"15e7":function(e,a,t){"use strict";t.r(a);var i=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",[e._v("采购管理")]),t("el-breadcrumb-item",{staticClass:"attrbute"},[t("span",{on:{click:e.goBack}},[e._v("采购计划")])]),t("el-breadcrumb-item",[e._v(e._s(e.title)+"采购计划")])],1),t("div",{staticClass:"search_container"},[t("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params,rules:e.formRules}},[t("el-form-item",{attrs:{label:"采购组织",size:"mini",prop:"company_id"}},[e._v(" "+e._s(function(){0==e.params.company_id&&(e.params.company_id=null)}())+" "),t("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:""},on:{focus:e.companyListInvok,change:e.companyChange},model:{value:e.params.company_id,callback:function(a){e.$set(e.params,"company_id",a)},expression:"params.company_id"}},e._l(e.companyList,(function(a){return t("el-option",{key:a.company_id,attrs:{label:a.company_name,value:a.company_id}},[t("span",{class:1==a.type?"optionStyle":""},[e._v(e._s(a.company_name))])])})),1)],1),t("el-form-item",{attrs:{label:"单据号:",size:"mini"}},[t("el-input",{attrs:{type:"text",maxlength:"300",disabled:""},model:{value:e.params.plan_sn,callback:function(a){e.$set(e.params,"plan_sn",a)},expression:"params.plan_sn"}})],1),t("el-form-item",{attrs:{label:"供应商(厂家)",size:"mini"}},[t("el-select",{attrs:{clearable:"","filter-method":e.supplierListInvok,filterable:"",placeholder:"请选择"},on:{focus:e.supplierListInvok},model:{value:e.params.supplier_id,callback:function(a){e.$set(e.params,"supplier_id",a)},expression:"params.supplier_id"}},e._l(e.supplierList,(function(e){return t("el-option",{key:e.supplier_id,attrs:{label:e.supplier_name,value:e.supplier_id}})})),1)],1),e.isJc?t("el-form-item",{attrs:{label:"仓库名称",size:"mini",prop:"warehouse_id"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:!0},on:{focus:e.warehouseInvok},model:{value:e.params.warehouse_id,callback:function(a){e.$set(e.params,"warehouse_id",a)},expression:"params.warehouse_id"}},e._l(e.warehouseList,(function(e){return t("el-option",{key:e.warehouse_id,attrs:{label:e.warehouse_name,value:e.warehouse_id}})})),1)],1):t("el-form-item",{attrs:{label:"仓库名称",size:"mini",prop:"warehouse_id",rules:{required:!1}}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:!0},on:{focus:e.warehouseInvok},model:{value:e.params.warehouse_id,callback:function(a){e.$set(e.params,"warehouse_id",a)},expression:"params.warehouse_id"}},e._l(e.warehouseList,(function(e){return t("el-option",{key:e.warehouse_id,attrs:{label:e.warehouse_name,value:e.warehouse_id}})})),1)],1),e.isJc?t("el-form-item",{attrs:{label:"交货日期",size:"mini",prop:"requirement_delivery_time"}},[t("el-date-picker",{staticStyle:{width:"160px"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.params.requirement_delivery_time,callback:function(a){e.$set(e.params,"requirement_delivery_time",a)},expression:"params.requirement_delivery_time"}})],1):t("el-form-item",{attrs:{label:"交货日期",size:"mini",prop:"requirement_delivery_time",rules:{required:!1}}},[t("el-date-picker",{staticStyle:{width:"160px"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.params.requirement_delivery_time,callback:function(a){e.$set(e.params,"requirement_delivery_time",a)},expression:"params.requirement_delivery_time"}})],1),t("el-form-item",{attrs:{label:"采购员",size:"mini",prop:"buyer_id"}},[e._v(" "+e._s(function(){0==e.params.buyer_id&&(e.params.buyer_id=null)}())+" "),t("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:!0},on:{focus:e.EmployeeListInvok},model:{value:e.params.buyer_id,callback:function(a){e.$set(e.params,"buyer_id",a)},expression:"params.buyer_id"}},e._l(e.employeeList,(function(e){return t("el-option",{key:e.employee_id,attrs:{label:e.employee_name,value:e.employee_id}})})),1)],1),t("el-form-item",{attrs:{label:"所属部门",size:"mini"}},[e._v(" "+e._s(function(){0==e.params.department_id&&(e.params.department_id=null)}())+" "),t("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:""},on:{change:e.departmentChange,focus:e.DepartmentListInvok},model:{value:e.params.department_id,callback:function(a){e.$set(e.params,"department_id",a)},expression:"params.department_id"}},e._l(e.departmentList,(function(e){return t("el-option",{key:e.department_id,attrs:{label:e.department_name,value:e.department_id}})})),1)],1),t("el-form-item",{attrs:{label:"收货状态",size:"mini"}},[t("el-input",{attrs:{type:"text",maxlength:"300",disabled:""},model:{value:e.params.delivery_status_name,callback:function(a){e.$set(e.params,"delivery_status_name",a)},expression:"params.delivery_status_name"}})],1),t("el-form-item",{attrs:{label:"审核状态",size:"mini"}},[t("el-input",{attrs:{type:"text",maxlength:"300",disabled:""},model:{value:e.params.auditor_status_name,callback:function(a){e.$set(e.params,"auditor_status_name",a)},expression:"params.auditor_status_name"}})],1)],1)],1),t("div",{staticClass:"add_delet"},[t("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:e.addRow}},[e._v("增行")]),t("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.deleteRow}},[e._v("删行")])],1),t("div",{staticClass:"table_container"},[t("xTable",{ref:"xTable",attrs:{sign:e.signObj,"edit-rules":e.editRules,isEdit:e.isEdit,tableColumn:e.tableColumn,totalArray:["goods_num","subtotal_price"]}})],1),t("div",[t("div",[e._v(" 单据备注: "),t("span",{staticStyle:{display:"inline-block",width:"90%","margin-bottom":"5px"}},[t("el-input",{model:{value:e.params.remark,callback:function(a){e.$set(e.params,"remark",a)},expression:"params.remark"}})],1)]),t("el-form",{ref:"paramsFooter",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params}},[t("el-form-item",{attrs:{label:"创建人：",size:"mini"}},[t("el-input",{attrs:{maxlength:"100",disabled:""},model:{value:e.params.add_user_name,callback:function(a){e.$set(e.params,"add_user_name",a)},expression:"params.add_user_name"}})],1),t("el-form-item",{attrs:{label:"创建时间：",size:"mini"}},[t("el-input",{attrs:{maxlength:"100",disabled:""},model:{value:e.params.add_time_name,callback:function(a){e.$set(e.params,"add_time_name",a)},expression:"params.add_time_name"}})],1),t("el-form-item",{attrs:{label:"修改人：",size:"mini"}},[t("el-input",{attrs:{maxlength:"100",disabled:""},model:{value:e.params.update_user_name,callback:function(a){e.$set(e.params,"update_user_name",a)},expression:"params.update_user_name"}})],1),t("el-form-item",{attrs:{label:"修改时间：",size:"mini"}},[t("el-input",{attrs:{maxlength:"100",disabled:""},model:{value:e.params.update_time_name,callback:function(a){e.$set(e.params,"update_time_name",a)},expression:"params.update_time_name"}})],1)],1)],1),e.isShowShopPop?t("goodsPopout",{attrs:{width:900,ExcloudParams:["specification_type","pattern","is_stocks","is_available_stocks","warehouse"],incloudTop:["goods_num","factory_code"],rowId:"goods_id",url:"getGoodsListDropdown",searchParams:{company_id:e.params.company_id}},on:{close:function(a){e.isShowShopPop=!1},submit:e.confirm}}):e._e(),t("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center","margin-top":"20px"}},[t("el-button",{on:{click:e.goBack}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.submit("ruleForm")}}},[e._v("确 定")])],1)],1)},r=[],s=(t("99af"),t("4de4"),t("d3b7"),t("d81d"),t("e9c4"),t("159b"),t("caad"),t("a9e3"),t("65b0")),n=t("fe6e"),o={name:"purchasePlanAdd",mixins:[n["c"]],data:function(){return{title:"添加",isJc:0,params:this.$publicFution.deepCopy(n["a"]),sumbitRow:{goods_id:"",goods_name:"",goods_sn:"",factory_code:"",purchase_price:"",goods_num:"",remark:"",subtotal_price:""},signObj:{arr:[],str:"plan_goods_id"},isShowShopPop:!1}},methods:{companyChange:function(){this.$set(this.params,"supplier_id",""),this.$set(this.params,"department_id",""),this.$set(this.params,"buyer_id",""),this.$set(this.params,"warehouse_id",""),this.$refs.xTable._proxy("loadData",[]),this.getIsJc()},getIsJc:function(){var e=this;this.$axMethod.getCompanyListDefalut({company_id:this.params.company_id}).then((function(a){var t=a.data;200===t.code&&(t.data.company_list&&t.data.company_list[0]?e.isJc=t.data.company_list[0].is_purchase_center:e.isJc=t.data.is_purchase_center),e.isJc?e.editRules.is_invoices_name=[{required:!0,message:"请选择是否带票"}]:e.editRules.is_invoices_name=[{required:!1,message:"请选择是否带票"}],e.$nextTick((function(){e.$refs.ruleForm.validate()}))}))},goBack:function(){this.$publicFution.goPage(this.$route.query.id),this.$router.push({path:"/purchase/plan"})},departmentChange:function(e){this.$set(this.params,"buyer_id","")},submit:function(e){var a=this,t=this.$refs.xTable._proxy("getTableData").fullData.concat([]);this.$refs[e].validate((function(e){if(e){if(t.length<1)return void a.$message.warning("请完善表格数据");a.$refs.xTable._proxy("validate",t).then((function(e){var i=Object.assign({},a.params);t=t.filter((function(e){if(1===e.auditor_status||3===e.auditor_status)return e})),t=t.map((function(e){return a.$publicFution.filter(n["b"],e)})),i.goods_json=JSON.stringify(t),a.$message.closeAll(),a.$baseData.checkComputation(t,{goods_num:"goods_num",total_price:"subtotal_price",goods_price:"purchase_price"}).then((function(){a.$axios({method:"post",url:a.plan_id?a.$api.editPlan:a.$api.addPlan,data:i}).then((function(e){200==e.data.code?(a.$message.success(e.data.msg),setTimeout((function(){a.goBack()}))):a.$message({dangerouslyUseHTMLString:!0,message:e.data.msg,duration:7e3,type:"error"})}))}))}))}}))},confirm:function(e){var a=this,t=e.map((function(e){return e.auditor_status=1,a.handleEdit({row:e,column:{property:"goods_num"}}),e}));this.$refs.xTable._proxy("loadData",this.$refs.xTable._proxy("getTableData").fullData.concat(t)),this.isShowShopPop=!1}},activated:function(){this.initTurnOrder()},mounted:function(){var e=this;if(this.$route.query&&this.$route.query.id)this.plan_id=this.$route.query.id,this.title="修改",this.$axios({method:"get",url:this.$api.getPlanInfo,params:{plan_id:this.plan_id}}).then((function(a){if(200==a.data.code){var t=a.data.data.goods_list;e.$refs.xTable._proxy("loadData",t),e.signObj.arr=[],t.forEach((function(a){1!==a.auditor_status&&3!==a.auditor_status&&e.signObj.arr.push(a)})),e.$set(e,"params",a.data.data.info),e.params.requirement_delivery_time=e.params.requirement_delivery_time_name,Object.assign(a.data.data.info,{employee_id:a.data.data.info.buyer_id,employee_name:a.data.data.info.buyer_name}),Object(s["l"])(e,a.data.data.info),e.getIsJc()}}));else{var a=localStorage,t=a.employee_id,i=a.company_admin_id;[0,1,2].includes(Number(t))||i>0?this.params.company_id=localStorage.company_id:(this.params.company_id=Number(localStorage.company_id),this.params.department_id=Number(localStorage.department_id),this.params.buyer_id=Number(localStorage.employee_id)),Object.assign(this.employeeList,{employee_id:Number(localStorage.employee_id),employee_name:Number(localStorage.employee_name)}),Object(s["l"])(this,localStorage),this.getIsJc()}}},l=o,d=t("2877"),m=Object(d["a"])(l,i,r,!1,null,"7d25faf6",null);a["default"]=m.exports},fe6e:function(e,a,t){"use strict";t.d(a,"b",(function(){return i})),t.d(a,"a",(function(){return r})),t.d(a,"c",(function(){return s}));t("d81d");var i={goods_id:"",goods_name:"",purchase_price:"",goods_num:"",goods_sn:"",subtotal_price:"",is_invoices:"",remark:""},r={remark:"",company_id:"",company_name:"",plan_sn:"",supplier_id:"",supplier_name:"",warehouse_id:"",warehouse_name:"",requirement_delivery_time:"",buyer_id:"",department_id:"",delivery_status_name:""},s={data:function(){var e=this;return{formRules:{company_id:[{required:!0,message:"请选择采购组织跟"}],warehouse_id:[{required:!0,message:"请选择仓库"}],requirement_delivery_time:[{required:!0,message:"请选择交货日期"}],buyer_id:[{required:!0,message:"请选择采购员"}]},editRules:{goods_num:[{required:!0,message:"数量输入请在0-99999999之间"}],goods_name:[{required:!0,message:"请选择商品"}],purchase_price:[{required:!0,message:"请输入采购价"}],purchase_total_price:[{required:!0,message:"请输入采购金额"}],is_invoices_name:[{required:!0,message:"请选择是否带票"}]},tableColumn:[{type:"checkbox",width:44,align:"center"},{title:"序号",type:"seq",width:50},{title:"商品编号",field:"goods_id",width:80},{title:"商品名称",field:"goods_name",width:400,editRender:{name:"vGoods",getParams:function(a){var t=a.row;return{params:{company_id:e.params.company_id},showObj:{goods_id:"商品编号",goods_name:"商品名称",unit_name:"单位",brand_name:"品牌",specification_type:"规格型号",factory_code:"工厂代码"},getIcon:function(){return t.goods_name?[{icon:"el-icon-close",title:"删除商品",iconMethod:function(){for(var e in t)t[e]=""}}]:[]}}},events:{change:function(a,t){var i=t.row;i.brand_name=a.brand_name,i.unit_name=a.unit_name,i.goods_id=a.goods_id,i.specification_type=a.specification_type,i.goods_sn=a.goods_sn,i.factory_code=a.factory_code,i.purchase_price=a.purchase_price,e.handleEdit({row:i,column:{property:"purchase_price"}})}}}},{title:"工厂代码",field:"factory_code",width:100},{title:"申请数量",field:"goods_num",width:132,headerAlign:"right",align:"right",editRender:{name:"number",autoselect:!0,events:{input:this.handleEdit}}},{title:"申请采购价",headerAlign:"right",align:"right",field:"purchase_price",width:132,editRender:{name:"Vinput",autoselect:!0,events:{input:this.handleEdit}}},{title:"申请金额",headerAlign:"right",align:"right",field:"subtotal_price",width:132,editRender:{name:"Vinput",autoselect:!0,events:{input:this.handleEdit}}},{title:"是否带票",field:"is_invoices_name",width:150,showOverflow:!0,editRender:{name:"vSelect",getParams:function(){return{modelKey:"is_invoices",list:[{value:1,label:"带票"},{value:2,label:"不带票"}]}}}},{title:"已收货数量",field:"delivery_num",width:132,headerAlign:"right",align:"right"},{title:"收货状态",field:"delivery_status_name",width:132},{title:"审批状态",field:"auditor_status_name",width:132},{title:"审批人",field:"auditor_user_name",width:132},{title:"审批时间",field:"auditor_time_name",width:160},{title:"商品备注",field:"remark",width:200,editRender:{name:"Vinput",formatter:"String"}}]}},methods:{handleEdit:function(e){var a=e.row,t=e.column,i={num:"goods_num",price:"purchase_price",goodsPrice:"subtotal_price"};this.$publicFution.computeTotal(a,i,t.property,this),this.$refs.xTable._proxy("updateFooter")},isEdit:function(e){var a=e.row;return!a.auditor_status||1===a.auditor_status||3===a.auditor_status||(this.$message.warning("只能修改未审核和驳回的单据行！"),!1)},deleteRow:function(){this.$refs.xTable._proxy("getSelectRecords").length?this.$refs.xTable._proxy("removeSelecteds"):this.$message.warning("请先选择要删除的商品！")},addRow:function(){if(void 0==this.params.company_id||""==this.params.company_id)return this.$message.error("请选择采购组织"),!1;this.isShowShopPop=!0},initTurnOrder:function(){var e=this,a=this.$route.params;a.transferType&&this.$axMethod.stockEarlyWarningChangeOrderInfo(a.portParams).then((function(a){var t=a.data;200===t.code&&(e.params.company_id=t.data.info.company_id,e.params.company_name=t.data.info.company_name,e.params.remark=t.data.info.abstract,e.params.requirement_delivery_time=new Date,t.data.goods_list.map((function(a){return e.handleEdit({row:a,column:{property:"goods_num"}}),a})),e.companyList=[{company_id:e.params.company_id,company_name:e.params.company_name}],e.$refs.xTable._proxy("loadData",t.data.goods_list))}))}}}}}]);
//# sourceMappingURL=chunk-7a2ad47e.e7484e62.js.map