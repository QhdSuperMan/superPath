(window["webpackJsonp_erpcode"]=window["webpackJsonp_erpcode"]||[]).push([["chunk-737d4906"],{4997:function(t,e,i){"use strict";i.d(e,"a",(function(){return u})),i.d(e,"b",(function(){return d}));var a=i("1da1"),n=i("ade3"),r=i("d4ec"),s=i("bee2"),l=(i("96cf"),i("d3b7"),i("25f0"),i("159b"),i("4de4"),i("caad"),i("2532"),i("4360"));function o(t){if("function"===typeof t&&t().then)return!0}var u=function(){function t(e){Object(r["a"])(this,t),this._this=e._this,this.addr=[],this.indexSign=null,this.URL=e.url,this.id=e.id,this.errId=e.errId?e.errId:e.id,this.title=e.title?e.title:"审核",this.allTitle=e.allTitle,this.params=e.params,this.before=e.before,this.checkbox=null,this.Data=null,this.showConfirm=e.showConfirm,this.callbackFunc=e.callbackFunc}return Object(s["a"])(t,[{key:"verify",value:function(){return!(this._this.multipleSelection.length<1)||(this._this.$message({message:"请选择需要".concat(this.title,"的信息"),type:"warning"}),!1)}},{key:"confirm",value:function(){var t="确定要“"+this.title+"”此条信息?";return this.allTitle&&(t=this.allTitle),this._this.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}},{key:"sendAjax",value:function(t,e,i){var a,r=this,s=Object.assign(Object(n["a"])({},this.id,t),this.params);this._this.$axMethod[this.URL]?a=this._this.$axMethod[this.URL](s):this._this.$api[this.URL]&&(a=this._this.$axios({url:this._this.$api[this.URL],method:"post",data:s})),a.then((function(t){r.checkbox=r._this.multipleSelection,r.callbackFunc&&r.callbackFunc(t.data),200==t.data.code?(e(t),r.Data=t):i(t)})).catch((function(t){i(t)}))}},{key:"logic",value:function(){var t=this;if(!this.verify())return!1;for(var e=0;e<this._this.multipleSelection.length;e++)this.addr.push(this._this.multipleSelection[e][this.id]);var i=this.addr.toString();return new Promise((function(e,a){if(1==t.showConfirm)t.confirm().then((function(){if(o(t.before))t.before(i).then((function(){return t.sendAjax(i,e,a)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(i,e,a)}));else if(o(t.before))t.before(i).then((function(){return t.sendAjax(i,e,a)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(i,e,a)}))}},{key:"send",value:function(){var t=this;this.logic().then((function(e){var i=e.data;200===i.code&&(t._this.$message.success(i.msg?i.msg:i.data),t._this.onSearch&&t._this.onSearch())}))}},{key:"callback",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,i,a,n,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.logic();case 3:this.Data&&this.Data.data&&this.Data.data.data.length?(e=this.Data.data.data,i=[],e.forEach((function(t){i.push(t.serial)})),a=this.checkbox.filter((function(t){return 1==i.includes(t[r.errId])})),this._this.indexSign.arr=a,this._this.indexSign.str=this.errId,l["a"].commit("setErrorObj",{msg:this.Data.data.msg,table:this.Data.data.data,state:!0})):(n=this.Data.data.msg?this.Data.data.msg:this.Data.data.data,this._this.indexSign.arr=[],this._this.$message({message:n,type:"success"}),this._this.multipleSelection=[],this._this.onSearch&&this._this.onSearch()),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.log();case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));function e(){return t.apply(this,arguments)}return e}()}]),t}(),d=function(){function t(e){var i=e._this,a=e.url,n=e.list,s=void 0===n?[]:n,l=e.params,o=void 0===l?{}:l,u=e.before;Object(r["a"])(this,t),this._this=i,this.url=a,this.list=s,this.params=o,this.before=u}return Object(s["a"])(t,[{key:"sendAjax",value:function(t,e){var i;this._this.$axMethod[this.url]?i=this._this.$axMethod[this.url](this.params):this._this.$api[this.url]&&(i=this._this.$axios({url:this._this.$api[this.url],method:"post",data:this.params})),i.then((function(i){200==i.data.code?t(i):e(i)})).catch((function(t){e(t)}))}},{key:"edit",value:function(){var t=this;return new Promise((function(e,i){if(o(t.before))t.before().then((function(){return t.sendAjax(e,i)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(e,i)}))}},{key:"callback",value:function(){var t=this;return new Promise((function(e,i){t.edit().then((function(a){if(a.data&&a.data.data&&a.data.data.length){l["a"].commit("setErrorObj",{msg:a.data.msg,table:a.data.data,state:!0});var n=[];a.data.data.forEach((function(t){n.push(t.serial)})),t._this.indexSign=n,i(a)}else t._this.$message({message:a.data.msg?a.data.msg:a.data.data,type:"success"}),e(a)}))}))}}]),t}()},"7dac":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",[i("div",{staticClass:"search_container"},[i("el-form",{ref:"filterFormRef",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.params}},[i("el-form-item",{attrs:{label:"采购组织",size:"mini"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",maxlength:"100"},on:{focus:t.companyListInvok,change:t.companyChange},model:{value:t.params.company_id,callback:function(e){t.$set(t.params,"company_id",e)},expression:"params.company_id"}},t._l(t.companyList,(function(e){return i("el-option",{key:e.company_id,attrs:{label:e.company_name,value:e.company_id}},[i("span",{class:1==e.type?"optionStyle":""},[t._v(t._s(e.company_name))])])})),1)],1),i("el-form-item",{attrs:{label:"部门",size:"mini"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"",maxlength:"100"},on:{change:t.departmentChange,focus:t.DepartmentListInvok},model:{value:t.params.department_id,callback:function(e){t.$set(t.params,"department_id",e)},expression:"params.department_id"}},t._l(t.departmentList,(function(t){return i("el-option",{key:t.department_id,attrs:{label:t.department_name,value:t.department_id}})})),1)],1),i("el-form-item",{attrs:{label:"业务日期",size:"mini"}},[i("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.timeValue,callback:function(e){t.timeValue=e},expression:"timeValue"}})],1),i("el-form-item",{attrs:{label:"单据号",size:"mini"}},[i("el-input",{attrs:{maxlength:"100",placeholder:"请输入",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch(1)}},model:{value:t.params.refund_sn,callback:function(e){t.$set(t.params,"refund_sn",e)},expression:"params.refund_sn"}})],1),i("el-form-item",{attrs:{label:"供应商(厂家)",size:"mini"}},[i("el-select",{attrs:{clearable:"",maxlength:"100","filter-method":t.supplierListInvok,filterable:"",placeholder:"请选择"},on:{change:t.supplierChangesave,focus:t.supplierListInvok},model:{value:t.params.supplier_id,callback:function(e){t.$set(t.params,"supplier_id",e)},expression:"params.supplier_id"}},t._l(t.supplierList,(function(t){return i("el-option",{key:t.supplier_id,attrs:{label:t.supplier_name,value:t.supplier_id}})})),1)],1),i("el-form-item",{attrs:{label:"采购员",size:"mini"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择",maxlength:"100"},on:{focus:t.EmployeeListInvok,change:t.buyerChange},model:{value:t.params.employee_id,callback:function(e){t.$set(t.params,"employee_id",e)},expression:"params.employee_id"}},t._l(t.employeeList,(function(t){return i("el-option",{key:t.employee_id,attrs:{label:t.employee_name,value:t.employee_id}})})),1)],1),i("el-form-item",{attrs:{label:"审核状态",size:"mini"}},[i("el-select",{attrs:{clearable:""},model:{value:t.params.auditor_status,callback:function(e){t.$set(t.params,"auditor_status",e)},expression:"params.auditor_status"}},[i("el-option",{attrs:{label:"全部",value:0}},[t._v("全部")]),i("el-option",{attrs:{label:"未审核",value:1}},[t._v("未审核")]),i("el-option",{attrs:{label:"已审核",value:2}},[t._v("已审核")]),i("el-option",{attrs:{label:"作废",value:3}},[t._v("作废")])],1)],1),i("el-form-item",{attrs:{label:"审核日期",size:"mini"}},[i("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.timeValue2,callback:function(e){t.timeValue2=e},expression:"timeValue2"}})],1),i("el-form-item",{attrs:{label:"来源单据",size:"mini"}},[i("el-input",{attrs:{maxlength:"100",placeholder:"请输入",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch(1)}},model:{value:t.params.instorage_sn,callback:function(e){t.$set(t.params,"instorage_sn",e)},expression:"params.instorage_sn"}})],1),i("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.onSearch(1)}}},[t._v("查询")]),i("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.onReset}},[t._v("重置")])],1)],1),i("div",{staticClass:"add_delet"},[1==t.authority.b_add?i("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:t.addRefund}},[t._v("新增")]):t._e(),1==t.authority.b_del?i("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:t.delFun}},[t._v("删除")]):t._e(),1==t.authority.b_pass?i("el-button",{staticClass:"iconfont icon-pass",attrs:{type:"primary",size:"mini"},on:{click:t.examineFun}},[t._v("审核")]):t._e(),1==t.authority.b_nopass?i("el-button",{attrs:{plain:"",size:"mini",icon:"iconfont icon-fanshenhe"},on:{click:t.AUDIT_GET}},[t._v("弃审")]):t._e(),1==t.authority.b_invalid?i("el-button",{staticClass:"iconfont icon-zuofei",attrs:{plain:"",size:"mini"},on:{click:t.abolishFun}},[t._v("作废")]):t._e(),1==t.authority.b_print?i("el-button",{attrs:{plain:"",size:"mini",icon:"el-icon-printer"},on:{click:t.printF}},[t._v("批量打印")]):t._e()],1)],1)]),i("div",{staticClass:"table_container"},[i("xTable",{ref:"xTable",attrs:{ajax:{url:"getRefundList",params:t.params},sign:t.indexSign,tableColumn:t.tableColumn}})],1),t.printFlag?i("div",[i("printRefund",{ref:"printRefund",attrs:{title:"salesReturn"},on:{Search:t.onSearch}})],1):t._e()])},n=[],r=(i("d3b7"),i("159b"),i("d81d"),i("99af"),i("a15b"),i("4de4"),i("caad"),i("2532"),i("78d2")),s={data:function(){var t=this,e=this.$createElement;return{tableColumn:[{type:"checkbox",width:44,align:"center"},{title:"采购组织",field:"company_name",width:130},{title:"操作",width:120,fixed:"right",slots:{default:function(i){return[e("el-button",{attrs:{size:"small",type:"text",disabled:1==!t.authority.b_info},on:{click:function(){return t.handleClick(i.row)}}},[" 查看 "]),e("el-button",{attrs:{size:"small",type:"text",disabled:!(1==i.row.auditor_status&&1==t.authority.b_edit)},on:{click:function(){return t.updateRow(i.row)}}},[" 修改  "]),e("el-button",{attrs:{type:"text",size:"small",disabled:!(1==i.row.after_auditor_print_status&&1==t.authority.b_print&&2==i.row.auditor_status||1!==i.row.after_auditor_print_status&&1==t.authority.b_print)},on:{click:function(){t.printSheet(i.row)}}},["打印"])]}}},{field:"order_sn",width:156,title:"单据号",slots:{default:function(e,i){return[i("a",{on:{click:function(){return t.handleClick(e.row)}}},[" ",e.row.refund_sn," "])]}}},{title:"供应商(厂家)",field:"supplier_name",width:180},{title:"退货数量",field:"num",headerAlign:"right",align:"right",width:70},{title:"总计金额",field:"refund_price",headerAlign:"right",align:"right",width:100,formatter:"priceFormat"},{title:"税额",field:"sub_revenue_price",headerAlign:"right",align:"right",formatter:"priceFormat",width:100},{title:"不含税金额",field:"sub_no_revenue_price",showOverflow:!0,headerAlign:"right",formatter:"priceFormat",align:"right",width:100},{title:"部门",field:"department_name",width:100},{title:"采购员",field:"buyer_name",width:100},{title:"创建人",field:"add_user_name",width:84},{title:"业务日期",field:"business_time",width:120},{title:"单据时间",field:"add_time",width:150},{title:"来源单号",field:"instorage_sn",width:156},{title:"出库类型",field:"add_time",width:80,formatter:function(){return"采购退货"}},{title:"审核状态",field:"auditor_status_name",width:70},{title:"审核人",field:"auditor_name",width:84},{title:"审核时间",field:"auditor_time",width:150},{title:"修改人",field:"update_user_name",width:84},{title:"修改时间",field:"update_time",width:150},{title:"备注",field:"remark",width:180}]}}},l=i("4997"),o={name:"purchaseRefundIndex",mixins:[s],data:function(){return{errorState:!1,trunErrTable:[],authority:{},indexSign:{noDisabled:!0,arr:[]},printFlag:!0,timeValue:[],timeValue2:[],refund_Id:"",params:{},hasAuditorStatusPrint:null}},components:{printRefund:r["a"]},methods:{AUDIT_GET:function(){var t=this,e=new l["a"]({_this:this,id:"refund_id",errId:"refund_sn",url:"purchaseUnAuditorPass",title:"弃审",before:function(e){return t.$baseData.checkCarDoctor({bill_type:14,bill_id:e,operation_type:5})}});e.callback()},printF:function(){for(var t=this,e=!1,i=this.multipleSelection,a=1;a<i.length;a++)if(i[a-1].company_id!=i[a].company_id){e=!0;break}if(this.multipleSelection.length)if(e)this.$message({message:"请选择相同公司单据进行打印",type:"warning"});else{var n=!0,r=[];if(this.multipleSelection.forEach((function(t){1==t.after_auditor_print_status&&2!=t.auditor_status&&(r.push(t.refund_sn),n=!1)})),n)this.multipleSelection.forEach((function(e){t.printSheet(e,!0)}));else{var s=r.map((function(t,e){return"".concat(e+1,".").concat(t)}));this.$alert('以下未审核的单据不可打印：<br/>\n            <div style="color:#e6a23c">\n              '.concat(s.join("，"),"\n            <div>"),"提示",{dangerouslyUseHTMLString:!0})}}else this.$message({message:"请选择单据进行打印",type:"warning"})},printSheet:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.$nextTick((function(){this.$refs.printRefund.printPdf({refund_id:t.refund_id},e)}))},buyerChange:function(t){t&&(this.params.employee_name=this.employeeList.filter((function(e){return e.employee_id===t}))[0].employee_name)},supplierChangesave:function(t){t&&(this.params.supplier_name=this.supplierList.filter((function(e){return e.supplier_id===t}))[0].supplier_name)},selectRowChangeBg:function(t){var e=t.row;return this.multipleSelection.length&&this.multipleSelection.map((function(t){return t.refund_id})).includes(e.refund_id)?"background:#d4e1ee":""},companyChange:function(t){""!=t&&(this.params.company_name=this.companyList.filter((function(e){return e.company_id===t}))[0].company_name),this.$set(this.params,"supplier_id",""),this.$set(this.params,"employee_id",""),this.$set(this.params,"department_id","")},departmentChange:function(t){t&&(this.params.department_name=this.departmentList.filter((function(e){return e.department_id===t}))[0].department_name),this.$set(this.params,"employee_id","")},examineFun:function(){var t=this,e=new l["a"]({_this:this,id:"refund_id",errId:"refund_sn",url:"refundAuditorPass",title:"审核",params:{is_list:1},before:function(e){return t.$baseData.checkCarDoctor({bill_type:14,bill_id:e,operation_type:4})}});e.callback()},abolishFun:function(){var t=this,e=new l["a"]({_this:this,id:"refund_id",errId:"refund_sn",url:"refundAuditorInvalid",title:"作废",before:function(e){return t.$baseData.checkCarDoctor({bill_type:14,bill_id:e,operation_type:6})}});e.callback()},onReset:function(){this.$set(this,"params",{}),this.timeValue=[],this.timeValue2=[],this.onSearch(1)},onSearch:function(t){1===t&&(this.indexSign.arr=[]),this.timeValue&&2==this.timeValue.length?(this.params.start_time=this.timeValue[0],this.params.end_time=this.timeValue[1]):this.params.start_time=this.params.end_time="",this.timeValue2&&2==this.timeValue2.length?(this.params.auditor_start_time=this.timeValue2[0],this.params.auditor_end_time=this.timeValue2[1]):this.params.auditor_start_time=this.params.auditor_end_time="",this.$refs.xTable._getData(t)},delFun:function(){var t=this,e=new l["a"]({_this:this,id:"refund_id",errId:"refund_sn",url:"delRefund",title:"删除",before:function(e){return t.$baseData.checkCarDoctor({bill_type:14,bill_id:e,operation_type:3})}});e.callback()},addRefund:function(){this.$router.push({path:"/purchase/refund/refundAdd"})},handleClick:function(t){this.$router.push({path:"/purchase/refund/refundSee",query:{id:t.refund_id,after_auditor_print_status:t.after_auditor_print_status}})},updateRow:function(t){if(t&&1==t.is_execute)return this.$message.error("wms系统正在操作此单据，暂不支持单据修改"),!1;this.$router.push({path:"/purchase/refund/refundAdd",query:{id:t.refund_id}})}},created:function(){this.authority=JSON.parse(localStorage.getItem("authority")),this.hasAuditorStatusPrint=window.localStorage.hasAuditorStatusPrint},activated:function(){this.onSearch(window.goPage)}},u=o,d=i("2877"),c=Object(d["a"])(u,a,n,!1,null,null,null);e["default"]=c.exports}}]);
//# sourceMappingURL=chunk-737d4906.84bf1231.js.map