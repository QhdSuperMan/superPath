(window["webpackJsonp_service"]=window["webpackJsonp_service"]||[]).push([["chunk-0dd7c8a6"],{"0cb2":function(e,a,t){var n=t("e330"),i=t("7b0b"),o=Math.floor,r=n("".charAt),s=n("".replace),c=n("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,a,t,n,u,m){var h=t+e.length,p=n.length,f=d;return void 0!==u&&(u=i(u),f=l),s(m,f,(function(i,s){var l;switch(r(s,0)){case"$":return"$";case"&":return e;case"`":return c(a,0,t);case"'":return c(a,h);case"<":l=u[c(s,1,-1)];break;default:var d=+s;if(0===d)return i;if(d>p){var m=o(d/10);return 0===m?i:m<=p?void 0===n[m-1]?r(s,1):n[m-1]+r(s,1):i}l=n[d-1]}return void 0===l?"":l}))}},"3e52":function(e,a,t){"use strict";t("6d2a")},"4cd7":function(e,a,t){"use strict";t("a5d3")},5319:function(e,a,t){"use strict";var n=t("2ba4"),i=t("c65b"),o=t("e330"),r=t("d784"),s=t("d039"),c=t("825a"),l=t("1626"),d=t("5926"),u=t("50c4"),m=t("577e"),h=t("1d80"),p=t("8aa5"),f=t("dc4a"),g=t("0cb2"),_=t("14c3"),v=t("b622"),y=v("replace"),b=Math.max,w=Math.min,x=o([].concat),T=o([].push),L=o("".indexOf),k=o("".slice),$=function(e){return void 0===e?e:String(e)},C=function(){return"$0"==="a".replace(/./,"$0")}(),S=function(){return!!/./[y]&&""===/./[y]("a","$0")}(),D=!s((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));r("replace",(function(e,a,t){var o=S?"$":"$0";return[function(e,t){var n=h(this),o=void 0==e?void 0:f(e,y);return o?i(o,e,n,t):i(a,m(n),e,t)},function(e,i){var r=c(this),s=m(e);if("string"==typeof i&&-1===L(i,o)&&-1===L(i,"$<")){var h=t(a,r,s,i);if(h.done)return h.value}var f=l(i);f||(i=m(i));var v=r.global;if(v){var y=r.unicode;r.lastIndex=0}var C=[];while(1){var S=_(r,s);if(null===S)break;if(T(C,S),!v)break;var D=m(S[0]);""===D&&(r.lastIndex=p(s,u(r.lastIndex),y))}for(var z="",I=0,P=0;P<C.length;P++){S=C[P];for(var N=m(S[0]),O=b(w(d(S.index),s.length),0),B=[],R=1;R<S.length;R++)T(B,$(S[R]));var E=S.groups;if(f){var F=x([N],B,O,s);void 0!==E&&T(F,E);var W=m(n(i,void 0,F))}else W=g(N,s,O,B,E,i);O>=I&&(z+=k(s,I,O)+W,I=O+N.length)}return z+k(s,I)}]}),!D||!C||S)},"5f9c":function(e,a,t){"use strict";t.r(a);var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.submitLoading,expression:"submitLoading"}],staticClass:"stock_alarm",attrs:{"element-loading-text":"数据处理中，请等待","element-loading-spinner":"el-icon-loading"}},[t("div",{staticClass:"search_container"},[t("el-form",{ref:"formSearch",attrs:{inline:!0,model:e.params}},[t("el-form-item",{attrs:{label:"库存组织",size:"mini",prop:"company_id",rules:[{required:!0,trigger:"change",message:"请选择"}]}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:""},on:{focus:e.companyListInvok,change:e.companyChange},model:{value:e.params.company_id,callback:function(a){e.$set(e.params,"company_id",a)},expression:"params.company_id"}},e._l(e.companyList,(function(a){return t("el-option",{key:a.company_id,attrs:{label:a.company_name,value:a.company_id}},[t("span",{class:1==a.type?"optionStyle":""},[e._v(e._s(a.company_name))])])})),1)],1),t("el-form-item",{attrs:{label:"商品编号",size:"mini"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入"},model:{value:e.params.goods_sn,callback:function(a){e.$set(e.params,"goods_sn",a)},expression:"params.goods_sn"}})],1),t("el-form-item",{attrs:{label:"商品名称",size:"mini"}},[t("el-select",{attrs:{placeholder:"请选择",filterable:"",remote:"",clearable:"","reserve-keyword":"",loading:e.downLoading,"remote-method":e.getGoodsList},on:{focus:e.getGoodsList},model:{value:e.params.goods_id,callback:function(a){e.$set(e.params,"goods_id",a)},expression:"params.goods_id"}},[t("ul",{staticClass:"warehouse-ul warehouse-ul2 warehouse-ul3"},[t("li",{staticStyle:{width:"80px"}},[e._v("商品编号")]),t("li",{staticStyle:{width:"200px","text-align":"right"}},[e._v("商品名称")])]),e._l(e.goodsList,(function(a,n){return t("el-option",{key:n,attrs:{label:a.goods_name,value:a.goods_id}},[t("ul",{staticClass:"warehouse-ul  warehouse-ul3"},[t("li",{staticStyle:{width:"80px",color:"#8492a6","font-size":"13px"}},[e._v(e._s(a.goods_id))]),t("li",{staticStyle:{width:"200px"},attrs:{title:a.goods_name}},[e._v(e._s(a.goods_name))])])])}))],2)],1),t("el-form-item",{attrs:{label:"仓库",size:"mini"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{focus:e.warehouseInvok},model:{value:e.params.warehouse_id,callback:function(a){e.$set(e.params,"warehouse_id",a)},expression:"params.warehouse_id"}},e._l(e.allWarehouseList,(function(e){return t("el-option",{key:e.warehouse_id,attrs:{label:e.warehouse_name,value:e.warehouse_id}})})),1)],1),t("el-form-item",{attrs:{label:"品牌",size:"mini"}},[t("getBrand",{model:{value:e.params.brand_id,callback:function(a){e.$set(e.params,"brand_id",a)},expression:"params.brand_id"}})],1),t("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.onSearch}},[e._v("查询")]),t("el-button",{attrs:{plain:"",size:"mini"},on:{click:e.onReset}},[e._v("重置")])],1)],1)],1),t("div",{staticClass:"add_delet"},[1==e.authority.b_edit?t("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",disabled:e.addType>=3,size:"mini"},on:{click:e.addF}},[e._v("新增")]):e._e(),1==e.authority.b_del?t("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.deletes}},[e._v("删除")]):e._e(),1==e.authority.b_edit?t("el-button",{attrs:{plain:"",icon:"el-icon-edit-outline",disabled:2==e.addType,size:"mini"},on:{click:e.editlList}},[e._v("修改")]):e._e(),t("el-button",{attrs:{plain:"",icon:"el-icon-tickets",size:"mini",disabled:1==e.addType},on:{click:function(a){return e.saveData("fromTable")}}},[e._v("保存")]),e.addType>=2?t("el-button",{attrs:{plain:"",icon:"el-icon-error",size:"mini"},on:{click:e.cancel}},[e._v("取消")]):e._e()],1),t("div",{staticClass:"table_container"},[t("el-form",{ref:"fromTable",staticClass:"tableForm",attrs:{rules:e.TableData.rules,model:e.TableData,size:"mini"}},[t("vxe-grid",{ref:"xTable",attrs:{border:"","show-header-overflow":!0,"show-overflow":"tooltip","show-footer":"true","footer-method":e.footerMethod,"tooltip-config":{theme:"light"},data:e.TableData.tableData,columns:e.tableColumn,size:"mini",resizable:"","max-height":380}})],1),t("div",{staticClass:"page_container"},[t("div",{staticClass:"pageNumber"},[e._v("每页显示")]),t("el-pagination",{staticClass:"erp-pagination",attrs:{"current-page":e.goPage,"page-size":e.pageSize1,"page-sizes":e.per_page,layout:"total,sizes, prev, pager, next,jumper",prevText:"上一页",nextText:"下一页",total:e.TableData.total},on:{"size-change":e.moduleHandleSizeChange,"current-change":e.moduleHandleCurrentChange,"update:currentPage":function(a){e.goPage=a},"update:current-page":function(a){e.goPage=a}}})],1)],1)])},i=[],o=(t("a9e3"),t("d3b7"),t("159b"),t("4de4"),t("e9c4"),t("d81d"),t("a434"),t("d398")),r=(t("ac1f"),t("5319"),t("caad"),t("1521")),s={data:function(){var e=this,a=this.$createElement;return{tableColumn:[{type:"checkbox",align:"center",width:50},{field:"company_name",title:"库存组织",width:200,showOverflow:!0,headerClassName:function(){e.addClass()},slots:{default:function(t){var n=t.row,i=t.rowIndex,o=n.company_name;return n.edit&&1!=e.addType&&(o=a("el-form-item",{ref:"goods_name",attrs:{prop:"tableData.".concat(i,".company_id"),rules:[{required:!0,trigger:"change",message:"请选择"}]},class:"form-container-purchasepriceindex"},[a("el-select",{attrs:{loading:e.downLoading,placeholder:"请选择",filterable:!0,remote:!0,"remote-method":function(a){return e.getCompanyList(a,n)}},on:{change:function(a){return e.companyRowChange(a,n,i)},focus:function(a){return e.getCompanyList("",n)}},model:{value:n.company_id,callback:function(a){e.$set(n,"company_id",a)}}},[n.companyList.map((function(e){return a("el-option",{attrs:{label:e.company_name,value:e.company_id},key:e.company_id},[a("span",{class:1==e.type?"optionStyle":""},[e.company_name])])}))])])),[o]}}},{field:"goods_id",title:"商品编号",width:150,showOverflow:!0,className:function(){return e.addClass("cellSetBack")}},{field:"goods_name",title:"商品名称",width:300,showOverflow:!0,headerClassName:function(){return e.addClass()},slots:{default:function(t){var n=t.row,i=t.rowIndex,o=n.goods_name;if(n.edit&&1!=e.addType){var r={company_id:n.company_id},s={goods_id:"商品编号",goods_name:"商品名称",factory_code:"工厂代码"};o=a("el-form-item",{ref:"goods_name",attrs:{prop:"tableData.".concat(i,".goods_name"),rules:[{required:!0,trigger:"change",message:"请选择"}]},class:"form-container-purchasepriceindex"},[a("v-goods-list",{ref:"vGoodsList".concat(i),attrs:{vxeParams:r,showObj:s,scopes:{row:n,rowIndex:i},changeGoods:e.handleSelect}})])}return[o]}}},{field:"warehouse_name",title:"预警仓库",width:200,showOverflow:!0,slots:{default:function(t){var n=t.row,i=t.rowIndex,o=n.warehouse_name;return n.edit&&1!=e.addType&&(n.warehouseList||e.$set(n,"warehouseList",[]),o=a("el-form-item",{ref:"goods_name",class:"form-container-purchasepriceindex"},[a("el-select",{attrs:{loading:e.downLoading,placeholder:"请选择"},on:{change:function(a){return e.changeWarehouse(a,n,i)},focus:function(a){return e.getWareHouseList(n)}},model:{value:n.warehouse_id,callback:function(a){e.$set(n,"warehouse_id",a)}}},[n.warehouseList.map((function(e){return a("el-option",{attrs:{label:e.warehouse_name,value:e.warehouse_id},key:e.warehouse_id})}))])])),[o]}}},{field:"brand_name",title:"品牌",width:100,showOverflow:!0},{field:"ceiling_inventory",title:"库存上限",width:100,showOverflow:!0,headerClassName:function(){return e.addClass()},slots:{default:function(t){var n=t.row,i=t.rowIndex,o=n.ceiling_inventory;return n.edit&&1!=e.addType&&(o=a("el-form-item",{ref:"price",attrs:{prop:"tableData.".concat(i,".ceiling_inventory"),rules:[{required:!0,message:"请输入"}]},class:"form-container-purchasepriceindex"},[a("el-input",{attrs:{placeholder:"请输入",type:"number"},on:{input:function(a){return e.linmikNumber(a,n,"ceiling_inventory")}},style:"width:100%",model:{value:n.ceiling_inventory,callback:function(a){e.$set(n,"ceiling_inventory",a)}}})])),[o]}}},{field:"lower_inventory",title:"安全库存",width:100,showOverflow:!0,headerClassName:function(){return e.addClass()},slots:{edit:function(e){e.row,e.rowIndex},default:function(t){var n=t.row,i=t.rowIndex,o=n.lower_inventory;return n.edit&&1!=e.addType&&(o=a("el-form-item",{ref:"price",attrs:{prop:"tableData.".concat(i,".lower_inventory"),rules:[{required:!0,message:"请输入"}]},class:"form-container-purchasepriceindex"},[a("el-input",{attrs:{placeholder:"请输入",type:"number"},on:{input:function(a){return e.linmikNumber(a,n,"lower_inventory")}},style:"width:100%",model:{value:n.lower_inventory,callback:function(a){e.$set(n,"lower_inventory",a)}}})])),[o]}}},{field:"remark",title:"备注",showOverflow:!0,className:"setRemark",slots:{default:function(t){var n=t.row,i=(t.rowIndex,n.remark);return n.edit&&1!=e.addType&&(i=a("el-input",{attrs:{placeholder:"请输入"},model:{value:n.remark,callback:function(a){e.$set(n,"remark",a)}}})),[i]}}}],tableData:[]}},components:{vGoodsList:r["a"]},methods:{linmikNumber:function(e,a,t){a[t]=e.replace(/[^(\-)0-9]/g,"")},addClass:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"addBefore";return 2==this.addType||3==this.addType?e:""},getSelectRecords:function(){var e=this.$refs.xTable.getCheckboxRecords();return e=e.map((function(e){return e._XID&&delete e._XID,e})),e},clearCheckboxRow:function(){this.$refs.xTable.clearCheckboxRow()},updateTableFooter:function(){this.$refs.xTable.updateFooter()},tableReloadRow:function(e){this.$refs.xTable.reloadRow(e)},footerMethod:function(e){var a=this,t=e.columns,n=e.data;return[t.map((function(e,t){return 1===t?"页小计":["ceiling_inventory","lower_inventory"].includes(e.property)?a.$utils.sum(n,e.property):null})),t.map((function(e,t){if(1===t)return"合计";if(a.TableData.allList){if("ceiling_inventory"==e["property"])return a.TableData.allList.total_ceiling_inventory;if("lower_inventory"==e["property"])return a.TableData.allList.total_lower_inventory}return null}))]}}},c=s,l=t("65b0"),d={name:"inventoryWarningStockEarlyWarningIndex",mixins:[o["a"],c],data:function(){return{submitLoading:!1,addFlag:-1,totalArr:[],headerTitle:[],loading:!1,dataList:[],addType:1}},methods:{portSaveData:function(e){var a=this,t="addserviceStockEarlyWarning";3==this.addType&&(t="editserviceStockEarlyWarning"),this.$api[t](e).then((function(e){var t=e.data;200==t.code&&(a.messageTip(t.msg,"success"),a.getTableList(a.searchParams))})).catch((function(e){}))},portDeletStock:function(e){var a=this;this.submitLoading=!0,this.$api.deletserviceStockEarlyWarning(e).then((function(e){var t=e.data;a.submitLoading=!1,200==t.code&&(a.messageTip(t.msg,"success"),a.getTableList(a.searchParams))})).catch((function(e){a.submitLoading=!1}))},getTableList:function(e){var a=this;1!=this.addType&&(this.addType=1);var t=e;t.TableData=this.TableData,t.API="getservice_stationWarningList",t.vm=this,Object(l["b"])(t,2,(function(e){e.data;a.$nextTick((function(){a.updateTableFooter()}))}))},dialogEmployee:function(){var e=this;this.$refs.formSearch.validate((function(a){a&&(e.options.params={company_id:e.params.company_id},e.$refs.upload.stateOpen())}))},dataFilter:function(){var e=this,a=[],t={company_id:Number(localStorage.getItem("company_id")),company_name:"",goods_id:0,goods_name:"",goods_sn:"",factory_code:"",warehouse_id:0,warehouse_name:"",brand_id:"",brand_name:"",unit_name:"",unit_id:0,ceiling_inventory:0,lower_inventory:0,remark:""};return 3==this.addType&&(t.stock_early_warning_id=0),this.TableData.tableData.forEach((function(n,i){if(n.edit){e.$refs["vGoodsList".concat(i)].query||e.$set(e.TableData.tableData[i],"goods_name","");var o=e.$publicFution.filter(t,n);a.push(o)}})),a},saveData:function(e){var a=this,t=this.dataFilter();this.$refs[e].validate((function(e){if(e){var n={stock_early_warning_data:JSON.stringify(t)};a.portSaveData(n)}}))},changeWarehouse:function(e,a){var t="";(e||0==e)&&a.warehouseList.some((function(a){if(a.warehouse_id==e)return t=a.warehouse_name,!0})),a.warehouse_name=t},companyRowChange:function(e,a,t){var n=this,i=["goods_id","goods_name","goods_sn","factory_code","unit_name","unit_id","warehouse_id","warehouse_name","brand_id","brand_name"];i.forEach((function(e){a[e]&&n.$set(a,e,"")}));var o="";e&&a.companyList.some((function(a){if(a.company_id==e)return o=a.company_name,!0})),a.company_name=o},addF:function(){this.TableData.length=this.TableData.tableData.length,1==this.addType&&this.clearCheckboxRow(),this.addType=2,this.addFlag+=1,this.TableData.tableData.unshift({edit:!0,add:"add".concat(this.addFlag),company_id:Number(localStorage.getItem("company_id")),company_name:localStorage.getItem("company_name"),companyList:[{company_id:Number(localStorage.getItem("company_id")),company_name:localStorage.getItem("company_name")}]})},editlList:function(){var e=this,a=this.getSelectRecords();a.length>0?(this.addType=3,a.forEach((function(a,t){a.edit||(e.$set(a,"edit",!0),a.warehouseList=[{warehouse_id:a.warehouse_id,warehouse_name:a.warehouse_name}],a.companyList=[{company_id:a.company_id,company_name:a.company_name}])}))):this.messageTip("请勾选需要修改的内容")},deletes:function(){var e=this,a=this.getSelectRecords();if(a.length<=0)this.messageTip("请勾选需要删除的预警信息");else{var t=[];a.forEach((function(a){a.add?e.TableData.tableData.map((function(e,t,n){if(e.add&&a.add===e.add)return n.splice(t,1),e})):t.push(a.stock_early_warning_id)})),this.addType=1,t.length&&this.messageBox({tipMsg:"确定要删除".concat(t.length,"条已保存的单据？"),cancelMsg:"已取消删除",callBack:function(){e.portDeletStock({stock_early_warning_id:t.toString()})}}),this.$nextTick((function(){e.clearCheckboxRow()}))}},cancel:function(){this.addType=1,this.getTableList(this.searchParams)},getDefaultCompany:function(){this.searchParams.params={},this.$set(this,"params",{company_id:Number(localStorage.company_id)}),this.$set(this,"companyList",[{company_id:Number(localStorage.company_id),company_name:localStorage.company_name}])},onSearch:function(){var e=this;this.$refs.formSearch.validate((function(a){a&&(Object.assign(e.searchParams.params,e.params,{page:1}),e.getTableList(e.searchParams))}))},onReset:function(){this.getDefaultCompany(),Object.assign(this.searchParams.params,this.params,{page:1}),this.getTableList(this.searchParams)},getCompanyList:function(e,a){var t=this;this.downLoading=!0,this.$axMethod.getCompanyListDefalut({company_name:e}).then((function(e){var n=e.data;if(t.downLoading=!1,200==n.code){var i=n.data.company_list;i instanceof Array&&(i.unshift({company_name:n.data.company_name,company_id:n.data.company_id,is_choose:n.data.is_choose,type:1}),t.$set(a,"companyList",i.filter((function(e){return 1==e.is_choose}))))}})).catch((function(e){t.downLoading=!1}))},getWareHouseList:function(e){var a=this,t={company_id:e.company_id};this.downLoading=!0,this.$axMethod.getWarehouseFocus(t).then((function(t){var n=t.data;if(a.downLoading=!1,200==n.code){var i=n.data;i.unshift({warehouse_id:0,warehouse_name:"全部仓库"}),a.$set(e,"warehouseList",i)}})).catch((function(e){a.downLoading=!1}))},handleSelect:function(e,a){var t=this,n=a.row;a.rowIndex;if(e.disabled)return!1;var i=n,o=["goods_id","goods_name","goods_sn","factory_code","unit_name","unit_id","brand_id","brand_name"];o.forEach((function(a){t.$set(i,a,e[a])})),this.tableReloadRow(i)}},mounted:function(){this.getDefaultCompany(),this.searchParams.params={},Object.assign(this.searchParams.params,this.params,{page:1}),this.getTableList(this.searchParams)}},u=d,m=(t("4cd7"),t("3e52"),t("2877")),h=Object(m["a"])(u,n,i,!1,null,"690a2ab1",null);a["default"]=h.exports},"6d2a":function(e,a,t){},a5d3:function(e,a,t){},d398:function(e,a,t){"use strict";t("d3b7"),t("159b");var n={data:function(){return{downLoading:!1,goodsList:[]}},computed:{allWarehouseList:function(){var e=this.warehouseList;return e.length>0&&e.unshift({relation_warehouse_id:0,warehouse_id:-1,warehouse_name:"全部仓库"}),e}},methods:{moduleHandleSizeChange:function(e){Object.assign(this.searchParams.params,{per_page:e,page:1}),this.getTableList(this.searchParams)},moduleHandleCurrentChange:function(e){Object.assign(this.searchParams.params,{page:e}),this.getTableList(this.searchParams)},companyChange:function(e){-1!=this.params.warehouse_id&&this.$set(this.params,"warehouse_id","")},messageTip:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"tip",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";void 0==this._messageBox?this._messageBox=[]:this._messageBox.forEach((function(e){e.close()}));var t=this.$message({message:e,type:a});this._messageBox.push(t)},messageBox:function(e){var a=this,t=e.title,n=void 0===t?"提示":t,i=e.tipMsg,o=void 0===i?"":i,r=e.type,s=void 0===r?"warning":r,c=e.conBtnText,l=void 0===c?"确定":c,d=e.canBtnText,u=void 0===d?"取消":d,m=e.cancelMsg,h=e.callBack;this.$confirm(o,{title:n,confirmButtonText:l,cancelButtonText:u,showCancelButton:!!u,dangerouslyUseHTMLString:!0,type:s}).then((function(){h&&h()})).catch((function(){m&&a.$message({type:"info",message:m})}))}},mounted:function(){var e=this.$refs.tableName,a=this.$refs.table_sum;if(e&&a){var t=e.$el.getElementsByClassName("el-table__body-wrapper")[0];t.addEventListener("scroll",(function(){a.scrollLeft=this.scrollLeft}))}}};a["a"]=n}}]);
//# sourceMappingURL=chunk-0dd7c8a6.bb9d5945.js.map