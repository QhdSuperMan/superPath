(window["webpackJsonp_service"]=window["webpackJsonp_service"]||[]).push([["chunk-50c802c4"],{4997:function(t,e,a){"use strict";a.d(e,"a",(function(){return d}));var i=a("1da1"),n=a("ade3"),o=a("d4ec"),r=a("bee2"),s=(a("96cf"),a("d3b7"),a("25f0"),a("159b"),a("4de4"),a("caad"),a("2532"),a("4360"));function l(t){if("function"===typeof t&&t().then)return!0}var d=function(){function t(e){Object(o["a"])(this,t),this._this=e._this,this.addr=[],this.indexSign=null,this.URL=e.url,this.id=e.id,this.errId=e.errId?e.errId:e.id,this.title=e.title?e.title:"审核",this.allTitle=e.allTitle,this.params=e.params,this.before=e.before,this.checkbox=null,this.Data=null,this.showConfirm=e.showConfirm,this.callbackFunc=e.callbackFunc}return Object(r["a"])(t,[{key:"verify",value:function(){return!(this._this.multipleSelection.length<1)||(this._this.$message({message:"请选择需要".concat(this.title,"的信息"),type:"warning"}),!1)}},{key:"confirm",value:function(){var t="确定要“"+this.title+"”此条信息?";return this.allTitle&&(t=this.allTitle),this._this.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}},{key:"sendAjax",value:function(t,e,a){var i,o=this,r=Object.assign(Object(n["a"])({},this.id,t),this.params);this._this.$axMethod[this.URL]?i=this._this.$axMethod[this.URL](r):this._this.$api[this.URL]&&(i=this._this.$axios({url:this._this.$api[this.URL],method:"post",data:r})),i.then((function(t){o.checkbox=o._this.multipleSelection,o.callbackFunc&&o.callbackFunc(t.data),200==t.data.code?(e(t),o.Data=t):a(t)})).catch((function(t){a(t)}))}},{key:"logic",value:function(){var t=this;if(!this.verify())return!1;for(var e=0;e<this._this.multipleSelection.length;e++)this.addr.push(this._this.multipleSelection[e][this.id]);var a=this.addr.toString();return new Promise((function(e,i){if(1==t.showConfirm)t.confirm().then((function(){if(l(t.before))t.before(a).then((function(){return t.sendAjax(a,e,i)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(a,e,i)}));else if(l(t.before))t.before(a).then((function(){return t.sendAjax(a,e,i)}));else if(t.before&&t.before()||!t.before)return t.sendAjax(a,e,i)}))}},{key:"send",value:function(){var t=this;this.logic().then((function(e){var a=e.data;200===a.code&&(t._this.$message.success(a.msg?a.msg:a.data),t._this.onSearch&&t._this.onSearch())}))}},{key:"callback",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,a,i,n,o=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.logic();case 3:this.Data&&this.Data.data&&this.Data.data.data.length?(e=this.Data.data.data,a=[],e.forEach((function(t){a.push(t.serial)})),i=this.checkbox.filter((function(t){return 1==a.includes(t[o.errId])})),this._this.indexSign.arr=i,this._this.indexSign.str=this.errId,s["a"].commit("setErrorObj",{msg:this.Data.data.msg,table:this.Data.data.data,state:!0})):(n=this.Data.data.msg?this.Data.data.msg:this.Data.data.data,this._this.indexSign.arr=[],this._this.$message({message:n,type:"success"}),this._this.multipleSelection=[],this._this.onSearch&&this._this.onSearch()),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.log();case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));function e(){return t.apply(this,arguments)}return e}()}]),t}()},a35c:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"params"},[a("vxe-modal",{attrs:{title:"适配车型",id:"inReceiptSelectOrder",width:"1200","esc-closable":!0,"destroy-on-close":"",height:"500","min-width":"600","min-height":"100",resize:"",remember:"",storage:"",transfer:""},on:{hide:function(e){return t.$emit("input",!1)}},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.tableData.length?a("div",[a("div",{staticClass:"el_tree_box"},[a("xTable",{ref:"xTable",attrs:{tableColumn:t.tableColumn,maxHeight:"380",xData:t.tableData}}),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,20,30,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)]):t.loading?t._e():a("div",{staticClass:"dialog-footer"},[t._v(" 适配车型无数据 ")])])])],1)},n=[],o=a("b85c"),r=(a("e3df"),a("3db6"),a("74af"),a("fde8"),a("c9ce"),a("b1f0"),a("3c64"),a("f043")),s={data:function(){var t=this;return{loading:!1,tableColumn:[{title:"车款",field:"sales_name",formatter:function(t){var e=t.row;return e.sales_name?e.sales_name:e.attr_value_name},width:250},{title:"品牌",field:"brand_name",width:70},{title:"厂家",field:"show_name",width:100},{title:"车系",field:"car_series",width:120},{title:"排放标准",field:"emission_standard",width:70},{title:"年款",field:"years",width:100},{title:"上市年份",field:"c_variant_sop",width:120},{title:"生产年份",field:"c_variant_sop",width:120},{title:"停产年份",field:"c_variant_eop",width:100},{title:"排量",field:"displacement",width:100},{title:"发动机",field:"engine_type",width:100},{title:"适配来源",field:"unit_name",width:100,formatter:function(e){var a=e.row;return 1==t.idsObj[a.car_lib_id]?"OE码匹配":"自主选择"}}],idsObj:{},tableData:[],currentPage:1,pageSize:10,total:0}},watch:{value:function(t){!0===t&&2===this.type&&this.getLibraryId()},library_id:function(){1===this.type&&this.getLibraryId()},ids:function(){this.getData()}},props:{value:null,type:{type:Number,default:1},library_id:{type:Number|String,default:""},shop_goods_id:{type:Number|String,default:""},ids:{type:Array,default:function(){return[]}}},created:function(){var t=this;this.alltableData=[],this.allData=[],Object(r["a"])((function(e){var a=[];for(var i in e.data){var n,r=Object(o["a"])(e.data[i]);try{for(r.s();!(n=r.n()).done;){var s=n.value;a.push(s)}}catch(l){r.e(l)}finally{r.f()}}t.allData=a,t.$emit("loaded"),1==t.type&&t.getData()}))},methods:{getLibraryId:function(){var t=this;this.init(),this.library_id?(this.loading=!0,this.$api.serviceStationGetOeCodeOrCarLibraryList({library_id:this.library_id}).then((function(e){var a=e.data;if(200==a.code){var i=[],n=[];for(var o in a.data.car_library)i=i.concat(a.data.car_library[o]);for(var r in a.data.oe_code)n.push(a.data.oe_code[r]);t.ids=i,t.$emit("getOeCode",n.join(","))}t.loading=!1,t.getAttributeCarLibraryList()})).catch((function(){t.loading=!1}))):this.getAttributeCarLibraryList()},submit:function(){this.$emit("sumbitData",{params:this.currentRow,selectBox:this.selectBox})},GetValue:function(t){if(t)return this.$api.serviceStationGetOeCodeOrCarLibraryList({library_id:t})},getAttributeCarLibraryList:function(){var t=this;this.shop_goods_id&&0===this.ids.length&&this.$api.getAttributeCarLibraryList({shop_goods_id:this.shop_goods_id}).then((function(e){var a=e.data;if(200==a.code){var i=[];for(var n in a.data)i=i.concat(a.data[n]);t.alltableData=i,t.handleCurrentChange(1)}}))},getFairModelData:function(t){for(var e="",a=0;a<t.length;a++){if(e.length>100)break;e=e+t[a].sales_name+","}this.$emit("renderModel",e.slice(0,-1)),this.$parent.showModelsName=e.slice(0,-1)},handleCurrentChange:function(t){var e=this.alltableData.concat([]);this.tableData=e.splice((t-1)*this.pageSize,this.pageSize)},handleSizeChange:function(t){this.pageSize=t},init:function(){this.currentPage=1,this.total=0,this.alltableData=[],this.tableData=[]},getData:function(){var t=this;if(this.init(),this.allData.length&&this.ids.length){this.idsObj={};for(var e=0;e<this.ids.length;e++){if(-1==this.ids[e].car_lib_id)return this.total=this.allData.length,this.alltableData=this.allData,this.handleCurrentChange(1),this.$emit("getData",[{sales_name:"通用车型"}]),void this.getFairModelData([{sales_name:"通用车型"}]);this.idsObj[this.ids[e].car_lib_id]=this.ids[e].match_type}var a=[],i=[];this.allData.forEach((function(e){1==t.idsObj[e.car_lib_id]&&i.push(e),0==t.idsObj[e.car_lib_id]&&a.push(e)})),this.total=i.length+a.length,this.alltableData=a.concat(i),this.handleCurrentChange(1),this.$emit("getData",this.alltableData),this.getFairModelData(this.alltableData)}}}},l=s,d=a("2877"),c=Object(d["a"])(l,i,n,!1,null,"5577fe30",null);e["a"]=c.exports},a462:function(t,e,a){"use strict";a("c57e")},c57e:function(t,e,a){},eb0b:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"companyGoods_base"},[a("div",{attrs:{id:"leixin"}},[a("div",{staticClass:"search_container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.params}},[a("el-form-item",{attrs:{label:"组织名称",size:"mini"}},[a("getServiceCompany",{model:{value:t.params.company_id,callback:function(e){t.$set(t.params,"company_id",e)},expression:"params.company_id"}})],1),a("el-form-item",{attrs:{label:"商品名称",size:"mini"}},[a("el-input",{attrs:{maxlength:"100",placeholder:"请输入",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.params.goods_name,callback:function(e){t.$set(t.params,"goods_name",e)},expression:"params.goods_name"}})],1),a("el-form-item",{attrs:{label:"商品编码",size:"mini"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.params.goods_id,callback:function(e){t.$set(t.params,"goods_id",e)},expression:"params.goods_id"}})],1),a("el-form-item",{staticStyle:{width:"350px"},attrs:{label:"助记码/自定义编码",size:"mini","label-width":"150px"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.params.goods_sn,callback:function(e){t.$set(t.params,"goods_sn",e)},expression:"params.goods_sn"}})],1),a("el-form-item",{attrs:{label:"工厂编码",size:"mini"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}},model:{value:t.params.factory_code,callback:function(e){t.$set(t.params,"factory_code",e)},expression:"params.factory_code"}})],1),a("el-form-item",{attrs:{label:"商品分类",size:"mini"}},[a("jybd-cascader",{ref:"cascader",attrs:{cascaderVue:t.cascaderVue},on:{cascaderChange:t.cascaderChange}})],1),a("el-form-item",{attrs:{label:"商品品牌",size:"mini"}},[a("getServiceBrand",{attrs:{showObj:{brand_name:"名称"},searchParams:{goods_type_id:t.params.goods_type_id}},model:{value:t.params.brand_id,callback:function(e){t.$set(t.params,"brand_id",e)},expression:"params.brand_id"}})],1),a("el-form-item",{staticClass:"search-style search",attrs:{size:"mini"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.onSearch}},[t._v("查询")]),a("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.onReset}},[t._v("重置")])],1)],1)],1),a("div",{staticClass:"add_delet"},[1==t.authority.b_add?a("el-button",{staticClass:"addBtn",attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"mini"},on:{click:t.add}},[t._v("新增 ")]):t._e(),1==t.authority.b_del?a("el-button",{attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:t.deletes}},[t._v("删除 ")]):t._e(),1==t.authority.b_export_file?a("el-dropdown",{staticStyle:{margin:"0 10px"}},[a("span",{staticStyle:{cursor:"pointer",color:"#4e90e2"},attrs:{"split-button":""}},[a("el-button",{attrs:{plain:"",icon:"iconfont icon-daochu10",size:"mini"}},[t._v("导出")])],1),a("el-dropdown-menu",{staticStyle:{"margin-top":"10px"},attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(e){return t.exportOrder(1)}}},[t._v("导出Excel文件")]),a("el-dropdown-item",{nativeOn:{click:function(e){return t.exportOrder(2)}}},[t._v("导出CSV逗号分隔")])],1)],1):t._e(),a("el-button",{attrs:{plain:"",icon:"el-icon-download",size:"mini"},on:{click:t.openDownload}},[t._v("下载模板")]),1==t.authority.b_import?a("el-button",{staticClass:"addBtn",attrs:{plain:"",icon:"iconfont icon-daoru5",size:"mini"},on:{click:function(e){return t.$refs.upload.stateOpen()}}},[t._v("导入")]):t._e()],1)]),a("div",{staticClass:"table_container"},[a("xTable",{ref:"xTable",attrs:{ajax:{url:"serviceStationgetGoodsList",params:t.params},tableColumn:t.tableColumn,isEdit:function(){return t.authority.b_list_edit}}})],1),t.isShowDownload?a("div",[a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"下载模板",visible:t.isShowDownload,width:"600px"},on:{close:t.closeDownload,"update:visible":function(e){t.isShowDownload=e}}},[a("el-form",{ref:"downloadPrams",staticClass:"demo-form-inline goodsbase_top",attrs:{inline:!0,model:t.downloadPrams}},[a("el-form-item",{attrs:{label:"组织名称",prop:"company_id",rules:{required:!0,message:"请选择组织"}}},[a("getServiceCompany",{attrs:{fatherParams:t.downloadPrams},model:{value:t.downloadPrams.company_id,callback:function(e){t.$set(t.downloadPrams,"company_id",e)},expression:"downloadPrams.company_id"}})],1),a("el-form-item",{attrs:{label:"商品类型",prop:"goods_type_id",rules:{required:!0,message:"请选择商品类型"}}},[a("jybd-cascader",{on:{cascaderChange:t.handleChange}})],1)],1),a("div",{staticClass:"dialog-footer"},[a("el-button",{on:{click:t.closeDownload}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.downLoadFile}},[t._v("确定")])],1)],1)],1):t._e(),a("modelDetail",{ref:"library",attrs:{type:2,library_id:t.currentCarIds},on:{loaded:function(e){t.loaded=!0}},model:{value:t.isShowModelDetail,callback:function(e){t.isShowModelDetail=e},expression:"isShowModelDetail"}}),a("upload",{ref:"upload",attrs:{options:t.options},on:{receiveUploadMsg:t.receiveUploadMsg}})],1)},n=[],o=a("4997"),r=(a("b64b"),{company_id:"",brand_id:"",goods_name:"",goods_type_id:"",unit_id:"",guide_price:"",goods_sn:"",factory_code:""}),s={data:function(){var t=this,e=this.$createElement;return{footerData:{},tableColumn:[{type:"checkbox",width:44,align:"center"},{type:"index",title:"序号",width:50},{title:"库位码",field:"goods_sn",width:100},{field:"name",title:"操作",width:100,fixed:"right",align:"center",slots:{default:function(a){return[e("el-button",{attrs:{size:"small",type:"text",disabled:1!=t.authority.b_info},on:{click:function(){return t.goDetail(a.row)}}},[" ","查看"," "]),e("el-button",{attrs:{size:"small",type:"text",disabled:1!=t.authority.b_edit},on:{click:function(){return t.add(a.row)}}},[" ","修改"," "])]}}},{title:"品牌",field:"brand_name",width:100},{title:"类型",field:"goods_type_name",minWidth:100},{title:"型号",field:"goods_model",width:100},{title:"适配车型",field:"auditor_time",width:100,slots:{default:function(a){return[e("el-link",{attrs:{target:a.row.library_id?"primary":"_blank",disabled:!a.row.library_id},on:{click:function(){t.currentCarIds=a.row.library_id,t.$refs.library.GetValue(a.row.library_id).then((function(e){var a=e.data;Object.keys(a.data.car_library).length&&(t.isShowModelDetail=!0)}))}}},[a.row.car_library])]}}},{title:"OE码",field:"oe_code",minWidth:100},{title:"组织名称",field:"company_name",width:140},{title:"单位",field:"unit_name",width:50},{title:"商品货号",field:"inventory_goods_id",width:80},{title:"销售价",field:"guide_price",headerAlign:"right",align:"right",width:100,editRender:{name:"Vinput",formatter:"positive",autoselect:!0,events:{change:function(e){var a=e.row;a.guide_price>0?t.editGoods(a):a.guide_price=""}}}}]}},methods:{editGoods:function(t){var e=this,a={inventory_goods_id:t.inventory_goods_id,guide_price:t.guide_price,goods_sn:t.goods_sn,taxrate:t.taxrate};this.$api.serviceStationEditPart(a).then((function(t){var a=t.data;200==a.code&&(e.$message.success(a.msg),e.onSearch())}))}}},l=a("a35c"),d={name:"service_station_inventory_goods",mixins:[s],data:function(){return{options:{title:"商品信息导入",url:"/service_station/system/Goods/importGoods"},downloadPrams:{company_id:"",goods_type_id:""},loaded:!1,isShowModelDetail:!1,isShowDownload:!1,params:this.$publicFution.deepCopy(r),currentCarIds:""}},components:{modelDetail:l["a"]},methods:{handleChange:function(t){var e=this;this.downloadPrams.goods_type_id_1=t[0],this.downloadPrams.goods_type_id_2=t[1],this.downloadPrams.goods_type_id=t[2],this.$nextTick((function(){e.$refs.downloadPrams.validateField("goods_type_id")}))},cascaderChange:function(t){this.cascaderVue=t,this.params.goods_type_id=t[2]},openDownload:function(){this.isShowDownload=!0,this.downloadPrams={company_id:localStorage.getItem("company_id"),company_name:localStorage.getItem("company_name"),goods_type_id:""}},closeDownload:function(){this.isShowDownload=!1},receiveUploadMsg:function(){this.onSearch()},goDetail:function(t){this.$router.push({path:"/service_station_goods/service_station_inventory_goods/service_station_inventory_goods_see",query:{id:t.inventory_goods_id}})},add:function(t){this.$router.push({path:"/service_station_goods/service_station_inventory_goods/service_station_inventory_goods_add",query:{id:t.inventory_goods_id}})},downLoadFile:function(){var t=this;this.$refs.downloadPrams.validate((function(e){e&&(t.downloadPrams.company_id=t.downloadPrams.company_id?t.downloadPrams.company_id:localStorage.getItem("company_id"),t.$api.serviceStationDownloadFile(t.downloadPrams).then((function(t){200==t.data.code&&window.open(t.data.data.url)})))}))},onReset:function(){this.params=this.$publicFution.deepCopy(r),this.cascaderVue=[],this.onSearch(1)},deletes:function(){new o["a"]({id:"inventory_goods_id",_this:this,title:"删除",url:"serviceStationDelCompanyGoods",showConfirm:!0}).send()},exportOrder:function(t){var e=Object.assign(this.params,{export_type:t});this.$api.serviceStationExportGoodsUrl(e).then((function(t){200==t.data.code&&(window.location.href=t.data.data.url)}))},onSearch:function(t){this.$refs.xTable._getData(t)}},created:function(){console.log(this)},activated:function(){this.onSearch(window.goPage)}},c=d,h=(a("a462"),a("2877")),u=Object(h["a"])(c,i,n,!1,null,"7c578b48",null);e["default"]=u.exports},f043:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("410a"),a("6f78"),a("b1f0"),a("3c64");var i=a("fc5a"),n=a("9887"),o=a.n(n);function r(t){var e="car_librarys_csv_874654166";if(window[e])return t({code:200,data:window[e]});function a(t){if(!(window.localStorage&&window.indexedDB&&window.indexedDB.open))return t(!1);var e=indexedDB.open("jybd-car",1);e.onerror=function(e){console.log("数据库打开报错"),t(!1)},e.onsuccess=function(a){console.log("数据库打开成功"),t(e.result)},e.onupgradeneeded=function(t){t.target.result.objectStoreNames.contains("car_choice")||t.target.result.createObjectStore("car_choice",{keyPath:"id"})}}function n(t,e){o.a.get(t).then((function(t){for(var a=t.data.split("\n"),i=[],n=a[1].split(","),o=2;o<a.length;o++){for(var r={},s=a[o].split(","),l=0;l<s.length;l++)n[l]&&(r[n[l]]=s[l]);r.car_lib_id&&i.push(r)}e({code:200,data:i})}))}function r(t,i){window[e]=t,a((function(a){if(!1!==a){var n=a.transaction(["car_choice"],"readwrite").objectStore("car_choice").put({id:0,data:t});n.onsuccess=function(t){window.localStorage.setItem(e,i.data.update_time),console.log("数据库存储成功")},n.onerror=function(t){console.log("Database error: ",t.target.error)}}}))}function s(t,i){if(200==t.code&&window.localStorage&&window.localStorage.getItem&&window.localStorage.getItem(e)!=t.data.update_time)return i();a((function(t){if(!1===t)return i();var a=t.transaction(["car_choice"]).objectStore("car_choice").get(0);a.onsuccess=function(t){console.log("数据库读取成功");var n=a.result&&a.result.data;i(n),n&&(window[e]=n)},a.onerror=function(t){console.log("Database error: ",t.target.error),i()}}))}function l(t){Object(i["a"])({type:"get",url:"v2/open/Excel/getCarLibraryExcel"}).then((function(e){try{e=JSON.parse(e.data.data)}catch(a){}t({code:e.code,data:e.result})})).catch((function(){t({code:400,message:"服务器错误，请联系管理员"})}))}function d(t){var e={};return t.forEach((function(t){e[t.brand_letter]||(e[t.brand_letter]=[]),e[t.brand_letter].push(t)})),e}l((function(e){s(e,(function(a){return a?t({code:200,data:a}):200!=e.code?t(e):void n(e.data.url,(function(a){a.data=d(a.data),t(a),200==a.code&&setTimeout((function(){r(a.data,e)}),100)}))}))}))}}}]);
//# sourceMappingURL=chunk-50c802c4.41979e50.js.map