<script src="../../dist/vue.global.js"></script>

<div id="demo">
  <h1>Latest Vue.js Commits {{ currentBranch }}</h1>
  <son :branch='currentBranch'></son>
</div>

<script>
  const {
    createApp,
    ref,
    watchEffect,
    reactive,
    getCurrentInstance
  } = Vue
  const API_URL = `https://api.github.com/repos/vuejs/vue-next/commits?per_page=3&sha=`

  const truncate = v => {
    const newline = v.indexOf('\n')
    return newline > 0 ? v.slice(0, newline) : v
  }

  const son = {
    setup(props) {
      console.log(getCurrentInstance())
      const sonData = ref(props.fatherDataf)
      return {
        sonData
      }
    },
    template: `<span>1111111111 {{ sonData }} {{ branch }}</span>`,
    props: ['branch']
  }


  const formatDate = v => v.replace(/T|Z/g, ' ')
  createApp({
    components: {
      son
    },
    setup() {
      console.log(getCurrentInstance())
      const currentBranch = ref('master')
      const commits = ref(null)

      // watchEffect(() => {
      //   fetch(`${API_URL}${currentBranch.value}`)
      //     .then(res => res.json())
      //     .then(data => {
      //       commits.value = data
      //     })
      // })

      return {
        branches: ['master', 'sync'],
        currentBranch,
        commits,
        truncate,
        formatDate
      }
    }
  }).mount('#demo')
</script>

<style>
  #demo {
    font-family: 'Helvetica', Arial, sans-serif;
  }

  a {
    text-decoration: none;
    color: #f66;
  }

  li {
    line-height: 1.5em;
    margin-bottom: 20px;
  }

  .author,
  .date {
    font-weight: bold;
  }
</style>