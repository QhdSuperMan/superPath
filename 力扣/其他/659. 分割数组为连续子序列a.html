<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  </head>

  <body>
    <script>
      

      // function test(arr) {
      //   if (arr.length < 3) {
      //     return false
      //   }
      //   var length = arr.length
      //   var result = []
      //   var current = 0
      //   var step = 0
      //   for (var i = 0; i < length; i++) {
      //     var resultSon = arr[i - 1]
      //     if (resultSon) {
      //       if (arr[i] === resultSon + 1) {
      //         if (arr[i + step] && arr[i + step] === arr[i]) {
      //           step = 0
      //         } else {
      //           current += step
      //         }
      //         result[current].push(arr[i])
      //       } else if (arr[i] === resultSon) {
      //         step++
      //         if (!result[current + step]) {
      //           result[current + step] = []
      //         }
      //         result[current + step].push(arr[i])
      //       } else {
      //         return false
      //       }
      //     } else {
      //       result[current] = []
      //       result[current].push(arr[i])
      //     }
      //   }
      //   console.log(result)
      //   return result.every(val => val.length > 3)
      // }
      // console.log(test(arr))


      // var arr = [1, 2, 3,3,3,3, 3,4,4,4, 4,5,5,5,5,6,7,8]
      // var isPossible = function qiefen(nums) {
      //   var dp1 = 0,
      //     dp2 = 0,
      //     dp3 = 0,
      //     i = 0
      //   while (i < nums.length) {
      //     var start = i,
      //     left
      //     while (i < nums.length && nums[i] === nums[++i]) {}
      //     if (start > 0 && nums[start - 1] + 1 < nums[start]) {// 当出现不连续之后 如果有长度为1的子串 或者长度为2的子串 则返回false
      //       if (dp1 || dp2) return false
      //       dp1 = i - start, dp3 = 0
      //     } else {
      //       if ((left = i - start - dp1 - dp2) < 0) return false
      //       var _dp2 = dp2
      //       dp2 = dp1
      //       if (left > dp3) {
      //         dp1 = left - dp3
      //         dp3 = dp3 + _dp2
      //       } else {
      //         dp1 = 0
      //         dp3 = left + _dp2
      //       }
      //     }
      //   }
      //   return dp1 === 0 && dp2 === 0
      // }
      // isPossible(arr)


      var arr = [1, 2, 3, 4, 5]
      var isPossible = function (nums) {
        for (var i = 0, h = new Map; i < nums.length; i++) set(h, nums[i], 1)
        for (var i = 0, m = new Map; i < nums.length; i++) {
          if (!h.has(nums[i])) continue
          if (m.has(nums[i] - 1)) {
            set(m, nums[i] - 1, -1)
            set(m, nums[i], 1)
          } else {
            if (h.has(nums[i] + 1) && h.has(nums[i] + 2)) {
              set(h, nums[i] + 1, -1)
              set(h, nums[i] + 2, -1)
              set(m, nums[i] + 2, 1)
            } else return false
          }
          set(h, nums[i], -1)
          debugger
        }
        return true
      };
      var set = (m, n, v, t) =>
        m.has(n) ? (t = m.get(n) + v) === 0 ? m.delete(n) : m.set(n, t) : m.set(n, v)

      isPossible(arr)


















      function demo(nums) {
        var box = [1, null]
        var prev = 0
        var obj = {}
        for (var i = 0; i < nums.length; i++) {
          if ((nums[i + 1] && nums[i + 1] > nums[i])) {
            if (nums[i + 1] - nums[i] > 1) {
              break;
            }
            if (box[0] && box[1]) {
              if (!nums[i + 2] || (nums[i + 2] && nums[i + 2] !== nums[i + 1])) {
                box[prev]++
                if (box[prev] < 4) {
                  return false
                } else {
                  box[prev] = null
                  prev = (prev == 0 ? 1 : 0)
                }
              }
            }
            box[0] && box[0]++
            box[1] && box[1]++
          } else {
            if (nums[i + 1]) {
              if (nums[i + 1] === nums[i]) {
                if (!box[prev === 0 ? 1 : 0]) {
                  box[prev === 0 ? 1 : 0] = 1
                }
              }
            }
          }
        }
        if (box[0] && box[1]) {
          if (!nums[i + 2] || (nums[i + 2] && nums[i + 2] !== nums[i + 1])) {
            box[prev]++
            if (box[prev] < 4) {
              return false
            } else {
              box[prev] = null
              prev = (prev == 0 ? 1 : 0)
              box[prev]++
            }
          }
        } else {
          box[prev]++
        }
        if (box[prev] < 4) {
          return false
        }
        return true
      }
    </script>
  </body>

</html>